import{s as It,m as Oe,g as z,n as ft,f as k,e as li,c as ai,b as ui,v as Be,k as Kl,_ as yl,Y as pc,P as e$,Z as gp,L as hn,l as Dn,o as On,M as cn,N as pn,O as dn,U as ye,w as R,X as I,V as bt,q as Cp,W as hi,a2 as YT,a3 as ih,u as dc,C as XT,a4 as Zh,a5 as WT,a6 as Hd,r as ZT,a as QT,a7 as JT,a8 as eD,h as tD}from"../chunks/scheduler.t7vxtD6u.js";import{S as Ft,i as Kt,g as Ul,t as C,c as Hl,a as g,b as M,d as T,m as D,e as O,f as F}from"../chunks/index.CHhTF49h.js";import{g as Li,a as Ai,T as Cv,k as nD,O as iD,i as t$,j as n$,E as sD,l as rD,n as oD,o as lD,W as aD}from"../chunks/Earth.CkDENJS7.js";import{l as uD}from"../chunks/index.BgdColIh.js";import{w as Sf}from"../chunks/index.CDZL4280.js";const hD=!0,cD=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function jC(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function Ve(n){return n==null}function Lf(n){return n!==null&&typeof n=="object"}function Pv(n){return n!==null&&typeof n=="object"}function pD(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function io(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return Pv(r)&&Pv(o)?Object.assign(Object.assign({},i),{[s]:io(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function dD(n){return Lf(n)?"target"in n:!1}const mD={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let so=class vl{static alreadyDisposed(){return new vl({type:"alreadydisposed"})}static notBindable(){return new vl({type:"notbindable"})}static notCompatible(e,t){return new vl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new vl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new vl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=mD[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},NC=class i${constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!i$.isBindable(i))throw so.notBindable();if(!(e in i))throw so.propertyNotFound(e);i[e]=t}},mn=class{constructor(){this.observers_={}}on(e,t,i){var s;let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t,key:(s=i==null?void 0:i.key)!==null&&s!==void 0?s:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.key!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},vD=class{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new mn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},fD=class{constructor(e){this.emitter=new mn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},wD=class{constructor(e){this.emitter=new mn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function tt(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new fD(n):new vD(n,e)}function _D(n){return[new wD(n),(e,t)=>{n.setRawValue(e,t)}]}let _e=class s${constructor(e){this.emitter=new mn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:tt(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new s$(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},Pp=class{constructor(e){this.values=_e.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},bD=class{constructor(e){this.values=_e.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Ve(i)||(s=Math.max(s,i)),Ve(t)||(s=Math.min(s,t)),s}},gD=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},CD=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const PD={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let yD=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=PD[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const ED={"+":n=>n,"-":n=>-n,"~":n=>~n};let xD=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=ED[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function Af(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function bu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function $D(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function gu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function VD(n,e){const t=gu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=gu(n,e);return s===""?"":i+s}function Mf(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=VD(n,e);return i===""?"":t+i}function r$(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=$D(n,e);return e+=i.length,i===""?"":i+gu(n,e)}function kD(n,e){const t=r$(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=gu(n,e);return e+=s.length,t+i+s+Mf(n,e)}function SD(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=gu(n,e);return e+=i.length,i===""?"":t+i+Mf(n,e)}function LD(n,e){const t=r$(n,e);return e+=t.length,t===""?"":t+Mf(n,e)}const AD=Af([kD,SD,LD]);function MD(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function TD(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=MD(n,e);return i===""?"":t+i}function DD(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function OD(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=DD(n,e);return i===""?"":t+i}function RD(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function jD(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=RD(n,e);return i===""?"":t+i}const ND=Af([TD,OD,jD]),BD=Af([ND,AD]);function ID(n,e){const t=BD(n,e);return e+=t.length,t===""?null:{evaluable:new CD(t),cursor:e}}function FD(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=l$(n,e);if(!i)return null;e=i.cursor,e+=bu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function KD(n,e){var t;return(t=ID(n,e))!==null&&t!==void 0?t:FD(n,e)}function o$(n,e){const t=KD(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=o$(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new xD(i,s.evaluable)}):null}function UD(n,e,t){t+=bu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=bu(e,t).length,{cursor:t,operator:i}):null}function HD(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=UD(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new yD(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const zD=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>HD(n,e),o$);function l$(n,e){return e+=bu(n,e).length,zD(n,e)}function qD(n){const e=l$(n,0);return!e||e.cursor+bu(n,e.cursor).length!==n.length?null:e.evaluable}function xr(n){var e;const t=qD(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function a$(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=xr(n);if(!Ve(e))return e}return 0}function en(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function ne(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function BC(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ue(n,e,t){return Math.min(Math.max(n,e),t)}function u$(n,e){return(n%e+e)%e}function GD(n,e){return Ve(n.step)?Math.max(BC(e),2):BC(n.step)}function h$(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function YD(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function c$(n,e){return Ve(n.step)?null:new gD(n.step,e)}function p$(n){return!Ve(n.max)&&!Ve(n.min)?new Pp({max:n.max,min:n.min}):!Ve(n.max)||!Ve(n.min)?new bD({max:n.max,min:n.min}):null}function d$(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:en(GD(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:h$(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:YD(n,e)}}function m$(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function Tf(n){return{constraint:n.constraint,textProps:_e.fromObject(d$(n.params,n.initialValue))}}let Df=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},yp=class{constructor(e){this.target=e}},v$=class extends yp{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},XD=class extends yp{constructor(e,t){super(e),this.expanded=t}},WD=class extends yp{constructor(e,t){super(e),this.index=t}},ZD=class extends yp{constructor(e,t){super(e),this.native=t}},Of=class extends Df{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new mn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new v$(this,t.binding.target.read(),e.options.last))}};function QD(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function JD(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function eO(n){return n===null?!1:typeof n=="object"}function Gi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function IC(n){return{custom:e=>Gi(e)(n),boolean:Gi(e=>typeof e=="boolean"?e:void 0)(n),number:Gi(e=>typeof e=="number"?e:void 0)(n),string:Gi(e=>typeof e=="string"?e:void 0)(n),function:Gi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Gi(t=>t===e?e:void 0)(n),raw:Gi(e=>e)(n),object:e=>Gi(t=>{if(eO(t))return QD(t,e)})(n),array:e=>Gi(t=>{if(Array.isArray(t))return JD(t,e)})(n)}}const yv={optional:IC(!0),required:IC(!1)};function Ct(n,e){const t=e(yv),i=yv.required.object(t)(n);return i.succeeded?i.value:void 0}function Mi(n,e,t,i){if(e&&!e(n))return!1;const s=Ct(n,t);return s?i(s):!1}function Ti(n,e){var t;return io((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function mc(n){return"value"in n}function tO(n){if(!Lf(n)||!("binding"in n))return!1;const e=n.binding;return dD(e)}const ni="http://www.w3.org/2000/svg";function Fc(n){n.offsetHeight}function nO(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function Rf(n){return n.ontouchstart!==void 0}function iO(){return globalThis}function sO(){return iO().document}function rO(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const oO={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ep(n,e){const t=n.createElementNS(ni,"svg");return t.innerHTML=oO[e],t}function f$(n,e,t){n.insertBefore(e,n.children[t])}function jf(n){n.parentElement&&n.parentElement.removeChild(n)}function w$(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function lO(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function _$(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function cs(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function ci(n,e,t){cs(n.value(e),t)}const aO="tp";function te(n){return(t,i)=>[aO,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const Ta=te("lbl");function uO(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let hO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ta()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ta("l")),ci(t.props,"label",r=>{Ve(r)?this.element.classList.add(Ta(void 0,"nol")):(this.element.classList.remove(Ta(void 0,"nol")),lO(i),i.appendChild(uO(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(Ta("v")),this.element.appendChild(s),this.valueElement=s}},cO=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new hO(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Mi(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Ti(null,{label:this.props.get("label")})}};function pO(){return["veryfirst","first","last","verylast"]}const FC=te(""),KC={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let b$=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{pO().forEach(i=>{t.classList.remove(FC(void 0,KC[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(FC(void 0,KC[i]))})}),this.viewProps.handleDispose(()=>{jf(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Mi(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Ti(null,Object.assign({},this.viewProps.exportState()))}},dO=class extends Df{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,r=>{i(new ZD(this,r.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}};function mO(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function ua(n,e){return t=>{mO(n,e,t)}}function Nf(n,e){cs(n,t=>{e.textContent=t??""})}const zd=te("btn");let vO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(zd()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(zd("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(zd("t")),Nf(t.props.value("title"),s),this.buttonElement.appendChild(s)}},fO=class{constructor(e,t){this.emitter=new mn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new vO(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Mi(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Ti(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}},UC=class extends b${constructor(e,t){const i=new fO(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new cO(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Mi(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Ti(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},wO=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const _O=new wO("2.0.3");function Ut(n){return Object.assign({core:_O},n)}Ut({id:"button",type:"blade",accept(n){const e=Ct(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new UC(n.document,{blade:n.blade,buttonProps:_e.fromObject({title:n.params.title}),labelProps:_e.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof UC?new dO(n.controller):null}});function bO(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function gO(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function CO(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function PO(n){return Lf(n)?"refresh"in n&&typeof n.refresh=="function":!1}function yO(n,e){if(!NC.isBindable(n))throw so.notBindable();return new NC(n,e)}let EO=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new mn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,yO(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return gO(this,e)}addButton(e){return bO(this,e)}addTab(e){return CO(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{PO(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=tO(t.value)?t.value.binding:null;this.emitter_.emit("change",new v$(i,s?s.target.read():t.value.rawValue,e.options.last))}},Bf=class extends Df{constructor(e,t){super(e),this.rackApi_=new EO(e.rackController,t)}refresh(){this.rackApi_.refresh()}},If=class extends b${constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Mi(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Ti(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Ev(n){return"rackController"in n}let xO=class{constructor(e){this.emitter=new mn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw so.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function $O(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(mc(i)&&i.value===e)return i}return null}function VO(n){return Ev(n)?n.rackController.rack.bcSet_:null}let kO=class{constructor(e){var t,i;this.emitter=new mn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new xO(VO),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),mc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Ev(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(mc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Ev(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=$O(this.find(mc),e.sender);if(!t)throw so.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Ff=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new kO({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&f$(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&jf(e.bladeController.view.element)}};function g$(){return new _e({positions:tt([],{equals:pD})})}let Kf=class C$ extends _e{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=_e.createCore(t);return new C$(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Ve(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};ci(this,"expanded",i),ci(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function SO(n,e){let t=0;return nO(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),Fc(e),t=e.clientHeight,n.set("temporaryExpanded",null),Fc(e)}),t}function HC(n,e){e.style.height=n.styleHeight}function Uf(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Ve(n.get("expandedHeight"))){const t=SO(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),Fc(e)}),n.emitter.on("change",()=>{HC(n,e)}),HC(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let LO=class extends Bf{constructor(e,t){super(e,t),this.emitter_=new mn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new XD(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}};const P$=te("cnt");let AO=class{constructor(e,t){var i;this.className_=te((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),P$()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ci(this.foldable_,"completed",ua(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),ci(t.props,"title",u=>{Ve(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Nf(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},zC=class extends If{constructor(e,t){var i;const s=Kf.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new AO(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Ff({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,Uf(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Mi(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Ti(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};Ut({id:"folder",type:"blade",accept(n){const e=Ct(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new zC(n.document,{blade:n.blade,expanded:n.params.expanded,props:_e.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof zC?new LO(n.controller,n.pool):null}});const MO=te("");function qC(n,e){return ua(n,MO(void 0,e))}let Hf=class y$ extends _e{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=_D(tt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new y$(_e.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){cs(this.globalDisabled_,qC(e,"disabled")),ci(this,"hidden",qC(e,"hidden"))}bindDisabled(e){cs(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){cs(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const GC=te("tbp");let TO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(GC()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(GC("c")),this.element.appendChild(i),this.containerElement=i}};const Da=te("tbi");let DO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Da()),t.viewProps.bindClassModifiers(this.element),ci(t.props,"selected",r=>{r?this.element.classList.add(Da(void 0,"sel")):this.element.classList.remove(Da(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Da("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Da("t")),Nf(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},OO=class{constructor(e,t){this.emitter=new mn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new DO(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},xv=class extends If{constructor(e,t){const i=new TO(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Ff({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new OO(e,{props:t.itemProps,viewProps:Hf.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,ci(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Mi(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Ti(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},RO=class extends Bf{constructor(e,t){super(e,t),this.emitter_=new mn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new xv(t,{blade:g$(),itemProps:_e.fromObject({selected:!1,title:e.title}),props:_e.fromObject({selected:!1}),viewProps:Hf.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new WD(this,e.rawValue))}},jO=class extends Bf{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const YC=-1;let NO=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=tt(!0),this.selectedIndex=tt(YC),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=YC,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const Oa=te("tab");let BO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Oa(),P$()),t.viewProps.bindClassModifiers(this.element),cs(t.empty,ua(this.element,Oa(void 0,"nop")));const i=e.createElement("div");i.classList.add(Oa("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(Oa("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(Oa("c")),this.element.appendChild(r),this.contentsElement=r}},XC=class extends If{constructor(e,t){const i=new NO,s=new BO(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Ff({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;f$(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;jf(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};Ut({id:"tab",type:"blade",accept(n){const e=Ct(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new XC(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new xv(n.document,{blade:g$(),itemProps:_e.fromObject({selected:!1,title:t.title}),props:_e.fromObject({selected:!1}),viewProps:Hf.create()});e.add(i)}),e},api(n){return n.controller instanceof XC?new RO(n.controller,n.pool):n.controller instanceof xv?new jO(n.controller,n.pool):null}});let zf=class extends Of{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},sh=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function Kc(n,e){if(n instanceof e)return n;if(n instanceof sh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let xp=class{constructor(e){this.values=_e.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function $p(n){var e;const t=yv;if(Array.isArray(n))return(e=Ct({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function E$(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function qf(n){return Ve(n)?null:new xp(E$(n))}const qd=te("lst");let IO=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(qd()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(qd("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(qd("m")),s.appendChild(Ep(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,ci(this.props_,"options",r=>{w$(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},zl=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new IO(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Mi(e,null,t=>({options:t.required.custom($p)}),t=>(this.props.set("options",E$(t.options)),!0))}exportProps(){return Ti(null,{options:this.props.get("options")})}};const WC=te("pop");let FO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(WC()),t.viewProps.bindClassModifiers(this.element),cs(t.shows,ua(this.element,WC(void 0,"v")))}},x$=class{constructor(e,t){this.shows=tt(!1),this.viewProps=t.viewProps,this.view=new FO(e,{shows:this.shows,viewProps:this.viewProps})}};const ZC=te("txt");let KO=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ZC()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(ZC("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},Gf=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new KO(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ve(s)||(this.value.rawValue=s),this.view.refresh()}};function UO(n){return String(n)}function $$(n){return n==="false"?!1:!!n}function QC(n){return UO(n)}function HO(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const zO=en(0);function Uc(n){return zO(n)+"%"}function V$(n){return String(n)}function $v(n){return n}function ha({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Gt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Cu(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function bs(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function qO(n){return n==="ArrowUp"||n==="ArrowDown"}function k$(n){return qO(n)||n==="ArrowLeft"||n==="ArrowRight"}function Gd(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Ao=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new mn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Gd(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Gd(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Gd(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const En=te("txt");let GO=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(En(),En(void 0,"num")),t.arrayPosition&&this.element.classList.add(En(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(En("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(En()),this.inputElement.classList.add(En("i"));const s=e.createElement("div");s.classList.add(En("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(ni,"svg");r.classList.add(En("g")),this.knobElement.appendChild(r);const o=e.createElementNS(ni,"path");o.classList.add(En("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(ni,"path");l.classList.add(En("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(te("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(En(void 0,"drg"));return}this.element.classList.add(En(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Ue(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},rh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=tt(null),this.view=new GO(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Ao(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ve(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Gt(this.props.get("keyScale"),Cu(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Gt(this.props.get("keyScale"),Cu(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const Yd=te("sld");let YO=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Yd()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Yd("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(Yd("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ue(ne(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},XO=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new YO(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ao(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(ne(Ue(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Gt(this.props.get("keyScale"),bs(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Gt(this.props.get("keyScale"),bs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Xd=te("sldtxt");let WO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xd());const i=e.createElement("div");i.classList.add(Xd("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Xd("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},JC=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new XO(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new rh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new WO(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Mi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Ti(null,{max:e.get("max"),min:e.get("min")})}};function ZO(n){return{sliderProps:new _e({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new _e({formatter:tt(n.formatter),keyScale:n.keyScale,pointerScale:tt(n.pointerScale)})}}const QO={containerUnitSize:"cnt-usz"};function S$(n){return`--${QO[n]}`}function Pu(n){return m$(n)}function lr(n){if(Pv(n))return Ct(n,Pu)}function ns(n,e){if(!n)return;const t=[],i=c$(n,e);i&&t.push(i);const s=p$(n);return s&&t.push(s),new sh(t)}function L$(n){if(n==="inline"||n==="popup")return n}function oh(n,e){n.write(e)}const Qh=te("ckb");let JO=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Qh()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(Qh("l")),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("input");s.classList.add(Qh("i")),s.type="checkbox",this.labelElement.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(Qh("w")),this.labelElement.appendChild(r);const o=Ep(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},eR=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new JO(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}};function tR(n){const e=[],t=qf(n.options);return t&&e.push(t),new sh(e)}Ut({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Ct(e,i=>({options:i.optional.custom($p),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>$$,constraint:n=>tR(n.params),writer:n=>oh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Kc(i,xp);return s?new zl(e,{props:new _e({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new eR(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof zl?new zf(n.controller):null}});const Fr=te("col");let nR=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Fr()),t.foldable.bindExpandedClass(this.element,Fr(void 0,"expanded")),ci(t.foldable,"completed",ua(this.element,Fr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Fr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Fr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Fr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Fr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function iR(n,e,t){const i=Ue(n/255,0,1),s=Ue(e/255,0,1),r=Ue(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function sR(n,e,t){const i=(n%360+360)%360,s=Ue(e/100,0,1),r=Ue(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function rR(n,e,t){const i=Ue(n/255,0,1),s=Ue(e/255,0,1),r=Ue(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function A$(n,e,t){const i=u$(n,360),s=Ue(e/100,0,1),r=Ue(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function oR(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function lR(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function pi(n){return[n[0],n[1],n[2]]}function Vp(n,e){return[n[0],n[1],n[2],e]}const aR={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:oR,rgb:sR},hsv:{hsl:lR,hsv:(n,e,t)=>[n,e,t],rgb:A$},rgb:{hsl:iR,hsv:rR,rgb:(n,e,t)=>[n,e,t]}};function ql(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function uR(n,e){return n===e?e:u$(n,e)}function M$(n,e,t){var i;const s=ql(e,t);return[e==="rgb"?Ue(n[0],0,s[0]):uR(n[0],s[0]),Ue(n[1],0,s[1]),Ue(n[2],0,s[2]),Ue((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function e0(n,e,t,i){const s=ql(e,t),r=ql(e,i);return n.map((o,l)=>o/s[l]*r[l])}function T$(n,e,t){const i=e0(n,e.mode,e.type,"int"),s=aR[e.mode][t.mode](...i);return e0(s,t.mode,"int",t.type)}let ue=class D${static black(){return new D$([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=M$(e,t,this.type)}getComponents(e){return Vp(T$(pi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const As=te("colp");let hR=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(As()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(As("hsv"));const s=e.createElement("div");s.classList.add(As("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(As("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(As("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(As("a"));const a=e.createElement("div");a.classList.add(As("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(As("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function cR(n){return n==="int"?"int":n==="float"?"float":void 0}function Yf(n){return Ct(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(cR)}),expanded:e.optional.boolean,picker:e.optional.custom(L$),readonly:e.optional.constant(!1)}))}function ro(n){return n?.1:1}function O$(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let Xf=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=M$(e,t,this.type)}getComponents(e){return Vp(T$(pi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const pR={int:(n,e)=>new ue(n,e),float:(n,e)=>new Xf(n,e)};function Wf(n,e,t){return pR[t](n,e)}function dR(n){return n.type==="float"}function mR(n){return n.type==="int"}function vR(n){const e=n.getComponents(),t=ql(n.mode,"int");return new ue([Math.round(ne(e[0],0,1,0,t[0])),Math.round(ne(e[1],0,1,0,t[1])),Math.round(ne(e[2],0,1,0,t[2])),e[3]],n.mode)}function fR(n){const e=n.getComponents(),t=ql(n.mode,"int");return new Xf([ne(e[0],0,t[0],0,1),ne(e[1],0,t[1],0,1),ne(e[2],0,t[2],0,1),e[3]],n.mode)}function Lt(n,e){if(n.type===e)return n;if(mR(n)&&e==="float")return fR(n);if(dR(n)&&e==="int")return vR(n);throw so.shouldNeverHappen()}function wR(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Rn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const _R={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function R$(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return _R[i](t)}function j$(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Rn(e[1],255),Rn(e[2],255),Rn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function bR(n){const e=j$(n);return e?new ue(e,"rgb"):null}function N$(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Rn(e[1],255),Rn(e[2],255),Rn(e[3],255),Rn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function gR(n){const e=N$(n);return e?new ue(e,"rgb"):null}function B$(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[R$(e[1]),Rn(e[2],100),Rn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function CR(n){const e=B$(n);return e?new ue(e,"hsl"):null}function I$(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[R$(e[1]),Rn(e[2],100),Rn(e[3],100),Rn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function PR(n){const e=I$(n);return e?new ue(e,"hsl"):null}function F$(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function yR(n){const e=F$(n);return e?new ue(e,"rgb"):null}function K$(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),ne(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),ne(parseInt(t[4],16),0,255,0,1)]:null}function ER(n){const e=K$(n);return e?new ue(e,"rgb"):null}function U$(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function t0(n){return e=>{const t=U$(e);return t?Wf(t,"rgb",n):null}}function H$(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function n0(n){return e=>{const t=H$(e);return t?Wf(t,"rgb",n):null}}const xR=[{parser:F$,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:K$,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:j$,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:N$,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:B$,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:I$,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:U$,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:H$,result:{alpha:!0,mode:"rgb",notation:"object"}}];function $R(n){return xR.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function VR(n,e="int"){const t=$R(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function lh(n){const e=[yR,ER,bR,gR,CR,PR];n==="int"&&e.push(t0("int"),n0("int")),n==="float"&&e.push(t0("float"),n0("float"));const t=HO(e);return i=>{const s=t(i);return s?Lt(s,n):null}}function kR(n){const e=lh("int");if(typeof n!="string")return ue.black();const t=e(n);return t??ue.black()}function z$(n){const e=Ue(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Zf(n,e="#"){const t=pi(n.getComponents("rgb")).map(z$).join("");return`${e}${t}`}function Qf(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(z$).join("");return`${e}${i}`}function q$(n){const e=en(0),t=Lt(n,"int");return`rgb(${pi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function vc(n){const e=en(2),t=en(0);return`rgba(${Lt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function SR(n){const e=[en(0),Uc,Uc],t=Lt(n,"int");return`hsl(${pi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function LR(n){const e=[en(0),Uc,Uc,en(2)];return`hsla(${Lt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function G$(n,e){const t=en(e==="float"?2:0),i=["r","g","b"],s=Lt(n,e);return`{${pi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function AR(n){return e=>G$(e,n)}function Y$(n,e){const t=en(2),i=en(e==="float"?2:0),s=["r","g","b","a"];return`{${Lt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function MR(n){return e=>Y$(e,n)}const TR=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Zf},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Qf},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:q$},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:vc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:SR},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:LR},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:AR(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:MR(e)}],[])];function X$(n){return TR.reduce((e,t)=>e||(wR(t.format,n)?t.stringifier:null),null)}const Ra=te("apl");let DR=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ra()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Ra("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Ra("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(Ra("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(Ra("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new ue([t[0],t[1],t[2],0],"rgb"),s=new ue([t[0],t[1],t[2],255],"rgb"),r=["to right",vc(i),vc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=vc(e);const o=ne(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},OR=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new DR(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ao(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ue([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Gt(ro(!0),bs(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ue([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Gt(ro(!0),bs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const zo=te("coltxt");function RR(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let jR=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(zo()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(zo("m")),this.modeElem_=RR(e),this.modeElem_.classList.add(zo("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(zo("mm")),s.appendChild(Ep(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(zo("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),cs(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){w$(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(zo("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function NR(n){return en(n==="float"?2:0)}function BR(n,e,t){const i=ql(n,e)[t];return new Pp({min:0,max:i})}function IR(n,e,t){return new rh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:_e.fromObject({formatter:NR(e.colorType),keyScale:ro(!1),pointerScale:e.colorType==="float"?.01:1}),value:tt(0,{constraint:BR(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function FR(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:xr,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=IR(n,t,i);return ha({primary:e.value,secondary:s.value,forward(r){return Lt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Lt(r,e.colorType).getComponents(l);u[i]=o;const h=Wf(Vp(pi(u),u[3]),l,e.colorType);return Lt(h,"int")}}),s})}function KR(n,e){const t=new Gf(n,{parser:lh("int"),props:_e.fromObject({formatter:Zf}),value:tt(ue.black()),viewProps:e.viewProps});return ha({primary:e.value,secondary:t.value,forward:i=>new ue(pi(i.getComponents()),i.mode),backward:(i,s)=>new ue(Vp(pi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function UR(n){return n!=="hex"}let HR=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=tt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new jR(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return UR(t)?FR(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):KR(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const Wd=te("hpl");let zR=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Wd()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Wd("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Wd("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=q$(new ue([t,100,100],"hsv"));const i=ne(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},qR=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new zR(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ao(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ne(Ue(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ue([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Gt(ro(!1),bs(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ue([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Gt(ro(!1),bs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Zd=te("svp"),i0=64;let GR=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Zd()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=i0,i.width=i0,i.classList.add(Zd("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(Zd("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=rO(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const m=ne(c,0,s,0,100),d=ne(h,0,r,100,0),f=A$(i[0],m,d),p=(h*s+c)*4;l[p]=f[0],l[p+1]=f[1],l[p+2]=f[2],l[p+3]=255}e.putImageData(o,0,0);const a=ne(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=ne(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},YR=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new GR(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ao(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ne(e.point.x,0,e.bounds.width,0,100),s=ne(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ue([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){k$(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=ro(!1),l=Gt(o,bs(e)),a=Gt(o,Cu(e));l===0&&a===0||this.value.setRawValue(new ue([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=ro(!1),i=Gt(t,bs(e)),s=Gt(t,Cu(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},XR=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new qR(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new YR(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new OR(e,{value:this.value,viewProps:this.viewProps}),text:new rh(e,{parser:xr,props:_e.fromObject({pointerScale:.01,keyScale:.1,formatter:en(2)}),value:tt(0,{constraint:new Pp({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ha({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new ue(r,i.mode)}}),this.textsC_=new HR(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new hR(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Qd=te("colsw");let WR=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Qd()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Qd("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(Qd("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Qf(e)}onValueChange_(){this.update_()}},ZR=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new WR(e,{value:this.value,viewProps:this.viewProps})}},Jf=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Kf.create(t.expanded),this.swatchC_=new ZR(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Gf(e,{parser:t.parser,props:_e.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new nR(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new x$(e,{viewProps:this.viewProps}):null;const s=new XR(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),ha({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Uf(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=_$(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Rf(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function QR(n){return pi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function JR(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function ej(n){return new ue([n>>16&255,n>>8&255,n&255],"rgb")}function tj(n){return new ue([n>>24&255,n>>16&255,n>>8&255,ne(n&255,0,255,0,1)],"rgb")}function nj(n){return typeof n!="number"?ue.black():ej(n)}function ij(n){return typeof n!="number"?ue.black():tj(n)}function fc(n,e){return typeof n!="object"||Ve(n)?!1:e in n&&typeof n[e]=="number"}function ew(n){return fc(n,"r")&&fc(n,"g")&&fc(n,"b")}function tw(n){return ew(n)&&fc(n,"a")}function W$(n){return ew(n)}function nw(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function s0(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function sj(n){const e=X$(n);return e?(t,i)=>{oh(t,e(i))}:null}function rj(n){const e=n?JR:QR;return(t,i)=>{oh(t,e(i))}}function oj(n,e,t){const s=Lt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function lj(n,e,t){const s=Lt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function aj(n,e){return(t,i)=>{n?oj(t,i,e):lj(t,i,e)}}function uj(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function hj(n){return n?e=>Qf(e,"0x"):e=>Zf(e,"0x")}function cj(n){return"color"in n||n.view==="color"}Ut({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!cj(e))return null;const t=Yf(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:uj(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?ij:nj,equals:nw,writer:n=>rj(n.params.supportsAlpha)},controller:n=>{var e,t;return new Jf(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:hj(n.params.supportsAlpha),parser:lh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function pj(n,e){if(!W$(n))return Lt(ue.black(),e);if(e==="int"){const t=s0(n);return new ue(t,"rgb")}if(e==="float"){const t=s0(n);return new Xf(t,"rgb")}return Lt(ue.black(),"int")}function dj(n){return tw(n)}function mj(n){return e=>{const t=pj(e,n);return Lt(t,"int")}}function vj(n,e){return t=>n?Y$(t,e):G$(t,e)}Ut({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!W$(n))return null;const i=Yf(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=O$(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>mj(n.params.colorType),equals:nw,writer:n=>aj(dj(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=tw(n.initialValue);return new Jf(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:vj(i,n.params.colorType),parser:lh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});Ut({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=VR(n,O$(e));if(!t)return null;const i=X$(t);if(!i)return null;const s=Yf(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>kR,equals:nw,writer:n=>{const e=sj(n.params.format);if(!e)throw so.notBindable();return e}},controller:n=>{var e,t;return new Jf(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:lh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let iw=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const r0=te("pndtxt");let fj=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(r0()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(r0("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function wj(n,e,t){return new rh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:tt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let sw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>wj(e,t,s)),this.acs_.forEach((i,s)=>{ha({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new fj(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},_j=class extends Of{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function bj(n,e){const t=[],i=c$(n,e);i&&t.push(i);const s=p$(n);s&&t.push(s);const r=qf(n.options);return r&&t.push(r),new sh(t)}Ut({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Ct(e,i=>Object.assign(Object.assign({},m$(i)),{options:i.optional.custom($p),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>a$,constraint:n=>bj(n.params,n.initialValue),writer:n=>oh},controller:n=>{const e=n.value,t=n.constraint,i=t&&Kc(t,xp);if(i)return new zl(n.document,{props:new _e({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=d$(n.params,e.rawValue),r=t&&Kc(t,Pp);return r?new JC(n.document,Object.assign(Object.assign({},ZO(Object.assign(Object.assign({},s),{keyScale:tt(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:xr,value:e,viewProps:n.viewProps})):new rh(n.document,{parser:xr,props:_e.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof JC?new _j(n.controller):n.controller.valueController instanceof zl?new zf(n.controller):null}});let vr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Ve(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const Z$={toComponents:n=>n.getComponents(),fromComponents:n=>new vr(...n)},qo=te("p2d");let gj=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(qo()),t.viewProps.bindClassModifiers(this.element),cs(t.expanded,ua(this.element,qo(void 0,"expanded")));const i=e.createElement("div");i.classList.add(qo("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(qo("b")),s.appendChild(Ep(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(qo("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(qo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Ms=te("p2dp");let Cj=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Ms()),t.layout==="popup"&&this.element.classList.add(Ms(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ms("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(ni,"svg");s.classList.add(Ms("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(ni,"line");r.classList.add(Ms("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(ni,"line");o.classList.add(Ms("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(ni,"line");l.classList.add(Ms("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Ms("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=ne(e,-i,+i,0,100),r=ne(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function o0(n,e,t){return[Gt(e[0],bs(n)),Gt(e[1],Cu(n))*(t?1:-1)]}let Pj=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Cj(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ao(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=ne(e.point.x,0,e.bounds.width,-i,+i),r=ne(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new vr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){k$(e.key)&&e.preventDefault();const[t,i]=o0(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new vr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=o0(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},yj=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Kf.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new x$(e,{viewProps:this.viewProps}):null;const r=new Pj(e,{layout:t.pickerLayout,props:new _e({invertsY:tt(t.invertsY),max:tt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new sw(e,{assembly:Z$,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new gj(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ha({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Uf(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=_$(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Rf(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function Ej(n){return vr.isObject(n)?new vr(n.x,n.y):new vr}function xj(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function $j(n,e){return new iw({assembly:Z$,components:[ns(Object.assign(Object.assign({},n),n.x),e.x),ns(Object.assign(Object.assign({},n),n.y),e.y)]})}function l0(n,e){var t,i;if(!Ve(n.min)||!Ve(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=h$(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function Vj(n,e){var t,i;const s=l0(io(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=l0(io(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function kj(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}Ut({id:"input-point2d",type:"input",accept:(n,e)=>{if(!vr.isObject(n))return null;const t=Ct(e,i=>Object.assign(Object.assign({},Pu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(L$),readonly:i.optional.constant(!1),x:i.optional.custom(lr),y:i.optional.object(Object.assign(Object.assign({},Pu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>Ej,constraint:n=>$j(n.params,n.initialValue),equals:vr.equals,writer:()=>xj},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new yj(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return Tf({constraint:r.components[a],initialValue:l,params:io(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:kj(n.params),max:Vj(n.params,s.rawValue),parser:xr,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let El=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Ve(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const Q$={toComponents:n=>n.getComponents(),fromComponents:n=>new El(...n)};function Sj(n){return El.isObject(n)?new El(n.x,n.y,n.z):new El}function Lj(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function Aj(n,e){return new iw({assembly:Q$,components:[ns(Object.assign(Object.assign({},n),n.x),e.x),ns(Object.assign(Object.assign({},n),n.y),e.y),ns(Object.assign(Object.assign({},n),n.z),e.z)]})}Ut({id:"input-point3d",type:"input",accept:(n,e)=>{if(!El.isObject(n))return null;const t=Ct(e,i=>Object.assign(Object.assign({},Pu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(lr),y:i.optional.custom(lr),z:i.optional.custom(lr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Sj,constraint:n=>Aj(n.params,n.initialValue),equals:El.equals,writer:n=>Lj},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new sw(n.document,{assembly:Q$,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Tf({constraint:t.components[r],initialValue:s,params:io(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:xr,value:e,viewProps:n.viewProps})}});let xl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Ve(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const J$={toComponents:n=>n.getComponents(),fromComponents:n=>new xl(...n)};function Mj(n){return xl.isObject(n)?new xl(n.x,n.y,n.z,n.w):new xl}function Tj(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function Dj(n,e){return new iw({assembly:J$,components:[ns(Object.assign(Object.assign({},n),n.x),e.x),ns(Object.assign(Object.assign({},n),n.y),e.y),ns(Object.assign(Object.assign({},n),n.z),e.z),ns(Object.assign(Object.assign({},n),n.w),e.w)]})}Ut({id:"input-point4d",type:"input",accept:(n,e)=>{if(!xl.isObject(n))return null;const t=Ct(e,i=>Object.assign(Object.assign({},Pu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(lr),x:i.optional.custom(lr),y:i.optional.custom(lr),z:i.optional.custom(lr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Mj,constraint:n=>Dj(n.params,n.initialValue),equals:xl.equals,writer:n=>Tj},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new sw(n.document,{assembly:J$,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Tf({constraint:t.components[r],initialValue:s,params:io(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:xr,value:e,viewProps:n.viewProps})}});function Oj(n){const e=[],t=qf(n.options);return t&&e.push(t),new sh(e)}Ut({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=Ct(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom($p)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>V$,constraint:n=>Oj(n.params),writer:n=>oh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Kc(i,xp);return s?new zl(e,{props:new _e({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Gf(e,{parser:r=>r,props:_e.fromObject({formatter:$v}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof zl?new zf(n.controller):null}});const kp={monitor:{defaultInterval:200,defaultRows:3}},a0=te("mll");let Rj=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(a0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(a0("i")),i.style.height=`calc(var(${S$("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},rw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Rj(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const u0=te("sgl");let jj=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(u0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(u0("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},ow=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new jj(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};Ut({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Ct(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>$$},controller:n=>{var e;return n.value.rawValue.length===1?new ow(n.document,{formatter:QC,value:n.value,viewProps:n.viewProps}):new rw(n.document,{formatter:QC,rows:(e=n.params.rows)!==null&&e!==void 0?e:kp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let Nj=class extends Of{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Ts=te("grl");let Bj=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ts()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(ni,"svg");i.classList.add(Ts("g")),i.style.height=`calc(var(${S$("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(ni,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Ts("t"),te("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,s=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach((c,m)=>{if(c===void 0)return;const d=ne(m,0,i,0,e),f=ne(c,s,r,t,0);o.push([d,f].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const l=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(a===void 0){l.classList.remove(Ts("t","a"));return}const u=ne(this.cursor_.rawValue,0,i,0,e),h=ne(a,s,r,t,0);l.style.left=`${u}px`,l.style.top=`${h}px`,l.textContent=`${this.formatter_(a)}`,l.classList.contains(Ts("t","a"))||(l.classList.add(Ts("t","a"),Ts("t","in")),Fc(l),l.classList.remove(Ts("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},eV=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=tt(-1),this.view=new Bj(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Rf(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Ao(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Mi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Ti(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(ne(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(ne(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function Vv(n){return Ve(n.format)?en(2):n.format}function Ij(n){var e;return n.value.rawValue.length===1?new ow(n.document,{formatter:Vv(n.params),value:n.value,viewProps:n.viewProps}):new rw(n.document,{formatter:Vv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:kp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function Fj(n){var e,t,i;return new eV(n.document,{formatter:Vv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:kp.monitor.defaultRows,props:_e.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function h0(n){return n.view==="graph"}Ut({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=Ct(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>h0(n)?64:1,reader:n=>a$},controller:n=>h0(n.params)?Fj(n):Ij(n),api:n=>n.controller.valueController instanceof eV?new Nj(n.controller):null});Ut({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=Ct(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>V$},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new rw(n.document,{formatter:$v,rows:(e=n.params.rows)!==null&&e!==void 0?e:kp.monitor.defaultRows,value:t,viewProps:n.viewProps}):new ow(n.document,{formatter:$v,value:t,viewProps:n.viewProps})}});const Hc={baseBackgroundColor:"hsl(230, 7%, 17%)",baseBorderRadius:"6px",baseFontFamily:"Roboto Mono, Source Code Pro, Menlo, Courier, monospace",baseShadowColor:"rgba(0, 0, 0, 0.2)",bladeBorderRadius:"2px",bladeHorizontalPadding:"4px",bladeValueWidth:"160px",buttonBackgroundColor:"hsl(230, 7%, 70%)",buttonBackgroundColorActive:"#d6d7db",buttonBackgroundColorFocus:"#c8cad0",buttonBackgroundColorHover:"#bbbcc4",buttonForegroundColor:"hsl(230, 7%, 17%)",containerBackgroundColor:"rgba(187, 188, 196, 0.1)",containerBackgroundColorActive:"rgba(187, 188, 196, 0.25)",containerBackgroundColorFocus:"rgba(187, 188, 196, 0.2)",containerBackgroundColorHover:"rgba(187, 188, 196, 0.15)",containerForegroundColor:"hsl(230, 7%, 75%)",containerHorizontalPadding:"4px",containerUnitSize:"20px",containerUnitSpacing:"4px",containerVerticalPadding:"4px",grooveForegroundColor:"rgba(187, 188, 196, 0.1)",inputBackgroundColor:"rgba(187, 188, 196, 0.1)",inputBackgroundColorActive:"rgba(187, 188, 196, 0.25)",inputBackgroundColorFocus:"rgba(187, 188, 196, 0.2)",inputBackgroundColorHover:"rgba(187, 188, 196, 0.15)",inputForegroundColor:"hsl(230, 7%, 75%)",labelForegroundColor:"rgba(187, 188, 196, 0.7)",monitorBackgroundColor:"rgba(0, 0, 0, 0.2)",monitorForegroundColor:"rgba(187, 188, 196, 0.7)",pluginImageDraggingColor:"hsla(230, 100%, 66%, 1)"};Object.keys(Hc).reduce((n,e)=>(n[e]=e,n),{});const Kj=new Map([["baseBackgroundColor","--tp-base-background-color"],["baseBorderRadius","--tp-base-border-radius"],["baseFontFamily","--tp-base-font-family"],["baseShadowColor","--tp-base-shadow-color"],["bladeBorderRadius","--tp-blade-border-radius"],["bladeHorizontalPadding","--tp-blade-horizontal-padding"],["bladeValueWidth","--tp-blade-value-width"],["buttonBackgroundColor","--tp-button-background-color"],["buttonBackgroundColorActive","--tp-button-background-color-active"],["buttonBackgroundColorFocus","--tp-button-background-color-focus"],["buttonBackgroundColorHover","--tp-button-background-color-hover"],["buttonForegroundColor","--tp-button-foreground-color"],["containerBackgroundColor","--tp-container-background-color"],["containerBackgroundColorActive","--tp-container-background-color-active"],["containerBackgroundColorFocus","--tp-container-background-color-focus"],["containerBackgroundColorHover","--tp-container-background-color-hover"],["containerForegroundColor","--tp-container-foreground-color"],["containerHorizontalPadding","--tp-container-horizontal-padding"],["containerUnitSize","--tp-container-unit-size"],["containerUnitSpacing","--tp-container-unit-spacing"],["containerVerticalPadding","--tp-container-vertical-padding"],["grooveForegroundColor","--tp-groove-foreground-color"],["inputBackgroundColor","--tp-input-background-color"],["inputBackgroundColorActive","--tp-input-background-color-active"],["inputBackgroundColorFocus","--tp-input-background-color-focus"],["inputBackgroundColorHover","--tp-input-background-color-hover"],["inputForegroundColor","--tp-input-foreground-color"],["labelForegroundColor","--tp-label-foreground-color"],["monitorBackgroundColor","--tp-monitor-background-color"],["monitorForegroundColor","--tp-monitor-foreground-color"],["pluginImageDraggingColor","--tp-plugin-image-dragging-color"]]);function kv(n){if(n!==void 0){if(typeof n=="string")return n;if(tw(n))return`rgba(${n.r}, ${n.g}, ${n.b}, ${n.a})`;if(ew(n))return`rgb(${n.r}, ${n.g}, ${n.b})`}}function c0(n){if(n.startsWith("--tp-"))return n;const e=Kj.get(n);if(e)return e;throw new Error(`Unknown Tweakpane CSS theme map variable key: "${n}"`)}function p0(n,e){return(n==null?void 0:n[e])===void 0?kv(Hc[e]):kv(n[e])}function Uj(n,e){const t=sO().documentElement;if(e===void 0)for(const i of Object.keys(Hc)){const s=c0(i);n.style.getPropertyValue(s).length>0&&n.style.removeProperty(s)}else for(const[i,s]of Object.entries(e)){const r=c0(i),o=kv(s),l=Hc[i]||void 0,a=t.style.getPropertyValue(r)||void 0;e!==void 0&&o!==void 0&&(((a&&o!==a)??!1)||!a&&((l&&o!==l)??!1))?n.style.setProperty(r,o):n.style.getPropertyValue(r).length>0&&n.style.removeProperty(r)}}function d0(n){let e,t=`${n[0]}px`;return{c(){e=li("div"),this.h()},l(i){e=ai(i,"DIV",{}),ui(e).forEach(k),this.h()},h(){Be(e,"background",null),Be(e,"height",t)},m(i,s){z(i,e,s)},p(i,s){s&1&&t!==(t=`${i[0]}px`)&&Be(e,"height",t)},d(i){i&&k(e)}}}function Hj(n){let e,t=n[0]>0&&d0(n);return{c(){t&&t.c(),e=Oe()},l(i){t&&t.l(i),e=Oe()},m(i,s){t&&t.m(i,s),z(i,e,s)},p(i,[s]){i[0]>0?t?t.p(i,s):(t=d0(i),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ft,o:ft,d(i){i&&k(e),t&&t.d(i)}}}function m0(n){return Number.parseFloat(n.replace("px",""))}function zj(n,e,t){let i,{theme:s=void 0}=e,{keysAdd:r=[]}=e,{keysSubtract:o=[]}=e,{extra:l=void 0}=e;function a(u,h,c=0){return u.reduce((m,d)=>m+=m0(p0(s,d)),0)-h.reduce((m,d)=>m+=m0(p0(s,d)),0)+c}return n.$$set=u=>{"theme"in u&&t(1,s=u.theme),"keysAdd"in u&&t(2,r=u.keysAdd),"keysSubtract"in u&&t(3,o=u.keysSubtract),"extra"in u&&t(4,l=u.extra)},n.$$.update=()=>{n.$$.dirty&28&&t(0,i=a(r,o,l))},[i,s,r,o,l]}class ca extends Ft{constructor(e){super(),Kt(this,e,zj,Hj,It,{theme:1,keysAdd:2,keysSubtract:3,extra:4})}}function tV(n){return n.constructor.name==="Pane"}function Jd(n,e,t){return Math.min(Math.max(n,e),t)}function nV(n){let e=0,t=n;for(;(t=t.previousElementSibling)!==null;)e++;return e}function $r(n,...e){for(const t of e)t in n&&delete n[t];return n}function v0(n){n.isTrusted&&n.stopPropagation()}function iV(n,e,t,i){if(e){const s=e.querySelector(`.${t}`);if(s){const r=i?e.querySelector(`.${i}`):void 0;n?(s.removeEventListener("click",v0,{capture:!0}),s.style.cursor="pointer",r&&(r.style.display="block")):(s.addEventListener("click",v0,{capture:!0}),s.style.cursor="default",r&&(r.style.display="none"))}}else console.warn(`Title bar element not found with class "${t}"`)}function qj(n,e,t){let i,s;return e&&t?(i=Math.min(Math.ceil(n/e),t),s=Math.min(e,n)):e?(i=Math.ceil(n/e),s=e):t?(s=Math.ceil(n/t),i=t):(s=Math.ceil(Math.sqrt(n)),i=Math.ceil(n/s)),{columns:s,rows:i}}function Gj(n){var e,t,i,s;return(s=(i=(t=(e=n.controller.valueController)==null?void 0:e.foldable_)==null?void 0:t.valMap_)==null?void 0:i.expanded)==null?void 0:s.value_}function Yj(n){var t,i,s,r,o,l,a;return((r=(s=(i=(t=n.controller)==null?void 0:t.valueController)==null?void 0:i.view)==null?void 0:s.swatchElement)==null?void 0:r.querySelector("button"))??((a=(l=(o=n.controller)==null?void 0:o.valueController)==null?void 0:l.view)==null?void 0:a.buttonElement)}/*! Tweakpane 4.0.3 (c) 2016 cocopon, licensed under the MIT license. */function Ce(n){return n==null}function lw(n){return n!==null&&typeof n=="object"}function Sv(n){return n!==null&&typeof n=="object"}function Xj(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function oo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return Sv(r)&&Sv(o)?Object.assign(Object.assign({},i),{[s]:oo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function aw(n){return lw(n)?"target"in n:!1}const Wj={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let wt=class fl{static alreadyDisposed(){return new fl({type:"alreadydisposed"})}static notBindable(){return new fl({type:"notbindable"})}static notCompatible(e,t){return new fl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new fl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new fl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=Wj[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},f0=class sV{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!sV.isBindable(i))throw wt.notBindable();if(!(e in i))throw wt.propertyNotFound(e);i[e]=t}},Fe=class{constructor(){this.observers_={}}on(e,t,i){var s;let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t,key:(s=i==null?void 0:i.key)!==null&&s!==void 0?s:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.key!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},Zj=class{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new Fe,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},Qj=class{constructor(e){this.emitter=new Fe,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},Jj=class{constructor(e){this.emitter=new Fe,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function $e(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new Qj(n):new Zj(n,e)}function eN(n){return[new Jj(n),(e,t)=>{n.setRawValue(e,t)}]}let j=class rV{constructor(e){this.emitter=new Fe,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:$e(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new rV(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},ah=class{constructor(e){this.values=j.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},tN=class{constructor(e){this.values=j.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Ce(i)||(s=Math.max(s,i)),Ce(t)||(s=Math.min(s,t)),s}},nN=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},iN=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const sN={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let rN=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=sN[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const oN={"+":n=>n,"-":n=>-n,"~":n=>~n};let lN=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=oN[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function uw(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function yu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function aN(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Eu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function uN(n,e){const t=Eu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Eu(n,e);return s===""?"":i+s}function hw(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=uN(n,e);return i===""?"":t+i}function oV(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=aN(n,e);return e+=i.length,i===""?"":i+Eu(n,e)}function hN(n,e){const t=oV(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Eu(n,e);return e+=s.length,t+i+s+hw(n,e)}function cN(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Eu(n,e);return e+=i.length,i===""?"":t+i+hw(n,e)}function pN(n,e){const t=oV(n,e);return e+=t.length,t===""?"":t+hw(n,e)}const dN=uw([hN,cN,pN]);function mN(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function vN(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=mN(n,e);return i===""?"":t+i}function fN(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function wN(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=fN(n,e);return i===""?"":t+i}function _N(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function bN(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=_N(n,e);return i===""?"":t+i}const gN=uw([vN,wN,bN]),CN=uw([gN,dN]);function PN(n,e){const t=CN(n,e);return e+=t.length,t===""?null:{evaluable:new iN(t),cursor:e}}function yN(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=aV(n,e);if(!i)return null;e=i.cursor,e+=yu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function EN(n,e){var t;return(t=PN(n,e))!==null&&t!==void 0?t:yN(n,e)}function lV(n,e){const t=EN(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=lV(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new lN(i,s.evaluable)}):null}function xN(n,e,t){t+=yu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=yu(e,t).length,{cursor:t,operator:i}):null}function $N(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=xN(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new rN(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const VN=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>$N(n,e),lV);function aV(n,e){return e+=yu(n,e).length,VN(n,e)}function kN(n){const e=aV(n,0);return!e||e.cursor+yu(n,e.cursor).length!==n.length?null:e.evaluable}function gs(n){var e;const t=kN(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function uV(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=gs(n);if(!Ce(e))return e}return 0}function SN(n){return String(n)}function tn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function ie(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function w0(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function He(n,e,t){return Math.min(Math.max(n,e),t)}function hV(n,e){return(n%e+e)%e}function LN(n,e){return Ce(n.step)?Math.max(w0(e),2):w0(n.step)}function cV(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function pV(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function dV(n,e){return Ce(n.step)?null:new nN(n.step,e)}function mV(n){return!Ce(n.max)&&!Ce(n.min)?new ah({max:n.max,min:n.min}):!Ce(n.max)||!Ce(n.min)?new tN({max:n.max,min:n.min}):null}function vV(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:tn(LN(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:cV(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:pV(n,e)}}function fV(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function cw(n){return{constraint:n.constraint,textProps:j.fromObject(vV(n.params,n.initialValue))}}let Mo=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Sp=class{constructor(e){this.target=e}},uh=class extends Sp{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},AN=class extends Sp{constructor(e,t){super(e),this.expanded=t}},MN=class extends Sp{constructor(e,t){super(e),this.index=t}},TN=class extends Sp{constructor(e,t){super(e),this.native=t}},xu=class extends Mo{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Fe,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new uh(this,t.binding.target.read(),e.options.last))}};class DN{constructor(e,t){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new Fe}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function ON(n){if(!("binding"in n))return!1;const e=n.binding;return aw(e)&&"read"in e&&"write"in e}function RN(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function jN(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function NN(n){return n===null?!1:typeof n=="object"}function Yi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function _0(n){return{custom:e=>Yi(e)(n),boolean:Yi(e=>typeof e=="boolean"?e:void 0)(n),number:Yi(e=>typeof e=="number"?e:void 0)(n),string:Yi(e=>typeof e=="string"?e:void 0)(n),function:Yi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Yi(t=>t===e?e:void 0)(n),raw:Yi(e=>e)(n),object:e=>Yi(t=>{if(NN(t))return RN(t,e)})(n),array:e=>Yi(t=>{if(Array.isArray(t))return jN(t,e)})(n)}}const Lv={optional:_0(!0),required:_0(!1)};function De(n,e){const t=e(Lv),i=Lv.required.object(t)(n);return i.succeeded?i.value:void 0}function vn(n,e,t,i){if(e&&!e(n))return!1;const s=De(n,t);return s?i(s):!1}function fn(n,e){var t;return oo((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function no(n){return"value"in n}function wV(n){if(!lw(n)||!("binding"in n))return!1;const e=n.binding;return aw(e)}const ii="http://www.w3.org/2000/svg";function zc(n){n.offsetHeight}function BN(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function pw(n){return n.ontouchstart!==void 0}function IN(){return globalThis}function FN(){return IN().document}function KN(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const UN={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Lp(n,e){const t=n.createElementNS(ii,"svg");return t.innerHTML=UN[e],t}function _V(n,e,t){n.insertBefore(e,n.children[t])}function dw(n){n.parentElement&&n.parentElement.removeChild(n)}function bV(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function HN(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function gV(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function ps(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function di(n,e,t){ps(n.value(e),t)}const zN="tp";function K(n){return(t,i)=>[zN,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const ja=K("lbl");function qN(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let CV=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ja()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ja("l")),di(t.props,"label",r=>{Ce(r)?this.element.classList.add(ja(void 0,"nol")):(this.element.classList.remove(ja(void 0,"nol")),HN(i),i.appendChild(qN(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(ja("v")),this.element.appendChild(s),this.valueElement=s}},PV=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new CV(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return vn(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return fn(null,{label:this.props.get("label")})}};function GN(){return["veryfirst","first","last","verylast"]}const b0=K(""),g0={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let Ap=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{GN().forEach(i=>{t.classList.remove(b0(void 0,g0[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(b0(void 0,g0[i]))})}),this.viewProps.handleDispose(()=>{dw(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return vn(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return fn(null,Object.assign({},this.viewProps.exportState()))}},lo=class extends Ap{constructor(e,t){if(t.value!==t.valueController.value)throw wt.shouldNeverHappen();const i=t.valueController.viewProps,s=new PV(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new CV(e,{props:t.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return vn(e,t=>{var i,s,r;return super.importState(t)&&this.labelController.importProps(t)&&((r=(s=(i=this.valueController).importProps)===null||s===void 0?void 0:s.call(i,e))!==null&&r!==void 0?r:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,i;return fn(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:{}))}};function C0(n){const e=Object.assign({},n);return delete e.value,e}class yV extends lo{constructor(e,t){super(e,t),this.tag=t.tag}importState(e){return vn(e,t=>super.importState(C0(e)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return fn(()=>C0(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function YN(n){return no(n)&&wV(n.value)}class XN extends yV{importState(e){return vn(e,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function WN(n){return no(n)&&ON(n.value)}function EV(n,e){for(;n.length<e;)n.push(void 0)}function ZN(n){const e=[];return EV(e,n),e}function QN(n){const e=n.indexOf(void 0);return e<0?n:n.slice(0,e)}function JN(n,e){const t=[...QN(n),e];return t.length>n.length?t.splice(0,t.length-n.length):EV(t,n.length),t}class eB{constructor(e){this.emitter=new Fe,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=$e(ZN(e.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=JN(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function tB(n){if(!("binding"in n))return!1;const e=n.binding;return aw(e)&&"read"in e&&!("write"in e)}class nB extends yV{exportState(){return fn(()=>super.exportState(),{binding:{readonly:!0}})}}function iB(n){return no(n)&&tB(n.value)}let sB=class extends Mo{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,r=>{i(new TN(this,r.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}};function rB(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function pa(n,e){return t=>{rB(n,e,t)}}function mw(n,e){ps(n,t=>{e.textContent=t??""})}const em=K("btn");let oB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(em()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(em("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(em("t")),mw(t.props.value("title"),s),this.buttonElement.appendChild(s)}},lB=class{constructor(e,t){this.emitter=new Fe,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new oB(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return vn(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return fn(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}},P0=class extends Ap{constructor(e,t){const i=new lB(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new PV(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return vn(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return fn(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},xV=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const da=new xV("2.0.3");function Ht(n){return Object.assign({core:da},n)}const aB=Ht({id:"button",type:"blade",accept(n){const e=De(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new P0(n.document,{blade:n.blade,buttonProps:j.fromObject({title:n.params.title}),labelProps:j.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof P0?new sB(n.controller):null}});function uB(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function hB(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function cB(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function pB(n){return lw(n)?"refresh"in n&&typeof n.refresh=="function":!1}function dB(n,e){if(!f0.isBindable(n))throw wt.notBindable();return new f0(n,e)}let mB=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Fe,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,dB(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return hB(this,e)}addButton(e){return uB(this,e)}addTab(e){return cB(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{pB(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=wV(t.value)?t.value.binding:null;this.emitter_.emit("change",new uh(i,s?s.target.read():t.value.rawValue,e.options.last))}},vw=class extends Mo{constructor(e,t){super(e),this.rackApi_=new mB(e.rackController,t)}refresh(){this.rackApi_.refresh()}},fw=class extends Ap{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return vn(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return fn(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Av(n){return"rackController"in n}let vB=class{constructor(e){this.emitter=new Fe,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw wt.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function fB(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(no(i)&&i.value===e)return i}return null}function wB(n){return Av(n)?n.rackController.rack.bcSet_:null}let _B=class{constructor(e){var t,i;this.emitter=new Fe,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new vB(wB),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),no(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Av(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(no(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Av(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=fB(this.find(no),e.sender);if(!t)throw wt.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},ww=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new _B({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&_V(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&dw(e.bladeController.view.element)}};function ma(){return new j({positions:$e([],{equals:Xj})})}let _w=class $V extends j{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=j.createCore(t);return new $V(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Ce(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};di(this,"expanded",i),di(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function bB(n,e){let t=0;return BN(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),zc(e),t=e.clientHeight,n.set("temporaryExpanded",null),zc(e)}),t}function y0(n,e){e.style.height=n.styleHeight}function bw(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Ce(n.get("expandedHeight"))){const t=bB(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),zc(e)}),n.emitter.on("change",()=>{y0(n,e)}),y0(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let VV=class extends vw{constructor(e,t){super(e,t),this.emitter_=new Fe,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new AN(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}};const kV=K("cnt");let gB=class{constructor(e,t){var i;this.className_=K((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),kV()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),di(this.foldable_,"completed",pa(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),di(t.props,"title",u=>{Ce(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),mw(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},Mv=class extends fw{constructor(e,t){var i;const s=_w.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new gB(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new ww({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,bw(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return vn(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return fn(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};const CB=Ht({id:"folder",type:"blade",accept(n){const e=De(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new Mv(n.document,{blade:n.blade,expanded:n.params.expanded,props:j.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof Mv?new VV(n.controller,n.pool):null}}),PB=K("");function E0(n,e){return pa(n,PB(void 0,e))}let To=class SV extends j{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=eN($e(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new SV(j.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){ps(this.globalDisabled_,E0(e,"disabled")),di(this,"hidden",E0(e,"hidden"))}bindDisabled(e){ps(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){ps(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const x0=K("tbp");let yB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(x0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(x0("c")),this.element.appendChild(i),this.containerElement=i}};const Na=K("tbi");let EB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Na()),t.viewProps.bindClassModifiers(this.element),di(t.props,"selected",r=>{r?this.element.classList.add(Na(void 0,"sel")):this.element.classList.remove(Na(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Na("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Na("t")),mw(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},xB=class{constructor(e,t){this.emitter=new Fe,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new EB(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Tv=class extends fw{constructor(e,t){const i=new yB(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new ww({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new xB(e,{props:t.itemProps,viewProps:To.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,di(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return vn(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return fn(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},$B=class extends vw{constructor(e,t){super(e,t),this.emitter_=new Fe,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new Tv(t,{blade:ma(),itemProps:j.fromObject({selected:!1,title:e.title}),props:j.fromObject({selected:!1}),viewProps:To.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new MN(this,e.rawValue))}},VB=class extends vw{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const $0=-1;let kB=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=$e(!0),this.selectedIndex=$e($0),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=$0,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const Ba=K("tab");let SB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ba(),kV()),t.viewProps.bindClassModifiers(this.element),ps(t.empty,pa(this.element,Ba(void 0,"nop")));const i=e.createElement("div");i.classList.add(Ba("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(Ba("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(Ba("c")),this.element.appendChild(r),this.contentsElement=r}},V0=class extends fw{constructor(e,t){const i=new kB,s=new SB(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new ww({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;_V(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;dw(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};const LV=Ht({id:"tab",type:"blade",accept(n){const e=De(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new V0(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new Tv(n.document,{blade:ma(),itemProps:j.fromObject({selected:!1,title:t.title}),props:j.fromObject({selected:!1}),viewProps:To.create()});e.add(i)}),e},api(n){return n.controller instanceof V0?new $B(n.controller,n.pool):n.controller instanceof Tv?new VB(n.controller,n.pool):null}});function LB(n,e){const t=n.accept(e.params);if(!t)return null;const i=De(e.params,s=>({disabled:s.optional.boolean,hidden:s.optional.boolean}));return n.controller({blade:ma(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:i==null?void 0:i.disabled,hidden:i==null?void 0:i.hidden}),viewProps:To.create({disabled:i==null?void 0:i.disabled,hidden:i==null?void 0:i.hidden})})}let gw=class extends xu{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},AB=class{constructor(){this.disabled=!1,this.emitter=new Fe}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}},MB=class{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new Fe,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}},hh=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function qc(n,e){if(n instanceof e)return n;if(n instanceof hh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let ch=class{constructor(e){this.values=j.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function ph(n){var e;const t=Lv;if(Array.isArray(n))return(e=De({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function Cw(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function Pw(n){return Ce(n)?null:new ch(Cw(n))}const tm=K("lst");let TB=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(tm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(tm("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(tm("m")),s.appendChild(Lp(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,di(this.props_,"options",r=>{bV(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Vr=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new TB(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return vn(e,null,t=>({options:t.required.custom(ph)}),t=>(this.props.set("options",Cw(t.options)),!0))}exportProps(){return fn(null,{options:this.props.get("options")})}};const k0=K("pop");let DB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(k0()),t.viewProps.bindClassModifiers(this.element),ps(t.shows,pa(this.element,k0(void 0,"v")))}},AV=class{constructor(e,t){this.shows=$e(!1),this.viewProps=t.viewProps,this.view=new DB(e,{shows:this.shows,viewProps:this.viewProps})}};const S0=K("txt");let OB=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(S0()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(S0("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},$u=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new OB(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ce(s)||(this.value.rawValue=s),this.view.refresh()}};function RB(n){return String(n)}function MV(n){return n==="false"?!1:!!n}function L0(n){return RB(n)}function jB(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const NB=tn(0);function Gc(n){return NB(n)+"%"}function TV(n){return String(n)}function Dv(n){return n}function va({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Yt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Vu(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Cs(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function BB(n){return n==="ArrowUp"||n==="ArrowDown"}function DV(n){return BB(n)||n==="ArrowLeft"||n==="ArrowRight"}function nm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Do=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Fe,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(nm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(nm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(nm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const xn=K("txt");let IB=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(xn(),xn(void 0,"num")),t.arrayPosition&&this.element.classList.add(xn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(xn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(xn()),this.inputElement.classList.add(xn("i"));const s=e.createElement("div");s.classList.add(xn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(ii,"svg");r.classList.add(xn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(ii,"path");o.classList.add(xn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(ii,"path");l.classList.add(xn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(K("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(xn(void 0,"drg"));return}this.element.classList.add(xn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=He(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},dh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=$e(null),this.view=new IB(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Do(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ce(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Yt(this.props.get("keyScale"),Vu(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Yt(this.props.get("keyScale"),Vu(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const im=K("sld");let FB=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(im()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(im("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(im("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=He(ie(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},KB=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new FB(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Do(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(ie(He(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Yt(this.props.get("keyScale"),Cs(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Yt(this.props.get("keyScale"),Cs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const sm=K("sldtxt");let UB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(sm());const i=e.createElement("div");i.classList.add(sm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(sm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},Yc=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new KB(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new dh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new UB(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return vn(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return fn(null,{max:e.get("max"),min:e.get("min")})}};function OV(n){return{sliderProps:new j({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new j({formatter:$e(n.formatter),keyScale:n.keyScale,pointerScale:$e(n.pointerScale)})}}const HB={containerUnitSize:"cnt-usz"};function RV(n){return`--${HB[n]}`}function ku(n){return fV(n)}function ar(n){if(Sv(n))return De(n,ku)}function is(n,e){if(!n)return;const t=[],i=dV(n,e);i&&t.push(i);const s=mV(n);return s&&t.push(s),new hh(t)}function zB(n){return n?n.major===da.major:!1}function jV(n){if(n==="inline"||n==="popup")return n}function mh(n,e){n.write(e)}const Jh=K("ckb");let qB=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Jh()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(Jh("l")),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("input");s.classList.add(Jh("i")),s.type="checkbox",this.labelElement.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(Jh("w")),this.labelElement.appendChild(r);const o=Lp(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},GB=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new qB(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}};function YB(n){const e=[],t=Pw(n.options);return t&&e.push(t),new hh(e)}const XB=Ht({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=De(e,i=>({options:i.optional.custom(ph),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>MV,constraint:n=>YB(n.params),writer:n=>mh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&qc(i,ch);return s?new Vr(e,{props:new j({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new GB(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Vr?new gw(n.controller):null}}),Kr=K("col");let WB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Kr()),t.foldable.bindExpandedClass(this.element,Kr(void 0,"expanded")),di(t.foldable,"completed",pa(this.element,Kr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Kr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Kr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Kr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Kr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function ZB(n,e,t){const i=He(n/255,0,1),s=He(e/255,0,1),r=He(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function QB(n,e,t){const i=(n%360+360)%360,s=He(e/100,0,1),r=He(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function JB(n,e,t){const i=He(n/255,0,1),s=He(e/255,0,1),r=He(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function NV(n,e,t){const i=hV(n,360),s=He(e/100,0,1),r=He(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function eI(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function tI(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function mi(n){return[n[0],n[1],n[2]]}function Mp(n,e){return[n[0],n[1],n[2],e]}const nI={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:eI,rgb:QB},hsv:{hsl:tI,hsv:(n,e,t)=>[n,e,t],rgb:NV},rgb:{hsl:ZB,hsv:JB,rgb:(n,e,t)=>[n,e,t]}};function Gl(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function iI(n,e){return n===e?e:hV(n,e)}function BV(n,e,t){var i;const s=Gl(e,t);return[e==="rgb"?He(n[0],0,s[0]):iI(n[0],s[0]),He(n[1],0,s[1]),He(n[2],0,s[2]),He((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function A0(n,e,t,i){const s=Gl(e,t),r=Gl(e,i);return n.map((o,l)=>o/s[l]*r[l])}function IV(n,e,t){const i=A0(n,e.mode,e.type,"int"),s=nI[e.mode][t.mode](...i);return A0(s,t.mode,"int",t.type)}let he=class FV{static black(){return new FV([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=BV(e,t,this.type)}getComponents(e){return Mp(IV(mi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Ds=K("colp");let sI=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Ds()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ds("hsv"));const s=e.createElement("div");s.classList.add(Ds("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Ds("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Ds("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Ds("a"));const a=e.createElement("div");a.classList.add(Ds("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Ds("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function rI(n){return n==="int"?"int":n==="float"?"float":void 0}function yw(n){return De(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(rI)}),expanded:e.optional.boolean,picker:e.optional.custom(jV),readonly:e.optional.constant(!1)}))}function ao(n){return n?.1:1}function KV(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let Ew=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=BV(e,t,this.type)}getComponents(e){return Mp(IV(mi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const oI={int:(n,e)=>new he(n,e),float:(n,e)=>new Ew(n,e)};function xw(n,e,t){return oI[t](n,e)}function lI(n){return n.type==="float"}function aI(n){return n.type==="int"}function uI(n){const e=n.getComponents(),t=Gl(n.mode,"int");return new he([Math.round(ie(e[0],0,1,0,t[0])),Math.round(ie(e[1],0,1,0,t[1])),Math.round(ie(e[2],0,1,0,t[2])),e[3]],n.mode)}function hI(n){const e=n.getComponents(),t=Gl(n.mode,"int");return new Ew([ie(e[0],0,t[0],0,1),ie(e[1],0,t[1],0,1),ie(e[2],0,t[2],0,1),e[3]],n.mode)}function At(n,e){if(n.type===e)return n;if(aI(n)&&e==="float")return hI(n);if(lI(n)&&e==="int")return uI(n);throw wt.shouldNeverHappen()}function cI(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function jn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const pI={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function UV(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return pI[i](t)}function HV(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[jn(e[1],255),jn(e[2],255),jn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function dI(n){const e=HV(n);return e?new he(e,"rgb"):null}function zV(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[jn(e[1],255),jn(e[2],255),jn(e[3],255),jn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function mI(n){const e=zV(n);return e?new he(e,"rgb"):null}function qV(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[UV(e[1]),jn(e[2],100),jn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function vI(n){const e=qV(n);return e?new he(e,"hsl"):null}function GV(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[UV(e[1]),jn(e[2],100),jn(e[3],100),jn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function fI(n){const e=GV(n);return e?new he(e,"hsl"):null}function YV(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function wI(n){const e=YV(n);return e?new he(e,"rgb"):null}function XV(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),ie(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),ie(parseInt(t[4],16),0,255,0,1)]:null}function _I(n){const e=XV(n);return e?new he(e,"rgb"):null}function WV(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function M0(n){return e=>{const t=WV(e);return t?xw(t,"rgb",n):null}}function ZV(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function T0(n){return e=>{const t=ZV(e);return t?xw(t,"rgb",n):null}}const bI=[{parser:YV,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:XV,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:HV,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:zV,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:qV,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:GV,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:WV,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:ZV,result:{alpha:!0,mode:"rgb",notation:"object"}}];function gI(n){return bI.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function CI(n,e="int"){const t=gI(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function vh(n){const e=[wI,_I,dI,mI,vI,fI];n==="int"&&e.push(M0("int"),T0("int")),n==="float"&&e.push(M0("float"),T0("float"));const t=jB(e);return i=>{const s=t(i);return s?At(s,n):null}}function PI(n){const e=vh("int");if(typeof n!="string")return he.black();const t=e(n);return t??he.black()}function QV(n){const e=He(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function $w(n,e="#"){const t=mi(n.getComponents("rgb")).map(QV).join("");return`${e}${t}`}function Vw(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(QV).join("");return`${e}${i}`}function JV(n){const e=tn(0),t=At(n,"int");return`rgb(${mi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function wc(n){const e=tn(2),t=tn(0);return`rgba(${At(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function yI(n){const e=[tn(0),Gc,Gc],t=At(n,"int");return`hsl(${mi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function EI(n){const e=[tn(0),Gc,Gc,tn(2)];return`hsla(${At(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function ek(n,e){const t=tn(e==="float"?2:0),i=["r","g","b"],s=At(n,e);return`{${mi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function xI(n){return e=>ek(e,n)}function tk(n,e){const t=tn(2),i=tn(e==="float"?2:0),s=["r","g","b","a"];return`{${At(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function $I(n){return e=>tk(e,n)}const VI=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:$w},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Vw},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:JV},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:wc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:yI},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:EI},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:xI(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:$I(e)}],[])];function nk(n){return VI.reduce((e,t)=>e||(cI(t.format,n)?t.stringifier:null),null)}const Ia=K("apl");let kI=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ia()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Ia("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Ia("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(Ia("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(Ia("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new he([t[0],t[1],t[2],0],"rgb"),s=new he([t[0],t[1],t[2],255],"rgb"),r=["to right",wc(i),wc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=wc(e);const o=ie(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},SI=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new kI(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Do(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new he([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Yt(ao(!0),Cs(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new he([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Yt(ao(!0),Cs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Go=K("coltxt");function LI(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let AI=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Go()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Go("m")),this.modeElem_=LI(e),this.modeElem_.classList.add(Go("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(Go("mm")),s.appendChild(Lp(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(Go("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),ps(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){bV(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(Go("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function MI(n){return tn(n==="float"?2:0)}function TI(n,e,t){const i=Gl(n,e)[t];return new ah({min:0,max:i})}function DI(n,e,t){return new dh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:j.fromObject({formatter:MI(e.colorType),keyScale:ao(!1),pointerScale:e.colorType==="float"?.01:1}),value:$e(0,{constraint:TI(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function OI(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:gs,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=DI(n,t,i);return va({primary:e.value,secondary:s.value,forward(r){return At(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=At(r,e.colorType).getComponents(l);u[i]=o;const h=xw(Mp(mi(u),u[3]),l,e.colorType);return At(h,"int")}}),s})}function RI(n,e){const t=new $u(n,{parser:vh("int"),props:j.fromObject({formatter:$w}),value:$e(he.black()),viewProps:e.viewProps});return va({primary:e.value,secondary:t.value,forward:i=>new he(mi(i.getComponents()),i.mode),backward:(i,s)=>new he(Mp(mi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function jI(n){return n!=="hex"}let NI=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=$e(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new AI(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return jI(t)?OI(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):RI(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const rm=K("hpl");let BI=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(rm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(rm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(rm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=JV(new he([t,100,100],"hsv"));const i=ie(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},II=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new BI(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Do(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ie(He(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new he([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Yt(ao(!1),Cs(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new he([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Yt(ao(!1),Cs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const om=K("svp"),D0=64;let FI=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(om()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=D0,i.width=D0,i.classList.add(om("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(om("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=KN(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const m=ie(c,0,s,0,100),d=ie(h,0,r,100,0),f=NV(i[0],m,d),p=(h*s+c)*4;l[p]=f[0],l[p+1]=f[1],l[p+2]=f[2],l[p+3]=255}e.putImageData(o,0,0);const a=ie(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=ie(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},KI=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new FI(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Do(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ie(e.point.x,0,e.bounds.width,0,100),s=ie(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new he([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){DV(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=ao(!1),l=Yt(o,Cs(e)),a=Yt(o,Vu(e));l===0&&a===0||this.value.setRawValue(new he([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=ao(!1),i=Yt(t,Cs(e)),s=Yt(t,Vu(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},UI=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new II(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new KI(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new SI(e,{value:this.value,viewProps:this.viewProps}),text:new dh(e,{parser:gs,props:j.fromObject({pointerScale:.01,keyScale:.1,formatter:tn(2)}),value:$e(0,{constraint:new ah({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&va({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new he(r,i.mode)}}),this.textsC_=new NI(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new sI(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const lm=K("colsw");let HI=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(lm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(lm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(lm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Vw(e)}onValueChange_(){this.update_()}},zI=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new HI(e,{value:this.value,viewProps:this.viewProps})}},kw=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=_w.create(t.expanded),this.swatchC_=new zI(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new $u(e,{parser:t.parser,props:j.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new WB(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new AV(e,{viewProps:this.viewProps}):null;const s=new UI(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),va({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bw(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=gV(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!pw(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function qI(n){return mi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function GI(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function YI(n){return new he([n>>16&255,n>>8&255,n&255],"rgb")}function XI(n){return new he([n>>24&255,n>>16&255,n>>8&255,ie(n&255,0,255,0,1)],"rgb")}function WI(n){return typeof n!="number"?he.black():YI(n)}function ZI(n){return typeof n!="number"?he.black():XI(n)}function _c(n,e){return typeof n!="object"||Ce(n)?!1:e in n&&typeof n[e]=="number"}function ik(n){return _c(n,"r")&&_c(n,"g")&&_c(n,"b")}function sk(n){return ik(n)&&_c(n,"a")}function rk(n){return ik(n)}function Sw(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function O0(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function QI(n){const e=nk(n);return e?(t,i)=>{mh(t,e(i))}:null}function JI(n){const e=n?GI:qI;return(t,i)=>{mh(t,e(i))}}function eF(n,e,t){const s=At(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function tF(n,e,t){const s=At(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function nF(n,e){return(t,i)=>{n?eF(t,i,e):tF(t,i,e)}}function iF(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function sF(n){return n?e=>Vw(e,"0x"):e=>$w(e,"0x")}function rF(n){return"color"in n||n.view==="color"}const oF=Ht({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!rF(e))return null;const t=yw(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:iF(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?ZI:WI,equals:Sw,writer:n=>JI(n.params.supportsAlpha)},controller:n=>{var e,t;return new kw(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:sF(n.params.supportsAlpha),parser:vh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function lF(n,e){if(!rk(n))return At(he.black(),e);if(e==="int"){const t=O0(n);return new he(t,"rgb")}if(e==="float"){const t=O0(n);return new Ew(t,"rgb")}return At(he.black(),"int")}function aF(n){return sk(n)}function uF(n){return e=>{const t=lF(e,n);return At(t,"int")}}function hF(n,e){return t=>n?tk(t,e):ek(t,e)}const cF=Ht({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!rk(n))return null;const i=yw(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=KV(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>uF(n.params.colorType),equals:Sw,writer:n=>nF(aF(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=sk(n.initialValue);return new kw(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:hF(i,n.params.colorType),parser:vh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}}),pF=Ht({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=CI(n,KV(e));if(!t)return null;const i=nk(t);if(!i)return null;const s=yw(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>PI,equals:Sw,writer:n=>{const e=QI(n.params.format);if(!e)throw wt.notBindable();return e}},controller:n=>{var e,t;return new kw(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:vh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let Lw=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const R0=K("pndtxt");let dF=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(R0()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(R0("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function mF(n,e,t){return new dh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:$e(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let Aw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>mF(e,t,s)),this.acs_.forEach((i,s)=>{va({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new dF(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},vF=class extends xu{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function fF(n,e){const t=[],i=dV(n,e);i&&t.push(i);const s=mV(n);s&&t.push(s);const r=Pw(n.options);return r&&t.push(r),new hh(t)}const wF=Ht({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=De(e,i=>Object.assign(Object.assign({},fV(i)),{options:i.optional.custom(ph),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>uV,constraint:n=>fF(n.params,n.initialValue),writer:n=>mh},controller:n=>{const e=n.value,t=n.constraint,i=t&&qc(t,ch);if(i)return new Vr(n.document,{props:new j({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=vV(n.params,e.rawValue),r=t&&qc(t,ah);return r?new Yc(n.document,Object.assign(Object.assign({},OV(Object.assign(Object.assign({},s),{keyScale:$e(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:gs,value:e,viewProps:n.viewProps})):new dh(n.document,{parser:gs,props:j.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof Yc?new vF(n.controller):n.controller.valueController instanceof Vr?new gw(n.controller):null}});let fr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Ce(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const ok={toComponents:n=>n.getComponents(),fromComponents:n=>new fr(...n)},Yo=K("p2d");let _F=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Yo()),t.viewProps.bindClassModifiers(this.element),ps(t.expanded,pa(this.element,Yo(void 0,"expanded")));const i=e.createElement("div");i.classList.add(Yo("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(Yo("b")),s.appendChild(Lp(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(Yo("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Yo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Os=K("p2dp");let bF=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Os()),t.layout==="popup"&&this.element.classList.add(Os(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Os("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(ii,"svg");s.classList.add(Os("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(ii,"line");r.classList.add(Os("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(ii,"line");o.classList.add(Os("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(ii,"line");l.classList.add(Os("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Os("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=ie(e,-i,+i,0,100),r=ie(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function j0(n,e,t){return[Yt(e[0],Cs(n)),Yt(e[1],Vu(n))*(t?1:-1)]}let gF=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new bF(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Do(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=ie(e.point.x,0,e.bounds.width,-i,+i),r=ie(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new fr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){DV(e.key)&&e.preventDefault();const[t,i]=j0(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new fr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=j0(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},CF=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=_w.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new AV(e,{viewProps:this.viewProps}):null;const r=new gF(e,{layout:t.pickerLayout,props:new j({invertsY:$e(t.invertsY),max:$e(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new Aw(e,{assembly:ok,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new _F(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),va({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),bw(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=gV(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!pw(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function PF(n){return fr.isObject(n)?new fr(n.x,n.y):new fr}function yF(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function EF(n,e){return new Lw({assembly:ok,components:[is(Object.assign(Object.assign({},n),n.x),e.x),is(Object.assign(Object.assign({},n),n.y),e.y)]})}function N0(n,e){var t,i;if(!Ce(n.min)||!Ce(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=cV(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function xF(n,e){var t,i;const s=N0(oo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=N0(oo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function $F(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}const VF=Ht({id:"input-point2d",type:"input",accept:(n,e)=>{if(!fr.isObject(n))return null;const t=De(e,i=>Object.assign(Object.assign({},ku(i)),{expanded:i.optional.boolean,picker:i.optional.custom(jV),readonly:i.optional.constant(!1),x:i.optional.custom(ar),y:i.optional.object(Object.assign(Object.assign({},ku(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>PF,constraint:n=>EF(n.params,n.initialValue),equals:fr.equals,writer:()=>yF},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new CF(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return cw({constraint:r.components[a],initialValue:l,params:oo(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:$F(n.params),max:xF(n.params,s.rawValue),parser:gs,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let $l=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Ce(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const lk={toComponents:n=>n.getComponents(),fromComponents:n=>new $l(...n)};function kF(n){return $l.isObject(n)?new $l(n.x,n.y,n.z):new $l}function SF(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function LF(n,e){return new Lw({assembly:lk,components:[is(Object.assign(Object.assign({},n),n.x),e.x),is(Object.assign(Object.assign({},n),n.y),e.y),is(Object.assign(Object.assign({},n),n.z),e.z)]})}const AF=Ht({id:"input-point3d",type:"input",accept:(n,e)=>{if(!$l.isObject(n))return null;const t=De(e,i=>Object.assign(Object.assign({},ku(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(ar),y:i.optional.custom(ar),z:i.optional.custom(ar)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>kF,constraint:n=>LF(n.params,n.initialValue),equals:$l.equals,writer:n=>SF},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new Aw(n.document,{assembly:lk,axes:e.rawValue.getComponents().map((s,r)=>{var o;return cw({constraint:t.components[r],initialValue:s,params:oo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:gs,value:e,viewProps:n.viewProps})}});let Vl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Ce(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const ak={toComponents:n=>n.getComponents(),fromComponents:n=>new Vl(...n)};function MF(n){return Vl.isObject(n)?new Vl(n.x,n.y,n.z,n.w):new Vl}function TF(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function DF(n,e){return new Lw({assembly:ak,components:[is(Object.assign(Object.assign({},n),n.x),e.x),is(Object.assign(Object.assign({},n),n.y),e.y),is(Object.assign(Object.assign({},n),n.z),e.z),is(Object.assign(Object.assign({},n),n.w),e.w)]})}const OF=Ht({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Vl.isObject(n))return null;const t=De(e,i=>Object.assign(Object.assign({},ku(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(ar),x:i.optional.custom(ar),y:i.optional.custom(ar),z:i.optional.custom(ar)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>MF,constraint:n=>DF(n.params,n.initialValue),equals:Vl.equals,writer:n=>TF},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new Aw(n.document,{assembly:ak,axes:e.rawValue.getComponents().map((s,r)=>{var o;return cw({constraint:t.components[r],initialValue:s,params:oo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:gs,value:e,viewProps:n.viewProps})}});function RF(n){const e=[],t=Pw(n.options);return t&&e.push(t),new hh(e)}const jF=Ht({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=De(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(ph)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>TV,constraint:n=>RF(n.params),writer:n=>mh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&qc(i,ch);return s?new Vr(e,{props:new j({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new $u(e,{parser:r=>r,props:j.fromObject({formatter:Dv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Vr?new gw(n.controller):null}}),fh={monitor:{defaultInterval:200,defaultRows:3}},B0=K("mll");let NF=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(B0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(B0("i")),i.style.height=`calc(var(${RV("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Mw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new NF(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const I0=K("sgl");let BF=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(I0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(I0("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},Tw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new BF(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};const IF=Ht({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=De(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>MV},controller:n=>{var e;return n.value.rawValue.length===1?new Tw(n.document,{formatter:L0,value:n.value,viewProps:n.viewProps}):new Mw(n.document,{formatter:L0,rows:(e=n.params.rows)!==null&&e!==void 0?e:fh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let FF=class extends xu{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Rs=K("grl");let KF=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Rs()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(ii,"svg");i.classList.add(Rs("g")),i.style.height=`calc(var(${RV("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(ii,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Rs("t"),K("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,s=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach((c,m)=>{if(c===void 0)return;const d=ie(m,0,i,0,e),f=ie(c,s,r,t,0);o.push([d,f].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const l=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(a===void 0){l.classList.remove(Rs("t","a"));return}const u=ie(this.cursor_.rawValue,0,i,0,e),h=ie(a,s,r,t,0);l.style.left=`${u}px`,l.style.top=`${h}px`,l.textContent=`${this.formatter_(a)}`,l.classList.contains(Rs("t","a"))||(l.classList.add(Rs("t","a"),Rs("t","in")),zc(l),l.classList.remove(Rs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},uk=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=$e(-1),this.view=new KF(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!pw(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Do(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return vn(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return fn(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(ie(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(ie(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function Ov(n){return Ce(n.format)?tn(2):n.format}function UF(n){var e;return n.value.rawValue.length===1?new Tw(n.document,{formatter:Ov(n.params),value:n.value,viewProps:n.viewProps}):new Mw(n.document,{formatter:Ov(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:fh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function HF(n){var e,t,i;return new uk(n.document,{formatter:Ov(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:fh.monitor.defaultRows,props:j.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function F0(n){return n.view==="graph"}const zF=Ht({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=De(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>F0(n)?64:1,reader:n=>uV},controller:n=>F0(n.params)?HF(n):UF(n),api:n=>n.controller.valueController instanceof uk?new FF(n.controller):null}),qF=Ht({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=De(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>TV},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Mw(n.document,{formatter:Dv,rows:(e=n.params.rows)!==null&&e!==void 0?e:fh.monitor.defaultRows,value:t,viewProps:n.viewProps}):new Tw(n.document,{formatter:Dv,value:t,viewProps:n.viewProps})}});class GF{constructor(){this.map_=new Map}get(e){var t;return(t=this.map_.get(e))!==null&&t!==void 0?t:null}has(e){return this.map_.has(e)}add(e,t){return this.map_.set(e,t),e.viewProps.handleDispose(()=>{this.map_.delete(e)}),t}}class YF{constructor(e){this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}read(){return this.reader_(this.target.read())}write(e){this.writer_(this.target,e)}inject(e){this.write(this.reader_(e))}}function XF(n,e){var t;const i=n.accept(e.target.read(),e.params);if(Ce(i))return null;const s={target:e.target,initialValue:i.initialValue,params:i.params},r=De(e.params,c=>({disabled:c.optional.boolean,hidden:c.optional.boolean,label:c.optional.string,tag:c.optional.string})),o=n.binding.reader(s),l=n.binding.constraint?n.binding.constraint(s):void 0,a=new YF({reader:o,target:e.target,writer:n.binding.writer(s)}),u=new DN($e(o(i.initialValue),{constraint:l,equals:n.binding.equals}),a),h=n.controller({constraint:l,document:e.document,initialValue:i.initialValue,params:i.params,value:u,viewProps:To.create({disabled:r==null?void 0:r.disabled,hidden:r==null?void 0:r.hidden})});return new XN(e.document,{blade:ma(),props:j.fromObject({label:"label"in e.params?(t=r==null?void 0:r.label)!==null&&t!==void 0?t:null:e.target.key}),tag:r==null?void 0:r.tag,value:u,valueController:h})}class WF{constructor(e){this.target=e.target,this.reader_=e.reader}read(){return this.reader_(this.target.read())}}function ZF(n,e){return e===0?new AB:new MB(n,e??fh.monitor.defaultInterval)}function QF(n,e){var t,i,s;const r=n.accept(e.target.read(),e.params);if(Ce(r))return null;const o={target:e.target,initialValue:r.initialValue,params:r.params},l=De(e.params,m=>({bufferSize:m.optional.number,disabled:m.optional.boolean,hidden:m.optional.boolean,interval:m.optional.number,label:m.optional.string})),a=n.binding.reader(o),u=(i=(t=l==null?void 0:l.bufferSize)!==null&&t!==void 0?t:n.binding.defaultBufferSize&&n.binding.defaultBufferSize(r.params))!==null&&i!==void 0?i:1,h=new eB({binding:new WF({reader:a,target:e.target}),bufferSize:u,ticker:ZF(e.document,l==null?void 0:l.interval)}),c=n.controller({document:e.document,params:r.params,value:h,viewProps:To.create({disabled:l==null?void 0:l.disabled,hidden:l==null?void 0:l.hidden})});return c.viewProps.bindDisabled(h.ticker),c.viewProps.handleDispose(()=>{h.ticker.dispose()}),new nB(e.document,{blade:ma(),props:j.fromObject({label:"label"in e.params?(s=l==null?void 0:l.label)!==null&&s!==void 0?s:null:e.target.key}),value:h,valueController:c})}class JF{constructor(e){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e,t){if(!zB(t.core))throw wt.notCompatible(e,t.id);t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput_(e,t,i){return this.pluginsMap_.inputs.reduce((s,r)=>s??XF(r,{document:e,target:t,params:i}),null)}createMonitor_(e,t,i){return this.pluginsMap_.monitors.reduce((s,r)=>s??QF(r,{document:e,params:i,target:t}),null)}createBinding(e,t,i){const s=t.read();if(Ce(s))throw new wt({context:{key:t.key},type:"nomatchingcontroller"});const r=this.createInput_(e,t,i);if(r)return r;const o=this.createMonitor_(e,t,i);if(o)return o;throw new wt({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const i=this.pluginsMap_.blades.reduce((s,r)=>s??LB(r,{document:e,params:t}),null);if(!i)throw new wt({type:"nomatchingview",context:{params:t}});return i}createInputBindingApi_(e){const t=this.pluginsMap_.inputs.reduce((i,s)=>{var r,o;return i||((o=(r=s.api)===null||r===void 0?void 0:r.call(s,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new xu(e))}createMonitorBindingApi_(e){const t=this.pluginsMap_.monitors.reduce((i,s)=>{var r,o;return i||((o=(r=s.api)===null||r===void 0?void 0:r.call(s,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new xu(e))}createBindingApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(WN(e))return this.createInputBindingApi_(e);if(iB(e))return this.createMonitorBindingApi_(e);throw wt.shouldNeverHappen()}createApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(YN(e))return this.createBindingApi(e);const t=this.pluginsMap_.blades.reduce((i,s)=>i??s.api({controller:e,pool:this}),null);if(!t)throw wt.shouldNeverHappen();return this.apiCache_.add(e,t)}}const e5=new GF;function t5(){const n=new JF(e5);return[VF,AF,OF,jF,wF,pF,cF,oF,XB,IF,qF,zF,aB,CB,LV].forEach(e=>{n.register("core",e)}),n}class n5 extends Mo{constructor(e){super(e),this.emitter_=new Fe,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new uh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class i5 extends Mo{}class s5 extends Mo{constructor(e){super(e),this.emitter_=new Fe,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new uh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class r5 extends Mo{constructor(e){super(e),this.emitter_=new Fe,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new uh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(e){this.controller.valueController.props.set("formatter",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const o5=function(){return{id:"list",type:"blade",core:da,accept(n){const e=De(n,t=>({options:t.required.custom(ph),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(n){const e=new ch(Cw(n.params.options)),t=$e(n.params.value,{constraint:e}),i=new Vr(n.document,{props:new j({options:e.values.value("options")}),value:t,viewProps:n.viewProps});return new lo(n.document,{blade:n.blade,props:j.fromObject({label:n.params.label}),value:t,valueController:i})},api(n){return!(n.controller instanceof lo)||!(n.controller.valueController instanceof Vr)?null:new n5(n.controller)}}}();class l5 extends VV{constructor(e,t){super(e,t)}get element(){return this.controller.view.element}}class a5 extends Mv{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const K0=K("spr");class u5{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(K0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("hr");i.classList.add(K0("r")),this.element.appendChild(i)}}class U0 extends Ap{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new u5(e,{viewProps:t.viewProps})}))}}const h5={id:"separator",type:"blade",core:da,accept(n){const e=De(n,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller(n){return new U0(n.document,{blade:n.blade,viewProps:n.viewProps})},api(n){return n.controller instanceof U0?new i5(n.controller):null}},c5={id:"slider",type:"blade",core:da,accept(n){const e=De(n,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(n){var e,t;const i=(e=n.params.value)!==null&&e!==void 0?e:0,s=new ah({max:n.params.max,min:n.params.min}),r=$e(i,{constraint:s}),o=new Yc(n.document,Object.assign(Object.assign({},OV({formatter:(t=n.params.format)!==null&&t!==void 0?t:SN,keyScale:$e(1),max:s.values.value("max"),min:s.values.value("min"),pointerScale:pV(n.params,i)})),{parser:gs,value:r,viewProps:n.viewProps}));return new lo(n.document,{blade:n.blade,props:j.fromObject({label:n.params.label}),value:r,valueController:o})},api(n){return!(n.controller instanceof lo)||!(n.controller.valueController instanceof Yc)?null:new s5(n.controller)}},p5=function(){return{id:"text",type:"blade",core:da,accept(n){const e=De(n,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(n){var e;const t=$e(n.params.value),i=new $u(n.document,{parser:n.params.parse,props:j.fromObject({formatter:(e=n.params.format)!==null&&e!==void 0?e:s=>String(s)}),value:t,viewProps:n.viewProps});return new lo(n.document,{blade:n.blade,props:j.fromObject({label:n.params.label}),value:t,valueController:i})},api(n){return!(n.controller instanceof lo)||!(n.controller.valueController instanceof $u)?null:new r5(n.controller)}}}();function d5(n){const e=n.createElement("div");return e.classList.add(K("dfw")()),n.body&&n.body.appendChild(e),e}function m5(n,e,t){if(n.querySelector(`style[data-tp-style=${e}]`))return;const i=n.createElement("style");i.dataset.tpStyle=e,i.textContent=t,n.head.appendChild(i)}let v5=class extends l5{constructor(e){var t,i;const s=e??{},r=(t=s.document)!==null&&t!==void 0?t:FN(),o=t5(),l=new a5(r,{expanded:s.expanded,blade:ma(),props:j.fromObject({title:s.title}),viewProps:To.create()});super(l,o),this.pool_=o,this.containerElem_=(i=s.container)!==null&&i!==void 0?i:d5(r),this.containerElem_.appendChild(this.element),this.doc_=r,this.usesDefaultWrapper_=!s.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw wt.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw wt.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){e.css&&m5(this.document,`plugin-${e.id}`,e.css),("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(i=>{this.pool_.register(e.id,i)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[o5,h5,c5,LV,p5]})}};new xV("4.0.3");function f5(n){let e,t;return e=new ca({props:{keysAdd:["containerVerticalPadding","containerUnitSize"],theme:n[2]}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&4&&(r.theme=i[2]),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function w5(n){return{c:ft,l:ft,m:ft,p:ft,i:ft,o:ft,d:ft}}function _5(n){let e,t,i,s;const r=[C5,g5],o=[];function l(h,c){return h[1]===void 0?0:1}e=l(n),t=o[e]=r[e](n);const a=n[11].default,u=hn(a,n,n[10],null);return{c(){t.c(),i=Dn(),u&&u.c()},l(h){t.l(h),i=On(h),u&&u.l(h)},m(h,c){o[e].m(h,c),z(h,i,c),u&&u.m(h,c),s=!0},p(h,c){let m=e;e=l(h),e===m?o[e].p(h,c):(Ul(),C(o[m],1,1,()=>{o[m]=null}),Hl(),t=o[e],t?t.p(h,c):(t=o[e]=r[e](h),t.c()),g(t,1),t.m(i.parentNode,i)),u&&u.p&&(!s||c&1024)&&cn(u,a,h,h[10],s?dn(a,h[10],c,null):pn(h[10]),null)},i(h){s||(g(t),g(u,h),s=!0)},o(h){C(t),C(u,h),s=!1},d(h){h&&k(i),o[e].d(h),u&&u.d(h)}}}function b5(n){let e;const t=n[11].default,i=hn(t,n,n[10],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&1024)&&cn(i,t,s,s[10],e?dn(t,s[10],r,null):pn(s[10]),null)},i(s){e||(g(i,s),e=!0)},o(s){C(i,s),e=!1},d(s){i&&i.d(s)}}}function g5(n){let e,t;return e=new ca({props:{keysAdd:["containerVerticalPadding","containerVerticalPadding","containerVerticalPadding","containerUnitSize"],theme:n[2]}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&4&&(r.theme=i[2]),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function C5(n){let e,t;return e=new ca({props:{keysAdd:["containerVerticalPadding"],theme:n[2]}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&4&&(r.theme=i[2]),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function P5(n){let e,t,i,s;const r=[b5,_5,w5,f5],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=Oe()},l(a){t.l(a),i=Oe()},m(a,u){o[e].m(a,u),z(a,i,u),s=!0},p(a,[u]){let h=e;e=l(),e===h?o[e].p(a,u):(Ul(),C(o[h],1,1,()=>{o[h]=null}),Hl(),t=o[e],t?t.p(a,u):(t=o[e]=r[e](a),t.c()),g(t,1),t.m(i.parentNode,i))},i(a){s||(g(t),s=!0)},o(a){C(t),s=!1},d(a){a&&k(i),o[e].d(a)}}}function y5(n,e,t){let i,s,{$$slots:r={},$$scope:o}=e,{title:l=void 0}=e,{userExpandable:a=!0}=e,{expanded:u=!0}=e,{theme:h=void 0}=e,{scale:c=1}=e,{userCreatedPane:m=!0}=e,{tpPane:d=void 0}=e;const f=Sf();Kl(n,f,P=>t(12,i=P));const p=yl("parentStore");Kl(n,p,P=>t(13,s=P));let v=[];pc("registerPlugin",P=>{d===void 0?console.warn(`tpPane is undefined, failed to register plugin "${P.id}"`):v.includes(P.id)||(d==null||d.registerPlugin(P),v.push(P.id))}),pc("userCreatedPane",m),s!==void 0&&console.warn("<Panes> must not be nested");let _=u;e$(f,i=new v5({expanded:u,title:l}),i),i.on("fold",()=>{t(9,_=i.expanded)}),d=i,pc("parentStore",f),gp(()=>{i.dispose()});function A(P){if(d)if(P===1)d.element.style.removeProperty("transform-origin"),d.element.style.removeProperty("transform"),d.element.style.removeProperty("width");else{const qt=Math.max(0,P);t(5,d.element.style.transformOrigin="0 0",d),t(5,d.element.style.transform=`scale(${qt})`,d),t(5,d.element.style.width=`${100/qt}%`,d)}}function x(){d&&t(5,d.expanded=_,d),t(0,u=_)}return n.$$set=P=>{"title"in P&&t(1,l=P.title),"userExpandable"in P&&t(6,a=P.userExpandable),"expanded"in P&&t(0,u=P.expanded),"theme"in P&&t(2,h=P.theme),"scale"in P&&t(7,c=P.scale),"userCreatedPane"in P&&t(8,m=P.userCreatedPane),"tpPane"in P&&t(5,d=P.tpPane),"$$scope"in P&&t(10,o=P.$$scope)},n.$$.update=()=>{n.$$.dirty&34&&d&&l&&t(5,d.title=l,d),n.$$.dirty&32&&d!=null&&d.element&&(d==null||d.element.classList.add("svelte-tweakpane-ui")),n.$$.dirty&160&&d&&A(c),n.$$.dirty&96&&d&&iV(a,d.element,"tp-rotv_b","tp-rotv_m"),n.$$.dirty&36&&d&&Uj(d.element,h),n.$$.dirty&33&&d&&t(9,_=u),n.$$.dirty&545&&d&&u!==void 0&&x()},[u,l,h,f,p,d,a,c,m,_,o,r]}class Dw extends Ft{constructor(e){super(),Kt(this,e,y5,P5,It,{title:1,userExpandable:6,expanded:0,theme:2,scale:7,userCreatedPane:8,tpPane:5})}}function E5(n){let e;const t=n[6].default,i=hn(t,n,n[10],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&1024)&&cn(i,t,s,s[10],e?dn(t,s[10],r,null):pn(s[10]),null)},i(s){e||(g(i,s),e=!0)},o(s){C(i,s),e=!1},d(s){i&&i.d(s)}}}function x5(n){let e,t,i,s,r;const o=[{theme:n[3]},$r(n[5],"position")];function l(h){n[7](h)}function a(h){n[8](h)}let u={$$slots:{default:[E5]},$$scope:{ctx:n}};for(let h=0;h<o.length;h+=1)u=ye(u,o[h]);return n[0]!==void 0&&(u.expanded=n[0]),n[1]!==void 0&&(u.tpPane=n[1]),t=new Dw({props:u}),R.push(()=>F(t,"expanded",l)),R.push(()=>F(t,"tpPane",a)),{c(){e=li("div"),M(t.$$.fragment),this.h()},l(h){e=ai(h,"DIV",{});var c=ui(e);T(t.$$.fragment,c),c.forEach(k),this.h()},h(){Be(e,"width",n[2]===void 0?null:`${n[2]}px`)},m(h,c){z(h,e,c),D(t,e,null),n[9](e),r=!0},p(h,[c]){const m=c&40?Li(o,[c&8&&{theme:h[3]},c&32&&Ai($r(h[5],"position"))]):{};c&1024&&(m.$$scope={dirty:c,ctx:h}),!i&&c&1&&(i=!0,m.expanded=h[0],I(()=>i=!1)),!s&&c&2&&(s=!0,m.tpPane=h[1],I(()=>s=!1)),t.$set(m),c&4&&Be(e,"width",h[2]===void 0?null:`${h[2]}px`)},i(h){r||(g(t.$$.fragment,h),r=!0)},o(h){C(t.$$.fragment,h),r=!1},d(h){h&&k(e),O(t),n[9](null)}}}function $5(n,e,t){const i=["expanded","width","tpPane","theme"];let s=bt(e,i),{$$slots:r={},$$scope:o}=e,{expanded:l=void 0}=e,{width:a=void 0}=e,{tpPane:u=void 0}=e,{theme:h={baseBorderRadius:"0px",baseShadowColor:"hsla(0, 0%, 0%, 0)"}}=e,c;Cp(()=>{if(u){const p=u.element.parentElement;c.append(u.element),p==null||p.remove()}else console.warn("tpPane is undefined")});function m(p){l=p,t(0,l)}function d(p){u=p,t(1,u)}function f(p){R[p?"unshift":"push"](()=>{c=p,t(4,c)})}return n.$$set=p=>{e=ye(ye({},e),hi(p)),t(5,s=bt(e,i)),"expanded"in p&&t(0,l=p.expanded),"width"in p&&t(2,a=p.width),"tpPane"in p&&t(1,u=p.tpPane),"theme"in p&&t(3,h=p.theme),"$$scope"in p&&t(10,o=p.$$scope)},[l,u,a,h,c,s,r,m,d,f,o]}class Ow extends Ft{constructor(e){super(),Kt(this,e,$5,x5,It,{expanded:0,width:2,tpPane:1,theme:3})}}function xe(n){return n==null}function Rw(n){return n!==null&&typeof n=="object"}function Rv(n){return n!==null&&typeof n=="object"}function V5(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function uo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return Rv(r)&&Rv(o)?Object.assign(Object.assign({},i),{[s]:uo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function k5(n){return Rw(n)?"target"in n:!1}const S5={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let Ps=class wl{static alreadyDisposed(){return new wl({type:"alreadydisposed"})}static notBindable(){return new wl({type:"notbindable"})}static notCompatible(e,t){return new wl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new wl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new wl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=S5[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},H0=class hk{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!hk.isBindable(i))throw Ps.notBindable();if(!(e in i))throw Ps.propertyNotFound(e);i[e]=t}},Pt=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},L5=class{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new Pt,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},A5=class{constructor(e){this.emitter=new Pt,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},M5=class{constructor(e){this.emitter=new Pt,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function Re(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new A5(n):new L5(n,e)}function T5(n){return[new M5(n),(e,t)=>{n.setRawValue(e,t)}]}let S=class ck{constructor(e){this.emitter=new Pt,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:Re(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new ck(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},wh=class{constructor(e){this.values=S.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},jw=class{constructor(e){this.values=S.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return xe(i)||(s=Math.max(s,i)),xe(t)||(s=Math.min(s,t)),s}},D5=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},O5=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const R5={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let j5=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=R5[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const N5={"+":n=>n,"-":n=>-n,"~":n=>~n};let B5=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=N5[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function Nw(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Su(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function I5(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Lu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function F5(n,e){const t=Lu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Lu(n,e);return s===""?"":i+s}function Bw(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=F5(n,e);return i===""?"":t+i}function pk(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=I5(n,e);return e+=i.length,i===""?"":i+Lu(n,e)}function K5(n,e){const t=pk(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Lu(n,e);return e+=s.length,t+i+s+Bw(n,e)}function U5(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Lu(n,e);return e+=i.length,i===""?"":t+i+Bw(n,e)}function H5(n,e){const t=pk(n,e);return e+=t.length,t===""?"":t+Bw(n,e)}const z5=Nw([K5,U5,H5]);function q5(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function G5(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=q5(n,e);return i===""?"":t+i}function Y5(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function X5(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=Y5(n,e);return i===""?"":t+i}function W5(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Z5(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=W5(n,e);return i===""?"":t+i}const Q5=Nw([G5,X5,Z5]),J5=Nw([Q5,z5]);function e3(n,e){const t=J5(n,e);return e+=t.length,t===""?null:{evaluable:new O5(t),cursor:e}}function t3(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=mk(n,e);if(!i)return null;e=i.cursor,e+=Su(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function n3(n,e){var t;return(t=e3(n,e))!==null&&t!==void 0?t:t3(n,e)}function dk(n,e){const t=n3(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=dk(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new B5(i,s.evaluable)}):null}function i3(n,e,t){t+=Su(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Su(e,t).length,{cursor:t,operator:i}):null}function s3(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=i3(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new j5(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const r3=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>s3(n,e),dk);function mk(n,e){return e+=Su(n,e).length,r3(n,e)}function o3(n){const e=mk(n,0);return!e||e.cursor+Su(n,e.cursor).length!==n.length?null:e.evaluable}function Wn(n){var e;const t=o3(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function Iw(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Wn(n);if(!xe(e))return e}return 0}function at(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function $(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function z0(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ke(n,e,t){return Math.min(Math.max(n,e),t)}function vk(n,e){return(n%e+e)%e}function l3(n,e){return xe(n.step)?Math.max(z0(e),2):z0(n.step)}function fk(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function a3(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function Fw(n,e){return xe(n.step)?null:new D5(n.step,e)}function Kw(n){return!xe(n.max)&&!xe(n.min)?new wh({max:n.max,min:n.min}):!xe(n.max)||!xe(n.min)?new jw({max:n.max,min:n.min}):null}function Uw(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:at(l3(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:fk(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:a3(n,e)}}function Hw(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function zw(n){return{constraint:n.constraint,textProps:S.fromObject(Uw(n.params,n.initialValue))}}let Oo=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Ro=class{constructor(e){this.target=e}},Tp=class extends Ro{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},u3=class extends Ro{constructor(e,t){super(e),this.expanded=t}},h3=class extends Ro{constructor(e,t){super(e),this.index=t}},qw=class extends Oo{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Pt,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new Tp(this,t.binding.target.read(),e.options.last))}};function c3(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function p3(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function d3(n){return n===null?!1:typeof n=="object"}function Xi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function q0(n){return{custom:e=>Xi(e)(n),boolean:Xi(e=>typeof e=="boolean"?e:void 0)(n),number:Xi(e=>typeof e=="number"?e:void 0)(n),string:Xi(e=>typeof e=="string"?e:void 0)(n),function:Xi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Xi(t=>t===e?e:void 0)(n),raw:Xi(e=>e)(n),object:e=>Xi(t=>{if(d3(t))return c3(t,e)})(n),array:e=>Xi(t=>{if(Array.isArray(t))return p3(t,e)})(n)}}const jv={optional:q0(!0),required:q0(!1)};function je(n,e){const t=e(jv),i=jv.required.object(t)(n);return i.succeeded?i.value:void 0}function Jn(n,e,t,i){if(e&&!e(n))return!1;const s=je(n,t);return s?i(s):!1}function ei(n,e){var t;return uo((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function bc(n){return"value"in n}function m3(n){if(!Rw(n)||!("binding"in n))return!1;const e=n.binding;return k5(e)}const Qe="http://www.w3.org/2000/svg";function Xc(n){n.offsetHeight}function v3(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function Dp(n){return n.ontouchstart!==void 0}function f3(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const w3={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Op(n,e){const t=n.createElementNS(Qe,"svg");return t.innerHTML=w3[e],t}function wk(n,e,t){n.insertBefore(e,n.children[t])}function Gw(n){n.parentElement&&n.parentElement.removeChild(n)}function _k(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function _3(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function Yw(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function qn(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function Gn(n,e,t){qn(n.value(e),t)}const b3="tp";function L(n){return(t,i)=>[b3,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const Fa=L("lbl");function g3(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let bk=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Fa()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Fa("l")),Gn(t.props,"label",r=>{xe(r)?this.element.classList.add(Fa(void 0,"nol")):(this.element.classList.remove(Fa(void 0,"nol")),_3(i),i.appendChild(g3(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(Fa("v")),this.element.appendChild(s),this.valueElement=s}},Rp=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new bk(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Jn(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return ei(null,{label:this.props.get("label")})}};function C3(){return["veryfirst","first","last","verylast"]}const G0=L(""),Y0={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let _h=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{C3().forEach(i=>{t.classList.remove(G0(void 0,Y0[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(G0(void 0,Y0[i]))})}),this.viewProps.handleDispose(()=>{Gw(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Jn(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return ei(null,Object.assign({},this.viewProps.exportState()))}};class Wc extends _h{constructor(e,t){if(t.value!==t.valueController.value)throw Ps.shouldNeverHappen();const i=t.valueController.viewProps,s=new Rp(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new bk(e,{props:t.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return Jn(e,t=>{var i,s,r;return super.importState(t)&&this.labelController.importProps(t)&&((r=(s=(i=this.valueController).importProps)===null||s===void 0?void 0:s.call(i,e))!==null&&r!==void 0?r:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,i;return ei(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:{}))}}function gk(n,e){for(;n.length<e;)n.push(void 0)}function P3(n){const e=[];return gk(e,n),e}function y3(n){const e=n.indexOf(void 0);return e<0?n:n.slice(0,e)}function E3(n,e){const t=[...y3(n),e];return t.length>n.length?t.splice(0,t.length-n.length):gk(t,n.length),t}let x3=class extends Oo{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new Ro(this))}),this}};function $3(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function Dr(n,e){return t=>{$3(n,e,t)}}function Xw(n,e){qn(n,t=>{e.textContent=t??""})}const am=L("btn");let V3=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(am()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(am("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(am("t")),Xw(t.props.value("title"),s),this.buttonElement.appendChild(s)}},Ck=class{constructor(e,t){this.emitter=new Pt,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new V3(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Jn(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return ei(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},X0=class extends _h{constructor(e,t){const i=new Ck(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new Rp(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Jn(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return ei(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},k3=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const S3=new k3("2.0.0-beta.2");function Ne(n){return Object.assign({core:S3},n)}Ne({id:"button",type:"blade",accept(n){const e=je(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new X0(n.document,{blade:n.blade,buttonProps:S.fromObject({title:n.params.title}),labelProps:S.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof X0?new x3(n.controller):null}});function L3(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function A3(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function M3(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function T3(n){return Rw(n)?"refresh"in n&&typeof n.refresh=="function":!1}function D3(n,e){if(!H0.isBindable(n))throw Ps.notBindable();return new H0(n,e)}let O3=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Pt,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,D3(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return A3(this,e)}addButton(e){return L3(this,e)}addTab(e){return M3(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{T3(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=m3(t.value)?t.value.binding:null;this.emitter_.emit("change",new Tp(i,s?s.target.read():t.value.rawValue,e.options.last))}},Ww=class extends Oo{constructor(e,t){super(e),this.rackApi_=new O3(e.rackController,t)}},Zw=class extends _h{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Jn(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return ei(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Nv(n){return"rackController"in n}let R3=class{constructor(e){this.emitter=new Pt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Ps.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function j3(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(bc(i)&&i.value===e)return i}return null}function N3(n){return Nv(n)?n.rackController.rack.bcSet_:null}let B3=class{constructor(e){var t,i;this.emitter=new Pt,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new R3(N3),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),bc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Nv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(bc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Nv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=j3(this.find(bc),e.sender);if(!t)throw Ps.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Qw=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new B3({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&wk(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Gw(e.bladeController.view.element)}};function Pk(){return new S({positions:Re([],{equals:V5})})}let jp=class yk extends S{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=S.createCore(t);return new yk(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!xe(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Gn(this,"expanded",i),Gn(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function I3(n,e){let t=0;return v3(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),Xc(e),t=e.clientHeight,n.set("temporaryExpanded",null),Xc(e)}),t}function W0(n,e){e.style.height=n.styleHeight}function Np(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),xe(n.get("expandedHeight"))){const t=I3(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),Xc(e)}),n.emitter.on("change",()=>{W0(n,e)}),W0(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let F3=class extends Ww{constructor(e,t){super(e,t),this.emitter_=new Pt,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new u3(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.rackApi_.refresh()}};const Ek=L("cnt");let K3=class{constructor(e,t){var i;this.className_=L((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Ek()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Gn(this.foldable_,"completed",Dr(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),Gn(t.props,"title",u=>{xe(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Xw(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},Z0=class extends Zw{constructor(e,t){var i;const s=jp.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new K3(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Qw({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,Np(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Jn(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return ei(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};Ne({id:"folder",type:"blade",accept(n){const e=je(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new Z0(n.document,{blade:n.blade,expanded:n.params.expanded,props:S.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof Z0?new F3(n.controller,n.pool):null}});const U3=L("");function Q0(n,e){return Dr(n,U3(void 0,e))}let ho=class xk extends S{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=T5(Re(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new xk(S.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){qn(this.globalDisabled_,Q0(e,"disabled")),Gn(this,"hidden",Q0(e,"hidden"))}bindDisabled(e){qn(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){qn(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const J0=L("tbp");let H3=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(J0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(J0("c")),this.element.appendChild(i),this.containerElement=i}};const Ka=L("tbi");let z3=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ka()),t.viewProps.bindClassModifiers(this.element),Gn(t.props,"selected",r=>{r?this.element.classList.add(Ka(void 0,"sel")):this.element.classList.remove(Ka(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Ka("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Ka("t")),Xw(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},q3=class{constructor(e,t){this.emitter=new Pt,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new z3(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Bv=class extends Zw{constructor(e,t){const i=new H3(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Qw({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new q3(e,{props:t.itemProps,viewProps:ho.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Gn(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Jn(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return ei(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},G3=class extends Ww{constructor(e,t){super(e,t),this.emitter_=new Pt,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new Bv(t,{blade:Pk(),itemProps:S.fromObject({selected:!1,title:e.title}),props:S.fromObject({selected:!1}),viewProps:ho.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new h3(this,e.rawValue))}},Y3=class extends Ww{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}refresh(){this.rackApi_.refresh()}};const eP=-1;let X3=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Re(!0),this.selectedIndex=Re(eP),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=eP,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const Ua=L("tab");let W3=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ua(),Ek()),t.viewProps.bindClassModifiers(this.element),qn(t.empty,Dr(this.element,Ua(void 0,"nop")));const i=e.createElement("div");i.classList.add(Ua("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(Ua("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(Ua("c")),this.element.appendChild(r),this.contentsElement=r}},tP=class extends Zw{constructor(e,t){const i=new X3,s=new W3(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Qw({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;wk(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Gw(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};Ne({id:"tab",type:"blade",accept(n){const e=je(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new tP(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new Bv(n.document,{blade:Pk(),itemProps:S.fromObject({selected:!1,title:t.title}),props:S.fromObject({selected:!1}),viewProps:ho.create()});e.add(i)}),e},api(n){return n.controller instanceof tP?new G3(n.controller,n.pool):n.controller instanceof Bv?new Y3(n.controller,n.pool):null}});let Jw=class extends qw{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},Z3=class{constructor(){this.disabled=!1,this.emitter=new Pt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}},Q3=class{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new Pt,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}},fa=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function Au(n,e){if(n instanceof e)return n;if(n instanceof fa){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let Bp=class{constructor(e){this.values=S.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Ip(n){var e;const t=jv;if(Array.isArray(n))return(e=je({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function $k(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function e_(n){return xe(n)?null:new Bp($k(n))}const um=L("lst");let J3=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(um()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(um("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(um("m")),s.appendChild(Op(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Gn(this.props_,"options",r=>{_k(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Yl=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new J3(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Jn(e,null,t=>({options:t.required.custom(Ip)}),t=>(this.props.set("options",$k(t.options)),!0))}exportProps(){return ei(null,{options:this.props.get("options")})}};const nP=L("pop");let eK=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nP()),t.viewProps.bindClassModifiers(this.element),qn(t.shows,Dr(this.element,nP(void 0,"v")))}},t_=class{constructor(e,t){this.shows=Re(!1),this.viewProps=t.viewProps,this.view=new eK(e,{shows:this.shows,viewProps:this.viewProps})}};const iP=L("txt");let tK=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(iP()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(iP("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},Fp=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new tK(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);xe(s)||(this.value.rawValue=s),this.view.refresh()}};function nK(n){return String(n)}function n_(n){return n==="false"?!1:!!n}function sP(n){return nK(n)}function iK(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const sK=at(0);function Zc(n){return sK(n)+"%"}function i_(n){return String(n)}function Iv(n){return n}function jo({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Je(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function co(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Zn(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function rK(n){return n==="ArrowUp"||n==="ArrowDown"}function Qc(n){return rK(n)||n==="ArrowLeft"||n==="ArrowRight"}function hm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Ss=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Pt,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(hm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(hm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(hm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const $n=L("txt");let oK=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add($n(),$n(void 0,"num")),t.arrayPosition&&this.element.classList.add($n(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add($n("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add($n()),this.inputElement.classList.add($n("i"));const s=e.createElement("div");s.classList.add($n("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(Qe,"svg");r.classList.add($n("g")),this.knobElement.appendChild(r);const o=e.createElementNS(Qe,"path");o.classList.add($n("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(Qe,"path");l.classList.add($n("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(L("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove($n(void 0,"drg"));return}this.element.classList.add($n(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=ke(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},bh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=Re(null),this.view=new oK(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Ss(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);xe(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Je(this.props.get("keyScale"),co(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Je(this.props.get("keyScale"),co(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const cm=L("sld");let lK=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(cm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(cm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(cm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=ke($(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},aK=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new lK(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ss(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue($(ke(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Je(this.props.get("keyScale"),Zn(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Je(this.props.get("keyScale"),Zn(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const pm=L("sldtxt");let uK=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pm());const i=e.createElement("div");i.classList.add(pm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(pm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},rP=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new aK(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new bh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new uK(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Jn(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return ei(null,{max:e.get("max"),min:e.get("min")})}};function hK(n){return{sliderProps:new S({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new S({formatter:Re(n.formatter),keyScale:n.keyScale,pointerScale:Re(n.pointerScale)})}}const cK={containerUnitSize:"cnt-usz"};function Vk(n){return`--${cK[n]}`}class kk{constructor(e,t){const i=L(t.viewName);this.element=e.createElement("div"),this.element.classList.add(i()),t.viewProps.bindClassModifiers(this.element)}}function Mu(n){return Hw(n)}function ur(n){if(Rv(n))return je(n,Mu)}function ss(n,e){if(!n)return;const t=[],i=Fw(n,e);i&&t.push(i);const s=Kw(n);return s&&t.push(s),new fa(t)}function Sk(n){if(n==="inline"||n==="popup")return n}function Or(n,e){n.write(e)}const ec=L("ckb");let pK=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ec()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(ec("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(ec("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(ec("w")),i.appendChild(r);const o=Op(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},dK=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new pK(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function mK(n){const e=[],t=e_(n.options);return t&&e.push(t),new fa(e)}Ne({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=je(e,i=>({options:i.optional.custom(Ip),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>n_,constraint:n=>mK(n.params),writer:n=>Or},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Au(i,Bp);return s?new Yl(e,{props:new S({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new dK(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Yl?new Jw(n.controller):null}});const Ur=L("col");let vK=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ur()),t.foldable.bindExpandedClass(this.element,Ur(void 0,"expanded")),Gn(t.foldable,"completed",Dr(this.element,Ur(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Ur("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Ur("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Ur("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Ur("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function fK(n,e,t){const i=ke(n/255,0,1),s=ke(e/255,0,1),r=ke(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function wK(n,e,t){const i=(n%360+360)%360,s=ke(e/100,0,1),r=ke(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function _K(n,e,t){const i=ke(n/255,0,1),s=ke(e/255,0,1),r=ke(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function Lk(n,e,t){const i=vk(n,360),s=ke(e/100,0,1),r=ke(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function bK(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function gK(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function vi(n){return[n[0],n[1],n[2]]}function Kp(n,e){return[n[0],n[1],n[2],e]}const CK={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:bK,rgb:wK},hsv:{hsl:gK,hsv:(n,e,t)=>[n,e,t],rgb:Lk},rgb:{hsl:fK,hsv:_K,rgb:(n,e,t)=>[n,e,t]}};function Xl(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function PK(n,e){return n===e?e:vk(n,e)}function Ak(n,e,t){var i;const s=Xl(e,t);return[e==="rgb"?ke(n[0],0,s[0]):PK(n[0],s[0]),ke(n[1],0,s[1]),ke(n[2],0,s[2]),ke((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function oP(n,e,t,i){const s=Xl(e,t),r=Xl(e,i);return n.map((o,l)=>o/s[l]*r[l])}function Mk(n,e,t){const i=oP(n,e.mode,e.type,"int"),s=CK[e.mode][t.mode](...i);return oP(s,t.mode,"int",t.type)}let ce=class Tk{static black(){return new Tk([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=Ak(e,t,this.type)}getComponents(e){return Kp(Mk(vi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const js=L("colp");let yK=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(js()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(js("hsv"));const s=e.createElement("div");s.classList.add(js("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(js("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(js("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(js("a"));const a=e.createElement("div");a.classList.add(js("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(js("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function EK(n){return n==="int"?"int":n==="float"?"float":void 0}function s_(n){return je(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(EK)}),expanded:e.optional.boolean,picker:e.optional.custom(Sk),readonly:e.optional.constant(!1)}))}function po(n){return n?.1:1}function Dk(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let r_=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=Ak(e,t,this.type)}getComponents(e){return Kp(Mk(vi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const xK={int:(n,e)=>new ce(n,e),float:(n,e)=>new r_(n,e)};function o_(n,e,t){return xK[t](n,e)}function $K(n){return n.type==="float"}function VK(n){return n.type==="int"}function kK(n){const e=n.getComponents(),t=Xl(n.mode,"int");return new ce([Math.round($(e[0],0,1,0,t[0])),Math.round($(e[1],0,1,0,t[1])),Math.round($(e[2],0,1,0,t[2])),e[3]],n.mode)}function SK(n){const e=n.getComponents(),t=Xl(n.mode,"int");return new r_([$(e[0],0,t[0],0,1),$(e[1],0,t[1],0,1),$(e[2],0,t[2],0,1),e[3]],n.mode)}function Mt(n,e){if(n.type===e)return n;if(VK(n)&&e==="float")return SK(n);if($K(n)&&e==="int")return kK(n);throw Ps.shouldNeverHappen()}function LK(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Nn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const AK={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function Ok(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return AK[i](t)}function Rk(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Nn(e[1],255),Nn(e[2],255),Nn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function MK(n){const e=Rk(n);return e?new ce(e,"rgb"):null}function jk(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Nn(e[1],255),Nn(e[2],255),Nn(e[3],255),Nn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function TK(n){const e=jk(n);return e?new ce(e,"rgb"):null}function Nk(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Ok(e[1]),Nn(e[2],100),Nn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function DK(n){const e=Nk(n);return e?new ce(e,"hsl"):null}function Bk(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Ok(e[1]),Nn(e[2],100),Nn(e[3],100),Nn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function OK(n){const e=Bk(n);return e?new ce(e,"hsl"):null}function Ik(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function RK(n){const e=Ik(n);return e?new ce(e,"rgb"):null}function Fk(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),$(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),$(parseInt(t[4],16),0,255,0,1)]:null}function jK(n){const e=Fk(n);return e?new ce(e,"rgb"):null}function Kk(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function lP(n){return e=>{const t=Kk(e);return t?o_(t,"rgb",n):null}}function Uk(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function aP(n){return e=>{const t=Uk(e);return t?o_(t,"rgb",n):null}}const NK=[{parser:Ik,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Fk,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Rk,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:jk,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Nk,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Bk,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Kk,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Uk,result:{alpha:!0,mode:"rgb",notation:"object"}}];function BK(n){return NK.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function IK(n,e="int"){const t=BK(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function gh(n){const e=[RK,jK,MK,TK,DK,OK];n==="int"&&e.push(lP("int"),aP("int")),n==="float"&&e.push(lP("float"),aP("float"));const t=iK(e);return i=>{const s=t(i);return s?Mt(s,n):null}}function FK(n){const e=gh("int");if(typeof n!="string")return ce.black();const t=e(n);return t??ce.black()}function Hk(n){const e=ke(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function l_(n,e="#"){const t=vi(n.getComponents("rgb")).map(Hk).join("");return`${e}${t}`}function a_(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(Hk).join("");return`${e}${i}`}function zk(n){const e=at(0),t=Mt(n,"int");return`rgb(${vi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function gc(n){const e=at(2),t=at(0);return`rgba(${Mt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function KK(n){const e=[at(0),Zc,Zc],t=Mt(n,"int");return`hsl(${vi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function UK(n){const e=[at(0),Zc,Zc,at(2)];return`hsla(${Mt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function qk(n,e){const t=at(e==="float"?2:0),i=["r","g","b"],s=Mt(n,e);return`{${vi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function HK(n){return e=>qk(e,n)}function Gk(n,e){const t=at(2),i=at(e==="float"?2:0),s=["r","g","b","a"];return`{${Mt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function zK(n){return e=>Gk(e,n)}const qK=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:l_},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:a_},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:zk},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:gc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:KK},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:UK},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:HK(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:zK(e)}],[])];function Yk(n){return qK.reduce((e,t)=>e||(LK(t.format,n)?t.stringifier:null),null)}const Ha=L("apl");let GK=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ha()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Ha("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Ha("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(Ha("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(Ha("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new ce([t[0],t[1],t[2],0],"rgb"),s=new ce([t[0],t[1],t[2],255],"rgb"),r=["to right",gc(i),gc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=gc(e);const o=$(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},YK=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new GK(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ss(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ce([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Je(po(!0),Zn(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ce([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Je(po(!0),Zn(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Xo=L("coltxt");function XK(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let WK=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xo()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Xo("m")),this.modeElem_=XK(e),this.modeElem_.classList.add(Xo("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(Xo("mm")),s.appendChild(Op(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(Xo("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),qn(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){_k(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(Xo("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function ZK(n){return at(n==="float"?2:0)}function QK(n,e,t){const i=Xl(n,e)[t];return new wh({min:0,max:i})}function JK(n,e,t){return new bh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:S.fromObject({formatter:ZK(e.colorType),keyScale:po(!1),pointerScale:e.colorType==="float"?.01:1}),value:Re(0,{constraint:QK(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function e6(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Wn,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=JK(n,t,i);return jo({primary:e.value,secondary:s.value,forward(r){return Mt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Mt(r,e.colorType).getComponents(l);u[i]=o;const h=o_(Kp(vi(u),u[3]),l,e.colorType);return Mt(h,"int")}}),s})}function t6(n,e){const t=new Fp(n,{parser:gh("int"),props:S.fromObject({formatter:l_}),value:Re(ce.black()),viewProps:e.viewProps});return jo({primary:e.value,secondary:t.value,forward:i=>new ce(vi(i.getComponents()),i.mode),backward:(i,s)=>new ce(Kp(vi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function n6(n){return n!=="hex"}let i6=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=Re(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new WK(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return n6(t)?e6(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):t6(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const dm=L("hpl");let s6=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(dm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(dm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(dm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=zk(new ce([t,100,100],"hsv"));const i=$(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},r6=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new s6(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ss(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=$(ke(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ce([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Je(po(!1),Zn(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ce([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Je(po(!1),Zn(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const mm=L("svp"),uP=64;let o6=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(mm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=uP,i.width=uP,i.classList.add(mm("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(mm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=f3(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const m=$(c,0,s,0,100),d=$(h,0,r,100,0),f=Lk(i[0],m,d),p=(h*s+c)*4;l[p]=f[0],l[p+1]=f[1],l[p+2]=f[2],l[p+3]=255}e.putImageData(o,0,0);const a=$(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=$(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},l6=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new o6(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ss(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=$(e.point.x,0,e.bounds.width,0,100),s=$(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ce([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Qc(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=po(!1),l=Je(o,Zn(e)),a=Je(o,co(e));l===0&&a===0||this.value.setRawValue(new ce([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=po(!1),i=Je(t,Zn(e)),s=Je(t,co(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},a6=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new r6(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new l6(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new YK(e,{value:this.value,viewProps:this.viewProps}),text:new bh(e,{parser:Wn,props:S.fromObject({pointerScale:.01,keyScale:.1,formatter:at(2)}),value:Re(0,{constraint:new wh({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&jo({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new ce(r,i.mode)}}),this.textsC_=new i6(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new yK(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const vm=L("colsw");let u6=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(vm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(vm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(vm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=a_(e)}onValueChange_(){this.update_()}},h6=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new u6(e,{value:this.value,viewProps:this.viewProps})}},u_=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=jp.create(t.expanded),this.swatchC_=new h6(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Fp(e,{parser:t.parser,props:S.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new vK(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new t_(e,{viewProps:this.viewProps}):null;const s=new a6(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),jo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Np(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Yw(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Dp(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function c6(n){return vi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function p6(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function d6(n){return new ce([n>>16&255,n>>8&255,n&255],"rgb")}function m6(n){return new ce([n>>24&255,n>>16&255,n>>8&255,$(n&255,0,255,0,1)],"rgb")}function v6(n){return typeof n!="number"?ce.black():d6(n)}function f6(n){return typeof n!="number"?ce.black():m6(n)}function Cc(n,e){return typeof n!="object"||xe(n)?!1:e in n&&typeof n[e]=="number"}function Xk(n){return Cc(n,"r")&&Cc(n,"g")&&Cc(n,"b")}function Wk(n){return Xk(n)&&Cc(n,"a")}function Zk(n){return Xk(n)}function h_(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function hP(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function w6(n){const e=Yk(n);return e?(t,i)=>{Or(t,e(i))}:null}function _6(n){const e=n?p6:c6;return(t,i)=>{Or(t,e(i))}}function b6(n,e,t){const s=Mt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function g6(n,e,t){const s=Mt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function C6(n,e){return(t,i)=>{n?b6(t,i,e):g6(t,i,e)}}function P6(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function y6(n){return n?e=>a_(e,"0x"):e=>l_(e,"0x")}function E6(n){return"color"in n||n.view==="color"}Ne({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!E6(e))return null;const t=s_(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:P6(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?f6:v6,equals:h_,writer:n=>_6(n.params.supportsAlpha)},controller:n=>{var e,t;return new u_(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:y6(n.params.supportsAlpha),parser:gh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function x6(n,e){if(!Zk(n))return Mt(ce.black(),e);if(e==="int"){const t=hP(n);return new ce(t,"rgb")}if(e==="float"){const t=hP(n);return new r_(t,"rgb")}return Mt(ce.black(),"int")}function $6(n){return Wk(n)}function V6(n){return e=>{const t=x6(e,n);return Mt(t,"int")}}function k6(n,e){return t=>n?Gk(t,e):qk(t,e)}Ne({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!Zk(n))return null;const i=s_(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=Dk(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>V6(n.params.colorType),equals:h_,writer:n=>C6($6(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=Wk(n.initialValue);return new u_(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:k6(i,n.params.colorType),parser:gh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});Ne({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=IK(n,Dk(e));if(!t)return null;const i=Yk(t);if(!i)return null;const s=s_(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>FK,equals:h_,writer:n=>{const e=w6(n.params.format);if(!e)throw Ps.notBindable();return e}},controller:n=>{var e,t;return new u_(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:gh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let Up=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const cP=L("pndtxt");let S6=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(cP()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(cP("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function L6(n,e,t){return new bh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:Re(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let wa=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>L6(e,t,s)),this.acs_.forEach((i,s)=>{jo({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new S6(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},A6=class extends qw{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function M6(n,e){const t=[],i=Fw(n,e);i&&t.push(i);const s=Kw(n);s&&t.push(s);const r=e_(n.options);return r&&t.push(r),new fa(t)}Ne({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=je(e,i=>Object.assign(Object.assign({},Hw(i)),{options:i.optional.custom(Ip),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Iw,constraint:n=>M6(n.params,n.initialValue),writer:n=>Or},controller:n=>{const e=n.value,t=n.constraint,i=t&&Au(t,Bp);if(i)return new Yl(n.document,{props:new S({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=Uw(n.params,e.rawValue),r=t&&Au(t,wh);return r?new rP(n.document,Object.assign(Object.assign({},hK(Object.assign(Object.assign({},s),{keyScale:Re(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Wn,value:e,viewProps:n.viewProps})):new bh(n.document,{parser:Wn,props:S.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof rP?new A6(n.controller):n.controller.valueController instanceof Yl?new Jw(n.controller):null}});let wr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(xe(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const Qk={toComponents:n=>n.getComponents(),fromComponents:n=>new wr(...n)},Wo=L("p2d");let T6=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Wo()),t.viewProps.bindClassModifiers(this.element),qn(t.expanded,Dr(this.element,Wo(void 0,"expanded")));const i=e.createElement("div");i.classList.add(Wo("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(Wo("b")),s.appendChild(Op(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(Wo("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Wo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Ns=L("p2dp");let D6=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Ns()),t.layout==="popup"&&this.element.classList.add(Ns(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ns("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(Qe,"svg");s.classList.add(Ns("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(Qe,"line");r.classList.add(Ns("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(Qe,"line");o.classList.add(Ns("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(Qe,"line");l.classList.add(Ns("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Ns("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=$(e,-i,+i,0,100),r=$(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function pP(n,e,t){return[Je(e[0],Zn(n)),Je(e[1],co(n))*(t?1:-1)]}let O6=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new D6(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ss(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=$(e.point.x,0,e.bounds.width,-i,+i),r=$(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new wr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Qc(e.key)&&e.preventDefault();const[t,i]=pP(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new wr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=pP(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},R6=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=jp.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new t_(e,{viewProps:this.viewProps}):null;const r=new O6(e,{layout:t.pickerLayout,props:new S({invertsY:Re(t.invertsY),max:Re(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new wa(e,{assembly:Qk,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new T6(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),jo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Np(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Yw(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Dp(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function j6(n){return wr.isObject(n)?new wr(n.x,n.y):new wr}function N6(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function B6(n,e){return new Up({assembly:Qk,components:[ss(Object.assign(Object.assign({},n),n.x),e.x),ss(Object.assign(Object.assign({},n),n.y),e.y)]})}function dP(n,e){var t,i;if(!xe(n.min)||!xe(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=fk(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function I6(n,e){var t,i;const s=dP(uo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=dP(uo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function F6(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}Ne({id:"input-point2d",type:"input",accept:(n,e)=>{if(!wr.isObject(n))return null;const t=je(e,i=>Object.assign(Object.assign({},Mu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(Sk),readonly:i.optional.constant(!1),x:i.optional.custom(ur),y:i.optional.object(Object.assign(Object.assign({},Mu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>j6,constraint:n=>B6(n.params,n.initialValue),equals:wr.equals,writer:()=>N6},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new R6(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return zw({constraint:r.components[a],initialValue:l,params:uo(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:F6(n.params),max:I6(n.params,s.rawValue),parser:Wn,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let kl=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(xe(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const Jk={toComponents:n=>n.getComponents(),fromComponents:n=>new kl(...n)};function K6(n){return kl.isObject(n)?new kl(n.x,n.y,n.z):new kl}function U6(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function H6(n,e){return new Up({assembly:Jk,components:[ss(Object.assign(Object.assign({},n),n.x),e.x),ss(Object.assign(Object.assign({},n),n.y),e.y),ss(Object.assign(Object.assign({},n),n.z),e.z)]})}Ne({id:"input-point3d",type:"input",accept:(n,e)=>{if(!kl.isObject(n))return null;const t=je(e,i=>Object.assign(Object.assign({},Mu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(ur),y:i.optional.custom(ur),z:i.optional.custom(ur)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>K6,constraint:n=>H6(n.params,n.initialValue),equals:kl.equals,writer:n=>U6},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new wa(n.document,{assembly:Jk,axes:e.rawValue.getComponents().map((s,r)=>{var o;return zw({constraint:t.components[r],initialValue:s,params:uo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Wn,value:e,viewProps:n.viewProps})}});let Sl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(xe(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const e1={toComponents:n=>n.getComponents(),fromComponents:n=>new Sl(...n)};function z6(n){return Sl.isObject(n)?new Sl(n.x,n.y,n.z,n.w):new Sl}function q6(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function G6(n,e){return new Up({assembly:e1,components:[ss(Object.assign(Object.assign({},n),n.x),e.x),ss(Object.assign(Object.assign({},n),n.y),e.y),ss(Object.assign(Object.assign({},n),n.z),e.z),ss(Object.assign(Object.assign({},n),n.w),e.w)]})}Ne({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Sl.isObject(n))return null;const t=je(e,i=>Object.assign(Object.assign({},Mu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(ur),x:i.optional.custom(ur),y:i.optional.custom(ur),z:i.optional.custom(ur)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>z6,constraint:n=>G6(n.params,n.initialValue),equals:Sl.equals,writer:n=>q6},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new wa(n.document,{assembly:e1,axes:e.rawValue.getComponents().map((s,r)=>{var o;return zw({constraint:t.components[r],initialValue:s,params:uo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Wn,value:e,viewProps:n.viewProps})}});function Y6(n){const e=[],t=e_(n.options);return t&&e.push(t),new fa(e)}Ne({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=je(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Ip)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>i_,constraint:n=>Y6(n.params),writer:n=>Or},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Au(i,Bp);return s?new Yl(e,{props:new S({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Fp(e,{parser:r=>r,props:S.fromObject({formatter:Iv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Yl?new Jw(n.controller):null}});const Ch={monitor:{defaultInterval:200,defaultRows:3}},mP=L("mll");let X6=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(mP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(mP("i")),i.style.height=`calc(var(${Vk("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},c_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new X6(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const vP=L("sgl");let W6=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(vP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(vP("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},p_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new W6(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};Ne({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=je(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>n_},controller:n=>{var e;return n.value.rawValue.length===1?new p_(n.document,{formatter:sP,value:n.value,viewProps:n.viewProps}):new c_(n.document,{formatter:sP,rows:(e=n.params.rows)!==null&&e!==void 0?e:Ch.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let Z6=class extends qw{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Bs=L("grl");let Q6=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Bs()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(Qe,"svg");i.classList.add(Bs("g")),i.style.height=`calc(var(${Vk("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(Qe,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Bs("t"),L("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const m=$(c,0,t,0,e.width),d=$(h,i,s,e.height,0);r.push([m,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(Bs("t","a"));return}const a=$(this.cursor_.rawValue,0,t,0,e.width),u=$(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(Bs("t","a"))||(o.classList.add(Bs("t","a"),Bs("t","in")),Xc(o),o.classList.remove(Bs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},d_=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=Re(-1),this.view=new Q6(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Dp(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Ss(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Jn(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return ei(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor($(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor($(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function Fv(n){return xe(n.format)?at(2):n.format}function J6(n){var e;return n.value.rawValue.length===1?new p_(n.document,{formatter:Fv(n.params),value:n.value,viewProps:n.viewProps}):new c_(n.document,{formatter:Fv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Ch.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function e4(n){var e,t,i;return new d_(n.document,{formatter:Fv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Ch.monitor.defaultRows,props:S.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function fP(n){return n.view==="graph"}Ne({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=je(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>fP(n)?64:1,reader:n=>Iw},controller:n=>fP(n.params)?e4(n):J6(n),api:n=>n.controller.valueController instanceof d_?new Z6(n.controller):null});Ne({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=je(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>i_},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new c_(n.document,{formatter:Iv,rows:(e=n.params.rows)!==null&&e!==void 0?e:Ch.monitor.defaultRows,value:t,viewProps:n.viewProps}):new p_(n.document,{formatter:Iv,value:t,viewProps:n.viewProps})}});class t1{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return(e=this.controller_.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller_.emitter.on(e,()=>{i(new Ro(this))}),this}}class t4 extends Ro{constructor(e,t,i){super(e),this.cell=t,this.index=i}}class n1 extends Oo{constructor(e){super(e),this.cellToApiMap_=new Map,this.emitter_=new Pt;const t=this.controller.valueController;t.cellControllers.forEach((i,s)=>{const r=new t1(i);this.cellToApiMap_.set(i,r),i.emitter.on("click",()=>{const o=s%t.size[0],l=Math.floor(s/t.size[0]);this.emitter_.emit("click",{event:new t4(this,r,[o,l])})})})}cell(e,t){const i=this.controller.valueController,s=i.cellControllers[t*i.size[0]+e];return this.cellToApiMap_.get(s)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s.event)}),this}}class i1{constructor(e,t){this.size=t.size;const[i,s]=this.size,r=[];for(let o=0;o<s;o++)for(let l=0;l<i;l++){const a=new Ck(e,{props:S.fromObject(Object.assign({},t.cellConfig(l,o))),viewProps:ho.create()});r.push(a)}this.cellCs_=r,this.viewProps=ho.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(o=>{o.viewProps.set("disposed",!0)})}),this.view=new kk(e,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(o=>{this.view.element.appendChild(o.view.element)})}get cellControllers(){return this.cellCs_}}class wP extends _h{constructor(e,t){const i=t.valueController,s=new Rp(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}const n4=Ne({id:"buttongrid",type:"blade",accept(n){const e=je(n,t=>({cells:t.required.function,size:t.required.array(t.required.number),view:t.required.constant("buttongrid"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new wP(n.document,{blade:n.blade,labelProps:S.fromObject({label:n.params.label}),valueController:new i1(n.document,{cellConfig:n.params.cells,size:n.params.size})})},api(n){return n.controller instanceof wP?new n1(n.controller):null}});class s1 extends Oo{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get value(){return this.controller.valueController.value.rawValue}set value(e){this.controller.valueController.value.rawValue=e}on(e,t){const i=t.bind(this);return this.controller.valueController.value.emitter.on(e,s=>{i(new Tp(this,s.rawValue,s.options.last))}),this}}function Vn(n,e,t){return n*(1-t)+e*t}const i4=20,s4=.001,fm=100;function r4(n,e){let t=.25,i=.5,s=-1;for(let r=0;r<i4;r++){const[o,l]=n.curve(i);if(i+=t*(o<e?1:-1),s=l,t*=.5,Math.abs(e-o)<s4)break}return s}class kr{constructor(e=0,t=0,i=1,s=1){this.cache_=[],this.comps_=[e,t,i,s]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(e){return xe(e)||!Array.isArray(e)?!1:typeof e[0]=="number"&&typeof e[1]=="number"&&typeof e[2]=="number"&&typeof e[3]=="number"}static equals(e,t){return e.x1===t.x1&&e.y1===t.y1&&e.x2===t.x2&&e.y2===t.y2}curve(e){const t=Vn(0,this.x1,e),i=Vn(0,this.y1,e),s=Vn(this.x1,this.x2,e),r=Vn(this.y1,this.y2,e),o=Vn(this.x2,1,e),l=Vn(this.y2,1,e),a=Vn(t,s,e),u=Vn(i,r,e),h=Vn(s,o,e),c=Vn(r,l,e);return[Vn(a,h,e),Vn(u,c,e)]}y(e){if(this.cache_.length===0){const t=[];for(let i=0;i<fm;i++)t.push(r4(this,$(i,0,fm-1,0,1)));this.cache_=t}return this.cache_[Math.round($(ke(e,0,1),0,1,0,fm-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const m_={toComponents:n=>n.toObject(),fromComponents:n=>new kr(...n)};function o4(n){const e=at(2);return`cubic-bezier(${n.toObject().map(i=>e(i)).join(", ")})`}const _P=[0,.5,.5,1];function l4(n){const e=n.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!e)return new kr(..._P);const t=[e[1],e[2],e[3],e[4]].reduce((i,s)=>{if(!i)return null;const r=Number(s);return isNaN(r)?null:[...i,r]},[]);return new kr(...t??_P)}const Hr=L("cbz");class r1{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Hr()),t.viewProps.bindClassModifiers(this.element),t.foldable.bindExpandedClass(this.element,Hr(void 0,"expanded")),Gn(t.foldable,"completed",Dr(this.element,Hr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Hr("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(Hr("b")),t.viewProps.bindDisabled(s);const r=e.createElementNS(Qe,"svg");r.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',s.appendChild(r),i.appendChild(s),this.buttonElement=s;const o=e.createElement("div");if(o.classList.add(Hr("t")),i.appendChild(o),this.textElement=o,t.pickerLayout==="inline"){const l=e.createElement("div");l.classList.add(Hr("p")),this.element.appendChild(l),this.pickerElement=l}else this.pickerElement=null}}const wm=L("cbzp");class o1{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(wm("g")),this.element.appendChild(i),this.graphElement=i;const s=e.createElement("div");s.classList.add(wm("t")),this.element.appendChild(s),this.textElement=s}}function l1(n,e){const t=new MutationObserver(s=>{for(const r of s)r.type==="childList"&&r.addedNodes.forEach(o=>{o.contains(o)&&(e(),t.disconnect())})}),i=n.ownerDocument;t.observe(i.body,{attributes:!0,childList:!0,subtree:!0})}const Is=L("cbzg");function a4(n,e){return t=>e(n(t))}class a1{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Is()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Is("p")),this.element.appendChild(i),this.previewElement=i;const s=e.createElementNS(Qe,"svg");s.classList.add(Is("g")),this.element.appendChild(s),this.svgElem_=s;const r=e.createElementNS(Qe,"path");r.classList.add(Is("u")),this.svgElem_.appendChild(r),this.guideElem_=r;const o=e.createElementNS(Qe,"polyline");o.classList.add(Is("l")),this.svgElem_.appendChild(o),this.lineElem_=o,this.handleElems_=[e.createElement("div"),e.createElement("div")],this.handleElems_.forEach(l=>{l.classList.add(Is("h")),this.element.appendChild(l)}),this.vectorElems_=[e.createElementNS(Qe,"line"),e.createElementNS(Qe,"line")],this.vectorElems_.forEach(l=>{l.classList.add(Is("v")),this.svgElem_.appendChild(l)}),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=t.selection,this.handleElems_.forEach((l,a)=>{qn(this.sel_,a4(u=>u===a,Dr(l,Is("h","sel"))))}),l1(this.element,()=>{this.refresh()})}getVertMargin_(e){return e*.25}valueToPosition(e,t){const{clientWidth:i,clientHeight:s}=this.element,r=this.getVertMargin_(s);return{x:$(e,0,1,0,i),y:$(t,0,1,s-r,r)}}positionToValue(e,t){const i=this.element.getBoundingClientRect(),s=i.width,r=i.height,o=this.getVertMargin_(r);return{x:ke($(e,0,s,0,1),0,1),y:$(t,r-o,o,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(r=>{const o=this.valueToPosition(0,r),l=this.valueToPosition(1,r);return[`M ${o.x},${o.y}`,`L ${l.x},${l.y}`].join(" ")}).join(" "));const e=this.value_.rawValue,t=[];let i=0;for(;;){const r=this.valueToPosition(...e.curve(i));if(t.push([r.x,r.y].join(",")),i>=1)break;i=Math.min(i+.05,1)}this.lineElem_.setAttributeNS(null,"points",t.join(" "));const s=e.toObject();[0,1].forEach(r=>{const o=this.valueToPosition(r,r),l=this.valueToPosition(s[r*2],s[r*2+1]),a=this.vectorElems_[r];a.setAttributeNS(null,"x1",String(o.x)),a.setAttributeNS(null,"y1",String(o.y)),a.setAttributeNS(null,"x2",String(l.x)),a.setAttributeNS(null,"y2",String(l.y));const u=this.handleElems_[r];u.style.left=`${l.x}px`,u.style.top=`${l.y}px`})}onValueChange_(){this.refresh()}}const bP=24,gP=400,CP=1e3,Zo=L("cbzprv");class u1{constructor(e,t){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Zo()),t.viewProps.bindClassModifiers(this.element);const i=e.createElementNS(Qe,"svg");i.classList.add(Zo("g")),this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(Qe,"path");s.classList.add(Zo("t")),this.svgElem_.appendChild(s),this.ticksElem_=s;const r=e.createElement("div");r.classList.add(Zo("m")),this.element.appendChild(r),this.markerElem_=r,this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_),t.viewProps.handleDispose(this.onDispose_),l1(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(Zo("m","a")),this.startTime_=new Date().getTime()+gP,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(Zo("m","a"))}onDispose_(){this.stop()}updateMarker_(e){const t=this.value_.rawValue.y(ke(e,0,1));this.markerElem_.style.left=`${t*100}%`}refresh(){const{clientWidth:e,clientHeight:t}=this.svgElem_,i=[],s=this.value_.rawValue;for(let r=0;r<bP;r++){const o=$(r,0,bP-1,0,1),l=$(s.y(o),0,1,0,e);i.push(`M ${l},0 v${t}`)}this.ticksElem_.setAttributeNS(null,"d",i.join(" "))}onTimer_(){if(this.startTime_===null)return;const e=new Date().getTime()-this.startTime_,t=e/CP;this.updateMarker_(t),e>CP+gP&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function Kv(n,e,t,i){const s=t-n,r=i-e;return Math.sqrt(s*s+r*r)}function u4(n,e,t,i){const s=Kv(n,e,t,i),r=Math.atan2(i-e,t-n),o=Math.round(r/(Math.PI/4))*Math.PI/4;return{x:n+Math.cos(o)*s,y:e+Math.sin(o)*s}}class h1{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.keyScale_=t.keyScale,this.value=t.value,this.sel_=Re(0),this.viewProps=t.viewProps,this.view=new a1(e,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new u1(e,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",s=>{s.stopImmediatePropagation(),s.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const i=new Ss(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(e,t,i){const s=this.sel_.rawValue,r=this.value.rawValue.toObject(),o=this.view.positionToValue(e.x,e.y),l=t?u4(s,s,o.x,o.y):o;r[s*2]=l.x,r[s*2+1]=l.y,this.value.setRawValue(new kr(...r),i)}onPointerDown_(e){const t=e.data;if(!t.point)return;const i=this.value.rawValue,s=this.view.valueToPosition(i.x1,i.y1),r=Kv(t.point.x,t.point.y,s.x,s.y),o=this.view.valueToPosition(i.x2,i.y2),l=Kv(t.point.x,t.point.y,o.x,o.y);this.sel_.rawValue=r<=l?0:1,this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(e){Qc(e.key)&&e.preventDefault();const t=this.sel_.rawValue,i=this.value.rawValue.toObject(),s=this.keyScale_.rawValue;i[t*2]+=Je(s,Zn(e)),i[t*2+1]+=Je(s,co(e)),this.value.setRawValue(new kr(...i),{forceEmit:!1,last:!1})}onKeyUp_(e){Qc(e.key)&&e.preventDefault();const t=this.keyScale_.rawValue,i=Je(t,Zn(e)),s=Je(t,co(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class c1{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new o1(e,{viewProps:this.viewProps}),this.gc_=new h1(e,{keyScale:t.axis.textProps.value("keyScale"),value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const i=Object.assign(Object.assign({},t.axis),{constraint:new jw({max:1,min:0})}),s=Object.assign(Object.assign({},t.axis),{constraint:void 0});this.tc_=new wa(e,{assembly:m_,axes:[i,s,i,s],parser:Wn,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(e=>e.inputElement)]}refresh(){this.gc_.refresh()}}class Uv{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=jp.create(t.expanded),this.view=new r1(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new Fp(e,{parser:l4,props:S.fromObject({formatter:o4}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=t.pickerLayout==="popup"?new t_(e,{viewProps:this.viewProps}):null;const i=new c1(e,{axis:t.axis,value:this.value,viewProps:this.viewProps});i.allFocusableElements.forEach(s=>{s.addEventListener("blur",this.onPopupChildBlur_),s.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),qn(this.popC_.shows,s=>{s&&i.refresh()}),jo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:s=>s,backward:(s,r)=>r})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Np(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=e.relatedTarget;(!t||!this.popC_.view.element.contains(t))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Yw(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Dp(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_&&e.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function h4(){return new Up({assembly:m_,components:[0,1,2,3].map(n=>n%2===0?new jw({min:0,max:1}):void 0)})}const c4=Ne({id:"cubicbezier",type:"blade",accept(n){const e=je(n,t=>({value:t.required.array(t.required.number),view:t.required.constant("cubicbezier"),expanded:t.optional.boolean,label:t.optional.string,picker:t.optional.custom(i=>i==="inline"||i==="popup"?i:void 0)}));return e?{params:e}:null},controller(n){var e,t;const i=new kr(...n.params.value),s=Re(i,{constraint:h4(),equals:kr.equals}),r=new Uv(n.document,{axis:{textProps:S.fromObject({keyScale:.1,pointerScale:.01,formatter:at(2)})},expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps});return new Wc(n.document,{blade:n.blade,props:S.fromObject({label:n.params.label}),value:s,valueController:r})},api(n){return!(n.controller instanceof Wc)||!(n.controller.valueController instanceof Uv)?null:new s1(n.controller)}});class p1 extends Oo{get fps(){return this.controller.valueController.fps}get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}begin(){this.controller.valueController.begin()}end(){this.controller.valueController.end()}on(e,t){const i=t.bind(this);return this.controller.valueController.ticker.emitter.on(e,()=>{i(new Ro(this))}),this}}const PP=20;class d1{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(e){this.start_=e.getTime()}calculateFps_(e){if(this.timestamps_.length===0)return null;const t=this.timestamps_[0];return 1e3*(this.frameCount_-t.frameCount)/(e-t.time)}compactTimestamps_(){if(this.timestamps_.length<=PP)return;const e=this.timestamps_.length-PP;this.timestamps_.splice(0,e);const t=this.timestamps_[0].frameCount;this.timestamps_.forEach(i=>{i.frameCount-=t}),this.frameCount_-=t}end(e){if(this.start_===null)return;const t=e.getTime();this.duration_=t-this.start_,this.start_=null,this.fps_=this.calculateFps_(t),this.timestamps_.push({frameCount:this.frameCount_,time:t}),++this.frameCount_,this.compactTimestamps_()}}const za=L("fps");class m1{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(za()),t.viewProps.bindClassModifiers(this.element),this.graphElement=e.createElement("div"),this.graphElement.classList.add(za("g")),this.element.appendChild(this.graphElement);const i=e.createElement("div");i.classList.add(za("l")),this.element.appendChild(i);const s=e.createElement("span");s.classList.add(za("v")),s.textContent="--",i.appendChild(s),this.valueElement=s;const r=e.createElement("span");r.classList.add(za("u")),r.textContent="FPS",i.appendChild(r)}}class v1{constructor(e,t){this.stopwatch_=new d1,this.onTick_=this.onTick_.bind(this),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.props=t.props,this.value_=t.value,this.viewProps=t.viewProps,this.view=new m1(e,{viewProps:this.viewProps}),this.graphC_=new d_(e,{formatter:at(0),props:this.props,rows:t.rows,value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker.dispose()})}get fps(){return this.stopwatch_.fps}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const e=this.fps;if(e!==null){const t=this.value_.rawValue;this.value_.rawValue=E3(t,e),this.view.valueElement.textContent=e.toFixed(0)}}}class yP extends _h{constructor(e,t){const i=t.valueController,s=new Rp(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}function p4(n,e){return e===0?new Z3:new Q3(n,e??Ch.monitor.defaultInterval)}const d4=Ne({id:"fpsgraph",type:"blade",accept(n){const e=je(n,t=>({view:t.required.constant("fpsgraph"),interval:t.optional.number,label:t.optional.string,rows:t.optional.number,max:t.optional.number,min:t.optional.number}));return e?{params:e}:null},controller(n){var e,t,i,s;const r=(e=n.params.interval)!==null&&e!==void 0?e:500;return new yP(n.document,{blade:n.blade,labelProps:S.fromObject({label:n.params.label}),valueController:new v1(n.document,{props:S.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:90,min:(i=n.params.min)!==null&&i!==void 0?i:0}),rows:(s=n.params.rows)!==null&&s!==void 0?s:2,ticker:p4(n.document,r),value:Re(P3(80)),viewProps:n.viewProps})})},api(n){return n.controller instanceof yP?new p1(n.controller):null}});class un{constructor(e,t){this.min=e,this.max=t}static isObject(e){if(typeof e!="object"||e===null)return!1;const t=e.min,i=e.max;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.min===t.min&&e.max===t.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const v_={fromComponents:n=>new un(n[0],n[1]),toComponents:n=>[n.min,n.max]};class f_{constructor(e){this.edge=e}constrain(e){var t,i,s,r,o,l,a,u;if(e.min<=e.max)return new un((i=(t=this.edge)===null||t===void 0?void 0:t.constrain(e.min))!==null&&i!==void 0?i:e.min,(r=(s=this.edge)===null||s===void 0?void 0:s.constrain(e.max))!==null&&r!==void 0?r:e.max);const h=(e.min+e.max)/2;return new un((l=(o=this.edge)===null||o===void 0?void 0:o.constrain(h))!==null&&l!==void 0?l:h,(u=(a=this.edge)===null||a===void 0?void 0:a.constrain(h))!==null&&u!==void 0?u:h)}}const _m=L("rsltxt");class f1{constructor(e,t){this.sliderView_=t.sliderView,this.textView_=t.textView,this.element=e.createElement("div"),this.element.classList.add(_m());const i=e.createElement("div");i.classList.add(_m("s")),i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(_m("t")),s.appendChild(this.textView_.element),this.element.appendChild(s)}}const zr=L("rsl");class w1{constructor(e,t){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=t.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=e.createElement("div"),this.element.classList.add(zr()),t.viewProps.bindClassModifiers(this.element),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_);const i=e.createElement("div");i.classList.add(zr("t")),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(zr("b")),i.appendChild(s),this.barElement=s;const r=["min","max"].map(o=>{const l=e.createElement("div");return l.classList.add(zr("k"),zr("k",o)),i.appendChild(l),l});this.knobElements=[r[0],r[1]],this.update_()}valueToX_(e){const t=this.sliderProps_.get("min"),i=this.sliderProps_.get("max");return ke($(e,t,i,0,1),0,1)*100}update_(){const e=this.value_.rawValue;e.length===0?this.element.classList.add(zr(void 0,"zero")):this.element.classList.remove(zr(void 0,"zero"));const t=[this.valueToX_(e.min),this.valueToX_(e.max)];this.barElement.style.left=`${t[0]}%`,this.barElement.style.right=`${100-t[1]}%`,this.knobElements.forEach((i,s)=>{i.style.left=`${t[s]}%`})}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class _1{constructor(e,t){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=t.sliderProps,this.viewProps=t.viewProps,this.value=t.value,this.view=new w1(e,{sliderProps:this.sliderProps,value:this.value,viewProps:t.viewProps});const i=new Ss(this.view.trackElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(e){if(!e.point)return null;const t=(e.point.x+this.ofs_())/e.bounds.width,i=this.sliderProps.get("min"),s=this.sliderProps.get("max");return $(t,0,1,i,s)}onPointerDown_(e){if(!e.data.point)return;const t=e.data.point.x/e.data.bounds.width,i=this.value.rawValue,s=this.sliderProps.get("min"),r=this.sliderProps.get("max"),o=$(i.min,s,r,0,1),l=$(i.max,s,r,0,1);Math.abs(l-t)<=.025?this.grabbing_="max":Math.abs(o-t)<=.025?this.grabbing_="min":t>=o&&t<=l?(this.grabbing_="length",this.grabOffset_=$(t-o,0,1,0,r-s)):t<o?(this.grabbing_="min",this.onPointerMove_(e)):t>l&&(this.grabbing_="max",this.onPointerMove_(e))}applyPointToValue_(e,t){const i=this.valueFromData_(e);if(i===null)return;const s=this.sliderProps.get("min"),r=this.sliderProps.get("max");if(this.grabbing_==="min")this.value.setRawValue(new un(i,this.value.rawValue.max),t);else if(this.grabbing_==="max")this.value.setRawValue(new un(this.value.rawValue.min,i),t);else if(this.grabbing_==="length"){const o=this.value.rawValue.length;let l=i-this.grabOffset_,a=l+o;l<s?(l=s,a=s+o):a>r&&(l=r-o,a=r),this.value.setRawValue(new un(l,a),t)}}onPointerMove_(e){this.applyPointToValue_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.applyPointToValue_(e.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class b1{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sc_=new _1(e,t);const i={constraint:t.constraint,textProps:t.textProps};this.tc_=new wa(e,{assembly:v_,axes:[i,i],parser:t.parser,value:this.value,viewProps:t.viewProps}),this.view=new f1(e,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function m4(n){return un.isObject(n)?new un(n.min,n.max):new un(0,0)}function v4(n,e){n.writeProperty("max",e.max),n.writeProperty("min",e.min)}function f4(n){const e=[],t=Kw(n);t&&e.push(t);const i=Fw(n);return i&&e.push(i),new f_(new fa(e))}const w4=Ne({id:"input-interval",type:"input",accept:(n,e)=>{if(!un.isObject(n))return null;const t=je(e,i=>Object.assign(Object.assign({},Hw(i)),{readonly:i.optional.constant(!1)}));return t?{initialValue:new un(n.min,n.max),params:t}:null},binding:{reader:n=>m4,constraint:n=>f4(n.params),equals:un.equals,writer:n=>v4},controller(n){const e=n.value,t=n.constraint;if(!(t instanceof f_))throw Ps.shouldNeverHappen();const i=(e.rawValue.min+e.rawValue.max)/2,s=S.fromObject(Uw(n.params,i)),r=t.edge&&Au(t.edge,wh);if(r)return new b1(n.document,{constraint:t.edge,parser:Wn,sliderProps:new S({keyScale:s.value("keyScale"),max:r.values.value("max"),min:r.values.value("min")}),textProps:s,value:e,viewProps:n.viewProps});const o={constraint:t.edge,textProps:s};return new wa(n.document,{assembly:v_,axes:[o,o],parser:Wn,value:e,viewProps:n.viewProps})}});class g1{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return(e=this.controller_.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.props.set("title",e)}}class C1 extends Tp{constructor(e,t,i,s,r){super(e,s,r),this.cell=t,this.index=i}}class P1 extends Oo{constructor(e){super(e),this.cellToApiMap_=new Map,this.controller.valueController.cellControllers.forEach(i=>{const s=new g1(i);this.cellToApiMap_.set(i,s)})}get value(){return this.controller.value}cell(e,t){const i=this.controller.valueController,s=i.cellControllers[t*i.size[0]+e];return this.cellToApiMap_.get(s)}on(e,t){const i=t.bind(this);this.controller.value.emitter.on(e,s=>{const r=this.controller.valueController,o=r.findCellByValue(s.rawValue);if(!o)return;const l=this.cellToApiMap_.get(o);if(!l)return;const a=r.cellControllers.indexOf(o);i(new C1(this,l,[a%r.size[0],Math.floor(a/r.size[0])],s.rawValue))})}}const qa=L("rad");class y1{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(qa()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(qa("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(qa("i")),s.name=t.name,s.type="radio",t.viewProps.bindDisabled(s),i.appendChild(s),this.inputElement=s;const r=e.createElement("div");r.classList.add(qa("b")),i.appendChild(r);const o=e.createElement("div");o.classList.add(qa("t")),r.appendChild(o),Gn(t.props,"title",l=>{o.textContent=l})}}class E1{constructor(e,t){this.props=t.props,this.viewProps=t.viewProps,this.view=new y1(e,{name:t.name,props:this.props,viewProps:this.viewProps})}}class Jc{constructor(e,t){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=t.size;const[i,s]=this.size;for(let r=0;r<s;r++)for(let o=0;o<i;o++){const l=new E1(e,{name:t.groupName,props:S.fromObject(Object.assign({},t.cellConfig(o,r))),viewProps:ho.create()});this.cellCs_.push(l),this.cellValues_.push(t.cellConfig(o,r).value)}this.value=t.value,qn(this.value,r=>{const o=this.findCellByValue(r);o&&(o.view.inputElement.checked=!0)}),this.viewProps=ho.create(),this.view=new kk(e,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(r=>{r.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(r.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(e){const t=this.cellValues_.findIndex(i=>i===e);return t<0?null:this.cellCs_[t]}onCellInputChange_(e){const t=e.currentTarget,i=this.cellCs_.findIndex(s=>s.view.inputElement===t);i<0||(this.value.rawValue=this.cellValues_[i])}}const _4=function(){return Ne({id:"radiogrid",type:"blade",accept(n){const e=je(n,t=>({cells:t.required.function,groupName:t.required.string,size:t.required.array(t.required.number),value:t.required.raw,view:t.required.constant("radiogrid"),label:t.optional.string}));return e?{params:e}:null},controller(n){const e=Re(n.params.value);return new Wc(n.document,{blade:n.blade,props:S.fromObject({label:n.params.label}),value:e,valueController:new Jc(n.document,{groupName:n.params.groupName,cellConfig:n.params.cells,size:n.params.size,value:e})})},api(n){return!(n.controller instanceof Wc)||!(n.controller.valueController instanceof Jc)?null:new P1(n.controller)}})}();function w_(n){return Ne({id:"input-radiogrid",type:"input",accept(e,t){if(!n.isType(e))return null;const i=je(t,s=>({cells:s.required.function,groupName:s.required.string,size:s.required.array(s.required.number),view:s.required.constant("radiogrid")}));return i?{initialValue:e,params:i}:null},binding:n.binding,controller:e=>new Jc(e.document,{cellConfig:e.params.cells,groupName:e.params.groupName,size:e.params.size,value:e.value})})}const b4=w_({isType:n=>typeof n=="number",binding:{reader:n=>Iw,writer:n=>Or}}),g4=w_({isType:n=>typeof n=="string",binding:{reader:n=>i_,writer:n=>Or}}),C4=w_({isType:n=>typeof n=="boolean",binding:{reader:n=>n_,writer:n=>Or}}),P4="essentials",y4='.tp-cbzgv,.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-radv_b,.tp-rslv_k,.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-radv_b:hover,.tp-rslv_k:hover,.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-radv_b:focus,.tp-rslv_k:focus,.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-radv_b:active,.tp-rslv_k:active,.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-radv_b:disabled,.tp-rslv_k:disabled,.tp-cbzv_b:disabled{opacity:.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:.5}.tp-btngridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-btngridv.tp-v-disabled{opacity:.5}.tp-btngridv .tp-btnv_b:disabled{opacity:1}.tp-btngridv .tp-btnv_b:disabled .tp-btnv_t{opacity:.5}.tp-btngridv .tp-btnv_b{border-radius:0}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--cnt-usp);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1 * var(--cnt-hp));position:absolute;right:calc(-1 * var(--cnt-hp));top:var(--cnt-usz)}.tp-cbzpv_t{margin-top:var(--cnt-usp)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--cnt-usz) * 5);width:100%}.tp-cbzgv_u{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:rgba(0,0,0,0);stroke:var(--in-fg)}.tp-cbzgv_v{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity .2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}.tp-fpsv{position:relative}.tp-fpsv_l{bottom:4px;color:var(--mo-fg);line-height:1;right:4px;pointer-events:none;position:absolute}.tp-fpsv_u{margin-left:.2em;opacity:.7}.tp-rslv{cursor:pointer;padding-left:8px;padding-right:8px}.tp-rslv.tp-v-disabled{opacity:.5}.tp-rslv_t{height:calc(var(--cnt-usz));position:relative}.tp-rslv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:-4px;right:-4px}.tp-rslv_b{bottom:0;top:0;position:absolute}.tp-rslv_b::before{background-color:var(--in-fg);content:"";height:2px;margin-top:-1px;position:absolute;top:50%;left:0;right:0}.tp-rslv_k{height:calc(var(--cnt-usz) - 8px);margin-top:calc((var(--cnt-usz) - 8px)/-2);position:absolute;top:50%;width:8px}.tp-rslv_k.tp-rslv_k-min{margin-left:-8px}.tp-rslv_k.tp-rslv_k-max{margin-left:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-min{border-bottom-right-radius:0;border-top-right-radius:0}.tp-rslv.tp-rslv-zero .tp-rslv_k.tp-rslv_k-max{border-bottom-left-radius:0;border-top-left-radius:0}.tp-rsltxtv{display:flex}.tp-rsltxtv_s{flex:1}.tp-rsltxtv_t{flex:1;margin-left:4px}.tp-radv_l{display:block;position:relative}.tp-radv_i{left:0;opacity:0;position:absolute;top:0}.tp-radv_b{opacity:.5}.tp-radv_i:hover+.tp-radv_b{background-color:var(--btn-bg-h)}.tp-radv_i:focus+.tp-radv_b{background-color:var(--btn-bg-f)}.tp-radv_i:active+.tp-radv_b{background-color:var(--btn-bg-a)}.tp-radv_i:checked+.tp-radv_b{opacity:1}.tp-radv_t{bottom:0;color:inherit;left:0;overflow:hidden;position:absolute;right:0;text-align:center;text-overflow:ellipsis;top:0}.tp-radv_i:disabled+.tp-radv_b>.tp-radv_t{opacity:.5}.tp-radgridv{border-radius:var(--bld-br);display:grid;overflow:hidden;gap:2px}.tp-radgridv.tp-v-disabled{opacity:.5}.tp-radgridv .tp-radv_b{border-radius:0}',E4=[n4,c4,d4,w4,_4,C4,b4,g4],x4=Object.freeze(Object.defineProperty({__proto__:null,ButtonCellApi:t1,ButtonGridApi:n1,ButtonGridController:i1,CubicBezier:kr,CubicBezierApi:s1,CubicBezierAssembly:m_,CubicBezierController:Uv,CubicBezierGraphController:h1,CubicBezierGraphView:a1,CubicBezierPickerController:c1,CubicBezierPickerView:o1,CubicBezierPreviewView:u1,CubicBezierView:r1,FpsGraphBladeApi:p1,FpsGraphController:v1,FpsView:m1,Fpswatch:d1,Interval:un,IntervalAssembly:v_,IntervalConstraint:f_,RadioCellApi:g1,RadioController:E1,RadioGridApi:P1,RadioGridController:Jc,RadioView:y1,RangeSliderController:_1,RangeSliderTextController:b1,RangeSliderTextView:f1,RangeSliderView:w1,TpRadioGridChangeEvent:C1,css:y4,id:P4,plugins:E4},Symbol.toStringTag,{value:"Module"}));var $4=Function.prototype.toString,bm=Object.create,V4=Object.prototype.toString,k4=function(){function n(){this._keys=[],this._values=[]}return n.prototype.has=function(e){return!!~this._keys.indexOf(e)},n.prototype.get=function(e){return this._values[this._keys.indexOf(e)]},n.prototype.set=function(e,t){this._keys.push(e),this._values.push(t)},n}();function S4(){return new k4}function L4(){return new WeakMap}var A4=typeof WeakMap<"u"?L4:S4;function __(n){if(!n)return bm(null);var e=n.constructor;if(e===Object)return n===Object.prototype?{}:bm(n);if(~$4.call(e).indexOf("[native code]"))try{return new e}catch{}return bm(n)}function M4(n){var e="";return n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.unicode&&(e+="u"),n.sticky&&(e+="y"),e}function T4(n){return n.flags}var D4=/test/g.flags==="g"?T4:M4;function x1(n){var e=V4.call(n);return e.substring(8,e.length-1)}function O4(n){return n[Symbol.toStringTag]||x1(n)}var R4=typeof Symbol<"u"?O4:x1,j4=Object.defineProperty,N4=Object.getOwnPropertyDescriptor,$1=Object.getOwnPropertyNames,b_=Object.getOwnPropertySymbols,V1=Object.prototype,k1=V1.hasOwnProperty,B4=V1.propertyIsEnumerable,S1=typeof b_=="function";function I4(n){return $1(n).concat(b_(n))}var F4=S1?I4:$1;function Hp(n,e,t){for(var i=F4(n),s=0,r=i.length,o=void 0,l=void 0;s<r;++s)if(o=i[s],!(o==="callee"||o==="caller")){if(l=N4(n,o),!l){e[o]=t.copier(n[o],t);continue}!l.get&&!l.set&&(l.value=t.copier(l.value,t));try{j4(e,o,l)}catch{e[o]=l.value}}return e}function K4(n,e){var t=new e.Constructor;e.cache.set(n,t);for(var i=0,s=n.length;i<s;++i)t[i]=e.copier(n[i],e);return t}function U4(n,e){var t=new e.Constructor;return e.cache.set(n,t),Hp(n,t,e)}function L1(n,e){return n.slice(0)}function H4(n,e){return n.slice(0,n.size,n.type)}function z4(n,e){return new e.Constructor(L1(n.buffer))}function q4(n,e){return new e.Constructor(n.getTime())}function A1(n,e){var t=new e.Constructor;return e.cache.set(n,t),n.forEach(function(i,s){t.set(s,e.copier(i,e))}),t}function G4(n,e){return Hp(n,A1(n,e),e)}function Y4(n,e){var t=__(e.prototype);e.cache.set(n,t);for(var i in n)k1.call(n,i)&&(t[i]=e.copier(n[i],e));return t}function X4(n,e){var t=__(e.prototype);e.cache.set(n,t);for(var i in n)k1.call(n,i)&&(t[i]=e.copier(n[i],e));for(var s=b_(n),r=0,o=s.length,l=void 0;r<o;++r)l=s[r],B4.call(n,l)&&(t[l]=e.copier(n[l],e));return t}var W4=S1?X4:Y4;function Z4(n,e){var t=__(e.prototype);return e.cache.set(n,t),Hp(n,t,e)}function gm(n,e){return new e.Constructor(n.valueOf())}function Q4(n,e){var t=new e.Constructor(n.source,D4(n));return t.lastIndex=n.lastIndex,t}function Pc(n,e){return n}function M1(n,e){var t=new e.Constructor;return e.cache.set(n,t),n.forEach(function(i){t.add(e.copier(i,e))}),t}function J4(n,e){return Hp(n,M1(n,e),e)}var eU=Array.isArray,g_=Object.assign,tU=Object.getPrototypeOf||function(n){return n.__proto__},T1={array:K4,arrayBuffer:L1,blob:H4,dataView:z4,date:q4,error:Pc,map:A1,object:W4,regExp:Q4,set:M1},nU=g_({},T1,{array:U4,map:G4,object:Z4,set:J4});function iU(n){return{Arguments:n.object,Array:n.array,ArrayBuffer:n.arrayBuffer,Blob:n.blob,Boolean:gm,DataView:n.dataView,Date:n.date,Error:n.error,Float32Array:n.arrayBuffer,Float64Array:n.arrayBuffer,Int8Array:n.arrayBuffer,Int16Array:n.arrayBuffer,Int32Array:n.arrayBuffer,Map:n.map,Number:gm,Object:n.object,Promise:Pc,RegExp:n.regExp,Set:n.set,String:gm,WeakMap:Pc,WeakSet:Pc,Uint8Array:n.arrayBuffer,Uint8ClampedArray:n.arrayBuffer,Uint16Array:n.arrayBuffer,Uint32Array:n.arrayBuffer,Uint64Array:n.arrayBuffer}}function D1(n){var e=g_({},T1,n),t=iU(e),i=t.Array,s=t.Object;function r(o,l){if(l.prototype=l.Constructor=void 0,!o||typeof o!="object")return o;if(l.cache.has(o))return l.cache.get(o);if(l.prototype=tU(o),l.Constructor=l.prototype&&l.prototype.constructor,!l.Constructor||l.Constructor===Object)return s(o,l);if(eU(o))return i(o,l);var a=t[R4(o)];return a?a(o,l):typeof o.then=="function"?o:s(o,l)}return function(l){return r(l,{Constructor:void 0,cache:A4(),copier:r,prototype:void 0})}}function sU(n){return D1(g_({},nU,n))}sU({});var Cm=D1({}),rU=Object.getOwnPropertyNames,oU=Object.getOwnPropertySymbols,lU=Object.prototype.hasOwnProperty;function EP(n,e){return function(i,s,r){return n(i,s,r)&&e(i,s,r)}}function tc(n){return function(t,i,s){if(!t||!i||typeof t!="object"||typeof i!="object")return n(t,i,s);var r=s.cache,o=r.get(t),l=r.get(i);if(o&&l)return o===i&&l===t;r.set(t,i),r.set(i,t);var a=n(t,i,s);return r.delete(t),r.delete(i),a}}function xP(n){return rU(n).concat(oU(n))}var O1=Object.hasOwn||function(n,e){return lU.call(n,e)};function _a(n,e){return n||e?n===e:n===e||n!==n&&e!==e}var R1="_owner",$P=Object.getOwnPropertyDescriptor,VP=Object.keys;function aU(n,e,t){var i=n.length;if(e.length!==i)return!1;for(;i-- >0;)if(!t.equals(n[i],e[i],i,i,n,e,t))return!1;return!0}function uU(n,e){return _a(n.getTime(),e.getTime())}function kP(n,e,t){if(n.size!==e.size)return!1;for(var i={},s=n.entries(),r=0,o,l;(o=s.next())&&!o.done;){for(var a=e.entries(),u=!1,h=0;(l=a.next())&&!l.done;){var c=o.value,m=c[0],d=c[1],f=l.value,p=f[0],v=f[1];!u&&!i[h]&&(u=t.equals(m,p,r,h,n,e,t)&&t.equals(d,v,m,p,n,e,t))&&(i[h]=!0),h++}if(!u)return!1;r++}return!0}function hU(n,e,t){var i=VP(n),s=i.length;if(VP(e).length!==s)return!1;for(var r;s-- >0;)if(r=i[s],r===R1&&(n.$$typeof||e.$$typeof)&&n.$$typeof!==e.$$typeof||!O1(e,r)||!t.equals(n[r],e[r],r,r,n,e,t))return!1;return!0}function Ga(n,e,t){var i=xP(n),s=i.length;if(xP(e).length!==s)return!1;for(var r,o,l;s-- >0;)if(r=i[s],r===R1&&(n.$$typeof||e.$$typeof)&&n.$$typeof!==e.$$typeof||!O1(e,r)||!t.equals(n[r],e[r],r,r,n,e,t)||(o=$P(n,r),l=$P(e,r),(o||l)&&(!o||!l||o.configurable!==l.configurable||o.enumerable!==l.enumerable||o.writable!==l.writable)))return!1;return!0}function cU(n,e){return _a(n.valueOf(),e.valueOf())}function pU(n,e){return n.source===e.source&&n.flags===e.flags}function SP(n,e,t){if(n.size!==e.size)return!1;for(var i={},s=n.values(),r,o;(r=s.next())&&!r.done;){for(var l=e.values(),a=!1,u=0;(o=l.next())&&!o.done;)!a&&!i[u]&&(a=t.equals(r.value,o.value,r.value,o.value,n,e,t))&&(i[u]=!0),u++;if(!a)return!1}return!0}function dU(n,e){var t=n.length;if(e.length!==t)return!1;for(;t-- >0;)if(n[t]!==e[t])return!1;return!0}var mU="[object Arguments]",vU="[object Boolean]",fU="[object Date]",wU="[object Map]",_U="[object Number]",bU="[object Object]",gU="[object RegExp]",CU="[object Set]",PU="[object String]",yU=Array.isArray,LP=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,AP=Object.assign,EU=Object.prototype.toString.call.bind(Object.prototype.toString);function xU(n){var e=n.areArraysEqual,t=n.areDatesEqual,i=n.areMapsEqual,s=n.areObjectsEqual,r=n.arePrimitiveWrappersEqual,o=n.areRegExpsEqual,l=n.areSetsEqual,a=n.areTypedArraysEqual;return function(h,c,m){if(h===c)return!0;if(h==null||c==null||typeof h!="object"||typeof c!="object")return h!==h&&c!==c;var d=h.constructor;if(d!==c.constructor)return!1;if(d===Object)return s(h,c,m);if(yU(h))return e(h,c,m);if(LP!=null&&LP(h))return a(h,c,m);if(d===Date)return t(h,c,m);if(d===RegExp)return o(h,c,m);if(d===Map)return i(h,c,m);if(d===Set)return l(h,c,m);var f=EU(h);return f===fU?t(h,c,m):f===gU?o(h,c,m):f===wU?i(h,c,m):f===CU?l(h,c,m):f===bU?typeof h.then!="function"&&typeof c.then!="function"&&s(h,c,m):f===mU?s(h,c,m):f===vU||f===_U||f===PU?r(h,c,m):!1}}function $U(n){var e=n.circular,t=n.createCustomConfig,i=n.strict,s={areArraysEqual:i?Ga:aU,areDatesEqual:uU,areMapsEqual:i?EP(kP,Ga):kP,areObjectsEqual:i?Ga:hU,arePrimitiveWrappersEqual:cU,areRegExpsEqual:pU,areSetsEqual:i?EP(SP,Ga):SP,areTypedArraysEqual:i?Ga:dU};if(t&&(s=AP({},s,t(s))),e){var r=tc(s.areArraysEqual),o=tc(s.areMapsEqual),l=tc(s.areObjectsEqual),a=tc(s.areSetsEqual);s=AP({},s,{areArraysEqual:r,areMapsEqual:o,areObjectsEqual:l,areSetsEqual:a})}return s}function VU(n){return function(e,t,i,s,r,o,l){return n(e,t,l)}}function kU(n){var e=n.circular,t=n.comparator,i=n.createState,s=n.equals,r=n.strict;if(i)return function(a,u){var h=i(),c=h.cache,m=c===void 0?e?new WeakMap:void 0:c,d=h.meta;return t(a,u,{cache:m,equals:s,meta:d,strict:r})};if(e)return function(a,u){return t(a,u,{cache:new WeakMap,equals:s,meta:void 0,strict:r})};var o={cache:void 0,equals:s,meta:void 0,strict:r};return function(a,u){return t(a,u,o)}}Rr();Rr({strict:!0});Rr({circular:!0});Rr({circular:!0,strict:!0});var SU=Rr({createInternalComparator:function(){return _a}});Rr({strict:!0,createInternalComparator:function(){return _a}});Rr({circular:!0,createInternalComparator:function(){return _a}});Rr({circular:!0,createInternalComparator:function(){return _a},strict:!0});function Rr(n){n===void 0&&(n={});var e=n.circular,t=e===void 0?!1:e,i=n.createInternalComparator,s=n.createState,r=n.strict,o=r===void 0?!1:r,l=$U(n),a=xU(l),u=i?i(a):VU(a);return kU({circular:t,comparator:a,createState:s,equals:u,strict:o})}function LU(n){let e,t;return e=new Ow({props:{theme:n[7],userCreatedPane:!1,$$slots:{default:[MU]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&128&&(r.theme=i[7]),s&1073741951&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function AU(n){let e,t,i,s;const r=[DU,TU],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=Oe()},l(a){t.l(a),i=Oe()},m(a,u){o[e].m(a,u),z(a,i,u),s=!0},p(a,u){t.p(a,u)},i(a){s||(g(t),s=!0)},o(a){C(t),s=!1},d(a){a&&k(i),o[e].d(a)}}}function MU(n){let e,t,i,s,r,o,l,a,u;function h(_){n[14](_)}function c(_){n[15](_)}function m(_){n[16](_)}function d(_){n[17](_)}function f(_){n[18](_)}function p(_){n[19](_)}function v(_){n[20](_)}let w={};return n[1]!==void 0&&(w.disabled=n[1]),n[5]!==void 0&&(w.key=n[5]),n[2]!==void 0&&(w.label=n[2]),n[0]!==void 0&&(w.object=n[0]),n[3]!==void 0&&(w.options=n[3]),n[6]!==void 0&&(w.plugin=n[6]),n[4]!==void 0&&(w.ref=n[4]),e=new j1({props:w}),R.push(()=>F(e,"disabled",h)),R.push(()=>F(e,"key",c)),R.push(()=>F(e,"label",m)),R.push(()=>F(e,"object",d)),R.push(()=>F(e,"options",f)),R.push(()=>F(e,"plugin",p)),R.push(()=>F(e,"ref",v)),e.$on("change",n[21]),{c(){M(e.$$.fragment)},l(_){T(e.$$.fragment,_)},m(_,A){D(e,_,A),u=!0},p(_,A){const x={};!t&&A&2&&(t=!0,x.disabled=_[1],I(()=>t=!1)),!i&&A&32&&(i=!0,x.key=_[5],I(()=>i=!1)),!s&&A&4&&(s=!0,x.label=_[2],I(()=>s=!1)),!r&&A&1&&(r=!0,x.object=_[0],I(()=>r=!1)),!o&&A&8&&(o=!0,x.options=_[3],I(()=>o=!1)),!l&&A&64&&(l=!0,x.plugin=_[6],I(()=>l=!1)),!a&&A&16&&(a=!0,x.ref=_[4],I(()=>a=!1)),e.$set(x)},i(_){u||(g(e.$$.fragment,_),u=!0)},o(_){C(e.$$.fragment,_),u=!1},d(_){O(e,_)}}}function TU(n){let e,t;return e=new ca({props:{keysAdd:["containerVerticalPadding","containerUnitSize"],theme:n[7]}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&128&&(r.theme=i[7]),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function DU(n){let e;return{c(){e=li("div"),this.h()},l(t){e=ai(t,"DIV",{style:!0}),ui(e).forEach(k),this.h()},h(){Be(e,"display","none")},m(t,i){z(t,e,i),n[13](e)},p:ft,i:ft,o:ft,d(t){t&&k(e),n[13](null)}}}function OU(n){let e,t,i,s;const r=[AU,LU],o=[];function l(a,u){return a[9]?0:1}return e=l(n),t=o[e]=r[e](n),{c(){t.c(),i=Oe()},l(a){t.l(a),i=Oe()},m(a,u){o[e].m(a,u),z(a,i,u),s=!0},p(a,[u]){t.p(a,u)},i(a){s||(g(t),s=!0)},o(a){C(t),s=!1},d(a){a&&k(i),o[e].d(a)}}}function RU(n,e,t){let i,{object:s}=e,{key:r}=e,{disabled:o=!1}=e,{label:l=void 0}=e,{options:a=void 0}=e,{theme:u=void 0}=e,{ref:h=void 0}=e,{plugin:c=void 0}=e;const m=yl("registerPlugin"),d=yl("parentStore");Kl(n,d,y=>t(12,i=y));const f=yl("userCreatedPane");let p,v,w;function _(){p&&p.dispose(),c!==void 0&&m(c),t(10,p=i.addBinding(s,r,{index:w,label:l,...a,disabled:o})),t(4,h=p),p.on("change",Yn)}Cp(()=>{t(11,w=v?nV(v):0)}),gp(()=>{p==null||p.dispose()});const A=YT();let x=Cm(s[r]),P=!1;function qt(y){SU(y[r],x)||(x=Cm(y[r]),A("change",{value:Cm(y[r]),origin:P?"internal":"external"}),!P&&p&&(p.off("change",Yn),p.refresh(),p.on("change",Yn))),P=!1}function Yn(){P=!0,t(0,s)}function V(y){R[y?"unshift":"push"](()=>{v=y,t(8,v)})}function Nr(y){o=y,t(1,o)}function zh(y){r=y,t(5,r)}function Pn(y){l=y,t(2,l)}function Vt(y){s=y,t(0,s)}function Ke(y){a=y,t(3,a)}function Br(y){c=y,t(6,c)}function qi(y){h=y,t(4,h)}function Ir(y){ih.call(this,n,y)}return n.$$set=y=>{"object"in y&&t(0,s=y.object),"key"in y&&t(5,r=y.key),"disabled"in y&&t(1,o=y.disabled),"label"in y&&t(2,l=y.label),"options"in y&&t(3,a=y.options),"theme"in y&&t(7,u=y.theme),"ref"in y&&t(4,h=y.ref),"plugin"in y&&t(6,c=y.plugin)},n.$$.update=()=>{n.$$.dirty&1026&&p!==void 0&&t(10,p.disabled=o,p),n.$$.dirty&1028&&p!==void 0&&t(10,p.label=l,p),n.$$.dirty&1040,n.$$.dirty&6152&&i!==void 0&&w!==void 0&&_(),n.$$.dirty&4097&&i!==void 0&&qt(s),n.$$.dirty&4224&&u&&i!==void 0&&(f||!tV(i))&&console.warn("Set theme on the <Pane> component, not on its children! (Check nested <Binding> components for a theme prop.)")},[s,o,l,a,h,r,c,u,v,d,p,w,i,V,Nr,zh,Pn,Vt,Ke,Br,qi,Ir]}class j1 extends Ft{constructor(e){super(),Kt(this,e,RU,OU,It,{object:0,key:5,disabled:1,label:2,options:3,theme:7,ref:4,plugin:6})}}function jU(n){let e,t,i,s;const r=[{key:n[3]},{options:n[1]},n[4]];function o(u){n[6](u)}function l(u){n[7](u)}let a={};for(let u=0;u<r.length;u+=1)a=ye(a,r[u]);return n[2]!==void 0&&(a.object=n[2]),n[0]!==void 0&&(a.ref=n[0]),e=new j1({props:a}),R.push(()=>F(e,"object",o)),R.push(()=>F(e,"ref",l)),e.$on("change",n[8]),{c(){M(e.$$.fragment)},l(u){T(e.$$.fragment,u)},m(u,h){D(e,u,h),s=!0},p(u,[h]){const c=h&26?Li(r,[h&8&&{key:u[3]},h&2&&{options:u[1]},h&16&&Ai(u[4])]):{};!t&&h&4&&(t=!0,c.object=u[2],I(()=>t=!1)),!i&&h&1&&(i=!0,c.ref=u[0],I(()=>i=!1)),e.$set(c)},i(u){s||(g(e.$$.fragment,u),s=!0)},o(u){C(e.$$.fragment,u),s=!1},d(u){O(e,u)}}}function NU(n,e,t){let i;const s=["value","ref","options"];let r=bt(e,s),{value:o}=e,{ref:l=void 0}=e,{options:a=void 0}=e;const u=Symbol("key");function h(){return o}function c(){t(2,i[u]=o,i)}function m(p){i=p,t(2,i)}function d(p){l=p,t(0,l)}function f(p){ih.call(this,n,p)}return n.$$set=p=>{e=ye(ye({},e),hi(p)),t(4,r=bt(e,s)),"value"in p&&t(5,o=p.value),"ref"in p&&t(0,l=p.ref),"options"in p&&t(1,a=p.options)},n.$$.update=()=>{n.$$.dirty&4&&t(5,o=i[u]),n.$$.dirty&32&&c()},t(2,i={[u]:h()}),[l,a,i,u,r,o,m,d,f]}class BU extends Ft{constructor(e){super(),Kt(this,e,NU,jU,It,{value:5,ref:0,options:1})}}function IU(n){let e,t,i,s;const r=[{options:n[2]},n[3]];function o(u){n[5](u)}function l(u){n[6](u)}let a={};for(let u=0;u<r.length;u+=1)a=ye(a,r[u]);return n[1]!==void 0&&(a.value=n[1]),n[0]!==void 0&&(a.ref=n[0]),e=new BU({props:a}),R.push(()=>F(e,"value",o)),R.push(()=>F(e,"ref",l)),e.$on("change",n[7]),{c(){M(e.$$.fragment)},l(u){T(e.$$.fragment,u)},m(u,h){D(e,u,h),s=!0},p(u,[h]){const c=h&12?Li(r,[h&4&&{options:u[2]},h&8&&Ai(u[3])]):{};!t&&h&2&&(t=!0,c.value=u[1],I(()=>t=!1)),!i&&h&1&&(i=!0,c.ref=u[0],I(()=>i=!1)),e.$set(c)},i(u){s||(g(e.$$.fragment,u),s=!0)},o(u){C(e.$$.fragment,u),s=!1},d(u){O(e,u)}}}function FU(n,e,t){const i=["options","ref","value"];let s=bt(e,i),{options:r=void 0}=e,{ref:o=void 0}=e,{value:l}=e,a;function u(m){l=m,t(1,l)}function h(m){o=m,t(0,o)}function c(m){ih.call(this,n,m)}return n.$$set=m=>{e=ye(ye({},e),hi(m)),t(3,s=bt(e,i)),"options"in m&&t(4,r=m.options),"ref"in m&&t(0,o=m.ref),"value"in m&&t(1,l=m.value)},n.$$.update=()=>{n.$$.dirty&16&&t(2,a={...r,readonly:!1})},[o,l,a,s,r,u,h,c]}class N1 extends Ft{constructor(e){super(),Kt(this,e,FU,IU,It,{options:4,ref:0,value:1})}}function KU(n){let e,t,i;const s=[n[1]];function r(l){n[2](l)}let o={};for(let l=0;l<s.length;l+=1)o=ye(o,s[l]);return n[0]!==void 0&&(o.value=n[0]),e=new N1({props:o}),R.push(()=>F(e,"value",r)),e.$on("change",n[3]),{c(){M(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){D(e,l,a),i=!0},p(l,[a]){const u=a&2?Li(s,[Ai(l[1])]):{};!t&&a&1&&(t=!0,u.value=l[0],I(()=>t=!1)),e.$set(u)},i(l){i||(g(e.$$.fragment,l),i=!0)},o(l){C(e.$$.fragment,l),i=!1},d(l){O(e,l)}}}function UU(n,e,t){const i=["value"];let s=bt(e,i),{value:r}=e;function o(a){r=a,t(0,r)}function l(a){ih.call(this,n,a)}return n.$$set=a=>{e=ye(ye({},e),hi(a)),t(1,s=bt(e,i)),"value"in a&&t(0,r=a.value)},[r,s,o,l]}class HU extends Ft{constructor(e){super(),Kt(this,e,UU,KU,It,{value:0})}}function Se(n){return n==null}function C_(n){return n!==null&&typeof n=="object"}function Hv(n){return n!==null&&typeof n=="object"}function zU(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function mo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return Hv(r)&&Hv(o)?Object.assign(Object.assign({},i),{[s]:mo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function qU(n){return C_(n)?"target"in n:!1}const GU={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let vo=class _l{static alreadyDisposed(){return new _l({type:"alreadydisposed"})}static notBindable(){return new _l({type:"notbindable"})}static notCompatible(e,t){return new _l({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new _l({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new _l({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=GU[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},MP=class B1{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!B1.isBindable(i))throw vo.notBindable();if(!(e in i))throw vo.propertyNotFound(e);i[e]=t}},wn=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},YU=class{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new wn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},XU=class{constructor(e){this.emitter=new wn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},WU=class{constructor(e){this.emitter=new wn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function nt(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new XU(n):new YU(n,e)}function ZU(n){return[new WU(n),(e,t)=>{n.setRawValue(e,t)}]}let be=class I1{constructor(e){this.emitter=new wn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:nt(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new I1(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},zp=class{constructor(e){this.values=be.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},QU=class{constructor(e){this.values=be.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Se(i)||(s=Math.max(s,i)),Se(t)||(s=Math.min(s,t)),s}},JU=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},eH=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const tH={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let nH=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=tH[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const iH={"+":n=>n,"-":n=>-n,"~":n=>~n};let sH=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=iH[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function P_(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Tu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function rH(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Du(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function oH(n,e){const t=Du(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Du(n,e);return s===""?"":i+s}function y_(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=oH(n,e);return i===""?"":t+i}function F1(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=rH(n,e);return e+=i.length,i===""?"":i+Du(n,e)}function lH(n,e){const t=F1(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Du(n,e);return e+=s.length,t+i+s+y_(n,e)}function aH(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Du(n,e);return e+=i.length,i===""?"":t+i+y_(n,e)}function uH(n,e){const t=F1(n,e);return e+=t.length,t===""?"":t+y_(n,e)}const hH=P_([lH,aH,uH]);function cH(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function pH(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=cH(n,e);return i===""?"":t+i}function dH(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function mH(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=dH(n,e);return i===""?"":t+i}function vH(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function fH(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=vH(n,e);return i===""?"":t+i}const wH=P_([pH,mH,fH]),_H=P_([wH,hH]);function bH(n,e){const t=_H(n,e);return e+=t.length,t===""?null:{evaluable:new eH(t),cursor:e}}function gH(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=U1(n,e);if(!i)return null;e=i.cursor,e+=Tu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function CH(n,e){var t;return(t=bH(n,e))!==null&&t!==void 0?t:gH(n,e)}function K1(n,e){const t=CH(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=K1(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new sH(i,s.evaluable)}):null}function PH(n,e,t){t+=Tu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Tu(e,t).length,{cursor:t,operator:i}):null}function yH(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=PH(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new nH(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const EH=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>yH(n,e),K1);function U1(n,e){return e+=Tu(n,e).length,EH(n,e)}function xH(n){const e=U1(n,0);return!e||e.cursor+Tu(n,e.cursor).length!==n.length?null:e.evaluable}function Sr(n){var e;const t=xH(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function H1(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Sr(n);if(!Se(e))return e}return 0}function nn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function se(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function TP(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ze(n,e,t){return Math.min(Math.max(n,e),t)}function z1(n,e){return(n%e+e)%e}function $H(n,e){return Se(n.step)?Math.max(TP(e),2):TP(n.step)}function q1(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function VH(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function G1(n,e){return Se(n.step)?null:new JU(n.step,e)}function Y1(n){return!Se(n.max)&&!Se(n.min)?new zp({max:n.max,min:n.min}):!Se(n.max)||!Se(n.min)?new QU({max:n.max,min:n.min}):null}function X1(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:nn($H(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:q1(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:VH(n,e)}}function W1(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function E_(n){return{constraint:n.constraint,textProps:be.fromObject(X1(n.params,n.initialValue))}}let x_=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},qp=class{constructor(e){this.target=e}},Z1=class extends qp{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},kH=class extends qp{constructor(e,t){super(e),this.expanded=t}},SH=class extends qp{constructor(e,t){super(e),this.index=t}},$_=class extends x_{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new wn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new Z1(this,t.binding.target.read(),e.options.last))}};function LH(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function AH(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function MH(n){return n===null?!1:typeof n=="object"}function Wi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function DP(n){return{custom:e=>Wi(e)(n),boolean:Wi(e=>typeof e=="boolean"?e:void 0)(n),number:Wi(e=>typeof e=="number"?e:void 0)(n),string:Wi(e=>typeof e=="string"?e:void 0)(n),function:Wi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Wi(t=>t===e?e:void 0)(n),raw:Wi(e=>e)(n),object:e=>Wi(t=>{if(MH(t))return LH(t,e)})(n),array:e=>Wi(t=>{if(Array.isArray(t))return AH(t,e)})(n)}}const zv={optional:DP(!0),required:DP(!1)};function ut(n,e){const t=e(zv),i=zv.required.object(t)(n);return i.succeeded?i.value:void 0}function Di(n,e,t,i){if(e&&!e(n))return!1;const s=ut(n,t);return s?i(s):!1}function Oi(n,e){var t;return mo((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function yc(n){return"value"in n}function TH(n){if(!C_(n)||!("binding"in n))return!1;const e=n.binding;return qU(e)}const si="http://www.w3.org/2000/svg";function ep(n){n.offsetHeight}function DH(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function V_(n){return n.ontouchstart!==void 0}function OH(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const RH={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Gp(n,e){const t=n.createElementNS(si,"svg");return t.innerHTML=RH[e],t}function Q1(n,e,t){n.insertBefore(e,n.children[t])}function k_(n){n.parentElement&&n.parentElement.removeChild(n)}function J1(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function jH(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function eS(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function ds(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function fi(n,e,t){ds(n.value(e),t)}const NH="tp";function X(n){return(t,i)=>[NH,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const Ya=X("lbl");function BH(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let IH=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ya()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ya("l")),fi(t.props,"label",r=>{Se(r)?this.element.classList.add(Ya(void 0,"nol")):(this.element.classList.remove(Ya(void 0,"nol")),jH(i),i.appendChild(BH(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(Ya("v")),this.element.appendChild(s),this.valueElement=s}},FH=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new IH(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Di(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Oi(null,{label:this.props.get("label")})}};function KH(){return["veryfirst","first","last","verylast"]}const OP=X(""),RP={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let tS=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{KH().forEach(i=>{t.classList.remove(OP(void 0,RP[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(OP(void 0,RP[i]))})}),this.viewProps.handleDispose(()=>{k_(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Di(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Oi(null,Object.assign({},this.viewProps.exportState()))}},UH=class extends x_{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new qp(this))}),this}};function HH(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function ba(n,e){return t=>{HH(n,e,t)}}function S_(n,e){ds(n,t=>{e.textContent=t??""})}const Pm=X("btn");let zH=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Pm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Pm("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Pm("t")),S_(t.props.value("title"),s),this.buttonElement.appendChild(s)}},qH=class{constructor(e,t){this.emitter=new wn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new zH(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Di(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Oi(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},jP=class extends tS{constructor(e,t){const i=new qH(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new FH(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Di(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Oi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},GH=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const YH=new GH("2.0.1");function yt(n){return Object.assign({core:YH},n)}yt({id:"button",type:"blade",accept(n){const e=ut(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new jP(n.document,{blade:n.blade,buttonProps:be.fromObject({title:n.params.title}),labelProps:be.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof jP?new UH(n.controller):null}});function XH(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function WH(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function ZH(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function QH(n){return C_(n)?"refresh"in n&&typeof n.refresh=="function":!1}function JH(n,e){if(!MP.isBindable(n))throw vo.notBindable();return new MP(n,e)}let ez=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new wn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,JH(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return WH(this,e)}addButton(e){return XH(this,e)}addTab(e){return ZH(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{QH(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=TH(t.value)?t.value.binding:null;this.emitter_.emit("change",new Z1(i,s?s.target.read():t.value.rawValue,e.options.last))}},L_=class extends x_{constructor(e,t){super(e),this.rackApi_=new ez(e.rackController,t)}refresh(){this.rackApi_.refresh()}},A_=class extends tS{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Di(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Oi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function qv(n){return"rackController"in n}let tz=class{constructor(e){this.emitter=new wn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw vo.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function nz(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(yc(i)&&i.value===e)return i}return null}function iz(n){return qv(n)?n.rackController.rack.bcSet_:null}let sz=class{constructor(e){var t,i;this.emitter=new wn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new tz(iz),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),yc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(qv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(yc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(qv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=nz(this.find(yc),e.sender);if(!t)throw vo.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},M_=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new sz({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&Q1(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&k_(e.bladeController.view.element)}};function nS(){return new be({positions:nt([],{equals:zU})})}let T_=class iS extends be{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=be.createCore(t);return new iS(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Se(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};fi(this,"expanded",i),fi(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function rz(n,e){let t=0;return DH(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),ep(e),t=e.clientHeight,n.set("temporaryExpanded",null),ep(e)}),t}function NP(n,e){e.style.height=n.styleHeight}function D_(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Se(n.get("expandedHeight"))){const t=rz(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),ep(e)}),n.emitter.on("change",()=>{NP(n,e)}),NP(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let oz=class extends L_{constructor(e,t){super(e,t),this.emitter_=new wn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new kH(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}};const sS=X("cnt");let lz=class{constructor(e,t){var i;this.className_=X((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),sS()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),fi(this.foldable_,"completed",ba(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),fi(t.props,"title",u=>{Se(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),S_(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},BP=class extends A_{constructor(e,t){var i;const s=T_.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new lz(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new M_({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,D_(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Di(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Oi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};yt({id:"folder",type:"blade",accept(n){const e=ut(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new BP(n.document,{blade:n.blade,expanded:n.params.expanded,props:be.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof BP?new oz(n.controller,n.pool):null}});const az=X("");function IP(n,e){return ba(n,az(void 0,e))}let O_=class rS extends be{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=ZU(nt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new rS(be.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){ds(this.globalDisabled_,IP(e,"disabled")),fi(this,"hidden",IP(e,"hidden"))}bindDisabled(e){ds(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){ds(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const FP=X("tbp");let uz=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(FP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(FP("c")),this.element.appendChild(i),this.containerElement=i}};const Xa=X("tbi");let hz=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xa()),t.viewProps.bindClassModifiers(this.element),fi(t.props,"selected",r=>{r?this.element.classList.add(Xa(void 0,"sel")):this.element.classList.remove(Xa(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Xa("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Xa("t")),S_(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},cz=class{constructor(e,t){this.emitter=new wn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new hz(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Gv=class extends A_{constructor(e,t){const i=new uz(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new M_({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new cz(e,{props:t.itemProps,viewProps:O_.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,fi(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Di(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Oi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},pz=class extends L_{constructor(e,t){super(e,t),this.emitter_=new wn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new Gv(t,{blade:nS(),itemProps:be.fromObject({selected:!1,title:e.title}),props:be.fromObject({selected:!1}),viewProps:O_.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new SH(this,e.rawValue))}},dz=class extends L_{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const KP=-1;let mz=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=nt(!0),this.selectedIndex=nt(KP),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=KP,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const Wa=X("tab");let vz=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Wa(),sS()),t.viewProps.bindClassModifiers(this.element),ds(t.empty,ba(this.element,Wa(void 0,"nop")));const i=e.createElement("div");i.classList.add(Wa("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(Wa("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(Wa("c")),this.element.appendChild(r),this.contentsElement=r}},UP=class extends A_{constructor(e,t){const i=new mz,s=new vz(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new M_({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;Q1(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;k_(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};yt({id:"tab",type:"blade",accept(n){const e=ut(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new UP(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new Gv(n.document,{blade:nS(),itemProps:be.fromObject({selected:!1,title:t.title}),props:be.fromObject({selected:!1}),viewProps:O_.create()});e.add(i)}),e},api(n){return n.controller instanceof UP?new pz(n.controller,n.pool):n.controller instanceof Gv?new dz(n.controller,n.pool):null}});let R_=class extends $_{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},Ph=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function tp(n,e){if(n instanceof e)return n;if(n instanceof Ph){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let Yp=class{constructor(e){this.values=be.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Xp(n){var e;const t=zv;if(Array.isArray(n))return(e=ut({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function oS(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function j_(n){return Se(n)?null:new Yp(oS(n))}const ym=X("lst");let fz=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(ym()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(ym("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(ym("m")),s.appendChild(Gp(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,fi(this.props_,"options",r=>{J1(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Wl=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new fz(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Di(e,null,t=>({options:t.required.custom(Xp)}),t=>(this.props.set("options",oS(t.options)),!0))}exportProps(){return Oi(null,{options:this.props.get("options")})}};const HP=X("pop");let wz=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(HP()),t.viewProps.bindClassModifiers(this.element),ds(t.shows,ba(this.element,HP(void 0,"v")))}},lS=class{constructor(e,t){this.shows=nt(!1),this.viewProps=t.viewProps,this.view=new wz(e,{shows:this.shows,viewProps:this.viewProps})}};const zP=X("txt");let _z=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(zP()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(zP("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},N_=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new _z(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Se(s)||(this.value.rawValue=s),this.view.refresh()}};function bz(n){return String(n)}function aS(n){return n==="false"?!1:!!n}function qP(n){return bz(n)}function gz(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const Cz=nn(0);function np(n){return Cz(n)+"%"}function uS(n){return String(n)}function Yv(n){return n}function ga({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Xt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Ou(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function ys(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function Pz(n){return n==="ArrowUp"||n==="ArrowDown"}function hS(n){return Pz(n)||n==="ArrowLeft"||n==="ArrowRight"}function Em(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let No=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new wn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Em(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Em(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Em(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const kn=X("txt");let yz=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(kn(),kn(void 0,"num")),t.arrayPosition&&this.element.classList.add(kn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(kn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(kn()),this.inputElement.classList.add(kn("i"));const s=e.createElement("div");s.classList.add(kn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(si,"svg");r.classList.add(kn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(si,"path");o.classList.add(kn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(si,"path");l.classList.add(kn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(X("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(kn(void 0,"drg"));return}this.element.classList.add(kn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=ze(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},yh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=nt(null),this.view=new yz(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new No(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Se(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Xt(this.props.get("keyScale"),Ou(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Xt(this.props.get("keyScale"),Ou(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const xm=X("sld");let Ez=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(xm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(xm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(xm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=ze(se(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},xz=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Ez(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(se(ze(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Xt(this.props.get("keyScale"),ys(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Xt(this.props.get("keyScale"),ys(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const $m=X("sldtxt");let $z=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add($m());const i=e.createElement("div");i.classList.add($m("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add($m("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},GP=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new xz(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new yh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new $z(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Di(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Oi(null,{max:e.get("max"),min:e.get("min")})}};function Vz(n){return{sliderProps:new be({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new be({formatter:nt(n.formatter),keyScale:n.keyScale,pointerScale:nt(n.pointerScale)})}}const kz={containerUnitSize:"cnt-usz"};function cS(n){return`--${kz[n]}`}function Ru(n){return W1(n)}function hr(n){if(Hv(n))return ut(n,Ru)}function rs(n,e){if(!n)return;const t=[],i=G1(n,e);i&&t.push(i);const s=Y1(n);return s&&t.push(s),new Ph(t)}function pS(n){if(n==="inline"||n==="popup")return n}function Eh(n,e){n.write(e)}const nc=X("ckb");let Sz=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(nc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(nc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(nc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(nc("w")),i.appendChild(r);const o=Gp(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},Lz=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Sz(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function Az(n){const e=[],t=j_(n.options);return t&&e.push(t),new Ph(e)}yt({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=ut(e,i=>({options:i.optional.custom(Xp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>aS,constraint:n=>Az(n.params),writer:n=>Eh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&tp(i,Yp);return s?new Wl(e,{props:new be({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Lz(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Wl?new R_(n.controller):null}});const qr=X("col");let Mz=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(qr()),t.foldable.bindExpandedClass(this.element,qr(void 0,"expanded")),fi(t.foldable,"completed",ba(this.element,qr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(qr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(qr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(qr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(qr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function Tz(n,e,t){const i=ze(n/255,0,1),s=ze(e/255,0,1),r=ze(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function Dz(n,e,t){const i=(n%360+360)%360,s=ze(e/100,0,1),r=ze(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function Oz(n,e,t){const i=ze(n/255,0,1),s=ze(e/255,0,1),r=ze(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function dS(n,e,t){const i=z1(n,360),s=ze(e/100,0,1),r=ze(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function Rz(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function jz(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function wi(n){return[n[0],n[1],n[2]]}function Wp(n,e){return[n[0],n[1],n[2],e]}const Nz={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:Rz,rgb:Dz},hsv:{hsl:jz,hsv:(n,e,t)=>[n,e,t],rgb:dS},rgb:{hsl:Tz,hsv:Oz,rgb:(n,e,t)=>[n,e,t]}};function Zl(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function Bz(n,e){return n===e?e:z1(n,e)}function mS(n,e,t){var i;const s=Zl(e,t);return[e==="rgb"?ze(n[0],0,s[0]):Bz(n[0],s[0]),ze(n[1],0,s[1]),ze(n[2],0,s[2]),ze((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function YP(n,e,t,i){const s=Zl(e,t),r=Zl(e,i);return n.map((o,l)=>o/s[l]*r[l])}function vS(n,e,t){const i=YP(n,e.mode,e.type,"int"),s=Nz[e.mode][t.mode](...i);return YP(s,t.mode,"int",t.type)}let pe=class fS{static black(){return new fS([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=mS(e,t,this.type)}getComponents(e){return Wp(vS(wi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Fs=X("colp");let Iz=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Fs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Fs("hsv"));const s=e.createElement("div");s.classList.add(Fs("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Fs("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Fs("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Fs("a"));const a=e.createElement("div");a.classList.add(Fs("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Fs("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function Fz(n){return n==="int"?"int":n==="float"?"float":void 0}function B_(n){return ut(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Fz)}),expanded:e.optional.boolean,picker:e.optional.custom(pS),readonly:e.optional.constant(!1)}))}function fo(n){return n?.1:1}function wS(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let I_=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=mS(e,t,this.type)}getComponents(e){return Wp(vS(wi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Kz={int:(n,e)=>new pe(n,e),float:(n,e)=>new I_(n,e)};function F_(n,e,t){return Kz[t](n,e)}function Uz(n){return n.type==="float"}function Hz(n){return n.type==="int"}function zz(n){const e=n.getComponents(),t=Zl(n.mode,"int");return new pe([Math.round(se(e[0],0,1,0,t[0])),Math.round(se(e[1],0,1,0,t[1])),Math.round(se(e[2],0,1,0,t[2])),e[3]],n.mode)}function qz(n){const e=n.getComponents(),t=Zl(n.mode,"int");return new I_([se(e[0],0,t[0],0,1),se(e[1],0,t[1],0,1),se(e[2],0,t[2],0,1),e[3]],n.mode)}function Tt(n,e){if(n.type===e)return n;if(Hz(n)&&e==="float")return qz(n);if(Uz(n)&&e==="int")return zz(n);throw vo.shouldNeverHappen()}function Gz(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Bn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const Yz={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function _S(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return Yz[i](t)}function bS(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Bn(e[1],255),Bn(e[2],255),Bn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Xz(n){const e=bS(n);return e?new pe(e,"rgb"):null}function gS(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Bn(e[1],255),Bn(e[2],255),Bn(e[3],255),Bn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Wz(n){const e=gS(n);return e?new pe(e,"rgb"):null}function CS(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[_S(e[1]),Bn(e[2],100),Bn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Zz(n){const e=CS(n);return e?new pe(e,"hsl"):null}function PS(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[_S(e[1]),Bn(e[2],100),Bn(e[3],100),Bn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Qz(n){const e=PS(n);return e?new pe(e,"hsl"):null}function yS(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Jz(n){const e=yS(n);return e?new pe(e,"rgb"):null}function ES(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),se(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),se(parseInt(t[4],16),0,255,0,1)]:null}function e8(n){const e=ES(n);return e?new pe(e,"rgb"):null}function xS(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function XP(n){return e=>{const t=xS(e);return t?F_(t,"rgb",n):null}}function $S(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function WP(n){return e=>{const t=$S(e);return t?F_(t,"rgb",n):null}}const t8=[{parser:yS,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ES,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:bS,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:gS,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:CS,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:PS,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:xS,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:$S,result:{alpha:!0,mode:"rgb",notation:"object"}}];function n8(n){return t8.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function i8(n,e="int"){const t=n8(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function xh(n){const e=[Jz,e8,Xz,Wz,Zz,Qz];n==="int"&&e.push(XP("int"),WP("int")),n==="float"&&e.push(XP("float"),WP("float"));const t=gz(e);return i=>{const s=t(i);return s?Tt(s,n):null}}function s8(n){const e=xh("int");if(typeof n!="string")return pe.black();const t=e(n);return t??pe.black()}function VS(n){const e=ze(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function K_(n,e="#"){const t=wi(n.getComponents("rgb")).map(VS).join("");return`${e}${t}`}function U_(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(VS).join("");return`${e}${i}`}function kS(n){const e=nn(0),t=Tt(n,"int");return`rgb(${wi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Ec(n){const e=nn(2),t=nn(0);return`rgba(${Tt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function r8(n){const e=[nn(0),np,np],t=Tt(n,"int");return`hsl(${wi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function o8(n){const e=[nn(0),np,np,nn(2)];return`hsla(${Tt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function SS(n,e){const t=nn(e==="float"?2:0),i=["r","g","b"],s=Tt(n,e);return`{${wi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function l8(n){return e=>SS(e,n)}function LS(n,e){const t=nn(2),i=nn(e==="float"?2:0),s=["r","g","b","a"];return`{${Tt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function a8(n){return e=>LS(e,n)}const u8=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:K_},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:U_},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:kS},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Ec},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:r8},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:o8},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:l8(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:a8(e)}],[])];function AS(n){return u8.reduce((e,t)=>e||(Gz(t.format,n)?t.stringifier:null),null)}const Za=X("apl");let h8=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Za()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Za("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Za("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(Za("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(Za("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new pe([t[0],t[1],t[2],0],"rgb"),s=new pe([t[0],t[1],t[2],255],"rgb"),r=["to right",Ec(i),Ec(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Ec(e);const o=se(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},c8=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new h8(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new pe([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Xt(fo(!0),ys(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new pe([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Xt(fo(!0),ys(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Qo=X("coltxt");function p8(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let d8=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Qo()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Qo("m")),this.modeElem_=p8(e),this.modeElem_.classList.add(Qo("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(Qo("mm")),s.appendChild(Gp(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(Qo("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),ds(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){J1(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(Qo("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function m8(n){return nn(n==="float"?2:0)}function v8(n,e,t){const i=Zl(n,e)[t];return new zp({min:0,max:i})}function f8(n,e,t){return new yh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:be.fromObject({formatter:m8(e.colorType),keyScale:fo(!1),pointerScale:e.colorType==="float"?.01:1}),value:nt(0,{constraint:v8(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function w8(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Sr,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=f8(n,t,i);return ga({primary:e.value,secondary:s.value,forward(r){return Tt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Tt(r,e.colorType).getComponents(l);u[i]=o;const h=F_(Wp(wi(u),u[3]),l,e.colorType);return Tt(h,"int")}}),s})}function _8(n,e){const t=new N_(n,{parser:xh("int"),props:be.fromObject({formatter:K_}),value:nt(pe.black()),viewProps:e.viewProps});return ga({primary:e.value,secondary:t.value,forward:i=>new pe(wi(i.getComponents()),i.mode),backward:(i,s)=>new pe(Wp(wi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function b8(n){return n!=="hex"}let g8=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=nt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new d8(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return b8(t)?w8(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):_8(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const Vm=X("hpl");let C8=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Vm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Vm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Vm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=kS(new pe([t,100,100],"hsv"));const i=se(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},P8=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new C8(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=se(ze(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new pe([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Xt(fo(!1),ys(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new pe([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Xt(fo(!1),ys(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const km=X("svp"),ZP=64;let y8=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(km()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=ZP,i.width=ZP,i.classList.add(km("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(km("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=OH(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const m=se(c,0,s,0,100),d=se(h,0,r,100,0),f=dS(i[0],m,d),p=(h*s+c)*4;l[p]=f[0],l[p+1]=f[1],l[p+2]=f[2],l[p+3]=255}e.putImageData(o,0,0);const a=se(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=se(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},E8=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new y8(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=se(e.point.x,0,e.bounds.width,0,100),s=se(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new pe([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){hS(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=fo(!1),l=Xt(o,ys(e)),a=Xt(o,Ou(e));l===0&&a===0||this.value.setRawValue(new pe([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=fo(!1),i=Xt(t,ys(e)),s=Xt(t,Ou(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},x8=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new P8(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new E8(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new c8(e,{value:this.value,viewProps:this.viewProps}),text:new yh(e,{parser:Sr,props:be.fromObject({pointerScale:.01,keyScale:.1,formatter:nn(2)}),value:nt(0,{constraint:new zp({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ga({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new pe(r,i.mode)}}),this.textsC_=new g8(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Iz(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Sm=X("colsw");let $8=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Sm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Sm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(Sm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=U_(e)}onValueChange_(){this.update_()}},V8=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new $8(e,{value:this.value,viewProps:this.viewProps})}},H_=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=T_.create(t.expanded),this.swatchC_=new V8(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new N_(e,{parser:t.parser,props:be.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Mz(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new lS(e,{viewProps:this.viewProps}):null;const s=new x8(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),ga({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),D_(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=eS(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!V_(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function k8(n){return wi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function S8(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function L8(n){return new pe([n>>16&255,n>>8&255,n&255],"rgb")}function A8(n){return new pe([n>>24&255,n>>16&255,n>>8&255,se(n&255,0,255,0,1)],"rgb")}function M8(n){return typeof n!="number"?pe.black():L8(n)}function T8(n){return typeof n!="number"?pe.black():A8(n)}function xc(n,e){return typeof n!="object"||Se(n)?!1:e in n&&typeof n[e]=="number"}function MS(n){return xc(n,"r")&&xc(n,"g")&&xc(n,"b")}function TS(n){return MS(n)&&xc(n,"a")}function DS(n){return MS(n)}function z_(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function QP(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function D8(n){const e=AS(n);return e?(t,i)=>{Eh(t,e(i))}:null}function O8(n){const e=n?S8:k8;return(t,i)=>{Eh(t,e(i))}}function R8(n,e,t){const s=Tt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function j8(n,e,t){const s=Tt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function N8(n,e){return(t,i)=>{n?R8(t,i,e):j8(t,i,e)}}function B8(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function I8(n){return n?e=>U_(e,"0x"):e=>K_(e,"0x")}function F8(n){return"color"in n||n.view==="color"}yt({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!F8(e))return null;const t=B_(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:B8(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?T8:M8,equals:z_,writer:n=>O8(n.params.supportsAlpha)},controller:n=>{var e,t;return new H_(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:I8(n.params.supportsAlpha),parser:xh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function K8(n,e){if(!DS(n))return Tt(pe.black(),e);if(e==="int"){const t=QP(n);return new pe(t,"rgb")}if(e==="float"){const t=QP(n);return new I_(t,"rgb")}return Tt(pe.black(),"int")}function U8(n){return TS(n)}function H8(n){return e=>{const t=K8(e,n);return Tt(t,"int")}}function z8(n,e){return t=>n?LS(t,e):SS(t,e)}yt({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!DS(n))return null;const i=B_(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=wS(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>H8(n.params.colorType),equals:z_,writer:n=>N8(U8(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=TS(n.initialValue);return new H_(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:z8(i,n.params.colorType),parser:xh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});yt({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=i8(n,wS(e));if(!t)return null;const i=AS(t);if(!i)return null;const s=B_(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>s8,equals:z_,writer:n=>{const e=D8(n.params.format);if(!e)throw vo.notBindable();return e}},controller:n=>{var e,t;return new H_(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:xh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let q_=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const JP=X("pndtxt");let q8=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(JP()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(JP("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function G8(n,e,t){return new yh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:nt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let G_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>G8(e,t,s)),this.acs_.forEach((i,s)=>{ga({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new q8(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},Y8=class extends $_{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function X8(n,e){const t=[],i=G1(n,e);i&&t.push(i);const s=Y1(n);s&&t.push(s);const r=j_(n.options);return r&&t.push(r),new Ph(t)}yt({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=ut(e,i=>Object.assign(Object.assign({},W1(i)),{options:i.optional.custom(Xp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>H1,constraint:n=>X8(n.params,n.initialValue),writer:n=>Eh},controller:n=>{const e=n.value,t=n.constraint,i=t&&tp(t,Yp);if(i)return new Wl(n.document,{props:new be({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=X1(n.params,e.rawValue),r=t&&tp(t,zp);return r?new GP(n.document,Object.assign(Object.assign({},Vz(Object.assign(Object.assign({},s),{keyScale:nt(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Sr,value:e,viewProps:n.viewProps})):new yh(n.document,{parser:Sr,props:be.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof GP?new Y8(n.controller):n.controller.valueController instanceof Wl?new R_(n.controller):null}});let _r=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Se(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const OS={toComponents:n=>n.getComponents(),fromComponents:n=>new _r(...n)},Jo=X("p2d");let W8=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jo()),t.viewProps.bindClassModifiers(this.element),ds(t.expanded,ba(this.element,Jo(void 0,"expanded")));const i=e.createElement("div");i.classList.add(Jo("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(Jo("b")),s.appendChild(Gp(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(Jo("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Jo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Ks=X("p2dp");let Z8=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Ks()),t.layout==="popup"&&this.element.classList.add(Ks(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ks("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(si,"svg");s.classList.add(Ks("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(si,"line");r.classList.add(Ks("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(si,"line");o.classList.add(Ks("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(si,"line");l.classList.add(Ks("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Ks("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=se(e,-i,+i,0,100),r=se(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function ey(n,e,t){return[Xt(e[0],ys(n)),Xt(e[1],Ou(n))*(t?1:-1)]}let Q8=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Z8(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=se(e.point.x,0,e.bounds.width,-i,+i),r=se(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new _r(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){hS(e.key)&&e.preventDefault();const[t,i]=ey(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new _r(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=ey(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},J8=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=T_.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new lS(e,{viewProps:this.viewProps}):null;const r=new Q8(e,{layout:t.pickerLayout,props:new be({invertsY:nt(t.invertsY),max:nt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new G_(e,{assembly:OS,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new W8(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ga({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),D_(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=eS(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!V_(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function eq(n){return _r.isObject(n)?new _r(n.x,n.y):new _r}function tq(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function nq(n,e){return new q_({assembly:OS,components:[rs(Object.assign(Object.assign({},n),n.x),e.x),rs(Object.assign(Object.assign({},n),n.y),e.y)]})}function ty(n,e){var t,i;if(!Se(n.min)||!Se(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=q1(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function iq(n,e){var t,i;const s=ty(mo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=ty(mo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function sq(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}yt({id:"input-point2d",type:"input",accept:(n,e)=>{if(!_r.isObject(n))return null;const t=ut(e,i=>Object.assign(Object.assign({},Ru(i)),{expanded:i.optional.boolean,picker:i.optional.custom(pS),readonly:i.optional.constant(!1),x:i.optional.custom(hr),y:i.optional.object(Object.assign(Object.assign({},Ru(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>eq,constraint:n=>nq(n.params,n.initialValue),equals:_r.equals,writer:()=>tq},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new J8(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return E_({constraint:r.components[a],initialValue:l,params:mo(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:sq(n.params),max:iq(n.params,s.rawValue),parser:Sr,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Ll=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Se(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const RS={toComponents:n=>n.getComponents(),fromComponents:n=>new Ll(...n)};function rq(n){return Ll.isObject(n)?new Ll(n.x,n.y,n.z):new Ll}function oq(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function lq(n,e){return new q_({assembly:RS,components:[rs(Object.assign(Object.assign({},n),n.x),e.x),rs(Object.assign(Object.assign({},n),n.y),e.y),rs(Object.assign(Object.assign({},n),n.z),e.z)]})}yt({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Ll.isObject(n))return null;const t=ut(e,i=>Object.assign(Object.assign({},Ru(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(hr),y:i.optional.custom(hr),z:i.optional.custom(hr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>rq,constraint:n=>lq(n.params,n.initialValue),equals:Ll.equals,writer:n=>oq},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new G_(n.document,{assembly:RS,axes:e.rawValue.getComponents().map((s,r)=>{var o;return E_({constraint:t.components[r],initialValue:s,params:mo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Sr,value:e,viewProps:n.viewProps})}});let Al=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Se(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const jS={toComponents:n=>n.getComponents(),fromComponents:n=>new Al(...n)};function aq(n){return Al.isObject(n)?new Al(n.x,n.y,n.z,n.w):new Al}function uq(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function hq(n,e){return new q_({assembly:jS,components:[rs(Object.assign(Object.assign({},n),n.x),e.x),rs(Object.assign(Object.assign({},n),n.y),e.y),rs(Object.assign(Object.assign({},n),n.z),e.z),rs(Object.assign(Object.assign({},n),n.w),e.w)]})}yt({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Al.isObject(n))return null;const t=ut(e,i=>Object.assign(Object.assign({},Ru(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(hr),x:i.optional.custom(hr),y:i.optional.custom(hr),z:i.optional.custom(hr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>aq,constraint:n=>hq(n.params,n.initialValue),equals:Al.equals,writer:n=>uq},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new G_(n.document,{assembly:jS,axes:e.rawValue.getComponents().map((s,r)=>{var o;return E_({constraint:t.components[r],initialValue:s,params:mo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Sr,value:e,viewProps:n.viewProps})}});function cq(n){const e=[],t=j_(n.options);return t&&e.push(t),new Ph(e)}yt({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=ut(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Xp)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>uS,constraint:n=>cq(n.params),writer:n=>Eh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&tp(i,Yp);return s?new Wl(e,{props:new be({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new N_(e,{parser:r=>r,props:be.fromObject({formatter:Yv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Wl?new R_(n.controller):null}});const Zp={monitor:{defaultInterval:200,defaultRows:3}},ny=X("mll");let pq=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(ny()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(ny("i")),i.style.height=`calc(var(${cS("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Y_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new pq(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const iy=X("sgl");let dq=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(iy()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(iy("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},X_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new dq(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};yt({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=ut(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>aS},controller:n=>{var e;return n.value.rawValue.length===1?new X_(n.document,{formatter:qP,value:n.value,viewProps:n.viewProps}):new Y_(n.document,{formatter:qP,rows:(e=n.params.rows)!==null&&e!==void 0?e:Zp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let mq=class extends $_{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Us=X("grl");let vq=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Us()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(si,"svg");i.classList.add(Us("g")),i.style.height=`calc(var(${cS("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(si,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Us("t"),X("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const m=se(c,0,t,0,e.width),d=se(h,i,s,e.height,0);r.push([m,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(Us("t","a"));return}const a=se(this.cursor_.rawValue,0,t,0,e.width),u=se(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(Us("t","a"))||(o.classList.add(Us("t","a"),Us("t","in")),ep(o),o.classList.remove(Us("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},NS=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=nt(-1),this.view=new vq(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!V_(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new No(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Di(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Oi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(se(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(se(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function Xv(n){return Se(n.format)?nn(2):n.format}function fq(n){var e;return n.value.rawValue.length===1?new X_(n.document,{formatter:Xv(n.params),value:n.value,viewProps:n.viewProps}):new Y_(n.document,{formatter:Xv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Zp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function wq(n){var e,t,i;return new NS(n.document,{formatter:Xv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Zp.monitor.defaultRows,props:be.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function sy(n){return n.view==="graph"}yt({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=ut(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>sy(n)?64:1,reader:n=>H1},controller:n=>sy(n.params)?wq(n):fq(n),api:n=>n.controller.valueController instanceof NS?new mq(n.controller):null});yt({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=ut(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>uS},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Y_(n.document,{formatter:Yv,rows:(e=n.params.rows)!==null&&e!==void 0?e:Zp.monitor.defaultRows,value:t,viewProps:n.viewProps}):new X_(n.document,{formatter:Yv,value:t,viewProps:n.viewProps})}});function _q(){const n=`
	<svg width="320" height="50" xmlns="http://www.w3.org/2000/svg">
  <style>
    text {
      font-family: "Menlo", monospace;
      font-size: 12px;
			fill: gray;
    }
  </style>
  <text x="50%" y="55%" text-anchor="middle">
    No Image
  </text>
</svg>`,e=new Blob([n],{type:"image/svg+xml"}),t=new Image;return t.src=URL.createObjectURL(e),t}function ry(n){const e=new Image;return e.crossOrigin="anonymous",e.src=n,e}const Gr=X("img");class bq{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Gr()),t.viewProps.bindClassModifiers(this.element),this.input=e.createElement("input"),this.input.classList.add(Gr("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.extensions.join(",")),this.image_=e.createElement("img"),this.image_.id="tpimg_"+Math.random().toString(36).slice(2),this.image_.classList.add(Gr("image")),this.image_.classList.add(Gr(`image_${t.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=i=>{t.clickCallback?t.clickCallback(i,this.input):this.input.click()},this.element.classList.add(Gr("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(e){this.image_.src=e}changeDraggingState(e){const t=this.element;e?t==null||t.classList.add(Gr("area_dragging")):t==null||t.classList.remove(Gr("area_dragging"))}}let Lm=null;class gq{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new bq(e,{viewProps:this.viewProps,extensions:t.extensions,imageFit:t.imageFit,clickCallback:t.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragstart",this.onDragStart),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.element.removeEventListener("drop",this.onDrop),this.view.element.removeEventListener("dragstart",this.onDragStart),this.view.element.removeEventListener("dragover",this.onDragOver),this.view.element.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",()=>this.handleValueChange()),this.handleValueChange()}onFile(e){const t=(e==null?void 0:e.target).files;if(!t||!t.length)return;const i=t[0];this.setValue(i)}onDrop(e){e.preventDefault();try{const{dataTransfer:t}=e,i=t==null?void 0:t.files[0];if(i)this.setValue(i);else{const s=t==null?void 0:t.getData("img-id");if(s){const r=document.getElementById(s);this.setValue(r)}else{const r=t==null?void 0:t.getData("url");if(!r)throw new Error("No url");this.setValue(r)}}}catch(t){console.error("Could not parse the dropped image",t)}finally{this.view.changeDraggingState(!1)}}onDragStart(e){var t,i;(t=e.dataTransfer)===null||t===void 0||t.setData("img-id",this.view.image_.id),(i=e.dataTransfer)===null||i===void 0||i.setDragImage(this.view.image_,0,0)}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(e){e instanceof HTMLImageElement?this.updateImage(e.src):typeof e=="string"||!e?((e==="placeholder"||!e)&&(e=this.handlePlaceholderImage().src),this.updateImage(e)):this.setValue(e)}updateImage(e){this.view.changeImage(e)}setValue(e){if(e instanceof HTMLImageElement)this.value.setRawValue(e);else if(e instanceof File){const t=URL.createObjectURL(e)+"#"+e.name;e.src=t;const i=ry(t);this.value.setRawValue(i||e)}else e?this.value.setRawValue(ry(e)):this.value.setRawValue(this.handlePlaceholderImage())}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return Lm||(Lm=_q()),Lm}}const Cq=[".jpg",".png",".gif"];yt({id:"input-image",type:"input",accept(n,e){if(!(n instanceof HTMLImageElement||typeof n=="string"))return null;const t=ut(e,i=>({view:i.required.constant("input-image"),acceptUrl:i.optional.boolean,clickCallback:i.optional.function,imageFit:i.optional.custom(s=>s==="contain"||s==="cover"?s:void 0),extensions:i.optional.array(i.required.string)}));return t?{initialValue:n,params:t}:null},binding:{reader(n){return e=>e.src!==void 0?e.src===""?"placeholder":e.src:e},writer(n){return(e,t)=>{e.write(t)}}},controller(n){var e,t;return new gq(n.document,{value:n.value,imageFit:(e=n.params.imageFit)!==null&&e!==void 0?e:"cover",clickCallback:n.params.clickCallback,viewProps:n.viewProps,extensions:(t=n.params.extensions)!==null&&t!==void 0?t:Cq})}});const Pq="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let yq=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n));for(;n--;)e+=Pq[t[n]&63];return e};function Eq(n){let e,t,i,s,r;const o=[{options:n[2]},{plugin:x4},n[3]];function l(h){n[11](h)}let a={};for(let h=0;h<o.length;h+=1)a=ye(a,o[h]);n[0]!==void 0&&(a.value=n[0]),e=new N1({props:a}),R.push(()=>F(e,"value",l)),e.$on("change",n[12]);let u=!hD;return{c(){M(e.$$.fragment),i=Dn(),s=Oe()},l(h){T(e.$$.fragment,h),i=On(h),s=Oe()},m(h,c){D(e,h,c),z(h,i,c),z(h,s,c),r=!0},p(h,[c]){const m=c&12?Li(o,[c&4&&{options:h[2]},o[1],c&8&&Ai(h[3])]):{};!t&&c&1&&(t=!0,m.value=h[0],I(()=>t=!1)),e.$set(m)},i(h){r||(g(e.$$.fragment,h),g(u),r=!0)},o(h){C(e.$$.fragment,h),C(u),r=!1},d(h){h&&(k(i),k(s)),O(e,h)}}}function xq(n,e,t){const i=["groupName","values","value","columns","rows","suffix","prefix"];let s=bt(e,i);const r=yq();let{groupName:o=void 0}=e,{values:l}=e,{value:a=l[0]}=e,{columns:u=void 0}=e,{rows:h=void 0}=e,{suffix:c=void 0}=e,{prefix:m=void 0}=e,d,f;function p(_,A){const x=A*d.columns+_;return x>=0&&x<l.length?{value:l[x],title:`${m??""}${l[x]}${c??""}`}:{value:l[0],title:""}}function v(_){a=_,t(0,a)}function w(_){ih.call(this,n,_)}return n.$$set=_=>{t(4,e=ye(ye({},e),hi(_))),t(3,s=bt(e,i)),"groupName"in _&&t(5,o=_.groupName),"values"in _&&t(6,l=_.values),"value"in _&&t(0,a=_.value),"columns"in _&&t(7,u=_.columns),"rows"in _&&t(8,h=_.rows),"suffix"in _&&t(9,c=_.suffix),"prefix"in _&&t(10,m=_.prefix)},n.$$.update=()=>{n.$$.dirty&448&&t(1,d=qj(l.length,u,h)),n.$$.dirty&34&&t(2,f={cells:p,groupName:o??r,size:[d.columns,d.rows],view:"radiogrid"})},e=hi(e),[a,d,f,s,e,o,l,u,h,c,m,v,w]}class $q extends Ft{constructor(e){super(),Kt(this,e,xq,Eq,It,{groupName:5,values:6,value:0,columns:7,rows:8,suffix:9,prefix:10})}}function Le(n){return n==null}function W_(n){return n!==null&&typeof n=="object"}function Wv(n){return n!==null&&typeof n=="object"}function Vq(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function wo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return Wv(r)&&Wv(o)?Object.assign(Object.assign({},i),{[s]:wo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function kq(n){return W_(n)?"target"in n:!1}const Sq={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let _o=class bl{static alreadyDisposed(){return new bl({type:"alreadydisposed"})}static notBindable(){return new bl({type:"notbindable"})}static notCompatible(e,t){return new bl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new bl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new bl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=Sq[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},oy=class BS{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!BS.isBindable(i))throw _o.notBindable();if(!(e in i))throw _o.propertyNotFound(e);i[e]=t}},_n=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},Lq=class{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new _n,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},Aq=class{constructor(e){this.emitter=new _n,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},Mq=class{constructor(e){this.emitter=new _n,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function We(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new Aq(n):new Lq(n,e)}function Tq(n){return[new Mq(n),(e,t)=>{n.setRawValue(e,t)}]}let J=class IS{constructor(e){this.emitter=new _n,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:We(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new IS(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},Qp=class{constructor(e){this.values=J.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},Dq=class{constructor(e){this.values=J.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Le(i)||(s=Math.max(s,i)),Le(t)||(s=Math.min(s,t)),s}},Oq=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},Rq=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const jq={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let Nq=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=jq[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const Bq={"+":n=>n,"-":n=>-n,"~":n=>~n};let Iq=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Bq[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function Z_(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function ju(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Fq(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Nu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Kq(n,e){const t=Nu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Nu(n,e);return s===""?"":i+s}function Q_(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=Kq(n,e);return i===""?"":t+i}function FS(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=Fq(n,e);return e+=i.length,i===""?"":i+Nu(n,e)}function Uq(n,e){const t=FS(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Nu(n,e);return e+=s.length,t+i+s+Q_(n,e)}function Hq(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Nu(n,e);return e+=i.length,i===""?"":t+i+Q_(n,e)}function zq(n,e){const t=FS(n,e);return e+=t.length,t===""?"":t+Q_(n,e)}const qq=Z_([Uq,Hq,zq]);function Gq(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Yq(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=Gq(n,e);return i===""?"":t+i}function Xq(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Wq(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=Xq(n,e);return i===""?"":t+i}function Zq(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Qq(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=Zq(n,e);return i===""?"":t+i}const Jq=Z_([Yq,Wq,Qq]),e7=Z_([Jq,qq]);function t7(n,e){const t=e7(n,e);return e+=t.length,t===""?null:{evaluable:new Rq(t),cursor:e}}function n7(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=US(n,e);if(!i)return null;e=i.cursor,e+=ju(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function i7(n,e){var t;return(t=t7(n,e))!==null&&t!==void 0?t:n7(n,e)}function KS(n,e){const t=i7(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=KS(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new Iq(i,s.evaluable)}):null}function s7(n,e,t){t+=ju(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=ju(e,t).length,{cursor:t,operator:i}):null}function r7(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=s7(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new Nq(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const o7=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>r7(n,e),KS);function US(n,e){return e+=ju(n,e).length,o7(n,e)}function l7(n){const e=US(n,0);return!e||e.cursor+ju(n,e.cursor).length!==n.length?null:e.evaluable}function _i(n){var e;const t=l7(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function Jp(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=_i(n);if(!Le(e))return e}return 0}function gt(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function re(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function Zv(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ie(n,e,t){return Math.min(Math.max(n,e),t)}function HS(n,e){return(n%e+e)%e}function a7(n,e){return Le(n.step)?Math.max(Zv(e),2):Zv(n.step)}function zS(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function u7(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function J_(n,e){return Le(n.step)?null:new Oq(n.step,e)}function eb(n){return!Le(n.max)&&!Le(n.min)?new Qp({max:n.max,min:n.min}):!Le(n.max)||!Le(n.min)?new Dq({max:n.max,min:n.min}):null}function ed(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:gt(a7(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:zS(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:u7(n,e)}}function td(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function tb(n){return{constraint:n.constraint,textProps:J.fromObject(ed(n.params,n.initialValue))}}let nb=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},nd=class{constructor(e){this.target=e}},qS=class extends nd{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},h7=class extends nd{constructor(e,t){super(e),this.expanded=t}},c7=class extends nd{constructor(e,t){super(e),this.index=t}},ib=class extends nb{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new _n,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new qS(this,t.binding.target.read(),e.options.last))}};function p7(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function d7(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function m7(n){return n===null?!1:typeof n=="object"}function Zi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function ly(n){return{custom:e=>Zi(e)(n),boolean:Zi(e=>typeof e=="boolean"?e:void 0)(n),number:Zi(e=>typeof e=="number"?e:void 0)(n),string:Zi(e=>typeof e=="string"?e:void 0)(n),function:Zi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Zi(t=>t===e?e:void 0)(n),raw:Zi(e=>e)(n),object:e=>Zi(t=>{if(m7(t))return p7(t,e)})(n),array:e=>Zi(t=>{if(Array.isArray(t))return d7(t,e)})(n)}}const Qv={optional:ly(!0),required:ly(!1)};function ot(n,e){const t=e(Qv),i=Qv.required.object(t)(n);return i.succeeded?i.value:void 0}function Ri(n,e,t,i){if(e&&!e(n))return!1;const s=ot(n,t);return s?i(s):!1}function ji(n,e){var t;return wo((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function $c(n){return"value"in n}function v7(n){if(!W_(n)||!("binding"in n))return!1;const e=n.binding;return kq(e)}const an="http://www.w3.org/2000/svg";function ip(n){n.offsetHeight}function f7(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function sb(n){return n.ontouchstart!==void 0}function w7(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const _7={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function id(n,e){const t=n.createElementNS(an,"svg");return t.innerHTML=_7[e],t}function GS(n,e,t){n.insertBefore(e,n.children[t])}function Bu(n){n.parentElement&&n.parentElement.removeChild(n)}function YS(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function b7(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function XS(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function ms(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function bi(n,e,t){ms(n.value(e),t)}const g7="tp";function N(n){return(t,i)=>[g7,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const Qa=N("lbl");function C7(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let P7=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Qa()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Qa("l")),bi(t.props,"label",r=>{Le(r)?this.element.classList.add(Qa(void 0,"nol")):(this.element.classList.remove(Qa(void 0,"nol")),b7(i),i.appendChild(C7(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(Qa("v")),this.element.appendChild(s),this.valueElement=s}},y7=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new P7(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Ri(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return ji(null,{label:this.props.get("label")})}};function E7(){return["veryfirst","first","last","verylast"]}const ay=N(""),uy={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let WS=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{E7().forEach(i=>{t.classList.remove(ay(void 0,uy[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(ay(void 0,uy[i]))})}),this.viewProps.handleDispose(()=>{Bu(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Ri(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return ji(null,Object.assign({},this.viewProps.exportState()))}},x7=class extends nb{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new nd(this))}),this}};function $7(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function Ca(n,e){return t=>{$7(n,e,t)}}function rb(n,e){ms(n,t=>{e.textContent=t??""})}const Am=N("btn");let V7=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Am()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Am("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Am("t")),rb(t.props.value("title"),s),this.buttonElement.appendChild(s)}},k7=class{constructor(e,t){this.emitter=new _n,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new V7(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Ri(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return ji(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},hy=class extends WS{constructor(e,t){const i=new k7(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new y7(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Ri(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return ji(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},S7=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const L7=new S7("2.0.0-beta.2");function ht(n){return Object.assign({core:L7},n)}ht({id:"button",type:"blade",accept(n){const e=ot(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new hy(n.document,{blade:n.blade,buttonProps:J.fromObject({title:n.params.title}),labelProps:J.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof hy?new x7(n.controller):null}});function A7(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function M7(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function T7(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function D7(n){return W_(n)?"refresh"in n&&typeof n.refresh=="function":!1}function O7(n,e){if(!oy.isBindable(n))throw _o.notBindable();return new oy(n,e)}let R7=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new _n,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,O7(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return M7(this,e)}addButton(e){return A7(this,e)}addTab(e){return T7(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{D7(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=v7(t.value)?t.value.binding:null;this.emitter_.emit("change",new qS(i,s?s.target.read():t.value.rawValue,e.options.last))}},ob=class extends nb{constructor(e,t){super(e),this.rackApi_=new R7(e.rackController,t)}},lb=class extends WS{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Ri(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return ji(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Jv(n){return"rackController"in n}let j7=class{constructor(e){this.emitter=new _n,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw _o.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function N7(n,e){for(let t=0;t<n.length;t++){const i=n[t];if($c(i)&&i.value===e)return i}return null}function B7(n){return Jv(n)?n.rackController.rack.bcSet_:null}let I7=class{constructor(e){var t,i;this.emitter=new _n,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new j7(B7),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),$c(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Jv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if($c(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Jv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=N7(this.find($c),e.sender);if(!t)throw _o.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},ab=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new I7({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&GS(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Bu(e.bladeController.view.element)}};function ZS(){return new J({positions:We([],{equals:Vq})})}let ub=class QS extends J{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=J.createCore(t);return new QS(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Le(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};bi(this,"expanded",i),bi(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function F7(n,e){let t=0;return f7(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),ip(e),t=e.clientHeight,n.set("temporaryExpanded",null),ip(e)}),t}function cy(n,e){e.style.height=n.styleHeight}function hb(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Le(n.get("expandedHeight"))){const t=F7(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),ip(e)}),n.emitter.on("change",()=>{cy(n,e)}),cy(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let K7=class extends ob{constructor(e,t){super(e,t),this.emitter_=new _n,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new h7(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.rackApi_.refresh()}};const JS=N("cnt");let U7=class{constructor(e,t){var i;this.className_=N((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),JS()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),bi(this.foldable_,"completed",Ca(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),bi(t.props,"title",u=>{Le(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),rb(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},py=class extends lb{constructor(e,t){var i;const s=ub.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new U7(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new ab({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,hb(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Ri(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return ji(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};ht({id:"folder",type:"blade",accept(n){const e=ot(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new py(n.document,{blade:n.blade,expanded:n.params.expanded,props:J.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof py?new K7(n.controller,n.pool):null}});const H7=N("");function dy(n,e){return Ca(n,H7(void 0,e))}let cb=class eL extends J{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=Tq(We(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new eL(J.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){ms(this.globalDisabled_,dy(e,"disabled")),bi(this,"hidden",dy(e,"hidden"))}bindDisabled(e){ms(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){ms(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const my=N("tbp");let z7=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(my()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(my("c")),this.element.appendChild(i),this.containerElement=i}};const Ja=N("tbi");let q7=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ja()),t.viewProps.bindClassModifiers(this.element),bi(t.props,"selected",r=>{r?this.element.classList.add(Ja(void 0,"sel")):this.element.classList.remove(Ja(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Ja("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Ja("t")),rb(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},G7=class{constructor(e,t){this.emitter=new _n,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new q7(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},ef=class extends lb{constructor(e,t){const i=new z7(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new ab({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new G7(e,{props:t.itemProps,viewProps:cb.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,bi(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Ri(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return ji(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},Y7=class extends ob{constructor(e,t){super(e,t),this.emitter_=new _n,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new ef(t,{blade:ZS(),itemProps:J.fromObject({selected:!1,title:e.title}),props:J.fromObject({selected:!1}),viewProps:cb.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new c7(this,e.rawValue))}},X7=class extends ob{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}refresh(){this.rackApi_.refresh()}};const vy=-1;let W7=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=We(!0),this.selectedIndex=We(vy),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=vy,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const eu=N("tab");let Z7=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(eu(),JS()),t.viewProps.bindClassModifiers(this.element),ms(t.empty,Ca(this.element,eu(void 0,"nop")));const i=e.createElement("div");i.classList.add(eu("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(eu("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(eu("c")),this.element.appendChild(r),this.contentsElement=r}},fy=class extends lb{constructor(e,t){const i=new W7,s=new Z7(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new ab({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;GS(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Bu(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};ht({id:"tab",type:"blade",accept(n){const e=ot(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new fy(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new ef(n.document,{blade:ZS(),itemProps:J.fromObject({selected:!1,title:t.title}),props:J.fromObject({selected:!1}),viewProps:cb.create()});e.add(i)}),e},api(n){return n.controller instanceof fy?new Y7(n.controller,n.pool):n.controller instanceof ef?new X7(n.controller,n.pool):null}});let pb=class extends ib{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},Pa=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function sp(n,e){if(n instanceof e)return n;if(n instanceof Pa){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let sd=class{constructor(e){this.values=J.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function rd(n){var e;const t=Qv;if(Array.isArray(n))return(e=ot({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function tL(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function db(n){return Le(n)?null:new sd(tL(n))}const Mm=N("lst");let Q7=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Mm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(Mm("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(Mm("m")),s.appendChild(id(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,bi(this.props_,"options",r=>{YS(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Ql=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Q7(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Ri(e,null,t=>({options:t.required.custom(rd)}),t=>(this.props.set("options",tL(t.options)),!0))}exportProps(){return ji(null,{options:this.props.get("options")})}};const wy=N("pop");let J7=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wy()),t.viewProps.bindClassModifiers(this.element),ms(t.shows,Ca(this.element,wy(void 0,"v")))}},nL=class{constructor(e,t){this.shows=We(!1),this.viewProps=t.viewProps,this.view=new J7(e,{shows:this.shows,viewProps:this.viewProps})}};const _y=N("txt");let eG=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(_y()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(_y("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},mb=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new eG(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Le(s)||(this.value.rawValue=s),this.view.refresh()}};function tG(n){return String(n)}function iL(n){return n==="false"?!1:!!n}function by(n){return tG(n)}function nG(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const iG=gt(0);function rp(n){return iG(n)+"%"}function sL(n){return String(n)}function tf(n){return n}function ya({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Wt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Iu(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Es(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function sG(n){return n==="ArrowUp"||n==="ArrowDown"}function rL(n){return sG(n)||n==="ArrowLeft"||n==="ArrowRight"}function Tm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let jr=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new _n,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Tm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Tm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Tm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Sn=N("txt");let rG=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Sn(),Sn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Sn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Sn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Sn()),this.inputElement.classList.add(Sn("i"));const s=e.createElement("div");s.classList.add(Sn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(an,"svg");r.classList.add(Sn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(an,"path");o.classList.add(Sn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(an,"path");l.classList.add(Sn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(N("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Sn(void 0,"drg"));return}this.element.classList.add(Sn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Ie(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Ea=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=We(null),this.view=new rG(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new jr(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Le(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Wt(this.props.get("keyScale"),Iu(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Wt(this.props.get("keyScale"),Iu(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const Dm=N("sld");let oG=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Dm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Dm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(Dm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ie(re(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},lG=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new oG(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new jr(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(re(Ie(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Wt(this.props.get("keyScale"),Es(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Wt(this.props.get("keyScale"),Es(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Om=N("sldtxt");let aG=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Om());const i=e.createElement("div");i.classList.add(Om("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Om("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},gy=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new lG(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Ea(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new aG(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Ri(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return ji(null,{max:e.get("max"),min:e.get("min")})}};function uG(n){return{sliderProps:new J({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new J({formatter:We(n.formatter),keyScale:n.keyScale,pointerScale:We(n.pointerScale)})}}const hG={containerUnitSize:"cnt-usz"};function oL(n){return`--${hG[n]}`}function Fu(n){return td(n)}function cr(n){if(Wv(n))return ot(n,Fu)}function os(n,e){if(!n)return;const t=[],i=J_(n,e);i&&t.push(i);const s=eb(n);return s&&t.push(s),new Pa(t)}function lL(n){if(n==="inline"||n==="popup")return n}function Bo(n,e){n.write(e)}const ic=N("ckb");let cG=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ic()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(ic("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(ic("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(ic("w")),i.appendChild(r);const o=id(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},pG=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new cG(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function dG(n){const e=[],t=db(n.options);return t&&e.push(t),new Pa(e)}ht({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=ot(e,i=>({options:i.optional.custom(rd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>iL,constraint:n=>dG(n.params),writer:n=>Bo},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&sp(i,sd);return s?new Ql(e,{props:new J({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new pG(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Ql?new pb(n.controller):null}});const Yr=N("col");let mG=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Yr()),t.foldable.bindExpandedClass(this.element,Yr(void 0,"expanded")),bi(t.foldable,"completed",Ca(this.element,Yr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Yr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Yr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Yr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Yr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function vG(n,e,t){const i=Ie(n/255,0,1),s=Ie(e/255,0,1),r=Ie(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function fG(n,e,t){const i=(n%360+360)%360,s=Ie(e/100,0,1),r=Ie(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function wG(n,e,t){const i=Ie(n/255,0,1),s=Ie(e/255,0,1),r=Ie(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function aL(n,e,t){const i=HS(n,360),s=Ie(e/100,0,1),r=Ie(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function _G(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function bG(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function gi(n){return[n[0],n[1],n[2]]}function od(n,e){return[n[0],n[1],n[2],e]}const gG={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:_G,rgb:fG},hsv:{hsl:bG,hsv:(n,e,t)=>[n,e,t],rgb:aL},rgb:{hsl:vG,hsv:wG,rgb:(n,e,t)=>[n,e,t]}};function Jl(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function CG(n,e){return n===e?e:HS(n,e)}function uL(n,e,t){var i;const s=Jl(e,t);return[e==="rgb"?Ie(n[0],0,s[0]):CG(n[0],s[0]),Ie(n[1],0,s[1]),Ie(n[2],0,s[2]),Ie((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function Cy(n,e,t,i){const s=Jl(e,t),r=Jl(e,i);return n.map((o,l)=>o/s[l]*r[l])}function hL(n,e,t){const i=Cy(n,e.mode,e.type,"int"),s=gG[e.mode][t.mode](...i);return Cy(s,t.mode,"int",t.type)}let de=class cL{static black(){return new cL([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=uL(e,t,this.type)}getComponents(e){return od(hL(gi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Hs=N("colp");let PG=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Hs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Hs("hsv"));const s=e.createElement("div");s.classList.add(Hs("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Hs("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Hs("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Hs("a"));const a=e.createElement("div");a.classList.add(Hs("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Hs("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function yG(n){return n==="int"?"int":n==="float"?"float":void 0}function vb(n){return ot(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(yG)}),expanded:e.optional.boolean,picker:e.optional.custom(lL),readonly:e.optional.constant(!1)}))}function bo(n){return n?.1:1}function pL(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let fb=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=uL(e,t,this.type)}getComponents(e){return od(hL(gi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const EG={int:(n,e)=>new de(n,e),float:(n,e)=>new fb(n,e)};function wb(n,e,t){return EG[t](n,e)}function xG(n){return n.type==="float"}function $G(n){return n.type==="int"}function VG(n){const e=n.getComponents(),t=Jl(n.mode,"int");return new de([Math.round(re(e[0],0,1,0,t[0])),Math.round(re(e[1],0,1,0,t[1])),Math.round(re(e[2],0,1,0,t[2])),e[3]],n.mode)}function kG(n){const e=n.getComponents(),t=Jl(n.mode,"int");return new fb([re(e[0],0,t[0],0,1),re(e[1],0,t[1],0,1),re(e[2],0,t[2],0,1),e[3]],n.mode)}function Dt(n,e){if(n.type===e)return n;if($G(n)&&e==="float")return kG(n);if(xG(n)&&e==="int")return VG(n);throw _o.shouldNeverHappen()}function SG(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function In(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const LG={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function dL(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return LG[i](t)}function mL(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[In(e[1],255),In(e[2],255),In(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function AG(n){const e=mL(n);return e?new de(e,"rgb"):null}function vL(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[In(e[1],255),In(e[2],255),In(e[3],255),In(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function MG(n){const e=vL(n);return e?new de(e,"rgb"):null}function fL(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[dL(e[1]),In(e[2],100),In(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function TG(n){const e=fL(n);return e?new de(e,"hsl"):null}function wL(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[dL(e[1]),In(e[2],100),In(e[3],100),In(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function DG(n){const e=wL(n);return e?new de(e,"hsl"):null}function _L(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function OG(n){const e=_L(n);return e?new de(e,"rgb"):null}function bL(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),re(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),re(parseInt(t[4],16),0,255,0,1)]:null}function RG(n){const e=bL(n);return e?new de(e,"rgb"):null}function gL(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Py(n){return e=>{const t=gL(e);return t?wb(t,"rgb",n):null}}function CL(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function yy(n){return e=>{const t=CL(e);return t?wb(t,"rgb",n):null}}const jG=[{parser:_L,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:bL,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:mL,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:vL,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:fL,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:wL,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:gL,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:CL,result:{alpha:!0,mode:"rgb",notation:"object"}}];function NG(n){return jG.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function BG(n,e="int"){const t=NG(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function $h(n){const e=[OG,RG,AG,MG,TG,DG];n==="int"&&e.push(Py("int"),yy("int")),n==="float"&&e.push(Py("float"),yy("float"));const t=nG(e);return i=>{const s=t(i);return s?Dt(s,n):null}}function IG(n){const e=$h("int");if(typeof n!="string")return de.black();const t=e(n);return t??de.black()}function PL(n){const e=Ie(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function _b(n,e="#"){const t=gi(n.getComponents("rgb")).map(PL).join("");return`${e}${t}`}function bb(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(PL).join("");return`${e}${i}`}function yL(n){const e=gt(0),t=Dt(n,"int");return`rgb(${gi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Vc(n){const e=gt(2),t=gt(0);return`rgba(${Dt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function FG(n){const e=[gt(0),rp,rp],t=Dt(n,"int");return`hsl(${gi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function KG(n){const e=[gt(0),rp,rp,gt(2)];return`hsla(${Dt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function EL(n,e){const t=gt(e==="float"?2:0),i=["r","g","b"],s=Dt(n,e);return`{${gi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function UG(n){return e=>EL(e,n)}function xL(n,e){const t=gt(2),i=gt(e==="float"?2:0),s=["r","g","b","a"];return`{${Dt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function HG(n){return e=>xL(e,n)}const zG=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:_b},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:bb},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:yL},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Vc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:FG},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:KG},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:UG(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:HG(e)}],[])];function $L(n){return zG.reduce((e,t)=>e||(SG(t.format,n)?t.stringifier:null),null)}const tu=N("apl");let qG=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(tu()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(tu("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(tu("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(tu("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(tu("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new de([t[0],t[1],t[2],0],"rgb"),s=new de([t[0],t[1],t[2],255],"rgb"),r=["to right",Vc(i),Vc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Vc(e);const o=re(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},GG=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new qG(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new jr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new de([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Wt(bo(!0),Es(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new de([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Wt(bo(!0),Es(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const el=N("coltxt");function YG(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let XG=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(el()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(el("m")),this.modeElem_=YG(e),this.modeElem_.classList.add(el("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(el("mm")),s.appendChild(id(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(el("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),ms(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){YS(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(el("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function WG(n){return gt(n==="float"?2:0)}function ZG(n,e,t){const i=Jl(n,e)[t];return new Qp({min:0,max:i})}function QG(n,e,t){return new Ea(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:J.fromObject({formatter:WG(e.colorType),keyScale:bo(!1),pointerScale:e.colorType==="float"?.01:1}),value:We(0,{constraint:ZG(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function JG(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:_i,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=QG(n,t,i);return ya({primary:e.value,secondary:s.value,forward(r){return Dt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Dt(r,e.colorType).getComponents(l);u[i]=o;const h=wb(od(gi(u),u[3]),l,e.colorType);return Dt(h,"int")}}),s})}function e9(n,e){const t=new mb(n,{parser:$h("int"),props:J.fromObject({formatter:_b}),value:We(de.black()),viewProps:e.viewProps});return ya({primary:e.value,secondary:t.value,forward:i=>new de(gi(i.getComponents()),i.mode),backward:(i,s)=>new de(od(gi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function t9(n){return n!=="hex"}let n9=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=We(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new XG(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return t9(t)?JG(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):e9(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const Rm=N("hpl");let i9=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Rm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Rm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Rm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=yL(new de([t,100,100],"hsv"));const i=re(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},s9=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new i9(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new jr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=re(Ie(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new de([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Wt(bo(!1),Es(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new de([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Wt(bo(!1),Es(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const jm=N("svp"),Ey=64;let r9=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(jm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=Ey,i.width=Ey,i.classList.add(jm("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(jm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=w7(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const m=re(c,0,s,0,100),d=re(h,0,r,100,0),f=aL(i[0],m,d),p=(h*s+c)*4;l[p]=f[0],l[p+1]=f[1],l[p+2]=f[2],l[p+3]=255}e.putImageData(o,0,0);const a=re(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=re(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},o9=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new r9(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new jr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=re(e.point.x,0,e.bounds.width,0,100),s=re(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new de([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){rL(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=bo(!1),l=Wt(o,Es(e)),a=Wt(o,Iu(e));l===0&&a===0||this.value.setRawValue(new de([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=bo(!1),i=Wt(t,Es(e)),s=Wt(t,Iu(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},l9=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new s9(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new o9(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new GG(e,{value:this.value,viewProps:this.viewProps}),text:new Ea(e,{parser:_i,props:J.fromObject({pointerScale:.01,keyScale:.1,formatter:gt(2)}),value:We(0,{constraint:new Qp({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ya({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new de(r,i.mode)}}),this.textsC_=new n9(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new PG(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Nm=N("colsw");let a9=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Nm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Nm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(Nm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=bb(e)}onValueChange_(){this.update_()}},u9=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new a9(e,{value:this.value,viewProps:this.viewProps})}},gb=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ub.create(t.expanded),this.swatchC_=new u9(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new mb(e,{parser:t.parser,props:J.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new mG(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new nL(e,{viewProps:this.viewProps}):null;const s=new l9(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),ya({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),hb(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=XS(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!sb(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function h9(n){return gi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function c9(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function p9(n){return new de([n>>16&255,n>>8&255,n&255],"rgb")}function d9(n){return new de([n>>24&255,n>>16&255,n>>8&255,re(n&255,0,255,0,1)],"rgb")}function m9(n){return typeof n!="number"?de.black():p9(n)}function v9(n){return typeof n!="number"?de.black():d9(n)}function kc(n,e){return typeof n!="object"||Le(n)?!1:e in n&&typeof n[e]=="number"}function VL(n){return kc(n,"r")&&kc(n,"g")&&kc(n,"b")}function kL(n){return VL(n)&&kc(n,"a")}function SL(n){return VL(n)}function Cb(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function xy(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function f9(n){const e=$L(n);return e?(t,i)=>{Bo(t,e(i))}:null}function w9(n){const e=n?c9:h9;return(t,i)=>{Bo(t,e(i))}}function _9(n,e,t){const s=Dt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function b9(n,e,t){const s=Dt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function g9(n,e){return(t,i)=>{n?_9(t,i,e):b9(t,i,e)}}function C9(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function P9(n){return n?e=>bb(e,"0x"):e=>_b(e,"0x")}function y9(n){return"color"in n||n.view==="color"}ht({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!y9(e))return null;const t=vb(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:C9(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?v9:m9,equals:Cb,writer:n=>w9(n.params.supportsAlpha)},controller:n=>{var e,t;return new gb(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:P9(n.params.supportsAlpha),parser:$h("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function E9(n,e){if(!SL(n))return Dt(de.black(),e);if(e==="int"){const t=xy(n);return new de(t,"rgb")}if(e==="float"){const t=xy(n);return new fb(t,"rgb")}return Dt(de.black(),"int")}function x9(n){return kL(n)}function $9(n){return e=>{const t=E9(e,n);return Dt(t,"int")}}function V9(n,e){return t=>n?xL(t,e):EL(t,e)}ht({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!SL(n))return null;const i=vb(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=pL(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>$9(n.params.colorType),equals:Cb,writer:n=>g9(x9(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=kL(n.initialValue);return new gb(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:V9(i,n.params.colorType),parser:$h("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});ht({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=BG(n,pL(e));if(!t)return null;const i=$L(t);if(!i)return null;const s=vb(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>IG,equals:Cb,writer:n=>{const e=f9(n.params.format);if(!e)throw _o.notBindable();return e}},controller:n=>{var e,t;return new gb(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:$h("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let Pb=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const $y=N("pndtxt");let k9=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add($y()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add($y("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function S9(n,e,t){return new Ea(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:We(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let yb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>S9(e,t,s)),this.acs_.forEach((i,s)=>{ya({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new k9(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},L9=class extends ib{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function A9(n,e){const t=[],i=J_(n,e);i&&t.push(i);const s=eb(n);s&&t.push(s);const r=db(n.options);return r&&t.push(r),new Pa(t)}ht({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=ot(e,i=>Object.assign(Object.assign({},td(i)),{options:i.optional.custom(rd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Jp,constraint:n=>A9(n.params,n.initialValue),writer:n=>Bo},controller:n=>{const e=n.value,t=n.constraint,i=t&&sp(t,sd);if(i)return new Ql(n.document,{props:new J({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=ed(n.params,e.rawValue),r=t&&sp(t,Qp);return r?new gy(n.document,Object.assign(Object.assign({},uG(Object.assign(Object.assign({},s),{keyScale:We(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:_i,value:e,viewProps:n.viewProps})):new Ea(n.document,{parser:_i,props:J.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof gy?new L9(n.controller):n.controller.valueController instanceof Ql?new pb(n.controller):null}});let br=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Le(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const LL={toComponents:n=>n.getComponents(),fromComponents:n=>new br(...n)},tl=N("p2d");let M9=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(tl()),t.viewProps.bindClassModifiers(this.element),ms(t.expanded,Ca(this.element,tl(void 0,"expanded")));const i=e.createElement("div");i.classList.add(tl("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(tl("b")),s.appendChild(id(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(tl("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(tl("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const zs=N("p2dp");let T9=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(zs()),t.layout==="popup"&&this.element.classList.add(zs(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(zs("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(an,"svg");s.classList.add(zs("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(an,"line");r.classList.add(zs("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(an,"line");o.classList.add(zs("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(an,"line");l.classList.add(zs("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(zs("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=re(e,-i,+i,0,100),r=re(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function Vy(n,e,t){return[Wt(e[0],Es(n)),Wt(e[1],Iu(n))*(t?1:-1)]}let D9=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new T9(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new jr(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=re(e.point.x,0,e.bounds.width,-i,+i),r=re(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new br(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){rL(e.key)&&e.preventDefault();const[t,i]=Vy(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new br(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=Vy(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},O9=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ub.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new nL(e,{viewProps:this.viewProps}):null;const r=new D9(e,{layout:t.pickerLayout,props:new J({invertsY:We(t.invertsY),max:We(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new yb(e,{assembly:LL,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new M9(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ya({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),hb(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=XS(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!sb(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function R9(n){return br.isObject(n)?new br(n.x,n.y):new br}function j9(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function N9(n,e){return new Pb({assembly:LL,components:[os(Object.assign(Object.assign({},n),n.x),e.x),os(Object.assign(Object.assign({},n),n.y),e.y)]})}function ky(n,e){var t,i;if(!Le(n.min)||!Le(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=zS(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function B9(n,e){var t,i;const s=ky(wo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=ky(wo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function I9(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}ht({id:"input-point2d",type:"input",accept:(n,e)=>{if(!br.isObject(n))return null;const t=ot(e,i=>Object.assign(Object.assign({},Fu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(lL),readonly:i.optional.constant(!1),x:i.optional.custom(cr),y:i.optional.object(Object.assign(Object.assign({},Fu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>R9,constraint:n=>N9(n.params,n.initialValue),equals:br.equals,writer:()=>j9},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new O9(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return tb({constraint:r.components[a],initialValue:l,params:wo(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:I9(n.params),max:B9(n.params,s.rawValue),parser:_i,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Ml=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Le(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const AL={toComponents:n=>n.getComponents(),fromComponents:n=>new Ml(...n)};function F9(n){return Ml.isObject(n)?new Ml(n.x,n.y,n.z):new Ml}function K9(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function U9(n,e){return new Pb({assembly:AL,components:[os(Object.assign(Object.assign({},n),n.x),e.x),os(Object.assign(Object.assign({},n),n.y),e.y),os(Object.assign(Object.assign({},n),n.z),e.z)]})}ht({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Ml.isObject(n))return null;const t=ot(e,i=>Object.assign(Object.assign({},Fu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(cr),y:i.optional.custom(cr),z:i.optional.custom(cr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>F9,constraint:n=>U9(n.params,n.initialValue),equals:Ml.equals,writer:n=>K9},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new yb(n.document,{assembly:AL,axes:e.rawValue.getComponents().map((s,r)=>{var o;return tb({constraint:t.components[r],initialValue:s,params:wo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:_i,value:e,viewProps:n.viewProps})}});let Tl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Le(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const ML={toComponents:n=>n.getComponents(),fromComponents:n=>new Tl(...n)};function H9(n){return Tl.isObject(n)?new Tl(n.x,n.y,n.z,n.w):new Tl}function z9(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function q9(n,e){return new Pb({assembly:ML,components:[os(Object.assign(Object.assign({},n),n.x),e.x),os(Object.assign(Object.assign({},n),n.y),e.y),os(Object.assign(Object.assign({},n),n.z),e.z),os(Object.assign(Object.assign({},n),n.w),e.w)]})}ht({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Tl.isObject(n))return null;const t=ot(e,i=>Object.assign(Object.assign({},Fu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(cr),x:i.optional.custom(cr),y:i.optional.custom(cr),z:i.optional.custom(cr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>H9,constraint:n=>q9(n.params,n.initialValue),equals:Tl.equals,writer:n=>z9},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new yb(n.document,{assembly:ML,axes:e.rawValue.getComponents().map((s,r)=>{var o;return tb({constraint:t.components[r],initialValue:s,params:wo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:_i,value:e,viewProps:n.viewProps})}});function G9(n){const e=[],t=db(n.options);return t&&e.push(t),new Pa(e)}ht({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=ot(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(rd)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>sL,constraint:n=>G9(n.params),writer:n=>Bo},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&sp(i,sd);return s?new Ql(e,{props:new J({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new mb(e,{parser:r=>r,props:J.fromObject({formatter:tf}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Ql?new pb(n.controller):null}});const ld={monitor:{defaultInterval:200,defaultRows:3}},Sy=N("mll");let Y9=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Sy()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(Sy("i")),i.style.height=`calc(var(${oL("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Eb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Y9(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const Ly=N("sgl");let X9=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Ly()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Ly("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},xb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new X9(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};ht({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=ot(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>iL},controller:n=>{var e;return n.value.rawValue.length===1?new xb(n.document,{formatter:by,value:n.value,viewProps:n.viewProps}):new Eb(n.document,{formatter:by,rows:(e=n.params.rows)!==null&&e!==void 0?e:ld.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let W9=class extends ib{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const qs=N("grl");let Z9=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(qs()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(an,"svg");i.classList.add(qs("g")),i.style.height=`calc(var(${oL("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(an,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(qs("t"),N("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const m=re(c,0,t,0,e.width),d=re(h,i,s,e.height,0);r.push([m,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(qs("t","a"));return}const a=re(this.cursor_.rawValue,0,t,0,e.width),u=re(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(qs("t","a"))||(o.classList.add(qs("t","a"),qs("t","in")),ip(o),o.classList.remove(qs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},TL=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=We(-1),this.view=new Z9(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!sb(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new jr(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Ri(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return ji(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(re(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(re(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function nf(n){return Le(n.format)?gt(2):n.format}function Q9(n){var e;return n.value.rawValue.length===1?new xb(n.document,{formatter:nf(n.params),value:n.value,viewProps:n.viewProps}):new Eb(n.document,{formatter:nf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:ld.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function J9(n){var e,t,i;return new TL(n.document,{formatter:nf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:ld.monitor.defaultRows,props:J.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function Ay(n){return n.view==="graph"}ht({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=ot(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>Ay(n)?64:1,reader:n=>Jp},controller:n=>Ay(n.params)?J9(n):Q9(n),api:n=>n.controller.valueController instanceof TL?new W9(n.controller):null});ht({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=ot(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>sL},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Eb(n.document,{formatter:tf,rows:(e=n.params.rows)!==null&&e!==void 0?e:ld.monitor.defaultRows,value:t,viewProps:n.viewProps}):new xb(n.document,{formatter:tf,value:t,viewProps:n.viewProps})}});const Xn=N("ckr");class eY{constructor(e,t){this.tickElems_=[],this.labelElems_=[],this.boundsWidth_=-1,this.onShowsTooltipChange_=this.onShowsTooltipChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.formatters_=t.formatters,this.unit_=t.unit,this.element=e.createElement("div"),this.element.classList.add(Xn(),Xn(void 0,`m${t.seriesId}`)),t.viewProps.bindClassModifiers(this.element),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_),t.showsTooltip.emitter.on("change",this.onShowsTooltipChange_);const i=e.createElement("div");i.classList.add(Xn("w")),this.element.appendChild(i),this.offsetElem_=e.createElement("div"),this.offsetElem_.classList.add(Xn("o")),i.appendChild(this.offsetElem_),this.svgElem_=e.createElementNS(an,"svg"),this.svgElem_.classList.add(Xn("g")),this.offsetElem_.appendChild(this.svgElem_),this.tooltipElem_=e.createElement("div"),this.tooltipElem_.classList.add(N("tt")(),Xn("tt")),this.element.appendChild(this.tooltipElem_),this.waitToBeAdded_()}waitToBeAdded_(){const e=new IntersectionObserver(t=>{t.forEach(i=>{i.target!==this.element||i.intersectionRatio===0||(this.update(),e.disconnect())})},{root:null});e.observe(this.element)}rebuildScaleIfNeeded_(e){if(this.boundsWidth_===e)return;this.boundsWidth_=e,this.tickElems_.forEach(u=>{Bu(u)}),this.tickElems_=[],this.labelElems_.forEach(u=>{Bu(u)}),this.labelElems_=[];const t=this.element.ownerDocument,i=this.unit_.ticks,s=this.unit_.pixels,l=((Math.ceil(e/2/s)+1)*2+1)*i,a=s/i;for(let u=0;u<l;u++){const h=u*a;if(u%i===0){const c=t.createElementNS(an,"line");c.classList.add(Xn("mjt")),c.setAttributeNS(null,"x1",String(h)),c.setAttributeNS(null,"y1","0"),c.setAttributeNS(null,"x2",String(h)),c.setAttributeNS(null,"y2","2"),this.svgElem_.appendChild(c),this.tickElems_.push(c);const m=t.createElement("div");m.classList.add(Xn("l")),m.style.left=`${h}px`,this.offsetElem_.appendChild(m),this.labelElems_.push(m)}else{const c=t.createElementNS(an,"line");c.classList.add(Xn("mnt")),c.setAttributeNS(null,"x1",String(h)),c.setAttributeNS(null,"y1","0"),c.setAttributeNS(null,"x2",String(h)),c.setAttributeNS(null,"y2","2"),this.svgElem_.appendChild(c),this.tickElems_.push(c)}}}updateScale_(e){const t=this.unit_.value,i=this.unit_.pixels,s=this.value_.rawValue,r=Math.ceil(e/2/i)+1,o=s-s%t-t*r,l=u=>1-Math.pow(Ie(Math.abs(s-u)/(e/2*(t/i)),0,1),10);this.labelElems_.forEach((u,h)=>{const c=o+h*t;u.textContent=this.formatters_.ring(c),u.style.opacity=String(l(c))});const a=this.unit_.ticks;this.tickElems_.forEach((u,h)=>{const c=o+h/a*t;u.style.opacity=String(l(c))})}update(){const e=this.element.getBoundingClientRect().width,t=this.unit_.value,i=this.unit_.pixels,s=this.value_.rawValue,r=Math.ceil(e/2/i)+1,o=(s%t+t*r)*(i/t),l=e/2-o;this.offsetElem_.style.transform=`translateX(${l}px)`,this.tooltipElem_.textContent=this.formatters_.text(s),this.rebuildScaleIfNeeded_(e),this.updateScale_(e)}onValueChange_(){this.update()}onShowsTooltipChange_(e){e.rawValue?this.element.classList.add(Xn(void 0,"tt")):this.element.classList.remove(Xn(void 0,"tt"))}}class $b{constructor(e,t){this.ox_=0,this.ov_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.tooltipEnabled_=t.tooltipEnabled,this.unit_=t.unit,this.showsTooltip_=We(!1),this.view=new eY(e,{formatters:t.formatters,seriesId:t.seriesId,showsTooltip:this.showsTooltip_,unit:t.unit,value:this.value,viewProps:this.viewProps});const i=new jr(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}onPointerDown_(e){const t=e.data;t.point&&(this.ox_=t.point.x,this.ov_=this.value.rawValue,this.tooltipEnabled_&&(this.showsTooltip_.rawValue=!0))}onPointerMove_(e){const t=e.data;if(!t.point)return;const i=t.point.x-this.ox_,s=this.unit_.pixels,r=this.unit_.value;this.value.setRawValue(this.ov_-i/s*r,{forceEmit:!1,last:!1})}onPointerUp_(){this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0}),this.showsTooltip_.rawValue=!1}}const Bm=N("ckrtxt");class tY{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Bm());const i=e.createElement("div");i.classList.add(Bm("r")),i.appendChild(t.ringView.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Bm("t")),s.appendChild(t.textView.element),this.element.appendChild(s)}}class DL{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.rc_=new $b(e,{formatters:{ring:t.ringFormatter,text:t.textProps.get("formatter")},seriesId:t.seriesId,tooltipEnabled:!1,unit:t.ringUnit,value:this.value,viewProps:this.viewProps}),this.tc_=new Ea(e,{parser:t.parser,props:t.textProps,value:this.value,viewProps:this.viewProps}),this.view=new tY(e,{ringView:this.rc_.view,textView:this.tc_.view})}}function OL(n){const e=[],t=eb(n);t&&e.push(t);const i=J_(n);return i&&e.push(i),new Pa(e)}function nY(n){return n===0||n===1||n===2?n:void 0}function My(n){return n!==void 0?String(n):"0"}function iY(n){const e=gt(Zv(n.value));return t=>{const i=e(t),s=i.substr(0,1);return i+(s==="-"||s==="+"?" ":"")}}ht({id:"input-ring",type:"input",accept(n,e){if(typeof n!="number")return null;const t=ot(e,i=>Object.assign(Object.assign({},td(i)),{series:i.optional.custom(nY),unit:i.optional.object({pixels:i.required.number,ticks:i.required.number,value:i.required.number}),view:i.required.constant("cameraring"),wide:i.optional.boolean}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Jp,constraint:n=>OL(n.params),writer:n=>Bo},controller(n){var e,t,i;const s=(e=n.params.unit)!==null&&e!==void 0?e:{ticks:5,pixels:40,value:10},r=iY(s),o=ed(n.params,n.initialValue);if(n.params.wide)return new $b(n.document,{formatters:{ring:r,text:o.formatter},seriesId:(t=My(n.params.series))!==null&&t!==void 0?t:"0",tooltipEnabled:!0,unit:s,value:n.value,viewProps:n.viewProps});const l=J.fromObject(o);return new DL(n.document,{parser:_i,ringFormatter:r,ringUnit:s,seriesId:(i=My(n.params.series))!==null&&i!==void 0?i:"0",textProps:l,value:n.value,viewProps:n.viewProps})}});ht({id:"input-wheel",type:"input",accept(n,e){if(typeof n!="number")return null;const t=ot(e,i=>Object.assign(Object.assign({},td(i)),{amount:i.optional.number,view:i.required.constant("camerawheel"),wide:i.optional.boolean}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Jp,constraint:n=>OL(n.params),writer:n=>Bo},controller(n){var e,t;const i=gt(0),s=ed(n.params,n.initialValue);return n.params.wide?new $b(n.document,{formatters:{ring:i,text:s.formatter},seriesId:"w",tooltipEnabled:!0,unit:{ticks:10,pixels:40,value:((e=n.params.amount)!==null&&e!==void 0?e:s.pointerScale)*40},value:n.value,viewProps:n.viewProps}):new DL(n.document,{parser:_i,ringFormatter:i,ringUnit:{ticks:10,pixels:40,value:((t=n.params.amount)!==null&&t!==void 0?t:s.pointerScale)*40},seriesId:"w",textProps:J.fromObject(s),value:n.value,viewProps:n.viewProps})}});function Pe(n){return n==null}function Vb(n){return n!==null&&typeof n=="object"}function sf(n){return n!==null&&typeof n=="object"}function sY(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function go(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return sf(r)&&sf(o)?Object.assign(Object.assign({},i),{[s]:go(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function rY(n){return Vb(n)?"target"in n:!1}const oY={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let xs=class gl{static alreadyDisposed(){return new gl({type:"alreadydisposed"})}static notBindable(){return new gl({type:"notbindable"})}static notCompatible(e,t){return new gl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new gl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new gl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=oY[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},Ty=class RL{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!RL.isBindable(i))throw xs.notBindable();if(!(e in i))throw xs.propertyNotFound(e);i[e]=t}},bn=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},lY=class{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new bn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},aY=class{constructor(e){this.emitter=new bn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},uY=class{constructor(e){this.emitter=new bn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function Ze(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new aY(n):new lY(n,e)}function hY(n){return[new uY(n),(e,t)=>{n.setRawValue(e,t)}]}let ee=class jL{constructor(e){this.emitter=new bn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:Ze(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new jL(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},ad=class{constructor(e){this.values=ee.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},NL=class{constructor(e){this.values=ee.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Pe(i)||(s=Math.max(s,i)),Pe(t)||(s=Math.min(s,t)),s}},BL=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},cY=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const pY={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let dY=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=pY[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const mY={"+":n=>n,"-":n=>-n,"~":n=>~n};let vY=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=mY[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function kb(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Ku(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function fY(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Uu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function wY(n,e){const t=Uu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Uu(n,e);return s===""?"":i+s}function Sb(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=wY(n,e);return i===""?"":t+i}function IL(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=fY(n,e);return e+=i.length,i===""?"":i+Uu(n,e)}function _Y(n,e){const t=IL(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Uu(n,e);return e+=s.length,t+i+s+Sb(n,e)}function bY(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Uu(n,e);return e+=i.length,i===""?"":t+i+Sb(n,e)}function gY(n,e){const t=IL(n,e);return e+=t.length,t===""?"":t+Sb(n,e)}const CY=kb([_Y,bY,gY]);function PY(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function yY(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=PY(n,e);return i===""?"":t+i}function EY(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function xY(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=EY(n,e);return i===""?"":t+i}function $Y(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function VY(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=$Y(n,e);return i===""?"":t+i}const kY=kb([yY,xY,VY]),SY=kb([kY,CY]);function LY(n,e){const t=SY(n,e);return e+=t.length,t===""?null:{evaluable:new cY(t),cursor:e}}function AY(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=KL(n,e);if(!i)return null;e=i.cursor,e+=Ku(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function MY(n,e){var t;return(t=LY(n,e))!==null&&t!==void 0?t:AY(n,e)}function FL(n,e){const t=MY(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=FL(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new vY(i,s.evaluable)}):null}function TY(n,e,t){t+=Ku(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Ku(e,t).length,{cursor:t,operator:i}):null}function DY(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=TY(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new dY(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const OY=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>DY(n,e),FL);function KL(n,e){return e+=Ku(n,e).length,OY(n,e)}function RY(n){const e=KL(n,0);return!e||e.cursor+Ku(n,e.cursor).length!==n.length?null:e.evaluable}function Ci(n){var e;const t=RY(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function UL(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Ci(n);if(!Pe(e))return e}return 0}function Bt(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function oe(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function Dy(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function qe(n,e,t){return Math.min(Math.max(n,e),t)}function HL(n,e){return(n%e+e)%e}function jY(n,e){return Pe(n.step)?Math.max(Dy(e),2):Dy(n.step)}function zL(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function NY(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function qL(n,e){return Pe(n.step)?null:new BL(n.step,e)}function GL(n){return!Pe(n.max)&&!Pe(n.min)?new ad({max:n.max,min:n.min}):!Pe(n.max)||!Pe(n.min)?new NL({max:n.max,min:n.min}):null}function YL(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:Bt(jY(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:zL(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:NY(n,e)}}function XL(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function Lb(n){return{constraint:n.constraint,textProps:ee.fromObject(YL(n.params,n.initialValue))}}let Ab=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},ud=class{constructor(e){this.target=e}},WL=class extends ud{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},BY=class extends ud{constructor(e,t){super(e),this.expanded=t}},IY=class extends ud{constructor(e,t){super(e),this.index=t}},Mb=class extends Ab{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new bn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new WL(this,t.binding.target.read(),e.options.last))}};function FY(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function KY(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function UY(n){return n===null?!1:typeof n=="object"}function Qi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function Oy(n){return{custom:e=>Qi(e)(n),boolean:Qi(e=>typeof e=="boolean"?e:void 0)(n),number:Qi(e=>typeof e=="number"?e:void 0)(n),string:Qi(e=>typeof e=="string"?e:void 0)(n),function:Qi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Qi(t=>t===e?e:void 0)(n),raw:Qi(e=>e)(n),object:e=>Qi(t=>{if(UY(t))return FY(t,e)})(n),array:e=>Qi(t=>{if(Array.isArray(t))return KY(t,e)})(n)}}const rf={optional:Oy(!0),required:Oy(!1)};function lt(n,e){const t=e(rf),i=rf.required.object(t)(n);return i.succeeded?i.value:void 0}function Ni(n,e,t,i){if(e&&!e(n))return!1;const s=lt(n,t);return s?i(s):!1}function Bi(n,e){var t;return go((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function Sc(n){return"value"in n}function HY(n){if(!Vb(n)||!("binding"in n))return!1;const e=n.binding;return rY(e)}const et="http://www.w3.org/2000/svg";function op(n){n.offsetHeight}function zY(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function hd(n){return n.ontouchstart!==void 0}function qY(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const GY={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function cd(n,e){const t=n.createElementNS(et,"svg");return t.innerHTML=GY[e],t}function ZL(n,e,t){n.insertBefore(e,n.children[t])}function Tb(n){n.parentElement&&n.parentElement.removeChild(n)}function QL(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function YY(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function Db(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function vs(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function Qn(n,e,t){vs(n.value(e),t)}const XY="tp";function B(n){return(t,i)=>[XY,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const nu=B("lbl");function WY(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let ZY=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nu()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(nu("l")),Qn(t.props,"label",r=>{Pe(r)?this.element.classList.add(nu(void 0,"nol")):(this.element.classList.remove(nu(void 0,"nol")),YY(i),i.appendChild(WY(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(nu("v")),this.element.appendChild(s),this.valueElement=s}},QY=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new ZY(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Ni(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Bi(null,{label:this.props.get("label")})}};function JY(){return["veryfirst","first","last","verylast"]}const Ry=B(""),jy={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let JL=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{JY().forEach(i=>{t.classList.remove(Ry(void 0,jy[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(Ry(void 0,jy[i]))})}),this.viewProps.handleDispose(()=>{Tb(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Ni(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Bi(null,Object.assign({},this.viewProps.exportState()))}},eX=class extends Ab{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new ud(this))}),this}};function tX(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function Io(n,e){return t=>{tX(n,e,t)}}function Ob(n,e){vs(n,t=>{e.textContent=t??""})}const Im=B("btn");let nX=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Im()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Im("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Im("t")),Ob(t.props.value("title"),s),this.buttonElement.appendChild(s)}},iX=class{constructor(e,t){this.emitter=new bn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new nX(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Ni(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Bi(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},Ny=class extends JL{constructor(e,t){const i=new iX(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new QY(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Ni(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Bi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},sX=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const rX=new sX("2.0.1");function ct(n){return Object.assign({core:rX},n)}ct({id:"button",type:"blade",accept(n){const e=lt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new Ny(n.document,{blade:n.blade,buttonProps:ee.fromObject({title:n.params.title}),labelProps:ee.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof Ny?new eX(n.controller):null}});function oX(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function lX(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function aX(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function uX(n){return Vb(n)?"refresh"in n&&typeof n.refresh=="function":!1}function hX(n,e){if(!Ty.isBindable(n))throw xs.notBindable();return new Ty(n,e)}let cX=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new bn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,hX(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return lX(this,e)}addButton(e){return oX(this,e)}addTab(e){return aX(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{uX(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=HY(t.value)?t.value.binding:null;this.emitter_.emit("change",new WL(i,s?s.target.read():t.value.rawValue,e.options.last))}},Rb=class extends Ab{constructor(e,t){super(e),this.rackApi_=new cX(e.rackController,t)}refresh(){this.rackApi_.refresh()}},jb=class extends JL{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Ni(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Bi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function of(n){return"rackController"in n}let pX=class{constructor(e){this.emitter=new bn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw xs.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function dX(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Sc(i)&&i.value===e)return i}return null}function mX(n){return of(n)?n.rackController.rack.bcSet_:null}let vX=class{constructor(e){var t,i;this.emitter=new bn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new pX(mX),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Sc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(of(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Sc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(of(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=dX(this.find(Sc),e.sender);if(!t)throw xs.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Nb=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new vX({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&ZL(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Tb(e.bladeController.view.element)}};function eA(){return new ee({positions:Ze([],{equals:sY})})}let pd=class tA extends ee{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=ee.createCore(t);return new tA(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Pe(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Qn(this,"expanded",i),Qn(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function fX(n,e){let t=0;return zY(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),op(e),t=e.clientHeight,n.set("temporaryExpanded",null),op(e)}),t}function By(n,e){e.style.height=n.styleHeight}function dd(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Pe(n.get("expandedHeight"))){const t=fX(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),op(e)}),n.emitter.on("change",()=>{By(n,e)}),By(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let wX=class extends Rb{constructor(e,t){super(e,t),this.emitter_=new bn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new BY(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}};const nA=B("cnt");let _X=class{constructor(e,t){var i;this.className_=B((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),nA()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Qn(this.foldable_,"completed",Io(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),Qn(t.props,"title",u=>{Pe(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Ob(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},Iy=class extends jb{constructor(e,t){var i;const s=pd.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new _X(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Nb({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,dd(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Ni(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Bi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};ct({id:"folder",type:"blade",accept(n){const e=lt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new Iy(n.document,{blade:n.blade,expanded:n.params.expanded,props:ee.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof Iy?new wX(n.controller,n.pool):null}});const bX=B("");function Fy(n,e){return Io(n,bX(void 0,e))}let Bb=class iA extends ee{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=hY(Ze(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new iA(ee.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){vs(this.globalDisabled_,Fy(e,"disabled")),Qn(this,"hidden",Fy(e,"hidden"))}bindDisabled(e){vs(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){vs(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const Ky=B("tbp");let gX=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ky()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ky("c")),this.element.appendChild(i),this.containerElement=i}};const iu=B("tbi");let CX=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(iu()),t.viewProps.bindClassModifiers(this.element),Qn(t.props,"selected",r=>{r?this.element.classList.add(iu(void 0,"sel")):this.element.classList.remove(iu(void 0,"sel"))});const i=e.createElement("button");i.classList.add(iu("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(iu("t")),Ob(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},PX=class{constructor(e,t){this.emitter=new bn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new CX(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},lf=class extends jb{constructor(e,t){const i=new gX(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Nb({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new PX(e,{props:t.itemProps,viewProps:Bb.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Qn(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Ni(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Bi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},yX=class extends Rb{constructor(e,t){super(e,t),this.emitter_=new bn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new lf(t,{blade:eA(),itemProps:ee.fromObject({selected:!1,title:e.title}),props:ee.fromObject({selected:!1}),viewProps:Bb.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new IY(this,e.rawValue))}},EX=class extends Rb{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const Uy=-1;let xX=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Ze(!0),this.selectedIndex=Ze(Uy),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Uy,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const su=B("tab");let $X=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(su(),nA()),t.viewProps.bindClassModifiers(this.element),vs(t.empty,Io(this.element,su(void 0,"nop")));const i=e.createElement("div");i.classList.add(su("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(su("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(su("c")),this.element.appendChild(r),this.contentsElement=r}},Hy=class extends jb{constructor(e,t){const i=new xX,s=new $X(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Nb({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;ZL(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Tb(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};ct({id:"tab",type:"blade",accept(n){const e=lt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new Hy(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new lf(n.document,{blade:eA(),itemProps:ee.fromObject({selected:!1,title:t.title}),props:ee.fromObject({selected:!1}),viewProps:Bb.create()});e.add(i)}),e},api(n){return n.controller instanceof Hy?new yX(n.controller,n.pool):n.controller instanceof lf?new EX(n.controller,n.pool):null}});let Ib=class extends Mb{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},xa=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function lp(n,e){if(n instanceof e)return n;if(n instanceof xa){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let md=class{constructor(e){this.values=ee.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function vd(n){var e;const t=rf;if(Array.isArray(n))return(e=lt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function sA(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function Fb(n){return Pe(n)?null:new md(sA(n))}const Fm=B("lst");let VX=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Fm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(Fm("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(Fm("m")),s.appendChild(cd(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Qn(this.props_,"options",r=>{QL(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},ea=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new VX(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Ni(e,null,t=>({options:t.required.custom(vd)}),t=>(this.props.set("options",sA(t.options)),!0))}exportProps(){return Bi(null,{options:this.props.get("options")})}};const zy=B("pop");let kX=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(zy()),t.viewProps.bindClassModifiers(this.element),vs(t.shows,Io(this.element,zy(void 0,"v")))}},Kb=class{constructor(e,t){this.shows=Ze(!1),this.viewProps=t.viewProps,this.view=new kX(e,{shows:this.shows,viewProps:this.viewProps})}};const qy=B("txt");let SX=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(qy()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(qy("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},Ub=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new SX(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Pe(s)||(this.value.rawValue=s),this.view.refresh()}};function LX(n){return String(n)}function rA(n){return n==="false"?!1:!!n}function Gy(n){return LX(n)}function AX(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const MX=Bt(0);function ap(n){return MX(n)+"%"}function oA(n){return String(n)}function af(n){return n}function Fo({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function _t(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function ta(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Pi(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function TX(n){return n==="ArrowUp"||n==="ArrowDown"}function Hb(n){return TX(n)||n==="ArrowLeft"||n==="ArrowRight"}function Km(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let vt=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new bn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Km(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Km(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Km(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Ln=B("txt");let DX=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Ln(),Ln(void 0,"num")),t.arrayPosition&&this.element.classList.add(Ln(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Ln("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ln()),this.inputElement.classList.add(Ln("i"));const s=e.createElement("div");s.classList.add(Ln("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(et,"svg");r.classList.add(Ln("g")),this.knobElement.appendChild(r);const o=e.createElementNS(et,"path");o.classList.add(Ln("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(et,"path");l.classList.add(Ln("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(B("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Ln(void 0,"drg"));return}this.element.classList.add(Ln(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=qe(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Vh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=Ze(null),this.view=new DX(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new vt(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Pe(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=_t(this.props.get("keyScale"),ta(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){_t(this.props.get("keyScale"),ta(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const Um=B("sld");let OX=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Um()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Um("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(Um("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=qe(oe(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},RX=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new OX(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(oe(qe(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=_t(this.props.get("keyScale"),Pi(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){_t(this.props.get("keyScale"),Pi(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Hm=B("sldtxt");let jX=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Hm());const i=e.createElement("div");i.classList.add(Hm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Hm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},Yy=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new RX(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Vh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new jX(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Ni(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Bi(null,{max:e.get("max"),min:e.get("min")})}};function NX(n){return{sliderProps:new ee({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new ee({formatter:Ze(n.formatter),keyScale:n.keyScale,pointerScale:Ze(n.pointerScale)})}}const BX={containerUnitSize:"cnt-usz"};function lA(n){return`--${BX[n]}`}function Hu(n){return XL(n)}function St(n){if(sf(n))return lt(n,Hu)}function ls(n,e){if(!n)return;const t=[],i=qL(n,e);i&&t.push(i);const s=GL(n);return s&&t.push(s),new xa(t)}function fd(n){if(n==="inline"||n==="popup")return n}function kh(n,e){n.write(e)}const sc=B("ckb");let IX=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(sc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(sc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(sc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(sc("w")),i.appendChild(r);const o=cd(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},FX=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new IX(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function KX(n){const e=[],t=Fb(n.options);return t&&e.push(t),new xa(e)}ct({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=lt(e,i=>({options:i.optional.custom(vd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>rA,constraint:n=>KX(n.params),writer:n=>kh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&lp(i,md);return s?new ea(e,{props:new ee({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new FX(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof ea?new Ib(n.controller):null}});const Xr=B("col");let UX=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xr()),t.foldable.bindExpandedClass(this.element,Xr(void 0,"expanded")),Qn(t.foldable,"completed",Io(this.element,Xr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Xr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Xr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Xr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Xr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function HX(n,e,t){const i=qe(n/255,0,1),s=qe(e/255,0,1),r=qe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function zX(n,e,t){const i=(n%360+360)%360,s=qe(e/100,0,1),r=qe(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function qX(n,e,t){const i=qe(n/255,0,1),s=qe(e/255,0,1),r=qe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function aA(n,e,t){const i=HL(n,360),s=qe(e/100,0,1),r=qe(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function GX(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function YX(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function yi(n){return[n[0],n[1],n[2]]}function wd(n,e){return[n[0],n[1],n[2],e]}const XX={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:GX,rgb:zX},hsv:{hsl:YX,hsv:(n,e,t)=>[n,e,t],rgb:aA},rgb:{hsl:HX,hsv:qX,rgb:(n,e,t)=>[n,e,t]}};function na(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function WX(n,e){return n===e?e:HL(n,e)}function uA(n,e,t){var i;const s=na(e,t);return[e==="rgb"?qe(n[0],0,s[0]):WX(n[0],s[0]),qe(n[1],0,s[1]),qe(n[2],0,s[2]),qe((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function Xy(n,e,t,i){const s=na(e,t),r=na(e,i);return n.map((o,l)=>o/s[l]*r[l])}function hA(n,e,t){const i=Xy(n,e.mode,e.type,"int"),s=XX[e.mode][t.mode](...i);return Xy(s,t.mode,"int",t.type)}let me=class cA{static black(){return new cA([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=uA(e,t,this.type)}getComponents(e){return wd(hA(yi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Gs=B("colp");let ZX=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Gs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Gs("hsv"));const s=e.createElement("div");s.classList.add(Gs("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Gs("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Gs("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Gs("a"));const a=e.createElement("div");a.classList.add(Gs("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Gs("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function QX(n){return n==="int"?"int":n==="float"?"float":void 0}function zb(n){return lt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(QX)}),expanded:e.optional.boolean,picker:e.optional.custom(fd),readonly:e.optional.constant(!1)}))}function Co(n){return n?.1:1}function pA(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let qb=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=uA(e,t,this.type)}getComponents(e){return wd(hA(yi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const JX={int:(n,e)=>new me(n,e),float:(n,e)=>new qb(n,e)};function Gb(n,e,t){return JX[t](n,e)}function eW(n){return n.type==="float"}function tW(n){return n.type==="int"}function nW(n){const e=n.getComponents(),t=na(n.mode,"int");return new me([Math.round(oe(e[0],0,1,0,t[0])),Math.round(oe(e[1],0,1,0,t[1])),Math.round(oe(e[2],0,1,0,t[2])),e[3]],n.mode)}function iW(n){const e=n.getComponents(),t=na(n.mode,"int");return new qb([oe(e[0],0,t[0],0,1),oe(e[1],0,t[1],0,1),oe(e[2],0,t[2],0,1),e[3]],n.mode)}function Ot(n,e){if(n.type===e)return n;if(tW(n)&&e==="float")return iW(n);if(eW(n)&&e==="int")return nW(n);throw xs.shouldNeverHappen()}function sW(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Fn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const rW={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function dA(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return rW[i](t)}function mA(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Fn(e[1],255),Fn(e[2],255),Fn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function oW(n){const e=mA(n);return e?new me(e,"rgb"):null}function vA(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Fn(e[1],255),Fn(e[2],255),Fn(e[3],255),Fn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function lW(n){const e=vA(n);return e?new me(e,"rgb"):null}function fA(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[dA(e[1]),Fn(e[2],100),Fn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function aW(n){const e=fA(n);return e?new me(e,"hsl"):null}function wA(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[dA(e[1]),Fn(e[2],100),Fn(e[3],100),Fn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function uW(n){const e=wA(n);return e?new me(e,"hsl"):null}function _A(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function hW(n){const e=_A(n);return e?new me(e,"rgb"):null}function bA(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),oe(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),oe(parseInt(t[4],16),0,255,0,1)]:null}function cW(n){const e=bA(n);return e?new me(e,"rgb"):null}function gA(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Wy(n){return e=>{const t=gA(e);return t?Gb(t,"rgb",n):null}}function CA(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Zy(n){return e=>{const t=CA(e);return t?Gb(t,"rgb",n):null}}const pW=[{parser:_A,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:bA,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:mA,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:vA,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:fA,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:wA,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:gA,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:CA,result:{alpha:!0,mode:"rgb",notation:"object"}}];function dW(n){return pW.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function mW(n,e="int"){const t=dW(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Sh(n){const e=[hW,cW,oW,lW,aW,uW];n==="int"&&e.push(Wy("int"),Zy("int")),n==="float"&&e.push(Wy("float"),Zy("float"));const t=AX(e);return i=>{const s=t(i);return s?Ot(s,n):null}}function vW(n){const e=Sh("int");if(typeof n!="string")return me.black();const t=e(n);return t??me.black()}function PA(n){const e=qe(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Yb(n,e="#"){const t=yi(n.getComponents("rgb")).map(PA).join("");return`${e}${t}`}function Xb(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(PA).join("");return`${e}${i}`}function yA(n){const e=Bt(0),t=Ot(n,"int");return`rgb(${yi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Lc(n){const e=Bt(2),t=Bt(0);return`rgba(${Ot(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function fW(n){const e=[Bt(0),ap,ap],t=Ot(n,"int");return`hsl(${yi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function wW(n){const e=[Bt(0),ap,ap,Bt(2)];return`hsla(${Ot(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function EA(n,e){const t=Bt(e==="float"?2:0),i=["r","g","b"],s=Ot(n,e);return`{${yi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function _W(n){return e=>EA(e,n)}function xA(n,e){const t=Bt(2),i=Bt(e==="float"?2:0),s=["r","g","b","a"];return`{${Ot(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function bW(n){return e=>xA(e,n)}const gW=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Yb},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Xb},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:yA},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Lc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:fW},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:wW},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:_W(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:bW(e)}],[])];function $A(n){return gW.reduce((e,t)=>e||(sW(t.format,n)?t.stringifier:null),null)}const ru=B("apl");let CW=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(ru()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(ru("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(ru("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(ru("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(ru("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new me([t[0],t[1],t[2],0],"rgb"),s=new me([t[0],t[1],t[2],255],"rgb"),r=["to right",Lc(i),Lc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Lc(e);const o=oe(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},PW=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new CW(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new me([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=_t(Co(!0),Pi(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new me([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){_t(Co(!0),Pi(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const nl=B("coltxt");function yW(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let EW=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(nl("m")),this.modeElem_=yW(e),this.modeElem_.classList.add(nl("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(nl("mm")),s.appendChild(cd(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(nl("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),vs(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){QL(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(nl("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function xW(n){return Bt(n==="float"?2:0)}function $W(n,e,t){const i=na(n,e)[t];return new ad({min:0,max:i})}function VW(n,e,t){return new Vh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:ee.fromObject({formatter:xW(e.colorType),keyScale:Co(!1),pointerScale:e.colorType==="float"?.01:1}),value:Ze(0,{constraint:$W(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function kW(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Ci,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=VW(n,t,i);return Fo({primary:e.value,secondary:s.value,forward(r){return Ot(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Ot(r,e.colorType).getComponents(l);u[i]=o;const h=Gb(wd(yi(u),u[3]),l,e.colorType);return Ot(h,"int")}}),s})}function SW(n,e){const t=new Ub(n,{parser:Sh("int"),props:ee.fromObject({formatter:Yb}),value:Ze(me.black()),viewProps:e.viewProps});return Fo({primary:e.value,secondary:t.value,forward:i=>new me(yi(i.getComponents()),i.mode),backward:(i,s)=>new me(wd(yi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function LW(n){return n!=="hex"}let AW=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=Ze(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new EW(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return LW(t)?kW(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):SW(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const zm=B("hpl");let MW=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(zm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(zm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(zm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=yA(new me([t,100,100],"hsv"));const i=oe(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},TW=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new MW(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=oe(qe(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new me([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=_t(Co(!1),Pi(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new me([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){_t(Co(!1),Pi(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const qm=B("svp"),Qy=64;let DW=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(qm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=Qy,i.width=Qy,i.classList.add(qm("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(qm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=qY(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const m=oe(c,0,s,0,100),d=oe(h,0,r,100,0),f=aA(i[0],m,d),p=(h*s+c)*4;l[p]=f[0],l[p+1]=f[1],l[p+2]=f[2],l[p+3]=255}e.putImageData(o,0,0);const a=oe(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=oe(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},OW=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new DW(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=oe(e.point.x,0,e.bounds.width,0,100),s=oe(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new me([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Hb(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=Co(!1),l=_t(o,Pi(e)),a=_t(o,ta(e));l===0&&a===0||this.value.setRawValue(new me([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Co(!1),i=_t(t,Pi(e)),s=_t(t,ta(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},RW=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new TW(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new OW(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new PW(e,{value:this.value,viewProps:this.viewProps}),text:new Vh(e,{parser:Ci,props:ee.fromObject({pointerScale:.01,keyScale:.1,formatter:Bt(2)}),value:Ze(0,{constraint:new ad({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Fo({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new me(r,i.mode)}}),this.textsC_=new AW(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new ZX(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Gm=B("colsw");let jW=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Gm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Gm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(Gm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Xb(e)}onValueChange_(){this.update_()}},NW=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new jW(e,{value:this.value,viewProps:this.viewProps})}},Wb=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=pd.create(t.expanded),this.swatchC_=new NW(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Ub(e,{parser:t.parser,props:ee.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new UX(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Kb(e,{viewProps:this.viewProps}):null;const s=new RW(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Fo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),dd(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Db(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!hd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function BW(n){return yi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function IW(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function FW(n){return new me([n>>16&255,n>>8&255,n&255],"rgb")}function KW(n){return new me([n>>24&255,n>>16&255,n>>8&255,oe(n&255,0,255,0,1)],"rgb")}function UW(n){return typeof n!="number"?me.black():FW(n)}function HW(n){return typeof n!="number"?me.black():KW(n)}function Ac(n,e){return typeof n!="object"||Pe(n)?!1:e in n&&typeof n[e]=="number"}function VA(n){return Ac(n,"r")&&Ac(n,"g")&&Ac(n,"b")}function kA(n){return VA(n)&&Ac(n,"a")}function SA(n){return VA(n)}function Zb(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function Jy(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function zW(n){const e=$A(n);return e?(t,i)=>{kh(t,e(i))}:null}function qW(n){const e=n?IW:BW;return(t,i)=>{kh(t,e(i))}}function GW(n,e,t){const s=Ot(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function YW(n,e,t){const s=Ot(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function XW(n,e){return(t,i)=>{n?GW(t,i,e):YW(t,i,e)}}function WW(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function ZW(n){return n?e=>Xb(e,"0x"):e=>Yb(e,"0x")}function QW(n){return"color"in n||n.view==="color"}ct({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!QW(e))return null;const t=zb(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:WW(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?HW:UW,equals:Zb,writer:n=>qW(n.params.supportsAlpha)},controller:n=>{var e,t;return new Wb(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:ZW(n.params.supportsAlpha),parser:Sh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function JW(n,e){if(!SA(n))return Ot(me.black(),e);if(e==="int"){const t=Jy(n);return new me(t,"rgb")}if(e==="float"){const t=Jy(n);return new qb(t,"rgb")}return Ot(me.black(),"int")}function eZ(n){return kA(n)}function tZ(n){return e=>{const t=JW(e,n);return Ot(t,"int")}}function nZ(n,e){return t=>n?xA(t,e):EA(t,e)}ct({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!SA(n))return null;const i=zb(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=pA(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>tZ(n.params.colorType),equals:Zb,writer:n=>XW(eZ(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=kA(n.initialValue);return new Wb(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:nZ(i,n.params.colorType),parser:Sh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});ct({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=mW(n,pA(e));if(!t)return null;const i=$A(t);if(!i)return null;const s=zb(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>vW,equals:Zb,writer:n=>{const e=zW(n.params.format);if(!e)throw xs.notBindable();return e}},controller:n=>{var e,t;return new Wb(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Sh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let Po=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const eE=B("pndtxt");let iZ=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(eE()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(eE("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function sZ(n,e,t){return new Vh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:Ze(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let _d=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>sZ(e,t,s)),this.acs_.forEach((i,s)=>{Fo({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new iZ(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},rZ=class extends Mb{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function oZ(n,e){const t=[],i=qL(n,e);i&&t.push(i);const s=GL(n);s&&t.push(s);const r=Fb(n.options);return r&&t.push(r),new xa(t)}ct({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=lt(e,i=>Object.assign(Object.assign({},XL(i)),{options:i.optional.custom(vd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>UL,constraint:n=>oZ(n.params,n.initialValue),writer:n=>kh},controller:n=>{const e=n.value,t=n.constraint,i=t&&lp(t,md);if(i)return new ea(n.document,{props:new ee({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=YL(n.params,e.rawValue),r=t&&lp(t,ad);return r?new Yy(n.document,Object.assign(Object.assign({},NX(Object.assign(Object.assign({},s),{keyScale:Ze(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Ci,value:e,viewProps:n.viewProps})):new Vh(n.document,{parser:Ci,props:ee.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof Yy?new rZ(n.controller):n.controller.valueController instanceof ea?new Ib(n.controller):null}});let gr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Pe(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const LA={toComponents:n=>n.getComponents(),fromComponents:n=>new gr(...n)},il=B("p2d");let lZ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(il()),t.viewProps.bindClassModifiers(this.element),vs(t.expanded,Io(this.element,il(void 0,"expanded")));const i=e.createElement("div");i.classList.add(il("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(il("b")),s.appendChild(cd(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(il("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(il("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Ys=B("p2dp");let aZ=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Ys()),t.layout==="popup"&&this.element.classList.add(Ys(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ys("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(et,"svg");s.classList.add(Ys("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(et,"line");r.classList.add(Ys("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(et,"line");o.classList.add(Ys("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(et,"line");l.classList.add(Ys("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Ys("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=oe(e,-i,+i,0,100),r=oe(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function tE(n,e,t){return[_t(e[0],Pi(n)),_t(e[1],ta(n))*(t?1:-1)]}let uZ=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new aZ(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new vt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=oe(e.point.x,0,e.bounds.width,-i,+i),r=oe(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new gr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Hb(e.key)&&e.preventDefault();const[t,i]=tE(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new gr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=tE(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},hZ=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=pd.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new Kb(e,{viewProps:this.viewProps}):null;const r=new uZ(e,{layout:t.pickerLayout,props:new ee({invertsY:Ze(t.invertsY),max:Ze(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new _d(e,{assembly:LA,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new lZ(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Fo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),dd(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Db(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!hd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function cZ(n){return gr.isObject(n)?new gr(n.x,n.y):new gr}function pZ(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function dZ(n,e){return new Po({assembly:LA,components:[ls(Object.assign(Object.assign({},n),n.x),e.x),ls(Object.assign(Object.assign({},n),n.y),e.y)]})}function nE(n,e){var t,i;if(!Pe(n.min)||!Pe(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=zL(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function mZ(n,e){var t,i;const s=nE(go(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=nE(go(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function vZ(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}ct({id:"input-point2d",type:"input",accept:(n,e)=>{if(!gr.isObject(n))return null;const t=lt(e,i=>Object.assign(Object.assign({},Hu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(fd),readonly:i.optional.constant(!1),x:i.optional.custom(St),y:i.optional.object(Object.assign(Object.assign({},Hu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>cZ,constraint:n=>dZ(n.params,n.initialValue),equals:gr.equals,writer:()=>pZ},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new hZ(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return Lb({constraint:r.components[a],initialValue:l,params:go(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:vZ(n.params),max:mZ(n.params,s.rawValue),parser:Ci,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Dl=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Pe(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const AA={toComponents:n=>n.getComponents(),fromComponents:n=>new Dl(...n)};function fZ(n){return Dl.isObject(n)?new Dl(n.x,n.y,n.z):new Dl}function wZ(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function _Z(n,e){return new Po({assembly:AA,components:[ls(Object.assign(Object.assign({},n),n.x),e.x),ls(Object.assign(Object.assign({},n),n.y),e.y),ls(Object.assign(Object.assign({},n),n.z),e.z)]})}ct({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Dl.isObject(n))return null;const t=lt(e,i=>Object.assign(Object.assign({},Hu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(St),y:i.optional.custom(St),z:i.optional.custom(St)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>fZ,constraint:n=>_Z(n.params,n.initialValue),equals:Dl.equals,writer:n=>wZ},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new _d(n.document,{assembly:AA,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Lb({constraint:t.components[r],initialValue:s,params:go(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Ci,value:e,viewProps:n.viewProps})}});let Ol=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Pe(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const MA={toComponents:n=>n.getComponents(),fromComponents:n=>new Ol(...n)};function bZ(n){return Ol.isObject(n)?new Ol(n.x,n.y,n.z,n.w):new Ol}function gZ(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function CZ(n,e){return new Po({assembly:MA,components:[ls(Object.assign(Object.assign({},n),n.x),e.x),ls(Object.assign(Object.assign({},n),n.y),e.y),ls(Object.assign(Object.assign({},n),n.z),e.z),ls(Object.assign(Object.assign({},n),n.w),e.w)]})}ct({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Ol.isObject(n))return null;const t=lt(e,i=>Object.assign(Object.assign({},Hu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(St),x:i.optional.custom(St),y:i.optional.custom(St),z:i.optional.custom(St)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>bZ,constraint:n=>CZ(n.params,n.initialValue),equals:Ol.equals,writer:n=>gZ},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new _d(n.document,{assembly:MA,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Lb({constraint:t.components[r],initialValue:s,params:go(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Ci,value:e,viewProps:n.viewProps})}});function PZ(n){const e=[],t=Fb(n.options);return t&&e.push(t),new xa(e)}ct({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=lt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(vd)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>oA,constraint:n=>PZ(n.params),writer:n=>kh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&lp(i,md);return s?new ea(e,{props:new ee({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Ub(e,{parser:r=>r,props:ee.fromObject({formatter:af}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof ea?new Ib(n.controller):null}});const bd={monitor:{defaultInterval:200,defaultRows:3}},iE=B("mll");let yZ=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(iE()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(iE("i")),i.style.height=`calc(var(${lA("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Qb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new yZ(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const sE=B("sgl");let EZ=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(sE()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(sE("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},Jb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new EZ(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};ct({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=lt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>rA},controller:n=>{var e;return n.value.rawValue.length===1?new Jb(n.document,{formatter:Gy,value:n.value,viewProps:n.viewProps}):new Qb(n.document,{formatter:Gy,rows:(e=n.params.rows)!==null&&e!==void 0?e:bd.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let xZ=class extends Mb{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Xs=B("grl");let $Z=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Xs()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(et,"svg");i.classList.add(Xs("g")),i.style.height=`calc(var(${lA("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(et,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Xs("t"),B("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const m=oe(c,0,t,0,e.width),d=oe(h,i,s,e.height,0);r.push([m,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(Xs("t","a"));return}const a=oe(this.cursor_.rawValue,0,t,0,e.width),u=oe(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(Xs("t","a"))||(o.classList.add(Xs("t","a"),Xs("t","in")),op(o),o.classList.remove(Xs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},TA=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=Ze(-1),this.view=new $Z(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!hd(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new vt(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Ni(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Bi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(oe(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(oe(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function uf(n){return Pe(n.format)?Bt(2):n.format}function VZ(n){var e;return n.value.rawValue.length===1?new Jb(n.document,{formatter:uf(n.params),value:n.value,viewProps:n.viewProps}):new Qb(n.document,{formatter:uf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:bd.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function kZ(n){var e,t,i;return new TA(n.document,{formatter:uf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:bd.monitor.defaultRows,props:ee.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function rE(n){return n.view==="graph"}ct({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=lt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>rE(n)?64:1,reader:n=>UL},controller:n=>rE(n.params)?kZ(n):VZ(n),api:n=>n.controller.valueController instanceof TA?new xZ(n.controller):null});ct({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=lt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>oA},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Qb(n.document,{formatter:af,rows:(e=n.params.rows)!==null&&e!==void 0?e:bd.monitor.defaultRows,value:t,viewProps:n.viewProps}):new Jb(n.document,{formatter:af,value:t,viewProps:n.viewProps})}});class DA{multiply(e){return this.format(this.quat.multiply(e.quat))}premultiply(e){return this.format(e.multiply(this))}slerp(e,t){return this.format(this.quat.slerp(e.quat,t))}}function OA(n,e,t){return Math.min(Math.max(n,e),t)}function SZ(n,e){return Math.floor(n/e)*e}function LZ(n,e){return n-SZ(n,e)}function _u(n){return LZ(n+Math.PI,Math.PI*2)-Math.PI}class Cr extends DA{static fromQuaternion(e,t,i){const s=e.toMat3(),[r,o,l,a]=t==="XYZ"?[0,1,2,1]:t==="XZY"?[0,2,1,-1]:t==="YXZ"?[1,0,2,-1]:t==="YZX"?[1,2,0,1]:t==="ZXY"?[2,0,1,1]:[2,1,0,-1],u=[0,0,0],h=s[l+r*3];return u[o]=-a*Math.asin(OA(h,-1,1)),Math.abs(h)<.999999?(u[r]=a*Math.atan2(s[l+o*3],s[l*4]),u[l]=a*Math.atan2(s[o+r*3],s[r*4])):u[r]=a*Math.atan2(-s[o+l*3],s[o*4]),Math.abs(u[r])+Math.abs(u[l])>Math.PI&&(u[r]=_u(u[r]+Math.PI),u[o]=_u(Math.PI-u[o]),u[l]=_u(u[l]+Math.PI)),new Cr(...u,t).reunit(i)}constructor(e,t,i,s,r){super(),this.x=e??0,this.y=t??0,this.z=i??0,this.order=s??"XYZ",this.unit=r??"rad"}get quat(){return U.fromEuler(this)}getComponents(){return[this.x,this.y,this.z]}toEuler(e,t){return this.reorder(e).reunit(t)}format(e){return e instanceof Cr?e.reorder(this.order):e.toEuler(this.order,this.unit)}reorder(e){return e===this.order?this:this.quat.toEuler(e,this.unit)}reunit(e){const t={deg:Math.PI/180,rad:1,turn:2*Math.PI}[this.unit],i={deg:180/Math.PI,rad:1,turn:.5/Math.PI}[e],s=t*i;return new Cr(s*this.x,s*this.y,s*this.z,this.order,e)}}class U extends DA{static fromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return new U(e.x*s,e.y*s,e.z*s,Math.cos(i))}static fromEuler(e){const t=e.reunit("rad"),[i,s,r,o]=t.order==="XYZ"?[0,1,2,1]:t.order==="XZY"?[0,2,1,-1]:t.order==="YXZ"?[1,0,2,-1]:t.order==="YZX"?[1,2,0,1]:t.order==="ZXY"?[2,0,1,1]:[2,1,0,-1],l=t.getComponents(),a=.5*l[i],u=.5*o*l[s],h=.5*l[r],c=Math.cos(a),m=Math.cos(u),d=Math.cos(h),f=Math.sin(a),p=Math.sin(u),v=Math.sin(h),w=[0,0,0,d*m*c+v*p*f];return w[i]=d*m*f-v*p*c,w[s]=o*(d*p*c+v*m*f),w[r]=v*m*c-d*p*f,new U(...w)}static lookRotation(e,t){const{normal:i,tangent:s,binormal:r}=e.orthoNormalize(t),o=r.x,l=s.x,a=i.x,u=r.y,h=s.y,c=i.y,m=r.z,d=s.z,f=i.z,p=o+h+f;if(p>0){const v=.5/Math.sqrt(p+1);return new U((d-c)*v,(a-m)*v,(u-l)*v,.25/v)}else if(o>h&&o>f){const v=2*Math.sqrt(1+o-h-f);return new U(.25*v,(l+u)/v,(a+m)/v,(d-c)/v)}else if(h>f){const v=2*Math.sqrt(1+h-o-f);return new U((l+u)/v,.25*v,(c+d)/v,(a-m)/v)}else{const v=2*Math.sqrt(1+f-o-h);return new U((a+m)/v,(c+d)/v,.25*v,(u-l)/v)}}constructor(e,t,i,s){super(),this.x=e??0,this.y=t??0,this.z=i??0,this.w=s??1}get quat(){return this}getComponents(){return[this.x,this.y,this.z,this.w]}toEuler(e,t){return Cr.fromQuaternion(this,e,t)}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const e=this.length;return e===0?new U:new U(this.x/e,this.y/e,this.z/e,this.w/e)}get negated(){return new U(-this.x,-this.y,-this.z,-this.w)}get ban360s(){return this.w<0?this.negated:this}multiply(e){const t=e.quat;return new U(this.w*t.x+this.x*t.w+this.y*t.z-this.z*t.y,this.w*t.y-this.x*t.z+this.y*t.w+this.z*t.x,this.w*t.z+this.x*t.y-this.y*t.x+this.z*t.w,this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z)}format(e){return e.quat}slerp(e,t){let i=e.quat;if(t===0)return this;if(t===1)return i;const s=this.ban360s;i=i.ban360s;let r=s.w*i.w+s.x*i.x+s.y*i.y+s.z*i.z;if(r<0&&(i=i.negated,r=-r),r>=1)return s;const o=1-r*r;if(o<=Number.EPSILON){const c=1-t;return new U(c*s.x+t*i.x,c*s.y+t*i.y,c*s.z+t*i.z,c*s.w+t*i.w).normalized}const l=Math.sqrt(o),a=Math.atan2(l,r),u=Math.sin((1-t)*a)/l,h=Math.sin(t*a)/l;return new U(s.x*u+i.x*h,s.y*u+i.y*h,s.z*u+i.z*h,s.w*u+i.w*h)}toMat3(){const{x:e,y:t,z:i,w:s}=this;return[1-2*t*t-2*i*i,2*e*t+2*i*s,2*e*i-2*t*s,2*e*t-2*i*s,1-2*e*e-2*i*i,2*t*i+2*e*s,2*e*i+2*t*s,2*t*i-2*e*s,1-2*e*e-2*t*t]}}class RA{constructor(){this.offset=[0,0,-5],this.fov=30,this.aspect=1,this.viewport=[0,0,1,1]}project(e){const t=(this.viewport[0]+this.viewport[2])*.5,i=(this.viewport[1]+this.viewport[3])*.5,s=this.viewport[2]-this.viewport[0],r=this.viewport[3]-this.viewport[1],o=1/Math.tan(this.fov*Math.PI/360),l=-(e.z+this.offset[2]),a=t+(e.x+this.offset[0])/l*o*s*.5/this.aspect,u=i-(e.y+this.offset[1])/l*o*r*.5;return[a,u]}}class Ee{constructor(e,t,i){this.element=e.createElementNS(et,"path"),this.vertices=t,this.projector=i}setRotation(e){let t="";return this.vertices.forEach((i,s)=>{const r=i.applyQuaternion(e),[o,l]=this.projector.project(r);t+=`${s===0?"M":"L"}${o} ${l}`}),this.element.setAttributeNS(null,"d",t),this}}class H{constructor(e,t,i){this.x=e??0,this.y=t??0,this.z=i??0}getComponents(){return[this.x,this.y,this.z]}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const e=this.length;return e===0?new H:new H(this.x/e,this.y/e,this.z/e)}get negated(){return new H(-this.x,-this.y,-this.z)}add(e){return new H(this.x+e.x,this.y+e.y,this.z+e.z)}sub(e){return new H(this.x-e.x,this.y-e.y,this.z-e.z)}scale(e){return new H(this.x*e,this.y*e,this.z*e)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){return new H(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}orthoNormalize(e){const t=this.normalized;e=e.normalized;let i=t.dot(e);i===1&&(Math.abs(t.y)>Math.abs(t.z)?e=new H(0,0,1):e=new H(0,1,0),i=t.dot(e)),e=e.sub(t.scale(i)).normalized;const s=e.cross(t);return{normal:t,tangent:e,binormal:s}}applyQuaternion(e){const t=e.w*this.x+e.y*this.z-e.z*this.y,i=e.w*this.y+e.z*this.x-e.x*this.z,s=e.w*this.z+e.x*this.y-e.y*this.x,r=-e.x*this.x-e.y*this.y-e.z*this.z;return new H(t*e.w+r*-e.x+i*-e.z-s*-e.y,i*e.w+r*-e.y+s*-e.x-t*-e.z,s*e.w+r*-e.z+t*-e.y-i*-e.x)}}function kt(n,e){const t=e.z>0?new U(0,0,0,1):new U(0,0,1,0);return Math.abs(n.z)>.9999?t:U.lookRotation(n,e)}function up(n,e,t,i,s,r=1){const o=[];for(let l=0;l<t;l++){const a=n+e*l/(t-1),u=new H;u[i]=r*Math.cos(a),u[s]=r*Math.sin(a),o.push(u)}return o}const E=B("rotationgizmo"),sl=new H(0,0,0),AZ=new H(1,0,0),MZ=new H(0,1,0),Wr=new H(0,0,1),rl=new H(0,0,-1),oE=new H(.7,0,0),lE=new H(0,.7,0),aE=new H(0,0,.7),uE=new H(-.7,0,0),hE=new H(0,-.7,0),cE=new H(0,0,-.7),pE=new U(0,0,0,1);function ol(n,e,t){const i=n.createElementNS(et,"g"),s=n.createElementNS(et,"circle");s.classList.add(E(e)),s.setAttributeNS(null,"cx","0"),s.setAttributeNS(null,"cy","0"),s.setAttributeNS(null,"r","8"),i.appendChild(s);const r=n.createElementNS(et,"text");return r.classList.add(E("labeltext")),r.setAttributeNS(null,"y","4"),r.setAttributeNS(null,"text-anchor","middle"),r.setAttributeNS(null,"font-size","10"),r.textContent=t,i.appendChild(r),i}class TZ{get xArcBElement(){return this.xArcBC_.element}get yArcBElement(){return this.yArcBC_.element}get zArcBElement(){return this.zArcBC_.element}get xArcFElement(){return this.xArcFC_.element}get yArcFElement(){return this.yArcFC_.element}get zArcFElement(){return this.zArcFC_.element}get rArcElement(){return this.rArcC_.element}constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.onModeChange_=this.onModeChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(E()),t.pickerLayout==="popup"&&this.element.classList.add(E(void 0,"p"));const i=e.createElement("div");i.classList.add(E("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(et,"svg");s.classList.add(E("g")),this.padElement.appendChild(s),this.svgElem_=s,this.projector_=new RA,this.projector_.viewport=[0,0,136,136];const r=up(0,Math.PI,33,"x","y"),o=up(0,2*Math.PI,65,"x","y",1.1);this.xArcB_=new Ee(e,r,this.projector_),this.xArcB_.element.classList.add(E("arcx")),this.svgElem_.appendChild(this.xArcB_.element),this.yArcB_=new Ee(e,r,this.projector_),this.yArcB_.element.classList.add(E("arcy")),this.svgElem_.appendChild(this.yArcB_.element),this.zArcB_=new Ee(e,r,this.projector_),this.zArcB_.element.classList.add(E("arcz")),this.svgElem_.appendChild(this.zArcB_.element),this.xArcBC_=new Ee(e,r,this.projector_),this.xArcBC_.element.classList.add(E("arcc")),this.svgElem_.appendChild(this.xArcBC_.element),this.yArcBC_=new Ee(e,r,this.projector_),this.yArcBC_.element.classList.add(E("arcc")),this.svgElem_.appendChild(this.yArcBC_.element),this.zArcBC_=new Ee(e,r,this.projector_),this.zArcBC_.element.classList.add(E("arcc")),this.svgElem_.appendChild(this.zArcBC_.element);const l=e.createElementNS(et,"g");s.classList.add(E("axes")),this.svgElem_.appendChild(l),this.axesElem_=l,this.xAxis_=new Ee(e,[sl,oE],this.projector_),this.xAxis_.element.classList.add(E("axisx")),this.axesElem_.appendChild(this.xAxis_.element),this.yAxis_=new Ee(e,[sl,lE],this.projector_),this.yAxis_.element.classList.add(E("axisy")),this.axesElem_.appendChild(this.yAxis_.element),this.zAxis_=new Ee(e,[sl,aE],this.projector_),this.zAxis_.element.classList.add(E("axisz")),this.axesElem_.appendChild(this.zAxis_.element),this.xnAxis_=new Ee(e,[sl,uE],this.projector_),this.xnAxis_.element.classList.add(E("axisn")),this.axesElem_.appendChild(this.xnAxis_.element),this.ynAxis_=new Ee(e,[sl,hE],this.projector_),this.ynAxis_.element.classList.add(E("axisn")),this.axesElem_.appendChild(this.ynAxis_.element),this.znAxis_=new Ee(e,[sl,cE],this.projector_),this.znAxis_.element.classList.add(E("axisn")),this.axesElem_.appendChild(this.znAxis_.element),this.xArcF_=new Ee(e,r,this.projector_),this.xArcF_.element.classList.add(E("arcx")),this.svgElem_.appendChild(this.xArcF_.element),this.yArcF_=new Ee(e,r,this.projector_),this.yArcF_.element.classList.add(E("arcy")),this.svgElem_.appendChild(this.yArcF_.element),this.zArcF_=new Ee(e,r,this.projector_),this.zArcF_.element.classList.add(E("arcz")),this.svgElem_.appendChild(this.zArcF_.element),this.xArcFC_=new Ee(e,r,this.projector_),this.xArcFC_.element.classList.add(E("arcc")),this.svgElem_.appendChild(this.xArcFC_.element),this.yArcFC_=new Ee(e,r,this.projector_),this.yArcFC_.element.classList.add(E("arcc")),this.svgElem_.appendChild(this.yArcFC_.element),this.zArcFC_=new Ee(e,r,this.projector_),this.zArcFC_.element.classList.add(E("arcc")),this.svgElem_.appendChild(this.zArcFC_.element),this.rArc_=new Ee(e,o,this.projector_),this.rArc_.element.classList.add(E("arcr")),this.rArc_.setRotation(pE),this.svgElem_.appendChild(this.rArc_.element),this.rArcC_=new Ee(e,o,this.projector_),this.rArcC_.element.classList.add(E("arcc")),this.rArcC_.setRotation(pE),this.svgElem_.appendChild(this.rArcC_.element);const a=e.createElementNS(et,"g");s.classList.add(E("labels")),this.svgElem_.appendChild(a),this.labelsElem_=a,this.xLabel=ol(e,"labelcirclex","X"),this.labelsElem_.appendChild(this.xLabel),this.yLabel=ol(e,"labelcircley","Y"),this.labelsElem_.appendChild(this.yLabel),this.zLabel=ol(e,"labelcirclez","Z"),this.labelsElem_.appendChild(this.zLabel),this.xnLabel=ol(e,"labelcirclen","-X"),this.labelsElem_.appendChild(this.xnLabel),this.ynLabel=ol(e,"labelcirclen","-Y"),this.labelsElem_.appendChild(this.ynLabel),this.znLabel=ol(e,"labelcirclen","-Z"),this.labelsElem_.appendChild(this.znLabel);const u=()=>{this.xArcB_.element.classList.add(E("arcx_hover")),this.xArcF_.element.classList.add(E("arcx_hover"))},h=()=>{this.xArcB_.element.classList.remove(E("arcx_hover")),this.xArcF_.element.classList.remove(E("arcx_hover"))};this.xArcBC_.element.addEventListener("mouseenter",u),this.xArcBC_.element.addEventListener("mouseleave",h),this.xArcFC_.element.addEventListener("mouseenter",u),this.xArcFC_.element.addEventListener("mouseleave",h);const c=()=>{this.yArcB_.element.classList.add(E("arcy_hover")),this.yArcF_.element.classList.add(E("arcy_hover"))},m=()=>{this.yArcB_.element.classList.remove(E("arcy_hover")),this.yArcF_.element.classList.remove(E("arcy_hover"))};this.yArcBC_.element.addEventListener("mouseenter",c),this.yArcBC_.element.addEventListener("mouseleave",m),this.yArcFC_.element.addEventListener("mouseenter",c),this.yArcFC_.element.addEventListener("mouseleave",m);const d=()=>{this.zArcB_.element.classList.add(E("arcz_hover")),this.zArcF_.element.classList.add(E("arcz_hover"))},f=()=>{this.zArcB_.element.classList.remove(E("arcz_hover")),this.zArcF_.element.classList.remove(E("arcz_hover"))};this.zArcBC_.element.addEventListener("mouseenter",d),this.zArcBC_.element.addEventListener("mouseleave",f),this.zArcFC_.element.addEventListener("mouseenter",d),this.zArcFC_.element.addEventListener("mouseleave",f);const p=()=>{this.rArc_.element.classList.add(E("arcr_hover"))},v=()=>{this.rArc_.element.classList.remove(E("arcr_hover"))};this.rArcC_.element.addEventListener("mouseenter",p),this.rArcC_.element.addEventListener("mouseleave",v),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,t.mode.emitter.on("change",this.onModeChange_),this.mode_=t.mode,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const e=this.value.rawValue.quat.normalized;this.xAxis_.setRotation(e),this.yAxis_.setRotation(e),this.zAxis_.setRotation(e),this.xnAxis_.setRotation(e),this.ynAxis_.setRotation(e),this.znAxis_.setRotation(e);const t=AZ.applyQuaternion(e),i=MZ.applyQuaternion(e),s=Wr.applyQuaternion(e),r=t.negated,o=i.negated,l=s.negated;[{el:this.xAxis_.element,v:t},{el:this.yAxis_.element,v:i},{el:this.zAxis_.element,v:s},{el:this.xnAxis_.element,v:r},{el:this.ynAxis_.element,v:o},{el:this.znAxis_.element,v:l}].map(({el:a,v:u})=>(this.axesElem_.removeChild(a),{el:a,v:u})).sort((a,u)=>a.v.z-u.v.z).forEach(({el:a})=>{this.axesElem_.appendChild(a)}),this.xArcB_.setRotation(kt(t,rl)),this.yArcB_.setRotation(kt(i,rl)),this.zArcB_.setRotation(kt(s,rl)),this.xArcBC_.setRotation(kt(t,rl)),this.yArcBC_.setRotation(kt(i,rl)),this.zArcBC_.setRotation(kt(s,rl)),this.xArcF_.setRotation(kt(t,Wr)),this.yArcF_.setRotation(kt(i,Wr)),this.zArcF_.setRotation(kt(s,Wr)),this.xArcFC_.setRotation(kt(t,Wr)),this.yArcFC_.setRotation(kt(i,Wr)),this.zArcFC_.setRotation(kt(s,Wr)),[{el:this.xLabel,v:oE},{el:this.yLabel,v:lE},{el:this.zLabel,v:aE},{el:this.xnLabel,v:uE},{el:this.ynLabel,v:hE},{el:this.znLabel,v:cE}].forEach(({el:a,v:u})=>{const[h,c]=this.projector_.project(u.applyQuaternion(e));a.setAttributeNS(null,"transform",`translate( ${h}, ${c} )`)}),[{el:this.xLabel,v:t},{el:this.yLabel,v:i},{el:this.zLabel,v:s},{el:this.xnLabel,v:r},{el:this.ynLabel,v:o},{el:this.znLabel,v:l}].map(({el:a,v:u})=>(this.labelsElem_.removeChild(a),{el:a,v:u})).sort((a,u)=>a.v.z-u.v.z).forEach(({el:a})=>{this.labelsElem_.appendChild(a)})}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}onModeChange_(){const e=this.mode_.rawValue,t=e==="angle-x"?"add":"remove",i=e==="angle-y"?"add":"remove",s=e==="angle-z"?"add":"remove",r=e==="angle-r"?"add":"remove";this.xArcB_.element.classList[t](E("arcx_active")),this.yArcB_.element.classList[i](E("arcy_active")),this.zArcB_.element.classList[s](E("arcz_active")),this.xArcF_.element.classList[t](E("arcx_active")),this.yArcF_.element.classList[i](E("arcy_active")),this.zArcF_.element.classList[s](E("arcz_active")),this.rArc_.element.classList[r](E("arcr_active"))}}function jA(n){return OA(n,0,1)}function DZ(n){if(n<=0)return 0;if(n>=1)return 1;const e=1-n,t=e*(e*(e*(e*(e*(e*(e*-6+7))))));return jA(1-t)}function OZ(n,e,t){return jA((t-n)/(e-n))}const Lr=1/Math.sqrt(2),RZ=new H(1,0,0),jZ=new H(0,1,0),NZ=new H(0,0,1),BZ=new U(0,0,0,1),IZ=new U(Lr,0,0,Lr),FZ=new U(0,-Lr,0,Lr),KZ=new U(-Lr,0,0,Lr),UZ=new U(0,Lr,0,Lr),HZ=new U(0,1,0,0);class zZ{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.mode_=Ze("free"),this.view=new TZ(e,{value:this.value,mode:this.mode_,viewProps:this.viewProps,pickerLayout:t.pickerLayout}),this.ptHandler_=new vt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);const i=new vt(this.view.xArcBElement);i.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),i.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const s=new vt(this.view.xArcFElement);s.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),s.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const r=new vt(this.view.yArcBElement);r.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),r.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const o=new vt(this.view.yArcFElement);o.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),o.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const l=new vt(this.view.zArcBElement);l.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),l.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const a=new vt(this.view.zArcFElement);a.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),a.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const u=new vt(this.view.rArcElement);u.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-r")),u.emitter.on("up",()=>this.changeModeIfNotAuto_("free")),[{el:this.view.xLabel,q:FZ},{el:this.view.yLabel,q:IZ},{el:this.view.zLabel,q:BZ},{el:this.view.xnLabel,q:UZ},{el:this.view.ynLabel,q:KZ},{el:this.view.znLabel,q:HZ}].forEach(({el:h,q:c})=>{new vt(h).emitter.on("down",()=>this.autoRotate_(c))}),this.px_=null,this.py_=null,this.angleState_=null}handlePointerEvent_(e){if(!e.point)return;const t=this.mode_.rawValue,i=e.point.x,s=e.point.y;if(t!=="auto")if(t==="free"){if(this.px_!=null&&this.py_!=null){const r=i-this.px_,o=s-this.py_,l=Math.sqrt(r*r+o*o);if(l===0)return;const a=new H(o/l,r/l,0),u=U.fromAxisAngle(a,l/68);this.value.rawValue=this.value.rawValue.premultiply(u)}this.px_=i,this.py_=s}else if(t==="angle-r"){const r=e.bounds.width/2,o=e.bounds.height/2,l=Math.atan2(s-o,i-r);if(this.angleState_==null){const a=new H(0,0,1);this.angleState_={initialRotation:this.value.rawValue,initialAngle:l,axis:a,reverseAngle:!0}}else{const{initialRotation:a,initialAngle:u,axis:h}=this.angleState_,c=-_u(l-u),m=U.fromAxisAngle(h,c);this.value.rawValue=a.premultiply(m)}}else{const r=e.bounds.width/2,o=e.bounds.height/2,l=Math.atan2(s-o,i-r);if(this.angleState_==null){const a=t==="angle-x"?RZ:t==="angle-y"?jZ:NZ,u=a.applyQuaternion(this.value.rawValue.quat).z>0;this.angleState_={initialRotation:this.value.rawValue,initialAngle:l,axis:a,reverseAngle:u}}else{const{initialRotation:a,initialAngle:u,axis:h,reverseAngle:c}=this.angleState_;let m=_u(l-u);m=c?-m:m;const d=U.fromAxisAngle(h,m);this.value.rawValue=a.multiply(d)}}}onPointerDown_(e){this.handlePointerEvent_(e.data)}onPointerMove_(e){this.handlePointerEvent_(e.data)}onPointerUp_(){this.px_=null,this.py_=null,this.angleState_=null}onPadKeyDown_(e){Hb(e.key)&&e.preventDefault();const t=_t(1,Pi(e)),i=_t(1,ta(e));if(t!==0||i!==0){const s=new H(-i,t,0),r=U.fromAxisAngle(s,Math.PI/16);this.value.rawValue=this.value.rawValue.premultiply(r)}}changeModeIfNotAuto_(e){this.mode_.rawValue!=="auto"&&(this.mode_.rawValue=e)}autoRotate_(e){this.mode_.rawValue="auto";const t=this.value.rawValue,i=Date.now(),s=()=>{const r=Date.now(),o=DZ(OZ(0,300,r-i));if(this.value.rawValue=t.slerp(e,o),o===1){this.mode_.rawValue="free";return}requestAnimationFrame(s)};requestAnimationFrame(s)}}const Zr=B("rotationswatch"),qZ=new H(1,0,0),GZ=new H(0,1,0),rc=new H(0,0,1),YZ=new U(0,0,0,1);class XZ{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Zr()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Zr("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElementNS(et,"svg");s.classList.add(Zr("g")),i.appendChild(s),this.svgElem_=s,this.projector_=new RA,this.projector_.viewport=[0,0,20,20];const r=up(0,Math.PI,33,"x","y"),o=up(0,2*Math.PI,65,"x","y");this.rArc_=new Ee(e,o,this.projector_),this.rArc_.element.classList.add(Zr("arcr")),s.appendChild(this.rArc_.element),this.rArc_.setRotation(YZ),this.xArc_=new Ee(e,r,this.projector_),this.xArc_.element.classList.add(Zr("arc")),s.appendChild(this.xArc_.element),this.yArc_=new Ee(e,r,this.projector_),this.yArc_.element.classList.add(Zr("arc")),s.appendChild(this.yArc_.element),this.zArc_=new Ee(e,r,this.projector_),this.zArc_.element.classList.add(Zr("arc")),s.appendChild(this.zArc_.element),this.update_()}update_(){const e=this.value.rawValue.quat.normalized,t=qZ.applyQuaternion(e),i=GZ.applyQuaternion(e),s=rc.applyQuaternion(e);this.xArc_.setRotation(kt(t,rc)),this.yArc_.setRotation(kt(i,rc)),this.zArc_.setRotation(kt(s,rc))}onValueChange_(){this.update_()}}class WZ{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new XZ(e,{value:this.value,viewProps:this.viewProps})}}const Ws=B("rotation");class ZZ{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ws()),t.foldable.bindExpandedClass(this.element,Ws(void 0,"expanded")),Qn(t.foldable,"completed",Io(this.element,Ws(void 0,"cpl"))),t.rotationMode==="quaternion"&&this.element.classList.add(Ws("quat"));const i=e.createElement("div");i.classList.add(Ws("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Ws("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Ws("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Ws("g")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}class NA{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=pd.create(t.expanded),this.swatchC_=new WZ(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new _d(e,{assembly:t.assembly,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new ZZ(e,{rotationMode:t.rotationMode,foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Kb(e,{viewProps:this.viewProps}):null;const s=new zZ(e,{value:this.value,viewProps:this.viewProps,pickerLayout:t.pickerLayout});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.gizmoC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Fo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.gizmoC_.view.element),dd(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.gizmoC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Db(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!hd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Ym(n,e){const t=Math.pow(.1,n);return{baseStep:t,constraint:e,textProps:ee.fromObject({formatter:Bt(n),keyScale:t,pointerScale:t})}}function to(n){if(!n)return;const e=[];return Pe(n.step)||e.push(new BL(n.step)),(!Pe(n.max)||!Pe(n.min))&&e.push(new NL({max:n.max,min:n.min})),new xa(e)}function dE(n,e){return{toComponents:t=>t.getComponents(),fromComponents:t=>new Cr(t[0],t[1],t[2],n,e)}}function mE(n,e,t){return typeof(n==null?void 0:n.x)=="number"&&typeof(n==null?void 0:n.y)=="number"&&typeof(n==null?void 0:n.z)=="number"?new Cr(n.x,n.y,n.z,e,t):new Cr(0,0,0,e,t)}function QZ(n){switch(n){case"XYZ":case"XZY":case"YXZ":case"YZX":case"ZXY":case"ZYX":return n;default:return}}function JZ(n){switch(n){case"rad":case"deg":case"turn":return n;default:return}}ct({id:"rotation",type:"input",accept(n,e){var t,i;const s=lt(e,r=>({view:r.required.constant("rotation"),label:r.optional.string,picker:r.optional.custom(fd),expanded:r.optional.boolean,rotationMode:r.required.constant("euler"),x:r.optional.custom(St),y:r.optional.custom(St),z:r.optional.custom(St),order:r.optional.custom(QZ),unit:r.optional.custom(JZ)}));return s?{initialValue:mE(n,(t=s.order)!==null&&t!==void 0?t:"XYZ",(i=s.unit)!==null&&i!==void 0?i:"rad"),params:s}:null},binding:{reader({params:n}){return e=>{var t,i;return mE(e,(t=n.order)!==null&&t!==void 0?t:"XYZ",(i=n.unit)!==null&&i!==void 0?i:"rad")}},constraint({params:n}){var e,t;return new Po({assembly:dE((e=n.order)!==null&&e!==void 0?e:"XYZ",(t=n.unit)!==null&&t!==void 0?t:"rad"),components:[to("x"in n?n.x:void 0),to("y"in n?n.y:void 0),to("z"in n?n.z:void 0)]})},writer(n){return(e,t)=>{e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}}},controller({document:n,value:e,constraint:t,params:i,viewProps:s}){var r,o;if(!(t instanceof Po))throw xs.shouldNeverHappen();const l="expanded"in i?i.expanded:void 0,a="picker"in i?i.picker:void 0,u=(r=i.unit)!==null&&r!==void 0?r:"rad",h={rad:2,deg:0,turn:2}[u];return new NA(n,{axes:[Ym(h,t.components[0]),Ym(h,t.components[1]),Ym(h,t.components[2])],assembly:dE((o=i.order)!==null&&o!==void 0?o:"XYZ",u),rotationMode:"euler",expanded:l??!1,parser:Ci,pickerLayout:a??"popup",value:e,viewProps:s})}});const vE={toComponents:n=>[n.x,n.y,n.z,n.w],fromComponents:n=>new U(n[0],n[1],n[2],n[3])};function oc(n){return{baseStep:.01,constraint:n,textProps:ee.fromObject({formatter:e=>Math.abs(e)<.995?e.toFixed(2).replace("0.","."):e.toFixed(1),keyScale:.01,pointerScale:.01})}}function fE(n){return typeof(n==null?void 0:n.x)=="number"&&typeof(n==null?void 0:n.y)=="number"&&typeof(n==null?void 0:n.z)=="number"&&typeof(n==null?void 0:n.w)=="number"?new U(n.x,n.y,n.z,n.w):new U(0,0,0,1)}ct({id:"rotation",type:"input",accept(n,e){const t=lt(e,i=>({view:i.required.constant("rotation"),label:i.optional.string,picker:i.optional.custom(fd),expanded:i.optional.boolean,rotationMode:i.optional.constant("quaternion"),x:i.optional.custom(St),y:i.optional.custom(St),z:i.optional.custom(St),w:i.optional.custom(St)}));return t?{initialValue:fE(n),params:t}:null},binding:{reader(n){return e=>fE(e)},constraint({params:n}){return new Po({assembly:vE,components:[to("x"in n?n.x:void 0),to("y"in n?n.y:void 0),to("z"in n?n.z:void 0),to("w"in n?n.w:void 0)]})},writer(n){return(e,t)=>{e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}}},controller({document:n,value:e,constraint:t,params:i,viewProps:s}){if(!(t instanceof Po))throw xs.shouldNeverHappen();const r="expanded"in i?i.expanded:void 0,o="picker"in i?i.picker:void 0;return new NA(n,{axes:[oc(t.components[0]),oc(t.components[1]),oc(t.components[2]),oc(t.components[3])],assembly:vE,rotationMode:"quaternion",expanded:r??!1,parser:Ci,pickerLayout:o??"popup",value:e,viewProps:s})}});function Ae(n){return n==null}function eg(n){return n!==null&&typeof n=="object"}function hf(n){return n!==null&&typeof n=="object"}function eQ(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function yo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return hf(r)&&hf(o)?Object.assign(Object.assign({},i),{[s]:yo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function tQ(n){return eg(n)?"target"in n:!1}const nQ={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let Eo=class Cl{static alreadyDisposed(){return new Cl({type:"alreadydisposed"})}static notBindable(){return new Cl({type:"notbindable"})}static notCompatible(e,t){return new Cl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new Cl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Cl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=nQ[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},wE=class BA{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!BA.isBindable(i))throw Eo.notBindable();if(!(e in i))throw Eo.propertyNotFound(e);i[e]=t}},gn=class{constructor(){this.observers_={}}on(e,t,i){var s;let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t,key:(s=i==null?void 0:i.key)!==null&&s!==void 0?s:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.key!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},iQ=class{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new gn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},sQ=class{constructor(e){this.emitter=new gn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},rQ=class{constructor(e){this.emitter=new gn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function it(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new sQ(n):new iQ(n,e)}function oQ(n){return[new rQ(n),(e,t)=>{n.setRawValue(e,t)}]}let ge=class IA{constructor(e){this.emitter=new gn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:it(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new IA(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},gd=class{constructor(e){this.values=ge.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},lQ=class{constructor(e){this.values=ge.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Ae(i)||(s=Math.max(s,i)),Ae(t)||(s=Math.min(s,t)),s}},aQ=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},uQ=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const hQ={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let cQ=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=hQ[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const pQ={"+":n=>n,"-":n=>-n,"~":n=>~n};let dQ=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=pQ[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function tg(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function zu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function mQ(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function qu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function vQ(n,e){const t=qu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=qu(n,e);return s===""?"":i+s}function ng(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=vQ(n,e);return i===""?"":t+i}function FA(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=mQ(n,e);return e+=i.length,i===""?"":i+qu(n,e)}function fQ(n,e){const t=FA(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=qu(n,e);return e+=s.length,t+i+s+ng(n,e)}function wQ(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=qu(n,e);return e+=i.length,i===""?"":t+i+ng(n,e)}function _Q(n,e){const t=FA(n,e);return e+=t.length,t===""?"":t+ng(n,e)}const bQ=tg([fQ,wQ,_Q]);function gQ(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function CQ(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=gQ(n,e);return i===""?"":t+i}function PQ(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function yQ(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=PQ(n,e);return i===""?"":t+i}function EQ(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function xQ(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=EQ(n,e);return i===""?"":t+i}const $Q=tg([CQ,yQ,xQ]),VQ=tg([$Q,bQ]);function kQ(n,e){const t=VQ(n,e);return e+=t.length,t===""?null:{evaluable:new uQ(t),cursor:e}}function SQ(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=UA(n,e);if(!i)return null;e=i.cursor,e+=zu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function LQ(n,e){var t;return(t=kQ(n,e))!==null&&t!==void 0?t:SQ(n,e)}function KA(n,e){const t=LQ(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=KA(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new dQ(i,s.evaluable)}):null}function AQ(n,e,t){t+=zu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=zu(e,t).length,{cursor:t,operator:i}):null}function MQ(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=AQ(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new cQ(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const TQ=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>MQ(n,e),KA);function UA(n,e){return e+=zu(n,e).length,TQ(n,e)}function DQ(n){const e=UA(n,0);return!e||e.cursor+zu(n,e.cursor).length!==n.length?null:e.evaluable}function Ar(n){var e;const t=DQ(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function HA(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Ar(n);if(!Ae(e))return e}return 0}function sn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function le(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function _E(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ge(n,e,t){return Math.min(Math.max(n,e),t)}function zA(n,e){return(n%e+e)%e}function OQ(n,e){return Ae(n.step)?Math.max(_E(e),2):_E(n.step)}function qA(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function RQ(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function GA(n,e){return Ae(n.step)?null:new aQ(n.step,e)}function YA(n){return!Ae(n.max)&&!Ae(n.min)?new gd({max:n.max,min:n.min}):!Ae(n.max)||!Ae(n.min)?new lQ({max:n.max,min:n.min}):null}function XA(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:sn(OQ(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:qA(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:RQ(n,e)}}function WA(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function ig(n){return{constraint:n.constraint,textProps:ge.fromObject(XA(n.params,n.initialValue))}}let sg=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Cd=class{constructor(e){this.target=e}},ZA=class extends Cd{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},jQ=class extends Cd{constructor(e,t){super(e),this.expanded=t}},NQ=class extends Cd{constructor(e,t){super(e),this.index=t}};class BQ extends Cd{constructor(e,t){super(e),this.native=t}}let rg=class extends sg{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new gn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new ZA(this,t.binding.target.read(),e.options.last))}};function IQ(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function FQ(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function KQ(n){return n===null?!1:typeof n=="object"}function Ji(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function bE(n){return{custom:e=>Ji(e)(n),boolean:Ji(e=>typeof e=="boolean"?e:void 0)(n),number:Ji(e=>typeof e=="number"?e:void 0)(n),string:Ji(e=>typeof e=="string"?e:void 0)(n),function:Ji(e=>typeof e=="function"?e:void 0)(n),constant:e=>Ji(t=>t===e?e:void 0)(n),raw:Ji(e=>e)(n),object:e=>Ji(t=>{if(KQ(t))return IQ(t,e)})(n),array:e=>Ji(t=>{if(Array.isArray(t))return FQ(t,e)})(n)}}const cf={optional:bE(!0),required:bE(!1)};function pt(n,e){const t=e(cf),i=cf.required.object(t)(n);return i.succeeded?i.value:void 0}function Ii(n,e,t,i){if(e&&!e(n))return!1;const s=pt(n,t);return s?i(s):!1}function Fi(n,e){var t;return yo((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function Mc(n){return"value"in n}function UQ(n){if(!eg(n)||!("binding"in n))return!1;const e=n.binding;return tQ(e)}const ri="http://www.w3.org/2000/svg";function hp(n){n.offsetHeight}function HQ(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function og(n){return n.ontouchstart!==void 0}function zQ(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const qQ={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Pd(n,e){const t=n.createElementNS(ri,"svg");return t.innerHTML=qQ[e],t}function QA(n,e,t){n.insertBefore(e,n.children[t])}function lg(n){n.parentElement&&n.parentElement.removeChild(n)}function JA(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function GQ(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function e2(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function fs(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function Ei(n,e,t){fs(n.value(e),t)}const YQ="tp";function W(n){return(t,i)=>[YQ,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const ou=W("lbl");function XQ(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let WQ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ou()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ou("l")),Ei(t.props,"label",r=>{Ae(r)?this.element.classList.add(ou(void 0,"nol")):(this.element.classList.remove(ou(void 0,"nol")),GQ(i),i.appendChild(XQ(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(ou("v")),this.element.appendChild(s),this.valueElement=s}},ZQ=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new WQ(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Ii(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Fi(null,{label:this.props.get("label")})}};function QQ(){return["veryfirst","first","last","verylast"]}const gE=W(""),CE={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let t2=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{QQ().forEach(i=>{t.classList.remove(gE(void 0,CE[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(gE(void 0,CE[i]))})}),this.viewProps.handleDispose(()=>{lg(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Ii(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Fi(null,Object.assign({},this.viewProps.exportState()))}},JQ=class extends sg{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,r=>{i(new BQ(this,r.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}};function eJ(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function $a(n,e){return t=>{eJ(n,e,t)}}function ag(n,e){fs(n,t=>{e.textContent=t??""})}const Xm=W("btn");let tJ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Xm("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Xm("t")),ag(t.props.value("title"),s),this.buttonElement.appendChild(s)}},nJ=class{constructor(e,t){this.emitter=new gn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new tJ(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Ii(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Fi(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}},PE=class extends t2{constructor(e,t){const i=new nJ(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new ZQ(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Ii(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Fi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},iJ=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const sJ=new iJ("2.0.3");function Et(n){return Object.assign({core:sJ},n)}Et({id:"button",type:"blade",accept(n){const e=pt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new PE(n.document,{blade:n.blade,buttonProps:ge.fromObject({title:n.params.title}),labelProps:ge.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof PE?new JQ(n.controller):null}});function rJ(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function oJ(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function lJ(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function aJ(n){return eg(n)?"refresh"in n&&typeof n.refresh=="function":!1}function uJ(n,e){if(!wE.isBindable(n))throw Eo.notBindable();return new wE(n,e)}let hJ=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new gn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,uJ(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return oJ(this,e)}addButton(e){return rJ(this,e)}addTab(e){return lJ(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{aJ(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=UQ(t.value)?t.value.binding:null;this.emitter_.emit("change",new ZA(i,s?s.target.read():t.value.rawValue,e.options.last))}},ug=class extends sg{constructor(e,t){super(e),this.rackApi_=new hJ(e.rackController,t)}refresh(){this.rackApi_.refresh()}},hg=class extends t2{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Ii(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Fi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function pf(n){return"rackController"in n}let cJ=class{constructor(e){this.emitter=new gn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Eo.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function pJ(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Mc(i)&&i.value===e)return i}return null}function dJ(n){return pf(n)?n.rackController.rack.bcSet_:null}let mJ=class{constructor(e){var t,i;this.emitter=new gn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new cJ(dJ),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Mc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(pf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Mc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(pf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=pJ(this.find(Mc),e.sender);if(!t)throw Eo.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},cg=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new mJ({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&QA(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&lg(e.bladeController.view.element)}};function n2(){return new ge({positions:it([],{equals:eQ})})}let pg=class i2 extends ge{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=ge.createCore(t);return new i2(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Ae(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Ei(this,"expanded",i),Ei(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function vJ(n,e){let t=0;return HQ(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),hp(e),t=e.clientHeight,n.set("temporaryExpanded",null),hp(e)}),t}function yE(n,e){e.style.height=n.styleHeight}function dg(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Ae(n.get("expandedHeight"))){const t=vJ(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),hp(e)}),n.emitter.on("change",()=>{yE(n,e)}),yE(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let fJ=class extends ug{constructor(e,t){super(e,t),this.emitter_=new gn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new jQ(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}};const s2=W("cnt");let wJ=class{constructor(e,t){var i;this.className_=W((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),s2()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Ei(this.foldable_,"completed",$a(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),Ei(t.props,"title",u=>{Ae(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),ag(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},EE=class extends hg{constructor(e,t){var i;const s=pg.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new wJ(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new cg({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,dg(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Ii(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Fi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};Et({id:"folder",type:"blade",accept(n){const e=pt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new EE(n.document,{blade:n.blade,expanded:n.params.expanded,props:ge.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof EE?new fJ(n.controller,n.pool):null}});const _J=W("");function xE(n,e){return $a(n,_J(void 0,e))}let mg=class r2 extends ge{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=oQ(it(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new r2(ge.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){fs(this.globalDisabled_,xE(e,"disabled")),Ei(this,"hidden",xE(e,"hidden"))}bindDisabled(e){fs(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){fs(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const $E=W("tbp");let bJ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add($E()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add($E("c")),this.element.appendChild(i),this.containerElement=i}};const lu=W("tbi");let gJ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(lu()),t.viewProps.bindClassModifiers(this.element),Ei(t.props,"selected",r=>{r?this.element.classList.add(lu(void 0,"sel")):this.element.classList.remove(lu(void 0,"sel"))});const i=e.createElement("button");i.classList.add(lu("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(lu("t")),ag(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},CJ=class{constructor(e,t){this.emitter=new gn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new gJ(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},df=class extends hg{constructor(e,t){const i=new bJ(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new cg({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new CJ(e,{props:t.itemProps,viewProps:mg.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Ei(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Ii(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Fi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},PJ=class extends ug{constructor(e,t){super(e,t),this.emitter_=new gn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new df(t,{blade:n2(),itemProps:ge.fromObject({selected:!1,title:e.title}),props:ge.fromObject({selected:!1}),viewProps:mg.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new NQ(this,e.rawValue))}},yJ=class extends ug{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const VE=-1;let EJ=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=it(!0),this.selectedIndex=it(VE),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=VE,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const au=W("tab");let xJ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(au(),s2()),t.viewProps.bindClassModifiers(this.element),fs(t.empty,$a(this.element,au(void 0,"nop")));const i=e.createElement("div");i.classList.add(au("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(au("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(au("c")),this.element.appendChild(r),this.contentsElement=r}},kE=class extends hg{constructor(e,t){const i=new EJ,s=new xJ(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new cg({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;QA(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;lg(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};Et({id:"tab",type:"blade",accept(n){const e=pt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new kE(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new df(n.document,{blade:n2(),itemProps:ge.fromObject({selected:!1,title:t.title}),props:ge.fromObject({selected:!1}),viewProps:mg.create()});e.add(i)}),e},api(n){return n.controller instanceof kE?new PJ(n.controller,n.pool):n.controller instanceof df?new yJ(n.controller,n.pool):null}});let vg=class extends rg{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},Lh=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function cp(n,e){if(n instanceof e)return n;if(n instanceof Lh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let yd=class{constructor(e){this.values=ge.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Ed(n){var e;const t=cf;if(Array.isArray(n))return(e=pt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function o2(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function fg(n){return Ae(n)?null:new yd(o2(n))}const Wm=W("lst");let $J=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Wm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(Wm("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(Wm("m")),s.appendChild(Pd(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Ei(this.props_,"options",r=>{JA(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},ia=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new $J(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Ii(e,null,t=>({options:t.required.custom(Ed)}),t=>(this.props.set("options",o2(t.options)),!0))}exportProps(){return Fi(null,{options:this.props.get("options")})}};const SE=W("pop");let VJ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(SE()),t.viewProps.bindClassModifiers(this.element),fs(t.shows,$a(this.element,SE(void 0,"v")))}},l2=class{constructor(e,t){this.shows=it(!1),this.viewProps=t.viewProps,this.view=new VJ(e,{shows:this.shows,viewProps:this.viewProps})}};const LE=W("txt");let kJ=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(LE()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(LE("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},wg=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new kJ(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ae(s)||(this.value.rawValue=s),this.view.refresh()}};function SJ(n){return String(n)}function a2(n){return n==="false"?!1:!!n}function AE(n){return SJ(n)}function LJ(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const AJ=sn(0);function pp(n){return AJ(n)+"%"}function u2(n){return String(n)}function mf(n){return n}function Va({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Zt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Gu(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function $s(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function MJ(n){return n==="ArrowUp"||n==="ArrowDown"}function h2(n){return MJ(n)||n==="ArrowLeft"||n==="ArrowRight"}function Zm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Ko=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new gn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Zm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Zm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Zm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const An=W("txt");let TJ=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(An(),An(void 0,"num")),t.arrayPosition&&this.element.classList.add(An(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(An("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(An()),this.inputElement.classList.add(An("i"));const s=e.createElement("div");s.classList.add(An("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(ri,"svg");r.classList.add(An("g")),this.knobElement.appendChild(r);const o=e.createElementNS(ri,"path");o.classList.add(An("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(ri,"path");l.classList.add(An("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(W("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(An(void 0,"drg"));return}this.element.classList.add(An(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Ge(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Ah=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=it(null),this.view=new TJ(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Ko(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ae(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Zt(this.props.get("keyScale"),Gu(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Zt(this.props.get("keyScale"),Gu(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const Qm=W("sld");let DJ=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Qm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Qm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(Qm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ge(le(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},OJ=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new DJ(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(le(Ge(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Zt(this.props.get("keyScale"),$s(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Zt(this.props.get("keyScale"),$s(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Jm=W("sldtxt");let RJ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jm());const i=e.createElement("div");i.classList.add(Jm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Jm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},ME=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new OJ(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Ah(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new RJ(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Ii(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Fi(null,{max:e.get("max"),min:e.get("min")})}};function jJ(n){return{sliderProps:new ge({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new ge({formatter:it(n.formatter),keyScale:n.keyScale,pointerScale:it(n.pointerScale)})}}const NJ={containerUnitSize:"cnt-usz"};function c2(n){return`--${NJ[n]}`}function Yu(n){return WA(n)}function pr(n){if(hf(n))return pt(n,Yu)}function as(n,e){if(!n)return;const t=[],i=GA(n,e);i&&t.push(i);const s=YA(n);return s&&t.push(s),new Lh(t)}function p2(n){if(n==="inline"||n==="popup")return n}function Mh(n,e){n.write(e)}const lc=W("ckb");let BJ=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(lc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(lc("l")),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("input");s.classList.add(lc("i")),s.type="checkbox",this.labelElement.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(lc("w")),this.labelElement.appendChild(r);const o=Pd(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},IJ=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new BJ(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}};function FJ(n){const e=[],t=fg(n.options);return t&&e.push(t),new Lh(e)}Et({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=pt(e,i=>({options:i.optional.custom(Ed),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>a2,constraint:n=>FJ(n.params),writer:n=>Mh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&cp(i,yd);return s?new ia(e,{props:new ge({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new IJ(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof ia?new vg(n.controller):null}});const Qr=W("col");let KJ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Qr()),t.foldable.bindExpandedClass(this.element,Qr(void 0,"expanded")),Ei(t.foldable,"completed",$a(this.element,Qr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Qr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Qr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Qr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Qr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function UJ(n,e,t){const i=Ge(n/255,0,1),s=Ge(e/255,0,1),r=Ge(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function HJ(n,e,t){const i=(n%360+360)%360,s=Ge(e/100,0,1),r=Ge(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function zJ(n,e,t){const i=Ge(n/255,0,1),s=Ge(e/255,0,1),r=Ge(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function d2(n,e,t){const i=zA(n,360),s=Ge(e/100,0,1),r=Ge(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function qJ(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function GJ(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function xi(n){return[n[0],n[1],n[2]]}function xd(n,e){return[n[0],n[1],n[2],e]}const YJ={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:qJ,rgb:HJ},hsv:{hsl:GJ,hsv:(n,e,t)=>[n,e,t],rgb:d2},rgb:{hsl:UJ,hsv:zJ,rgb:(n,e,t)=>[n,e,t]}};function sa(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function XJ(n,e){return n===e?e:zA(n,e)}function m2(n,e,t){var i;const s=sa(e,t);return[e==="rgb"?Ge(n[0],0,s[0]):XJ(n[0],s[0]),Ge(n[1],0,s[1]),Ge(n[2],0,s[2]),Ge((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function TE(n,e,t,i){const s=sa(e,t),r=sa(e,i);return n.map((o,l)=>o/s[l]*r[l])}function v2(n,e,t){const i=TE(n,e.mode,e.type,"int"),s=YJ[e.mode][t.mode](...i);return TE(s,t.mode,"int",t.type)}let ve=class f2{static black(){return new f2([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=m2(e,t,this.type)}getComponents(e){return xd(v2(xi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Zs=W("colp");let WJ=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Zs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Zs("hsv"));const s=e.createElement("div");s.classList.add(Zs("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Zs("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Zs("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Zs("a"));const a=e.createElement("div");a.classList.add(Zs("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Zs("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function ZJ(n){return n==="int"?"int":n==="float"?"float":void 0}function _g(n){return pt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(ZJ)}),expanded:e.optional.boolean,picker:e.optional.custom(p2),readonly:e.optional.constant(!1)}))}function xo(n){return n?.1:1}function w2(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let bg=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=m2(e,t,this.type)}getComponents(e){return xd(v2(xi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const QJ={int:(n,e)=>new ve(n,e),float:(n,e)=>new bg(n,e)};function gg(n,e,t){return QJ[t](n,e)}function JJ(n){return n.type==="float"}function eee(n){return n.type==="int"}function tee(n){const e=n.getComponents(),t=sa(n.mode,"int");return new ve([Math.round(le(e[0],0,1,0,t[0])),Math.round(le(e[1],0,1,0,t[1])),Math.round(le(e[2],0,1,0,t[2])),e[3]],n.mode)}function nee(n){const e=n.getComponents(),t=sa(n.mode,"int");return new bg([le(e[0],0,t[0],0,1),le(e[1],0,t[1],0,1),le(e[2],0,t[2],0,1),e[3]],n.mode)}function Rt(n,e){if(n.type===e)return n;if(eee(n)&&e==="float")return nee(n);if(JJ(n)&&e==="int")return tee(n);throw Eo.shouldNeverHappen()}function iee(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Kn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const see={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function _2(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return see[i](t)}function b2(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Kn(e[1],255),Kn(e[2],255),Kn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function ree(n){const e=b2(n);return e?new ve(e,"rgb"):null}function g2(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Kn(e[1],255),Kn(e[2],255),Kn(e[3],255),Kn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function oee(n){const e=g2(n);return e?new ve(e,"rgb"):null}function C2(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[_2(e[1]),Kn(e[2],100),Kn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function lee(n){const e=C2(n);return e?new ve(e,"hsl"):null}function P2(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[_2(e[1]),Kn(e[2],100),Kn(e[3],100),Kn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function aee(n){const e=P2(n);return e?new ve(e,"hsl"):null}function y2(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function uee(n){const e=y2(n);return e?new ve(e,"rgb"):null}function E2(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),le(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),le(parseInt(t[4],16),0,255,0,1)]:null}function hee(n){const e=E2(n);return e?new ve(e,"rgb"):null}function x2(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function DE(n){return e=>{const t=x2(e);return t?gg(t,"rgb",n):null}}function $2(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function OE(n){return e=>{const t=$2(e);return t?gg(t,"rgb",n):null}}const cee=[{parser:y2,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:E2,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:b2,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:g2,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:C2,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:P2,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:x2,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:$2,result:{alpha:!0,mode:"rgb",notation:"object"}}];function pee(n){return cee.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function dee(n,e="int"){const t=pee(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Th(n){const e=[uee,hee,ree,oee,lee,aee];n==="int"&&e.push(DE("int"),OE("int")),n==="float"&&e.push(DE("float"),OE("float"));const t=LJ(e);return i=>{const s=t(i);return s?Rt(s,n):null}}function mee(n){const e=Th("int");if(typeof n!="string")return ve.black();const t=e(n);return t??ve.black()}function V2(n){const e=Ge(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Cg(n,e="#"){const t=xi(n.getComponents("rgb")).map(V2).join("");return`${e}${t}`}function Pg(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(V2).join("");return`${e}${i}`}function k2(n){const e=sn(0),t=Rt(n,"int");return`rgb(${xi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Tc(n){const e=sn(2),t=sn(0);return`rgba(${Rt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function vee(n){const e=[sn(0),pp,pp],t=Rt(n,"int");return`hsl(${xi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function fee(n){const e=[sn(0),pp,pp,sn(2)];return`hsla(${Rt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function S2(n,e){const t=sn(e==="float"?2:0),i=["r","g","b"],s=Rt(n,e);return`{${xi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function wee(n){return e=>S2(e,n)}function L2(n,e){const t=sn(2),i=sn(e==="float"?2:0),s=["r","g","b","a"];return`{${Rt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function _ee(n){return e=>L2(e,n)}const bee=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Cg},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Pg},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:k2},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Tc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:vee},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:fee},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:wee(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:_ee(e)}],[])];function A2(n){return bee.reduce((e,t)=>e||(iee(t.format,n)?t.stringifier:null),null)}const uu=W("apl");let gee=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(uu()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(uu("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(uu("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(uu("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(uu("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new ve([t[0],t[1],t[2],0],"rgb"),s=new ve([t[0],t[1],t[2],255],"rgb"),r=["to right",Tc(i),Tc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Tc(e);const o=le(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},Cee=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new gee(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ve([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Zt(xo(!0),$s(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ve([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Zt(xo(!0),$s(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const ll=W("coltxt");function Pee(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let yee=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ll()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ll("m")),this.modeElem_=Pee(e),this.modeElem_.classList.add(ll("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(ll("mm")),s.appendChild(Pd(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(ll("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),fs(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){JA(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(ll("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function Eee(n){return sn(n==="float"?2:0)}function xee(n,e,t){const i=sa(n,e)[t];return new gd({min:0,max:i})}function $ee(n,e,t){return new Ah(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:ge.fromObject({formatter:Eee(e.colorType),keyScale:xo(!1),pointerScale:e.colorType==="float"?.01:1}),value:it(0,{constraint:xee(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function Vee(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Ar,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=$ee(n,t,i);return Va({primary:e.value,secondary:s.value,forward(r){return Rt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Rt(r,e.colorType).getComponents(l);u[i]=o;const h=gg(xd(xi(u),u[3]),l,e.colorType);return Rt(h,"int")}}),s})}function kee(n,e){const t=new wg(n,{parser:Th("int"),props:ge.fromObject({formatter:Cg}),value:it(ve.black()),viewProps:e.viewProps});return Va({primary:e.value,secondary:t.value,forward:i=>new ve(xi(i.getComponents()),i.mode),backward:(i,s)=>new ve(xd(xi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function See(n){return n!=="hex"}let Lee=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=it(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new yee(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return See(t)?Vee(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):kee(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const ev=W("hpl");let Aee=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(ev()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(ev("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(ev("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=k2(new ve([t,100,100],"hsv"));const i=le(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},Mee=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Aee(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=le(Ge(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ve([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Zt(xo(!1),$s(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ve([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Zt(xo(!1),$s(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const tv=W("svp"),RE=64;let Tee=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(tv()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=RE,i.width=RE,i.classList.add(tv("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(tv("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=zQ(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const m=le(c,0,s,0,100),d=le(h,0,r,100,0),f=d2(i[0],m,d),p=(h*s+c)*4;l[p]=f[0],l[p+1]=f[1],l[p+2]=f[2],l[p+3]=255}e.putImageData(o,0,0);const a=le(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=le(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},Dee=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Tee(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=le(e.point.x,0,e.bounds.width,0,100),s=le(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ve([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){h2(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=xo(!1),l=Zt(o,$s(e)),a=Zt(o,Gu(e));l===0&&a===0||this.value.setRawValue(new ve([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=xo(!1),i=Zt(t,$s(e)),s=Zt(t,Gu(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Oee=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new Mee(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Dee(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new Cee(e,{value:this.value,viewProps:this.viewProps}),text:new Ah(e,{parser:Ar,props:ge.fromObject({pointerScale:.01,keyScale:.1,formatter:sn(2)}),value:it(0,{constraint:new gd({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Va({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new ve(r,i.mode)}}),this.textsC_=new Lee(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new WJ(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const nv=W("colsw");let Ree=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(nv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(nv("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(nv("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Pg(e)}onValueChange_(){this.update_()}},jee=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ree(e,{value:this.value,viewProps:this.viewProps})}},yg=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=pg.create(t.expanded),this.swatchC_=new jee(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new wg(e,{parser:t.parser,props:ge.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new KJ(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new l2(e,{viewProps:this.viewProps}):null;const s=new Oee(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Va({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),dg(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=e2(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!og(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function Nee(n){return xi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function Bee(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function Iee(n){return new ve([n>>16&255,n>>8&255,n&255],"rgb")}function Fee(n){return new ve([n>>24&255,n>>16&255,n>>8&255,le(n&255,0,255,0,1)],"rgb")}function Kee(n){return typeof n!="number"?ve.black():Iee(n)}function Uee(n){return typeof n!="number"?ve.black():Fee(n)}function Dc(n,e){return typeof n!="object"||Ae(n)?!1:e in n&&typeof n[e]=="number"}function M2(n){return Dc(n,"r")&&Dc(n,"g")&&Dc(n,"b")}function T2(n){return M2(n)&&Dc(n,"a")}function D2(n){return M2(n)}function Eg(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function jE(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function Hee(n){const e=A2(n);return e?(t,i)=>{Mh(t,e(i))}:null}function zee(n){const e=n?Bee:Nee;return(t,i)=>{Mh(t,e(i))}}function qee(n,e,t){const s=Rt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function Gee(n,e,t){const s=Rt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function Yee(n,e){return(t,i)=>{n?qee(t,i,e):Gee(t,i,e)}}function Xee(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function Wee(n){return n?e=>Pg(e,"0x"):e=>Cg(e,"0x")}function Zee(n){return"color"in n||n.view==="color"}Et({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!Zee(e))return null;const t=_g(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:Xee(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?Uee:Kee,equals:Eg,writer:n=>zee(n.params.supportsAlpha)},controller:n=>{var e,t;return new yg(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:Wee(n.params.supportsAlpha),parser:Th("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function Qee(n,e){if(!D2(n))return Rt(ve.black(),e);if(e==="int"){const t=jE(n);return new ve(t,"rgb")}if(e==="float"){const t=jE(n);return new bg(t,"rgb")}return Rt(ve.black(),"int")}function Jee(n){return T2(n)}function ete(n){return e=>{const t=Qee(e,n);return Rt(t,"int")}}function tte(n,e){return t=>n?L2(t,e):S2(t,e)}Et({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!D2(n))return null;const i=_g(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=w2(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>ete(n.params.colorType),equals:Eg,writer:n=>Yee(Jee(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=T2(n.initialValue);return new yg(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:tte(i,n.params.colorType),parser:Th("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});Et({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=dee(n,w2(e));if(!t)return null;const i=A2(t);if(!i)return null;const s=_g(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>mee,equals:Eg,writer:n=>{const e=Hee(n.params.format);if(!e)throw Eo.notBindable();return e}},controller:n=>{var e,t;return new yg(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Th("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let xg=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const NE=W("pndtxt");let nte=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(NE()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(NE("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function ite(n,e,t){return new Ah(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:it(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let $g=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>ite(e,t,s)),this.acs_.forEach((i,s)=>{Va({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new nte(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},ste=class extends rg{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function rte(n,e){const t=[],i=GA(n,e);i&&t.push(i);const s=YA(n);s&&t.push(s);const r=fg(n.options);return r&&t.push(r),new Lh(t)}Et({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=pt(e,i=>Object.assign(Object.assign({},WA(i)),{options:i.optional.custom(Ed),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>HA,constraint:n=>rte(n.params,n.initialValue),writer:n=>Mh},controller:n=>{const e=n.value,t=n.constraint,i=t&&cp(t,yd);if(i)return new ia(n.document,{props:new ge({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=XA(n.params,e.rawValue),r=t&&cp(t,gd);return r?new ME(n.document,Object.assign(Object.assign({},jJ(Object.assign(Object.assign({},s),{keyScale:it(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Ar,value:e,viewProps:n.viewProps})):new Ah(n.document,{parser:Ar,props:ge.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof ME?new ste(n.controller):n.controller.valueController instanceof ia?new vg(n.controller):null}});let Pr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Ae(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const O2={toComponents:n=>n.getComponents(),fromComponents:n=>new Pr(...n)},al=W("p2d");let ote=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(al()),t.viewProps.bindClassModifiers(this.element),fs(t.expanded,$a(this.element,al(void 0,"expanded")));const i=e.createElement("div");i.classList.add(al("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(al("b")),s.appendChild(Pd(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(al("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(al("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Qs=W("p2dp");let lte=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Qs()),t.layout==="popup"&&this.element.classList.add(Qs(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Qs("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(ri,"svg");s.classList.add(Qs("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(ri,"line");r.classList.add(Qs("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(ri,"line");o.classList.add(Qs("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(ri,"line");l.classList.add(Qs("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Qs("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=le(e,-i,+i,0,100),r=le(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function BE(n,e,t){return[Zt(e[0],$s(n)),Zt(e[1],Gu(n))*(t?1:-1)]}let ate=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new lte(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=le(e.point.x,0,e.bounds.width,-i,+i),r=le(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Pr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){h2(e.key)&&e.preventDefault();const[t,i]=BE(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Pr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=BE(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},ute=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=pg.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new l2(e,{viewProps:this.viewProps}):null;const r=new ate(e,{layout:t.pickerLayout,props:new ge({invertsY:it(t.invertsY),max:it(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new $g(e,{assembly:O2,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new ote(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Va({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),dg(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=e2(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!og(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function hte(n){return Pr.isObject(n)?new Pr(n.x,n.y):new Pr}function cte(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function pte(n,e){return new xg({assembly:O2,components:[as(Object.assign(Object.assign({},n),n.x),e.x),as(Object.assign(Object.assign({},n),n.y),e.y)]})}function IE(n,e){var t,i;if(!Ae(n.min)||!Ae(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=qA(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function dte(n,e){var t,i;const s=IE(yo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=IE(yo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function mte(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}Et({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Pr.isObject(n))return null;const t=pt(e,i=>Object.assign(Object.assign({},Yu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(p2),readonly:i.optional.constant(!1),x:i.optional.custom(pr),y:i.optional.object(Object.assign(Object.assign({},Yu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>hte,constraint:n=>pte(n.params,n.initialValue),equals:Pr.equals,writer:()=>cte},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new ute(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return ig({constraint:r.components[a],initialValue:l,params:yo(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:mte(n.params),max:dte(n.params,s.rawValue),parser:Ar,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Rl=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Ae(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const R2={toComponents:n=>n.getComponents(),fromComponents:n=>new Rl(...n)};function vte(n){return Rl.isObject(n)?new Rl(n.x,n.y,n.z):new Rl}function fte(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function wte(n,e){return new xg({assembly:R2,components:[as(Object.assign(Object.assign({},n),n.x),e.x),as(Object.assign(Object.assign({},n),n.y),e.y),as(Object.assign(Object.assign({},n),n.z),e.z)]})}Et({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Rl.isObject(n))return null;const t=pt(e,i=>Object.assign(Object.assign({},Yu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(pr),y:i.optional.custom(pr),z:i.optional.custom(pr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>vte,constraint:n=>wte(n.params,n.initialValue),equals:Rl.equals,writer:n=>fte},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new $g(n.document,{assembly:R2,axes:e.rawValue.getComponents().map((s,r)=>{var o;return ig({constraint:t.components[r],initialValue:s,params:yo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Ar,value:e,viewProps:n.viewProps})}});let jl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Ae(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const j2={toComponents:n=>n.getComponents(),fromComponents:n=>new jl(...n)};function _te(n){return jl.isObject(n)?new jl(n.x,n.y,n.z,n.w):new jl}function bte(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function gte(n,e){return new xg({assembly:j2,components:[as(Object.assign(Object.assign({},n),n.x),e.x),as(Object.assign(Object.assign({},n),n.y),e.y),as(Object.assign(Object.assign({},n),n.z),e.z),as(Object.assign(Object.assign({},n),n.w),e.w)]})}Et({id:"input-point4d",type:"input",accept:(n,e)=>{if(!jl.isObject(n))return null;const t=pt(e,i=>Object.assign(Object.assign({},Yu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(pr),x:i.optional.custom(pr),y:i.optional.custom(pr),z:i.optional.custom(pr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>_te,constraint:n=>gte(n.params,n.initialValue),equals:jl.equals,writer:n=>bte},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new $g(n.document,{assembly:j2,axes:e.rawValue.getComponents().map((s,r)=>{var o;return ig({constraint:t.components[r],initialValue:s,params:yo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Ar,value:e,viewProps:n.viewProps})}});function Cte(n){const e=[],t=fg(n.options);return t&&e.push(t),new Lh(e)}Et({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=pt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Ed)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>u2,constraint:n=>Cte(n.params),writer:n=>Mh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&cp(i,yd);return s?new ia(e,{props:new ge({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new wg(e,{parser:r=>r,props:ge.fromObject({formatter:mf}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof ia?new vg(n.controller):null}});const $d={monitor:{defaultInterval:200,defaultRows:3}},FE=W("mll");let Pte=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(FE()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(FE("i")),i.style.height=`calc(var(${c2("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Vg=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Pte(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const KE=W("sgl");let yte=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(KE()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(KE("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},kg=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new yte(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};Et({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=pt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>a2},controller:n=>{var e;return n.value.rawValue.length===1?new kg(n.document,{formatter:AE,value:n.value,viewProps:n.viewProps}):new Vg(n.document,{formatter:AE,rows:(e=n.params.rows)!==null&&e!==void 0?e:$d.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let Ete=class extends rg{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Js=W("grl");let xte=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Js()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(ri,"svg");i.classList.add(Js("g")),i.style.height=`calc(var(${c2("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(ri,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Js("t"),W("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,s=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach((c,m)=>{if(c===void 0)return;const d=le(m,0,i,0,e),f=le(c,s,r,t,0);o.push([d,f].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const l=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(a===void 0){l.classList.remove(Js("t","a"));return}const u=le(this.cursor_.rawValue,0,i,0,e),h=le(a,s,r,t,0);l.style.left=`${u}px`,l.style.top=`${h}px`,l.textContent=`${this.formatter_(a)}`,l.classList.contains(Js("t","a"))||(l.classList.add(Js("t","a"),Js("t","in")),hp(l),l.classList.remove(Js("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},N2=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=it(-1),this.view=new xte(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!og(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Ko(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Ii(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Fi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(le(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(le(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function vf(n){return Ae(n.format)?sn(2):n.format}function $te(n){var e;return n.value.rawValue.length===1?new kg(n.document,{formatter:vf(n.params),value:n.value,viewProps:n.viewProps}):new Vg(n.document,{formatter:vf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:$d.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function Vte(n){var e,t,i;return new N2(n.document,{formatter:vf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:$d.monitor.defaultRows,props:ge.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function UE(n){return n.view==="graph"}Et({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=pt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>UE(n)?64:1,reader:n=>HA},controller:n=>UE(n.params)?Vte(n):$te(n),api:n=>n.controller.valueController instanceof N2?new Ete(n.controller):null});Et({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=pt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>u2},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Vg(n.document,{formatter:mf,rows:(e=n.params.rows)!==null&&e!==void 0?e:$d.monitor.defaultRows,value:t,viewProps:n.viewProps}):new kg(n.document,{formatter:mf,value:t,viewProps:n.viewProps})}});const HE=W("txtr");class kte{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(HE()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.rows=t.rows,i.cols=22,i.placeholder=t.placeholder,i.classList.add(HE("i")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){this.inputElement.value=this.value_.rawValue}onChange_(){this.refresh()}}class Ste{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.rows=t.rows,this.placeholder=t.placeholder,this.view=new kte(e,{value:this.value,viewProps:this.viewProps,rows:this.rows,placeholder:this.placeholder}),this.view.inputElement.addEventListener("keyup",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value;this.value.rawValue=i,this.view.refresh()}}Et({id:"input-template",type:"input",accept(n,e){if(typeof n!="string")return null;const t=pt(e,i=>({view:i.required.constant("textarea"),rows:i.optional.number,placeholder:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{reader(n){return e=>typeof e=="string"?e:""},writer(n){return(e,t)=>{e.write(t)}}},controller(n){var e,t;return new Ste(n.document,{value:n.value,rows:(e=n.params.rows)!==null&&e!==void 0?e:3,placeholder:(t=n.params.placeholder)!==null&&t!==void 0?t:"Enter text here",viewProps:n.viewProps})}});function Lte(n){let e,t;return e=new Ow({props:{theme:n[4],userCreatedPane:!1,$$slots:{default:[Tte]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&16&&(r.theme=i[4]),s&16399&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function Ate(n){let e,t,i,s;const r=[Ote,Dte],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=Oe()},l(a){t.l(a),i=Oe()},m(a,u){o[e].m(a,u),z(a,i,u),s=!0},p(a,u){t.p(a,u)},i(a){s||(g(t),s=!0)},o(a){C(t),s=!1},d(a){a&&k(i),o[e].d(a)}}}function Mte(n){let e;const t=n[11].default,i=hn(t,n,n[14],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&16384)&&cn(i,t,s,s[14],e?dn(t,s[14],r,null):pn(s[14]),null)},i(s){e||(g(i,s),e=!0)},o(s){C(i,s),e=!1},d(s){i&&i.d(s)}}}function Tte(n){let e,t,i;function s(o){n[13](o)}let r={disabled:n[2],title:n[1],userExpandable:n[3],$$slots:{default:[Mte]},$$scope:{ctx:n}};return n[0]!==void 0&&(r.expanded=n[0]),e=new B2({props:r}),R.push(()=>F(e,"expanded",s)),{c(){M(e.$$.fragment)},l(o){T(e.$$.fragment,o)},m(o,l){D(e,o,l),i=!0},p(o,l){const a={};l&4&&(a.disabled=o[2]),l&2&&(a.title=o[1]),l&8&&(a.userExpandable=o[3]),l&16384&&(a.$$scope={dirty:l,ctx:o}),!t&&l&1&&(t=!0,a.expanded=o[0],I(()=>t=!1)),e.$set(a)},i(o){i||(g(e.$$.fragment,o),i=!0)},o(o){C(e.$$.fragment,o),i=!1},d(o){O(e,o)}}}function Dte(n){let e,t,i,s;e=new ca({props:{keysAdd:["containerUnitSize"],theme:n[4]}});let r=n[0]&&zE(n);return{c(){M(e.$$.fragment),t=Dn(),r&&r.c(),i=Oe()},l(o){T(e.$$.fragment,o),t=On(o),r&&r.l(o),i=Oe()},m(o,l){D(e,o,l),z(o,t,l),r&&r.m(o,l),z(o,i,l),s=!0},p(o,l){const a={};l&16&&(a.theme=o[4]),e.$set(a),o[0]?r?(r.p(o,l),l&1&&g(r,1)):(r=zE(o),r.c(),g(r,1),r.m(i.parentNode,i)):r&&(Ul(),C(r,1,1,()=>{r=null}),Hl())},i(o){s||(g(e.$$.fragment,o),g(r),s=!0)},o(o){C(e.$$.fragment,o),C(r),s=!1},d(o){o&&(k(t),k(i)),O(e,o),r&&r.d(o)}}}function Ote(n){let e,t;const i=n[11].default,s=hn(i,n,n[14],null);return{c(){e=li("div"),s&&s.c(),this.h()},l(r){e=ai(r,"DIV",{style:!0});var o=ui(e);s&&s.l(o),o.forEach(k),this.h()},h(){Be(e,"display","none")},m(r,o){z(r,e,o),s&&s.m(e,null),n[12](e),t=!0},p(r,o){s&&s.p&&(!t||o&16384)&&cn(s,i,r,r[14],t?dn(i,r[14],o,null):pn(r[14]),null)},i(r){t||(g(s,r),t=!0)},o(r){C(s,r),t=!1},d(r){r&&k(e),s&&s.d(r),n[12](null)}}}function zE(n){let e,t,i;e=new ca({props:{keysAdd:["containerVerticalPadding","containerVerticalPadding"],theme:n[4]}});const s=n[11].default,r=hn(s,n,n[14],null);return{c(){M(e.$$.fragment),t=Dn(),r&&r.c()},l(o){T(e.$$.fragment,o),t=On(o),r&&r.l(o)},m(o,l){D(e,o,l),z(o,t,l),r&&r.m(o,l),i=!0},p(o,l){const a={};l&16&&(a.theme=o[4]),e.$set(a),r&&r.p&&(!i||l&16384)&&cn(r,s,o,o[14],i?dn(s,o[14],l,null):pn(o[14]),null)},i(o){i||(g(e.$$.fragment,o),g(r,o),i=!0)},o(o){C(e.$$.fragment,o),C(r,o),i=!1},d(o){o&&k(t),O(e,o),r&&r.d(o)}}}function Rte(n){let e,t,i,s;const r=[Ate,Lte],o=[];function l(a,u){return a[6]?0:1}return e=l(n),t=o[e]=r[e](n),{c(){t.c(),i=Oe()},l(a){t.l(a),i=Oe()},m(a,u){o[e].m(a,u),z(a,i,u),s=!0},p(a,[u]){t.p(a,u)},i(a){s||(g(t),s=!0)},o(a){C(t),s=!1},d(a){a&&k(i),o[e].d(a)}}}function jte(n,e,t){let i,s,{$$slots:r={},$$scope:o}=e,{title:l="Folder"}=e,{disabled:a=!1}=e,{expanded:u=!0}=e,{userExpandable:h=!0}=e,{theme:c=void 0}=e;const m=yl("parentStore");Kl(n,m,P=>t(10,i=P));const d=Sf();Kl(n,d,P=>t(15,s=P));const f=yl("userCreatedPane");let p,v,w;pc("parentStore",d);function _(){e$(d,s=i.addFolder({disabled:a,expanded:u,index:v,title:l}),s),s.on("fold",()=>{t(0,u=s.expanded)}),t(9,w=s)}Cp(()=>{t(8,v=p?nV(p):0)}),gp(()=>{s==null||s.dispose()});function A(P){R[P?"unshift":"push"](()=>{p=P,t(5,p)})}function x(P){u=P,t(0,u)}return n.$$set=P=>{"title"in P&&t(1,l=P.title),"disabled"in P&&t(2,a=P.disabled),"expanded"in P&&t(0,u=P.expanded),"userExpandable"in P&&t(3,h=P.userExpandable),"theme"in P&&t(4,c=P.theme),"$$scope"in P&&t(14,o=P.$$scope)},n.$$.update=()=>{n.$$.dirty&514&&w&&t(9,w.title=l,w),n.$$.dirty&516&&w&&t(9,w.disabled=a,w),n.$$.dirty&513&&w&&u!==void 0&&t(9,w.expanded=u,w),n.$$.dirty&1792&&i&&!w&&v!==void 0&&_(),n.$$.dirty&520&&w&&iV(h,w.element,"tp-fldv_b","tp-fldv_m"),n.$$.dirty&1040&&c&&i&&(f||!tV(i))&&console.warn("Set theme on the <Pane> component, not on its children! (Check nested <Folder> components for a theme prop.)")},[u,l,a,h,c,p,m,d,v,w,i,r,A,x,o]}class B2 extends Ft{constructor(e){super(),Kt(this,e,jte,Rte,It,{title:1,disabled:2,expanded:0,userExpandable:3,theme:4})}}var iv={local:{},session:{}};function Nte(n){return n==="local"?localStorage:sessionStorage}function qE(n,e,t){var i,s;const r=(i=t==null?void 0:t.serializer)!=null?i:JSON,o=(s=t==null?void 0:t.storage)!=null?s:"local",l=typeof window<"u"&&typeof document<"u",a=l?Nte(o):null;function u(h,c){a==null||a.setItem(h,r.stringify(c))}if(!iv[o][n]){const h=Sf(e,d=>{const f=a==null?void 0:a.getItem(n);if(f&&d(r.parse(f)),l&&o=="local"){const p=v=>{v.key===n&&d(v.newValue?r.parse(v.newValue):null)};return window.addEventListener("storage",p),()=>window.removeEventListener("storage",p)}}),{subscribe:c,set:m}=h;iv[o][n]={set(d){u(n,d),m(d)},update(d){return h.update(f=>{const p=d(f);return u(n,p),p})},subscribe:c}}return iv[o][n]}const{window:Bte}=cD;function Ite(n){let e;const t=n[25].default,i=hn(t,n,n[32],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r[1]&2)&&cn(i,t,s,s[32],e?dn(t,s[32],r,null):pn(s[32]),null)},i(s){e||(g(i,s),e=!0)},o(s){C(i,s),e=!1},d(s){i&&i.d(s)}}}function Fte(n){let e,t,i,s,r,o=`${n[2]}px`,l=`${n[3]}px`,a=`${n[4]}px`,u,h,c;const m=[{scale:n[8]},{title:n[7]},$r(n[16],"position")];function d(v){n[26](v)}function f(v){n[27](v)}let p={$$slots:{default:[Ite]},$$scope:{ctx:n}};for(let v=0;v<m.length;v+=1)p=ye(p,m[v]);return n[1]!==void 0&&(p.expanded=n[1]),n[0]!==void 0&&(p.tpPane=n[0]),t=new Dw({props:p}),R.push(()=>F(t,"expanded",d)),R.push(()=>F(t,"tpPane",f)),{c(){e=li("div"),M(t.$$.fragment),this.h()},l(v){e=ai(v,"DIV",{class:!0});var w=ui(e);T(t.$$.fragment,w),w.forEach(k),this.h()},h(){dc(e,"class","draggable-container svelte-2rtd0r"),XT(()=>n[28].call(e)),Zh(e,"not-collapsable",!n[6]),Zh(e,"not-resizable",!n[5]),Be(e,"left",o),Be(e,"padding",n[9]),Be(e,"top",l),Be(e,"width",a),Be(e,"z-index",n[14])},m(v,w){z(v,e,w),D(t,e,null),r=WT(e,n[28].bind(e)),n[29](e),u=!0,h||(c=[Hd(Bte,"resize",n[15]),Hd(e,"focus",n[30],!0),Hd(e,"pointerdown",n[31],!0)],h=!0)},p(v,w){const _=w[0]&65920?Li(m,[w[0]&256&&{scale:v[8]},w[0]&128&&{title:v[7]},w[0]&65536&&Ai($r(v[16],"position"))]):{};w[1]&2&&(_.$$scope={dirty:w,ctx:v}),!i&&w[0]&2&&(i=!0,_.expanded=v[1],I(()=>i=!1)),!s&&w[0]&1&&(s=!0,_.tpPane=v[0],I(()=>s=!1)),t.$set(_),(!u||w[0]&64)&&Zh(e,"not-collapsable",!v[6]),(!u||w[0]&32)&&Zh(e,"not-resizable",!v[5]),w[0]&4&&o!==(o=`${v[2]}px`)&&Be(e,"left",o),w[0]&512&&Be(e,"padding",v[9]),w[0]&8&&l!==(l=`${v[3]}px`)&&Be(e,"top",l),w[0]&16&&a!==(a=`${v[4]}px`)&&Be(e,"width",a),w[0]&16384&&Be(e,"z-index",v[14])},i(v){u||(g(t.$$.fragment,v),u=!0)},o(v){C(t.$$.fragment,v),u=!1},d(v){v&&k(e),O(t),r(),n[29](null),h=!1,ZT(c)}}}const ac="svelte-tweakpane-ui-draggable-position-",Kte="1",ul=[];let sv=1e3;function Ute(n,e,t){let i;const s=["storePositionLocally","localStoreId","tpPane","expanded","collapseChildrenToFit","x","y","width","resizable","userExpandable","minWidth","maxWidth","title","scale","padding"];let r=bt(e,s),o,l=ft,a=()=>(l(),l=QT(f,b=>t(40,o=b)),f);n.$$.on_destroy.push(()=>l());let{$$slots:u={},$$scope:h}=e,{storePositionLocally:c=!0}=e,{localStoreId:m=Kte}=e,{tpPane:d=void 0}=e,f;c&&a(f=qE(`${ac}${m}`,{x:0,y:0,expanded:!0,width:350}));let{expanded:p=(o==null?void 0:o.expanded)??!0}=e,{collapseChildrenToFit:v=!1}=e,{x:w=(o==null?void 0:o.x)??0}=e,{y:_=(o==null?void 0:o.y)??0}=e,{width:A=(o==null?void 0:o.width)??256}=e,{resizable:x=!0}=e,{userExpandable:P=!0}=e,{minWidth:qt=200}=e,{maxWidth:Yn=600}=e,{title:V="Tweakpane"}=e,{scale:Nr=1}=e,{padding:zh="0"}=e,Pn,Vt,Ke,Br,qi,Ir,y,Ls,Fd=sv;function RT(){m!==void 0&&(ul.includes(m)&&console.warn('Multiple instances of <Pane> with `mode="draggable"` and `storePositionLocally=true` detected. You must explicitly set unique localStoreId property on each component to avoid collisions.'),ul.push(m))}function jT(){m&&(ul.splice(ul.indexOf(m),1),localStorage.removeItem(`${ac}${m}`))}function NT(b){b!==void 0&&f!==void 0&&p!==void 0&&A!==void 0&&w!==void 0&&_!==void 0&&a(t(10,f=qE(`${ac}${m}`,{x:w,y:_,expanded:p,width:A})))}function MC(){if(w!==void 0&&_!==void 0&&A!==void 0){const b=y,yn=Ls;t(23,y=document.documentElement.clientWidth),t(24,Ls=document.documentElement.clientHeight);const ti=y-b,Ma=Ls-yn,qT=(w+A/2)/y,GT=(_+qi/2)/Ls;!Number.isNaN(ti)&&qT>=.5&&t(2,w+=ti),!Number.isNaN(Ma)&&GT>=.5&&t(3,_+=Ma)}}const qh=b=>{b.stopPropagation()};let TC=0,Kd=0,DC=0,Ud=0;const Gh=b=>{b.stopPropagation(),b.target&&A!==void 0&&b.target===Ke&&t(4,A=A<i?i:qt)},Yh=b=>{w!==void 0&&_!==void 0&&b.button===0&&b.target instanceof HTMLElement&&(Ud=0,b.target.setPointerCapture(b.pointerId),b.target.addEventListener("pointermove",Xh),b.target.addEventListener("pointerup",Wh),TC=A??0,Kd=w-b.pageX,DC=_-b.pageY)},Xh=b=>{b.target instanceof HTMLElement&&A!==void 0&&qt!==void 0&&w!==void 0&&_!==void 0&&(b.target===Vt?(Ud+=Math.hypot(b.movementX,b.movementY),t(2,w=b.pageX+Kd),t(3,_=b.pageY+DC)):b.target===Ke&&t(4,A=Jd(b.pageX+Kd+TC-w,qt,i)))},Wh=b=>{b.stopImmediatePropagation(),b.target instanceof HTMLElement&&(b.target.releasePointerCapture(b.pointerId),b.target.removeEventListener("pointermove",Xh),b.target.removeEventListener("pointerup",Wh),b.target===Vt&&Ud<3&&P&&d&&t(0,d.expanded=!d.expanded,d))},OC=b=>{b.preventDefault()};Cp(()=>{var yn;MC(),d?Pn.append(d.element):console.warn("no tpPane in draggable"),Pn.addEventListener("touchmove",OC,{passive:!1});const b=Pn.querySelector(".tp-rotv_t");b&&(Vt=b,Vt.addEventListener("click",qh),Vt.addEventListener("dblclick",Gh),Vt.addEventListener("pointerdown",Yh),Ke=(yn=Vt.parentElement)==null?void 0:yn.appendChild(document.createElement("div")),Ke&&(Ke.className="tp-custom-width-handle",Ke.textContent="↔",Ke.addEventListener("click",qh),Ke.addEventListener("dblclick",Gh),Ke.addEventListener("pointerdown",Yh)))}),gp(()=>{Vt&&(Vt.removeEventListener("click",qh),Vt.removeEventListener("dblclick",Gh),Vt.removeEventListener("pointerdown",Yh),Vt.removeEventListener("pointermove",Xh),Vt.removeEventListener("pointerup",Wh)),Ke&&(Ke.removeEventListener("click",qh),Ke.removeEventListener("dblclick",Gh),Ke.removeEventListener("pointerdown",Yh),Ke.removeEventListener("pointermove",Xh),Ke.removeEventListener("pointerup",Wh)),Pn&&Pn.removeEventListener("touchmove",OC),m!==void 0&&ul.splice(ul.indexOf(m),1)});function BT(b){Ke&&(Ke.style.display=b?"block":"none")}function RC(b,yn=Number.MAX_SAFE_INTEGER){if(yn>0)for(const ti of b)if("expanded"in ti)ti.expanded&&(yn--,ti.expanded=!1),"children"in ti&&RC(ti.children,yn);else{const Ma=Yj(ti);Ma&&Gj(ti)&&(yn--,Ma.click())}}function IT(b){p=b,t(1,p)}function FT(b){d=b,t(0,d)}function KT(){Br=this.clientHeight,Ir=this.clientWidth,t(12,Br),t(13,Ir)}function UT(b){R[b?"unshift":"push"](()=>{Pn=b,t(11,Pn)})}const HT=()=>{t(14,Fd=++sv)},zT=()=>{t(14,Fd=++sv)};return n.$$set=b=>{e=ye(ye({},e),hi(b)),t(16,r=bt(e,s)),"storePositionLocally"in b&&t(17,c=b.storePositionLocally),"localStoreId"in b&&t(18,m=b.localStoreId),"tpPane"in b&&t(0,d=b.tpPane),"expanded"in b&&t(1,p=b.expanded),"collapseChildrenToFit"in b&&t(19,v=b.collapseChildrenToFit),"x"in b&&t(2,w=b.x),"y"in b&&t(3,_=b.y),"width"in b&&t(4,A=b.width),"resizable"in b&&t(5,x=b.resizable),"userExpandable"in b&&t(6,P=b.userExpandable),"minWidth"in b&&t(20,qt=b.minWidth),"maxWidth"in b&&t(21,Yn=b.maxWidth),"title"in b&&t(7,V=b.title),"scale"in b&&t(8,Nr=b.scale),"padding"in b&&t(9,zh=b.padding),"$$scope"in b&&t(32,h=b.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&33&&d&&x&&BT(x),n.$$.dirty[0]&6400&&Pn)if(Nr===void 0||Nr===1)t(22,qi=Br);else{const b=window.getComputedStyle(Pn),yn=Number.parseFloat(b.paddingTop)+Number.parseFloat(b.paddingBottom);t(22,qi=(Br-yn)*Nr+yn)}n.$$.dirty[0]&33038365&&qi!==void 0&&y!==void 0&&Ls!==void 0&&w!==void 0&&_!==void 0&&A!==void 0&&qt!==void 0&&Yn!==void 0&&(v&&qi>Ls&&d&&RC(d.children),t(2,w=Jd(w,0,Math.max(0,y-Ir))),t(3,_=Jd(_,0,Math.max(0,Ls-qi))),y<Ir&&t(4,A=Math.max(qt,Math.min(Yn,y)))),n.$$.dirty[0]&10485764&&(i=Math.min(Yn??600,y-(w??0))),n.$$.dirty[0]&393216&&c&&RT(),n.$$.dirty[0]&393216&&!c&&jT(),n.$$.dirty[0]&262144&&m!==`${ac}${m}`&&NT(m),n.$$.dirty[0]&394270&&c&&m!==void 0&&w!==void 0&&_!==void 0&&A!==void 0&&p!==void 0&&(f==null||f.set({x:w,y:_,expanded:p,width:A}))},[d,p,w,_,A,x,P,V,Nr,zh,f,Pn,Br,Ir,Fd,MC,r,c,m,v,qt,Yn,qi,y,Ls,u,IT,FT,KT,UT,HT,zT,h]}class Hte extends Ft{constructor(e){super(),Kt(this,e,Ute,Fte,It,{storePositionLocally:17,localStoreId:18,tpPane:0,expanded:1,collapseChildrenToFit:19,x:2,y:3,width:4,resizable:5,userExpandable:6,minWidth:20,maxWidth:21,title:7,scale:8,padding:9},null,[-1,-1])}}function zte(n){let e;const t=n[8].default,i=hn(t,n,n[11],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&2048)&&cn(i,t,s,s[11],e?dn(t,s[11],r,null):pn(s[11]),null)},i(s){e||(g(i,s),e=!0)},o(s){C(i,s),e=!1},d(s){i&&i.d(s)}}}function qte(n){let e,t,i,s,r;const o=[{title:n[2]},$r(n[3],"position")];function l(h){n[9](h)}function a(h){n[10](h)}let u={$$slots:{default:[zte]},$$scope:{ctx:n}};for(let h=0;h<o.length;h+=1)u=ye(u,o[h]);return n[1]!==void 0&&(u.expanded=n[1]),n[0]!==void 0&&(u.tpPane=n[0]),t=new Dw({props:u}),R.push(()=>F(t,"expanded",l)),R.push(()=>F(t,"tpPane",a)),{c(){e=li("div"),M(t.$$.fragment),this.h()},l(h){e=ai(h,"DIV",{style:!0});var c=ui(e);T(t.$$.fragment,c),c.forEach(k),this.h()},h(){Be(e,"display","none")},m(h,c){z(h,e,c),D(t,e,null),r=!0},p(h,[c]){const m=c&12?Li(o,[c&4&&{title:h[2]},c&8&&Ai($r(h[3],"position"))]):{};c&2048&&(m.$$scope={dirty:c,ctx:h}),!i&&c&2&&(i=!0,m.expanded=h[1],I(()=>i=!1)),!s&&c&1&&(s=!0,m.tpPane=h[0],I(()=>s=!1)),t.$set(m)},i(h){r||(g(t.$$.fragment,h),r=!0)},o(h){C(t.$$.fragment,h),r=!1},d(h){h&&k(e),O(t)}}}function Gte(n,e,t){const i=["expanded","x","y","width","title","tpPane"];let s=bt(e,i),{$$slots:r={},$$scope:o}=e,{expanded:l=void 0}=e,{x:a=void 0}=e,{y:u=void 0}=e,{width:h=void 0}=e,{title:c="Tweakpane"}=e,{tpPane:m=void 0}=e,d;function f(v){l=v,t(1,l)}function p(v){m=v,t(0,m)}return n.$$set=v=>{e=ye(ye({},e),hi(v)),t(3,s=bt(e,i)),"expanded"in v&&t(1,l=v.expanded),"x"in v&&t(4,a=v.x),"y"in v&&t(5,u=v.y),"width"in v&&t(6,h=v.width),"title"in v&&t(2,c=v.title),"tpPane"in v&&t(0,m=v.tpPane),"$$scope"in v&&t(11,o=v.$$scope)},n.$$.update=()=>{n.$$.dirty&1&&m!=null&&m.element.parentElement&&t(7,d=m.element.parentElement),n.$$.dirty&144&&d!==void 0&&a!==void 0&&(d.style.setProperty("right","unset"),d.style.setProperty("left",`${a}px`)),n.$$.dirty&160&&d!==void 0&&u!==void 0&&d.style.setProperty("top",`${u}px`),n.$$.dirty&192&&d!==void 0&&h!==void 0&&d.style.setProperty("width",`${h}px`)},[m,l,c,s,a,u,h,d,r,f,p,o]}class Yte extends Ft{constructor(e){super(),Kt(this,e,Gte,qte,It,{expanded:1,x:4,y:5,width:6,title:2,tpPane:0})}}function Xte(n){let e,t,i,s;const r=[Jte,Qte],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=Oe()},l(a){t.l(a),i=Oe()},m(a,u){o[e].m(a,u),z(a,i,u),s=!0},p(a,u){t.p(a,u)},i(a){s||(g(t),s=!0)},o(a){C(t),s=!1},d(a){a&&k(i),o[e].d(a)}}}function Wte(n){let e,t,i,s;const r=[{width:n[1]},$r(n[6],"storePositionLocally")];function o(u){n[13](u)}function l(u){n[14](u)}let a={$$slots:{default:[tne]},$$scope:{ctx:n}};for(let u=0;u<r.length;u+=1)a=ye(a,r[u]);return n[0]!==void 0&&(a.expanded=n[0]),n[2]!==void 0&&(a.tpPane=n[2]),e=new Ow({props:a}),R.push(()=>F(e,"expanded",o)),R.push(()=>F(e,"tpPane",l)),{c(){M(e.$$.fragment)},l(u){T(e.$$.fragment,u)},m(u,h){D(e,u,h),s=!0},p(u,h){const c=h&66?Li(r,[h&2&&{width:u[1]},h&64&&Ai($r(u[6],"storePositionLocally"))]):{};h&524288&&(c.$$scope={dirty:h,ctx:u}),!t&&h&1&&(t=!0,c.expanded=u[0],I(()=>t=!1)),!i&&h&4&&(i=!0,c.tpPane=u[2],I(()=>i=!1)),e.$set(c)},i(u){s||(g(e.$$.fragment,u),s=!0)},o(u){C(e.$$.fragment,u),s=!1},d(u){O(e,u)}}}function Zte(n){let e,t,i,s;const r=[ine,nne],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=Oe()},l(a){t.l(a),i=Oe()},m(a,u){o[e].m(a,u),z(a,i,u),s=!0},p(a,u){t.p(a,u)},i(a){s||(g(t),s=!0)},o(a){C(t),s=!1},d(a){a&&k(i),o[e].d(a)}}}function Qte(n){let e,t;const i=n[7].default,s=hn(i,n,n[19],null);return{c(){e=li("div"),s&&s.c(),this.h()},l(r){e=ai(r,"DIV",{style:!0});var o=ui(e);s&&s.l(o),o.forEach(k),this.h()},h(){Be(e,"display","none")},m(r,o){z(r,e,o),s&&s.m(e,null),t=!0},p(r,o){s&&s.p&&(!t||o&524288)&&cn(s,i,r,r[19],t?dn(i,r[19],o,null):pn(r[19]),null)},i(r){t||(g(s,r),t=!0)},o(r){C(s,r),t=!1},d(r){r&&k(e),s&&s.d(r)}}}function Jte(n){let e,t,i,s,r,o;const l=[{width:n[1]},n[6]];function a(d){n[15](d)}function u(d){n[16](d)}function h(d){n[17](d)}function c(d){n[18](d)}let m={$$slots:{default:[ene]},$$scope:{ctx:n}};for(let d=0;d<l.length;d+=1)m=ye(m,l[d]);return n[0]!==void 0&&(m.expanded=n[0]),n[2]!==void 0&&(m.tpPane=n[2]),n[3]!==void 0&&(m.x=n[3]),n[4]!==void 0&&(m.y=n[4]),e=new Yte({props:m}),R.push(()=>F(e,"expanded",a)),R.push(()=>F(e,"tpPane",u)),R.push(()=>F(e,"x",h)),R.push(()=>F(e,"y",c)),{c(){M(e.$$.fragment)},l(d){T(e.$$.fragment,d)},m(d,f){D(e,d,f),o=!0},p(d,f){const p=f&66?Li(l,[f&2&&{width:d[1]},f&64&&Ai(d[6])]):{};f&524288&&(p.$$scope={dirty:f,ctx:d}),!t&&f&1&&(t=!0,p.expanded=d[0],I(()=>t=!1)),!i&&f&4&&(i=!0,p.tpPane=d[2],I(()=>i=!1)),!s&&f&8&&(s=!0,p.x=d[3],I(()=>s=!1)),!r&&f&16&&(r=!0,p.y=d[4],I(()=>r=!1)),e.$set(p)},i(d){o||(g(e.$$.fragment,d),o=!0)},o(d){C(e.$$.fragment,d),o=!1},d(d){O(e,d)}}}function ene(n){let e;const t=n[7].default,i=hn(t,n,n[19],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&524288)&&cn(i,t,s,s[19],e?dn(t,s[19],r,null):pn(s[19]),null)},i(s){e||(g(i,s),e=!0)},o(s){C(i,s),e=!1},d(s){i&&i.d(s)}}}function tne(n){let e;const t=n[7].default,i=hn(t,n,n[19],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&524288)&&cn(i,t,s,s[19],e?dn(t,s[19],r,null):pn(s[19]),null)},i(s){e||(g(i,s),e=!0)},o(s){C(i,s),e=!1},d(s){i&&i.d(s)}}}function nne(n){let e,t;const i=n[7].default,s=hn(i,n,n[19],null);return{c(){e=li("div"),s&&s.c(),this.h()},l(r){e=ai(r,"DIV",{style:!0});var o=ui(e);s&&s.l(o),o.forEach(k),this.h()},h(){Be(e,"display","none")},m(r,o){z(r,e,o),s&&s.m(e,null),t=!0},p(r,o){s&&s.p&&(!t||o&524288)&&cn(s,i,r,r[19],t?dn(i,r[19],o,null):pn(r[19]),null)},i(r){t||(g(s,r),t=!0)},o(r){C(s,r),t=!1},d(r){r&&k(e),s&&s.d(r)}}}function ine(n){let e,t,i,s,r,o,l;const a=[n[6]];function u(p){n[8](p)}function h(p){n[9](p)}function c(p){n[10](p)}function m(p){n[11](p)}function d(p){n[12](p)}let f={$$slots:{default:[sne]},$$scope:{ctx:n}};for(let p=0;p<a.length;p+=1)f=ye(f,a[p]);return n[0]!==void 0&&(f.expanded=n[0]),n[2]!==void 0&&(f.tpPane=n[2]),n[1]!==void 0&&(f.width=n[1]),n[3]!==void 0&&(f.x=n[3]),n[4]!==void 0&&(f.y=n[4]),e=new Hte({props:f}),R.push(()=>F(e,"expanded",u)),R.push(()=>F(e,"tpPane",h)),R.push(()=>F(e,"width",c)),R.push(()=>F(e,"x",m)),R.push(()=>F(e,"y",d)),{c(){M(e.$$.fragment)},l(p){T(e.$$.fragment,p)},m(p,v){D(e,p,v),l=!0},p(p,v){const w=v&64?Li(a,[Ai(p[6])]):{};v&524288&&(w.$$scope={dirty:v,ctx:p}),!t&&v&1&&(t=!0,w.expanded=p[0],I(()=>t=!1)),!i&&v&4&&(i=!0,w.tpPane=p[2],I(()=>i=!1)),!s&&v&2&&(s=!0,w.width=p[1],I(()=>s=!1)),!r&&v&8&&(r=!0,w.x=p[3],I(()=>r=!1)),!o&&v&16&&(o=!0,w.y=p[4],I(()=>o=!1)),e.$set(w)},i(p){l||(g(e.$$.fragment,p),l=!0)},o(p){C(e.$$.fragment,p),l=!1},d(p){O(e,p)}}}function sne(n){let e;const t=n[7].default,i=hn(t,n,n[19],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&524288)&&cn(i,t,s,s[19],e?dn(t,s[19],r,null):pn(s[19]),null)},i(s){e||(g(i,s),e=!0)},o(s){C(i,s),e=!1},d(s){i&&i.d(s)}}}function rne(n){let e,t,i,s;const r=[Zte,Wte,Xte],o=[];function l(a,u){return a[5]===void 0||a[5]==="draggable"?0:a[5]==="inline"?1:a[5]==="fixed"?2:-1}return~(e=l(n))&&(t=o[e]=r[e](n)),{c(){t&&t.c(),i=Oe()},l(a){t&&t.l(a),i=Oe()},m(a,u){~e&&o[e].m(a,u),z(a,i,u),s=!0},p(a,[u]){let h=e;e=l(a),e===h?~e&&o[e].p(a,u):(t&&(Ul(),C(o[h],1,1,()=>{o[h]=null}),Hl()),~e?(t=o[e],t?t.p(a,u):(t=o[e]=r[e](a),t.c()),g(t,1),t.m(i.parentNode,i)):t=null)},i(a){s||(g(t),s=!0)},o(a){C(t),s=!1},d(a){a&&k(i),~e&&o[e].d(a)}}}function one(n,e,t){const i=["expanded","position","width","tpPane","x","y"];let s=bt(e,i),{$$slots:r={},$$scope:o}=e,{expanded:l=void 0}=e,{position:a=void 0}=e,{width:u=void 0}=e,{tpPane:h=void 0}=e,{x:c=void 0}=e,{y:m=void 0}=e;JT(()=>{(e.position==="inline"||e.position==="fixed")&&(t(3,c=e.x),t(4,m=e.y),t(1,u=e.width),t(0,l=e.expanded))});function d(V){l=V,t(0,l)}function f(V){h=V,t(2,h)}function p(V){u=V,t(1,u)}function v(V){c=V,t(3,c)}function w(V){m=V,t(4,m)}function _(V){l=V,t(0,l)}function A(V){h=V,t(2,h)}function x(V){l=V,t(0,l)}function P(V){h=V,t(2,h)}function qt(V){c=V,t(3,c)}function Yn(V){m=V,t(4,m)}return n.$$set=V=>{t(20,e=ye(ye({},e),hi(V))),t(6,s=bt(e,i)),"expanded"in V&&t(0,l=V.expanded),"position"in V&&t(5,a=V.position),"width"in V&&t(1,u=V.width),"tpPane"in V&&t(2,h=V.tpPane),"x"in V&&t(3,c=V.x),"y"in V&&t(4,m=V.y),"$$scope"in V&&t(19,o=V.$$scope)},e=hi(e),[l,u,h,c,m,a,s,r,d,f,p,v,w,_,A,x,P,qt,Yn,o]}class lne extends Ft{constructor(e){super(),Kt(this,e,one,rne,It,{expanded:0,position:5,width:1,tpPane:2,x:3,y:4})}}function Me(n){return n==null}function Sg(n){return n!==null&&typeof n=="object"}function ff(n){return n!==null&&typeof n=="object"}function ane(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function $o(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return ff(r)&&ff(o)?Object.assign(Object.assign({},i),{[s]:$o(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function une(n){return Sg(n)?"target"in n:!1}const hne={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let Vo=class Pl{static alreadyDisposed(){return new Pl({type:"alreadydisposed"})}static notBindable(){return new Pl({type:"notbindable"})}static notCompatible(e,t){return new Pl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new Pl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Pl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=hne[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},GE=class I2{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!I2.isBindable(i))throw Vo.notBindable();if(!(e in i))throw Vo.propertyNotFound(e);i[e]=t}},zt=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},cne=class{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new zt,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},pne=class{constructor(e){this.emitter=new zt,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},dne=class{constructor(e){this.emitter=new zt,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function st(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new pne(n):new cne(n,e)}function mne(n){return[new dne(n),(e,t)=>{n.setRawValue(e,t)}]}let we=class F2{constructor(e){this.emitter=new zt,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:st(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new F2(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},Vd=class{constructor(e){this.values=we.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},vne=class{constructor(e){this.values=we.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Me(i)||(s=Math.max(s,i)),Me(t)||(s=Math.min(s,t)),s}},fne=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},wne=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const _ne={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let bne=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=_ne[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const gne={"+":n=>n,"-":n=>-n,"~":n=>~n};let Cne=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=gne[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function Lg(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Xu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Pne(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Wu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function yne(n,e){const t=Wu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Wu(n,e);return s===""?"":i+s}function Ag(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=yne(n,e);return i===""?"":t+i}function K2(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=Pne(n,e);return e+=i.length,i===""?"":i+Wu(n,e)}function Ene(n,e){const t=K2(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Wu(n,e);return e+=s.length,t+i+s+Ag(n,e)}function xne(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Wu(n,e);return e+=i.length,i===""?"":t+i+Ag(n,e)}function $ne(n,e){const t=K2(n,e);return e+=t.length,t===""?"":t+Ag(n,e)}const Vne=Lg([Ene,xne,$ne]);function kne(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Sne(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=kne(n,e);return i===""?"":t+i}function Lne(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Ane(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=Lne(n,e);return i===""?"":t+i}function Mne(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Tne(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=Mne(n,e);return i===""?"":t+i}const Dne=Lg([Sne,Ane,Tne]),One=Lg([Dne,Vne]);function Rne(n,e){const t=One(n,e);return e+=t.length,t===""?null:{evaluable:new wne(t),cursor:e}}function jne(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=H2(n,e);if(!i)return null;e=i.cursor,e+=Xu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function Nne(n,e){var t;return(t=Rne(n,e))!==null&&t!==void 0?t:jne(n,e)}function U2(n,e){const t=Nne(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=U2(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new Cne(i,s.evaluable)}):null}function Bne(n,e,t){t+=Xu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Xu(e,t).length,{cursor:t,operator:i}):null}function Ine(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=Bne(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new bne(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const Fne=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>Ine(n,e),U2);function H2(n,e){return e+=Xu(n,e).length,Fne(n,e)}function Kne(n){const e=H2(n,0);return!e||e.cursor+Xu(n,e.cursor).length!==n.length?null:e.evaluable}function Mr(n){var e;const t=Kne(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function z2(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Mr(n);if(!Me(e))return e}return 0}function rn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function ae(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function YE(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ye(n,e,t){return Math.min(Math.max(n,e),t)}function q2(n,e){return(n%e+e)%e}function Une(n,e){return Me(n.step)?Math.max(YE(e),2):YE(n.step)}function G2(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function Hne(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function Y2(n,e){return Me(n.step)?null:new fne(n.step,e)}function X2(n){return!Me(n.max)&&!Me(n.min)?new Vd({max:n.max,min:n.min}):!Me(n.max)||!Me(n.min)?new vne({max:n.max,min:n.min}):null}function W2(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:rn(Une(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:G2(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:Hne(n,e)}}function Z2(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function Mg(n){return{constraint:n.constraint,textProps:we.fromObject(W2(n.params,n.initialValue))}}let kd=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Sd=class{constructor(e){this.target=e}},Q2=class extends Sd{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},zne=class extends Sd{constructor(e,t){super(e),this.expanded=t}},qne=class extends Sd{constructor(e,t){super(e),this.index=t}},Tg=class extends kd{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new zt,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new Q2(this,t.binding.target.read(),e.options.last))}};function Gne(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function Yne(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function Xne(n){return n===null?!1:typeof n=="object"}function es(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function XE(n){return{custom:e=>es(e)(n),boolean:es(e=>typeof e=="boolean"?e:void 0)(n),number:es(e=>typeof e=="number"?e:void 0)(n),string:es(e=>typeof e=="string"?e:void 0)(n),function:es(e=>typeof e=="function"?e:void 0)(n),constant:e=>es(t=>t===e?e:void 0)(n),raw:es(e=>e)(n),object:e=>es(t=>{if(Xne(t))return Gne(t,e)})(n),array:e=>es(t=>{if(Array.isArray(t))return Yne(t,e)})(n)}}const wf={optional:XE(!0),required:XE(!1)};function dt(n,e){const t=e(wf),i=wf.required.object(t)(n);return i.succeeded?i.value:void 0}function Ki(n,e,t,i){if(e&&!e(n))return!1;const s=dt(n,t);return s?i(s):!1}function Ui(n,e){var t;return $o((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function Oc(n){return"value"in n}function Wne(n){if(!Sg(n)||!("binding"in n))return!1;const e=n.binding;return une(e)}const oi="http://www.w3.org/2000/svg";function dp(n){n.offsetHeight}function Zne(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function Dg(n){return n.ontouchstart!==void 0}function Qne(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const Jne={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ld(n,e){const t=n.createElementNS(oi,"svg");return t.innerHTML=Jne[e],t}function J2(n,e,t){n.insertBefore(e,n.children[t])}function Og(n){n.parentElement&&n.parentElement.removeChild(n)}function eM(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function eie(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function tM(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function ws(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function $i(n,e,t){ws(n.value(e),t)}const tie="tp";function Z(n){return(t,i)=>[tie,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const hu=Z("lbl");function nie(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let iie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(hu()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(hu("l")),$i(t.props,"label",r=>{Me(r)?this.element.classList.add(hu(void 0,"nol")):(this.element.classList.remove(hu(void 0,"nol")),eie(i),i.appendChild(nie(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(hu("v")),this.element.appendChild(s),this.valueElement=s}},nM=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new iie(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Ki(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Ui(null,{label:this.props.get("label")})}};function sie(){return["veryfirst","first","last","verylast"]}const WE=Z(""),ZE={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let Rg=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{sie().forEach(i=>{t.classList.remove(WE(void 0,ZE[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(WE(void 0,ZE[i]))})}),this.viewProps.handleDispose(()=>{Og(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Ki(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Ui(null,Object.assign({},this.viewProps.exportState()))}},rie=class extends kd{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new Sd(this))}),this}};function oie(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function ka(n,e){return t=>{oie(n,e,t)}}function jg(n,e){ws(n,t=>{e.textContent=t??""})}const rv=Z("btn");let lie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(rv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(rv("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(rv("t")),jg(t.props.value("title"),s),this.buttonElement.appendChild(s)}},aie=class{constructor(e,t){this.emitter=new zt,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new lie(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Ki(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Ui(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},QE=class extends Rg{constructor(e,t){const i=new aie(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new nM(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Ki(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Ui(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},uie=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const hie=new uie("2.0.1");function xt(n){return Object.assign({core:hie},n)}xt({id:"button",type:"blade",accept(n){const e=dt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new QE(n.document,{blade:n.blade,buttonProps:we.fromObject({title:n.params.title}),labelProps:we.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof QE?new rie(n.controller):null}});function cie(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function pie(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function die(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function mie(n){return Sg(n)?"refresh"in n&&typeof n.refresh=="function":!1}function vie(n,e){if(!GE.isBindable(n))throw Vo.notBindable();return new GE(n,e)}let fie=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new zt,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,vie(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return pie(this,e)}addButton(e){return cie(this,e)}addTab(e){return die(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{mie(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=Wne(t.value)?t.value.binding:null;this.emitter_.emit("change",new Q2(i,s?s.target.read():t.value.rawValue,e.options.last))}},Ng=class extends kd{constructor(e,t){super(e),this.rackApi_=new fie(e.rackController,t)}refresh(){this.rackApi_.refresh()}},Bg=class extends Rg{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Ki(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Ui(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function _f(n){return"rackController"in n}let wie=class{constructor(e){this.emitter=new zt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Vo.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function _ie(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Oc(i)&&i.value===e)return i}return null}function bie(n){return _f(n)?n.rackController.rack.bcSet_:null}let gie=class{constructor(e){var t,i;this.emitter=new zt,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new wie(bie),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Oc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(_f(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Oc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(_f(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=_ie(this.find(Oc),e.sender);if(!t)throw Vo.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Ig=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new gie({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&J2(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Og(e.bladeController.view.element)}};function iM(){return new we({positions:st([],{equals:ane})})}let Fg=class sM extends we{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=we.createCore(t);return new sM(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Me(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};$i(this,"expanded",i),$i(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function Cie(n,e){let t=0;return Zne(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),dp(e),t=e.clientHeight,n.set("temporaryExpanded",null),dp(e)}),t}function JE(n,e){e.style.height=n.styleHeight}function Kg(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Me(n.get("expandedHeight"))){const t=Cie(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),dp(e)}),n.emitter.on("change",()=>{JE(n,e)}),JE(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let Pie=class extends Ng{constructor(e,t){super(e,t),this.emitter_=new zt,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new zne(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}};const rM=Z("cnt");let yie=class{constructor(e,t){var i;this.className_=Z((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),rM()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),$i(this.foldable_,"completed",ka(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),$i(t.props,"title",u=>{Me(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),jg(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},ex=class extends Bg{constructor(e,t){var i;const s=Fg.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new yie(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Ig({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,Kg(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Ki(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Ui(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};xt({id:"folder",type:"blade",accept(n){const e=dt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new ex(n.document,{blade:n.blade,expanded:n.params.expanded,props:we.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof ex?new Pie(n.controller,n.pool):null}});const Eie=Z("");function tx(n,e){return ka(n,Eie(void 0,e))}let Ug=class oM extends we{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=mne(st(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new oM(we.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){ws(this.globalDisabled_,tx(e,"disabled")),$i(this,"hidden",tx(e,"hidden"))}bindDisabled(e){ws(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){ws(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const nx=Z("tbp");let xie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(nx("c")),this.element.appendChild(i),this.containerElement=i}};const cu=Z("tbi");let $ie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cu()),t.viewProps.bindClassModifiers(this.element),$i(t.props,"selected",r=>{r?this.element.classList.add(cu(void 0,"sel")):this.element.classList.remove(cu(void 0,"sel"))});const i=e.createElement("button");i.classList.add(cu("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(cu("t")),jg(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},Vie=class{constructor(e,t){this.emitter=new zt,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new $ie(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},bf=class extends Bg{constructor(e,t){const i=new xie(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Ig({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Vie(e,{props:t.itemProps,viewProps:Ug.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,$i(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Ki(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Ui(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},kie=class extends Ng{constructor(e,t){super(e,t),this.emitter_=new zt,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new bf(t,{blade:iM(),itemProps:we.fromObject({selected:!1,title:e.title}),props:we.fromObject({selected:!1}),viewProps:Ug.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new qne(this,e.rawValue))}},Sie=class extends Ng{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const ix=-1;let Lie=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=st(!0),this.selectedIndex=st(ix),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=ix,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const pu=Z("tab");let Aie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pu(),rM()),t.viewProps.bindClassModifiers(this.element),ws(t.empty,ka(this.element,pu(void 0,"nop")));const i=e.createElement("div");i.classList.add(pu("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(pu("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(pu("c")),this.element.appendChild(r),this.contentsElement=r}},sx=class extends Bg{constructor(e,t){const i=new Lie,s=new Aie(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Ig({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;J2(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Og(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};xt({id:"tab",type:"blade",accept(n){const e=dt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new sx(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new bf(n.document,{blade:iM(),itemProps:we.fromObject({selected:!1,title:t.title}),props:we.fromObject({selected:!1}),viewProps:Ug.create()});e.add(i)}),e},api(n){return n.controller instanceof sx?new kie(n.controller,n.pool):n.controller instanceof bf?new Sie(n.controller,n.pool):null}});let Hg=class extends Tg{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}};class Mie{constructor(){this.disabled=!1,this.emitter=new zt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Tie{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new zt,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}let Dh=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function mp(n,e){if(n instanceof e)return n;if(n instanceof Dh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let Ad=class{constructor(e){this.values=we.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Md(n){var e;const t=wf;if(Array.isArray(n))return(e=dt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function lM(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function zg(n){return Me(n)?null:new Ad(lM(n))}const ov=Z("lst");let Die=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(ov()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(ov("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(ov("m")),s.appendChild(Ld(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,$i(this.props_,"options",r=>{eM(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},ra=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Die(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Ki(e,null,t=>({options:t.required.custom(Md)}),t=>(this.props.set("options",lM(t.options)),!0))}exportProps(){return Ui(null,{options:this.props.get("options")})}};const rx=Z("pop");let Oie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(rx()),t.viewProps.bindClassModifiers(this.element),ws(t.shows,ka(this.element,rx(void 0,"v")))}},aM=class{constructor(e,t){this.shows=st(!1),this.viewProps=t.viewProps,this.view=new Oie(e,{shows:this.shows,viewProps:this.viewProps})}};const ox=Z("txt");let Rie=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ox()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(ox("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},qg=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Rie(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Me(s)||(this.value.rawValue=s),this.view.refresh()}};function jie(n){return String(n)}function uM(n){return n==="false"?!1:!!n}function lx(n){return jie(n)}function Nie(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const Bie=rn(0);function vp(n){return Bie(n)+"%"}function hM(n){return String(n)}function gf(n){return n}function Sa({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Qt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Zu(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Vs(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function Iie(n){return n==="ArrowUp"||n==="ArrowDown"}function cM(n){return Iie(n)||n==="ArrowLeft"||n==="ArrowRight"}function lv(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Uo=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new zt,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(lv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(lv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(lv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Mn=Z("txt");let Fie=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Mn(),Mn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Mn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Mn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Mn()),this.inputElement.classList.add(Mn("i"));const s=e.createElement("div");s.classList.add(Mn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(oi,"svg");r.classList.add(Mn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(oi,"path");o.classList.add(Mn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(oi,"path");l.classList.add(Mn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(Z("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Mn(void 0,"drg"));return}this.element.classList.add(Mn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Ye(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Oh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=st(null),this.view=new Fie(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Uo(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Me(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Qt(this.props.get("keyScale"),Zu(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Qt(this.props.get("keyScale"),Zu(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const av=Z("sld");let Kie=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(av()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(av("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(av("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ye(ae(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},Uie=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Kie(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Uo(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(ae(Ye(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Qt(this.props.get("keyScale"),Vs(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Qt(this.props.get("keyScale"),Vs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const uv=Z("sldtxt");let Hie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(uv());const i=e.createElement("div");i.classList.add(uv("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(uv("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},ax=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Uie(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Oh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new Hie(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Ki(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Ui(null,{max:e.get("max"),min:e.get("min")})}};function zie(n){return{sliderProps:new we({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new we({formatter:st(n.formatter),keyScale:n.keyScale,pointerScale:st(n.pointerScale)})}}const qie={containerUnitSize:"cnt-usz"};function pM(n){return`--${qie[n]}`}function Qu(n){return Z2(n)}function dr(n){if(ff(n))return dt(n,Qu)}function us(n,e){if(!n)return;const t=[],i=Y2(n,e);i&&t.push(i);const s=X2(n);return s&&t.push(s),new Dh(t)}function dM(n){if(n==="inline"||n==="popup")return n}function Rh(n,e){n.write(e)}const uc=Z("ckb");let Gie=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(uc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(uc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(uc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(uc("w")),i.appendChild(r);const o=Ld(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},Yie=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Gie(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function Xie(n){const e=[],t=zg(n.options);return t&&e.push(t),new Dh(e)}xt({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=dt(e,i=>({options:i.optional.custom(Md),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>uM,constraint:n=>Xie(n.params),writer:n=>Rh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&mp(i,Ad);return s?new ra(e,{props:new we({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Yie(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof ra?new Hg(n.controller):null}});const Jr=Z("col");let Wie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jr()),t.foldable.bindExpandedClass(this.element,Jr(void 0,"expanded")),$i(t.foldable,"completed",ka(this.element,Jr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Jr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Jr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Jr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Jr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function Zie(n,e,t){const i=Ye(n/255,0,1),s=Ye(e/255,0,1),r=Ye(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function Qie(n,e,t){const i=(n%360+360)%360,s=Ye(e/100,0,1),r=Ye(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function Jie(n,e,t){const i=Ye(n/255,0,1),s=Ye(e/255,0,1),r=Ye(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function mM(n,e,t){const i=q2(n,360),s=Ye(e/100,0,1),r=Ye(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function ese(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function tse(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function Vi(n){return[n[0],n[1],n[2]]}function Td(n,e){return[n[0],n[1],n[2],e]}const nse={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:ese,rgb:Qie},hsv:{hsl:tse,hsv:(n,e,t)=>[n,e,t],rgb:mM},rgb:{hsl:Zie,hsv:Jie,rgb:(n,e,t)=>[n,e,t]}};function oa(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function ise(n,e){return n===e?e:q2(n,e)}function vM(n,e,t){var i;const s=oa(e,t);return[e==="rgb"?Ye(n[0],0,s[0]):ise(n[0],s[0]),Ye(n[1],0,s[1]),Ye(n[2],0,s[2]),Ye((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function ux(n,e,t,i){const s=oa(e,t),r=oa(e,i);return n.map((o,l)=>o/s[l]*r[l])}function fM(n,e,t){const i=ux(n,e.mode,e.type,"int"),s=nse[e.mode][t.mode](...i);return ux(s,t.mode,"int",t.type)}let fe=class wM{static black(){return new wM([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=vM(e,t,this.type)}getComponents(e){return Td(fM(Vi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const er=Z("colp");let sse=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(er()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(er("hsv"));const s=e.createElement("div");s.classList.add(er("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(er("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(er("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(er("a"));const a=e.createElement("div");a.classList.add(er("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(er("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function rse(n){return n==="int"?"int":n==="float"?"float":void 0}function Gg(n){return dt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(rse)}),expanded:e.optional.boolean,picker:e.optional.custom(dM),readonly:e.optional.constant(!1)}))}function ko(n){return n?.1:1}function _M(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let Yg=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=vM(e,t,this.type)}getComponents(e){return Td(fM(Vi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const ose={int:(n,e)=>new fe(n,e),float:(n,e)=>new Yg(n,e)};function Xg(n,e,t){return ose[t](n,e)}function lse(n){return n.type==="float"}function ase(n){return n.type==="int"}function use(n){const e=n.getComponents(),t=oa(n.mode,"int");return new fe([Math.round(ae(e[0],0,1,0,t[0])),Math.round(ae(e[1],0,1,0,t[1])),Math.round(ae(e[2],0,1,0,t[2])),e[3]],n.mode)}function hse(n){const e=n.getComponents(),t=oa(n.mode,"int");return new Yg([ae(e[0],0,t[0],0,1),ae(e[1],0,t[1],0,1),ae(e[2],0,t[2],0,1),e[3]],n.mode)}function jt(n,e){if(n.type===e)return n;if(ase(n)&&e==="float")return hse(n);if(lse(n)&&e==="int")return use(n);throw Vo.shouldNeverHappen()}function cse(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Un(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const pse={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function bM(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return pse[i](t)}function gM(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Un(e[1],255),Un(e[2],255),Un(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function dse(n){const e=gM(n);return e?new fe(e,"rgb"):null}function CM(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Un(e[1],255),Un(e[2],255),Un(e[3],255),Un(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function mse(n){const e=CM(n);return e?new fe(e,"rgb"):null}function PM(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[bM(e[1]),Un(e[2],100),Un(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function vse(n){const e=PM(n);return e?new fe(e,"hsl"):null}function yM(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[bM(e[1]),Un(e[2],100),Un(e[3],100),Un(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function fse(n){const e=yM(n);return e?new fe(e,"hsl"):null}function EM(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function wse(n){const e=EM(n);return e?new fe(e,"rgb"):null}function xM(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),ae(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),ae(parseInt(t[4],16),0,255,0,1)]:null}function _se(n){const e=xM(n);return e?new fe(e,"rgb"):null}function $M(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function hx(n){return e=>{const t=$M(e);return t?Xg(t,"rgb",n):null}}function VM(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function cx(n){return e=>{const t=VM(e);return t?Xg(t,"rgb",n):null}}const bse=[{parser:EM,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:xM,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:gM,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:CM,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:PM,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:yM,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:$M,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:VM,result:{alpha:!0,mode:"rgb",notation:"object"}}];function gse(n){return bse.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function Cse(n,e="int"){const t=gse(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function jh(n){const e=[wse,_se,dse,mse,vse,fse];n==="int"&&e.push(hx("int"),cx("int")),n==="float"&&e.push(hx("float"),cx("float"));const t=Nie(e);return i=>{const s=t(i);return s?jt(s,n):null}}function Pse(n){const e=jh("int");if(typeof n!="string")return fe.black();const t=e(n);return t??fe.black()}function kM(n){const e=Ye(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Wg(n,e="#"){const t=Vi(n.getComponents("rgb")).map(kM).join("");return`${e}${t}`}function Zg(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(kM).join("");return`${e}${i}`}function SM(n){const e=rn(0),t=jt(n,"int");return`rgb(${Vi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Rc(n){const e=rn(2),t=rn(0);return`rgba(${jt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function yse(n){const e=[rn(0),vp,vp],t=jt(n,"int");return`hsl(${Vi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function Ese(n){const e=[rn(0),vp,vp,rn(2)];return`hsla(${jt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function LM(n,e){const t=rn(e==="float"?2:0),i=["r","g","b"],s=jt(n,e);return`{${Vi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function xse(n){return e=>LM(e,n)}function AM(n,e){const t=rn(2),i=rn(e==="float"?2:0),s=["r","g","b","a"];return`{${jt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function $se(n){return e=>AM(e,n)}const Vse=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Wg},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Zg},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:SM},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Rc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:yse},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Ese},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:xse(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:$se(e)}],[])];function MM(n){return Vse.reduce((e,t)=>e||(cse(t.format,n)?t.stringifier:null),null)}const du=Z("apl");let kse=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(du()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(du("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(du("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(du("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(du("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new fe([t[0],t[1],t[2],0],"rgb"),s=new fe([t[0],t[1],t[2],255],"rgb"),r=["to right",Rc(i),Rc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Rc(e);const o=ae(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},Sse=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new kse(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Uo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new fe([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Qt(ko(!0),Vs(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new fe([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Qt(ko(!0),Vs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const hl=Z("coltxt");function Lse(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let Ase=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(hl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(hl("m")),this.modeElem_=Lse(e),this.modeElem_.classList.add(hl("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(hl("mm")),s.appendChild(Ld(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(hl("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),ws(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){eM(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(hl("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function Mse(n){return rn(n==="float"?2:0)}function Tse(n,e,t){const i=oa(n,e)[t];return new Vd({min:0,max:i})}function Dse(n,e,t){return new Oh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:we.fromObject({formatter:Mse(e.colorType),keyScale:ko(!1),pointerScale:e.colorType==="float"?.01:1}),value:st(0,{constraint:Tse(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function Ose(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Mr,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=Dse(n,t,i);return Sa({primary:e.value,secondary:s.value,forward(r){return jt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=jt(r,e.colorType).getComponents(l);u[i]=o;const h=Xg(Td(Vi(u),u[3]),l,e.colorType);return jt(h,"int")}}),s})}function Rse(n,e){const t=new qg(n,{parser:jh("int"),props:we.fromObject({formatter:Wg}),value:st(fe.black()),viewProps:e.viewProps});return Sa({primary:e.value,secondary:t.value,forward:i=>new fe(Vi(i.getComponents()),i.mode),backward:(i,s)=>new fe(Td(Vi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function jse(n){return n!=="hex"}let Nse=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=st(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new Ase(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return jse(t)?Ose(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):Rse(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const hv=Z("hpl");let Bse=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(hv()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(hv("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(hv("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=SM(new fe([t,100,100],"hsv"));const i=ae(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},Ise=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Bse(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Uo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ae(Ye(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new fe([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Qt(ko(!1),Vs(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new fe([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Qt(ko(!1),Vs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const cv=Z("svp"),px=64;let Fse=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(cv()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=px,i.width=px,i.classList.add(cv("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(cv("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=Qne(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const m=ae(c,0,s,0,100),d=ae(h,0,r,100,0),f=mM(i[0],m,d),p=(h*s+c)*4;l[p]=f[0],l[p+1]=f[1],l[p+2]=f[2],l[p+3]=255}e.putImageData(o,0,0);const a=ae(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=ae(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},Kse=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Fse(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Uo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ae(e.point.x,0,e.bounds.width,0,100),s=ae(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new fe([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){cM(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=ko(!1),l=Qt(o,Vs(e)),a=Qt(o,Zu(e));l===0&&a===0||this.value.setRawValue(new fe([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=ko(!1),i=Qt(t,Vs(e)),s=Qt(t,Zu(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Use=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new Ise(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Kse(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new Sse(e,{value:this.value,viewProps:this.viewProps}),text:new Oh(e,{parser:Mr,props:we.fromObject({pointerScale:.01,keyScale:.1,formatter:rn(2)}),value:st(0,{constraint:new Vd({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Sa({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new fe(r,i.mode)}}),this.textsC_=new Nse(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new sse(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const pv=Z("colsw");let Hse=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(pv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(pv("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(pv("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Zg(e)}onValueChange_(){this.update_()}},zse=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Hse(e,{value:this.value,viewProps:this.viewProps})}},Qg=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Fg.create(t.expanded),this.swatchC_=new zse(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new qg(e,{parser:t.parser,props:we.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Wie(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new aM(e,{viewProps:this.viewProps}):null;const s=new Use(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Sa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Kg(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=tM(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Dg(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function qse(n){return Vi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function Gse(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function Yse(n){return new fe([n>>16&255,n>>8&255,n&255],"rgb")}function Xse(n){return new fe([n>>24&255,n>>16&255,n>>8&255,ae(n&255,0,255,0,1)],"rgb")}function Wse(n){return typeof n!="number"?fe.black():Yse(n)}function Zse(n){return typeof n!="number"?fe.black():Xse(n)}function jc(n,e){return typeof n!="object"||Me(n)?!1:e in n&&typeof n[e]=="number"}function TM(n){return jc(n,"r")&&jc(n,"g")&&jc(n,"b")}function DM(n){return TM(n)&&jc(n,"a")}function OM(n){return TM(n)}function Jg(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function dx(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function Qse(n){const e=MM(n);return e?(t,i)=>{Rh(t,e(i))}:null}function Jse(n){const e=n?Gse:qse;return(t,i)=>{Rh(t,e(i))}}function ere(n,e,t){const s=jt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function tre(n,e,t){const s=jt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function nre(n,e){return(t,i)=>{n?ere(t,i,e):tre(t,i,e)}}function ire(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function sre(n){return n?e=>Zg(e,"0x"):e=>Wg(e,"0x")}function rre(n){return"color"in n||n.view==="color"}xt({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!rre(e))return null;const t=Gg(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:ire(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?Zse:Wse,equals:Jg,writer:n=>Jse(n.params.supportsAlpha)},controller:n=>{var e,t;return new Qg(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:sre(n.params.supportsAlpha),parser:jh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function ore(n,e){if(!OM(n))return jt(fe.black(),e);if(e==="int"){const t=dx(n);return new fe(t,"rgb")}if(e==="float"){const t=dx(n);return new Yg(t,"rgb")}return jt(fe.black(),"int")}function lre(n){return DM(n)}function are(n){return e=>{const t=ore(e,n);return jt(t,"int")}}function ure(n,e){return t=>n?AM(t,e):LM(t,e)}xt({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!OM(n))return null;const i=Gg(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=_M(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>are(n.params.colorType),equals:Jg,writer:n=>nre(lre(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=DM(n.initialValue);return new Qg(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:ure(i,n.params.colorType),parser:jh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});xt({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=Cse(n,_M(e));if(!t)return null;const i=MM(t);if(!i)return null;const s=Gg(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>Pse,equals:Jg,writer:n=>{const e=Qse(n.params.format);if(!e)throw Vo.notBindable();return e}},controller:n=>{var e,t;return new Qg(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:jh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let eC=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const mx=Z("pndtxt");let hre=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(mx()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(mx("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function cre(n,e,t){return new Oh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:st(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let tC=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>cre(e,t,s)),this.acs_.forEach((i,s)=>{Sa({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new hre(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},pre=class extends Tg{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function dre(n,e){const t=[],i=Y2(n,e);i&&t.push(i);const s=X2(n);s&&t.push(s);const r=zg(n.options);return r&&t.push(r),new Dh(t)}xt({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=dt(e,i=>Object.assign(Object.assign({},Z2(i)),{options:i.optional.custom(Md),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>z2,constraint:n=>dre(n.params,n.initialValue),writer:n=>Rh},controller:n=>{const e=n.value,t=n.constraint,i=t&&mp(t,Ad);if(i)return new ra(n.document,{props:new we({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=W2(n.params,e.rawValue),r=t&&mp(t,Vd);return r?new ax(n.document,Object.assign(Object.assign({},zie(Object.assign(Object.assign({},s),{keyScale:st(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Mr,value:e,viewProps:n.viewProps})):new Oh(n.document,{parser:Mr,props:we.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof ax?new pre(n.controller):n.controller.valueController instanceof ra?new Hg(n.controller):null}});let yr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Me(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const RM={toComponents:n=>n.getComponents(),fromComponents:n=>new yr(...n)},cl=Z("p2d");let mre=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cl()),t.viewProps.bindClassModifiers(this.element),ws(t.expanded,ka(this.element,cl(void 0,"expanded")));const i=e.createElement("div");i.classList.add(cl("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(cl("b")),s.appendChild(Ld(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(cl("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(cl("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const tr=Z("p2dp");let vre=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(tr()),t.layout==="popup"&&this.element.classList.add(tr(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(tr("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(oi,"svg");s.classList.add(tr("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(oi,"line");r.classList.add(tr("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(oi,"line");o.classList.add(tr("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(oi,"line");l.classList.add(tr("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(tr("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=ae(e,-i,+i,0,100),r=ae(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function vx(n,e,t){return[Qt(e[0],Vs(n)),Qt(e[1],Zu(n))*(t?1:-1)]}let fre=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new vre(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Uo(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=ae(e.point.x,0,e.bounds.width,-i,+i),r=ae(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new yr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){cM(e.key)&&e.preventDefault();const[t,i]=vx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new yr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=vx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},wre=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Fg.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new aM(e,{viewProps:this.viewProps}):null;const r=new fre(e,{layout:t.pickerLayout,props:new we({invertsY:st(t.invertsY),max:st(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new tC(e,{assembly:RM,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new mre(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Sa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Kg(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=tM(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Dg(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function _re(n){return yr.isObject(n)?new yr(n.x,n.y):new yr}function bre(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function gre(n,e){return new eC({assembly:RM,components:[us(Object.assign(Object.assign({},n),n.x),e.x),us(Object.assign(Object.assign({},n),n.y),e.y)]})}function fx(n,e){var t,i;if(!Me(n.min)||!Me(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=G2(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function Cre(n,e){var t,i;const s=fx($o(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=fx($o(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function Pre(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}xt({id:"input-point2d",type:"input",accept:(n,e)=>{if(!yr.isObject(n))return null;const t=dt(e,i=>Object.assign(Object.assign({},Qu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(dM),readonly:i.optional.constant(!1),x:i.optional.custom(dr),y:i.optional.object(Object.assign(Object.assign({},Qu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>_re,constraint:n=>gre(n.params,n.initialValue),equals:yr.equals,writer:()=>bre},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new wre(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return Mg({constraint:r.components[a],initialValue:l,params:$o(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:Pre(n.params),max:Cre(n.params,s.rawValue),parser:Mr,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Nl=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Me(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const jM={toComponents:n=>n.getComponents(),fromComponents:n=>new Nl(...n)};function yre(n){return Nl.isObject(n)?new Nl(n.x,n.y,n.z):new Nl}function Ere(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function xre(n,e){return new eC({assembly:jM,components:[us(Object.assign(Object.assign({},n),n.x),e.x),us(Object.assign(Object.assign({},n),n.y),e.y),us(Object.assign(Object.assign({},n),n.z),e.z)]})}xt({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Nl.isObject(n))return null;const t=dt(e,i=>Object.assign(Object.assign({},Qu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(dr),y:i.optional.custom(dr),z:i.optional.custom(dr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>yre,constraint:n=>xre(n.params,n.initialValue),equals:Nl.equals,writer:n=>Ere},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new tC(n.document,{assembly:jM,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Mg({constraint:t.components[r],initialValue:s,params:$o(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Mr,value:e,viewProps:n.viewProps})}});let Bl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Me(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const NM={toComponents:n=>n.getComponents(),fromComponents:n=>new Bl(...n)};function $re(n){return Bl.isObject(n)?new Bl(n.x,n.y,n.z,n.w):new Bl}function Vre(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function kre(n,e){return new eC({assembly:NM,components:[us(Object.assign(Object.assign({},n),n.x),e.x),us(Object.assign(Object.assign({},n),n.y),e.y),us(Object.assign(Object.assign({},n),n.z),e.z),us(Object.assign(Object.assign({},n),n.w),e.w)]})}xt({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Bl.isObject(n))return null;const t=dt(e,i=>Object.assign(Object.assign({},Qu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(dr),x:i.optional.custom(dr),y:i.optional.custom(dr),z:i.optional.custom(dr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>$re,constraint:n=>kre(n.params,n.initialValue),equals:Bl.equals,writer:n=>Vre},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new tC(n.document,{assembly:NM,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Mg({constraint:t.components[r],initialValue:s,params:$o(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Mr,value:e,viewProps:n.viewProps})}});function Sre(n){const e=[],t=zg(n.options);return t&&e.push(t),new Dh(e)}xt({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=dt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Md)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>hM,constraint:n=>Sre(n.params),writer:n=>Rh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&mp(i,Ad);return s?new ra(e,{props:new we({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new qg(e,{parser:r=>r,props:we.fromObject({formatter:gf}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof ra?new Hg(n.controller):null}});const Nh={monitor:{defaultInterval:200,defaultRows:3}},wx=Z("mll");let Lre=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(wx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(wx("i")),i.style.height=`calc(var(${pM("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},nC=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Lre(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const _x=Z("sgl");let Are=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(_x()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(_x("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},iC=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Are(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};xt({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=dt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>uM},controller:n=>{var e;return n.value.rawValue.length===1?new iC(n.document,{formatter:lx,value:n.value,viewProps:n.viewProps}):new nC(n.document,{formatter:lx,rows:(e=n.params.rows)!==null&&e!==void 0?e:Nh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let Mre=class extends Tg{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const nr=Z("grl");let Tre=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(nr()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(oi,"svg");i.classList.add(nr("g")),i.style.height=`calc(var(${pM("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(oi,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(nr("t"),Z("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const m=ae(c,0,t,0,e.width),d=ae(h,i,s,e.height,0);r.push([m,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(nr("t","a"));return}const a=ae(this.cursor_.rawValue,0,t,0,e.width),u=ae(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(nr("t","a"))||(o.classList.add(nr("t","a"),nr("t","in")),dp(o),o.classList.remove(nr("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},BM=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=st(-1),this.view=new Tre(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Dg(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Uo(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Ki(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Ui(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(ae(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(ae(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function Cf(n){return Me(n.format)?rn(2):n.format}function Dre(n){var e;return n.value.rawValue.length===1?new iC(n.document,{formatter:Cf(n.params),value:n.value,viewProps:n.viewProps}):new nC(n.document,{formatter:Cf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Nh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function Ore(n){var e,t,i;return new BM(n.document,{formatter:Cf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Nh.monitor.defaultRows,props:we.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function bx(n){return n.view==="graph"}xt({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=dt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>bx(n)?64:1,reader:n=>z2},controller:n=>bx(n.params)?Ore(n):Dre(n),api:n=>n.controller.valueController instanceof BM?new Mre(n.controller):null});xt({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=dt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>hM},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new nC(n.document,{formatter:gf,rows:(e=n.params.rows)!==null&&e!==void 0?e:Nh.monitor.defaultRows,value:t,viewProps:n.viewProps}):new iC(n.document,{formatter:gf,value:t,viewProps:n.viewProps})}});class Rre extends kd{measureStart(e){this.controller.valueController.measureStart(e)}measureEnd(){return this.controller.valueController.measureEnd()}measure(e,t){this.controller.valueController.measure(e,t)}measureAsync(e,t){return this.controller.valueController.measureAsync(e,t)}get measureHandler(){return this.controller.valueController.measureHandler}set measureHandler(e){this.controller.valueController.measureHandler=e}}class gx extends Rg{constructor(e,t){const i=t.valueController,s=new nM(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}class jre{measureStart(){const e=performance.now();return()=>performance.now()-e}}function Cx(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(i.next(h))}catch(c){o(c)}}function a(h){try{u(i.throw(h))}catch(c){o(c)}}function u(h){h.done?r(h.value):s(h.value).then(l,a)}u((i=i.apply(n,e||[])).next())})}class IM{constructor(){this.map=new Map,this.keySet=new Set}get(e){return this.map.get(e)}getOrCreate(e,t){this.keySet.has(e)||this.keySet.add(e);let i=this.map.get(e);return i==null&&(i=t(),this.map.set(e,i)),i}set(e,t){this.keySet.has(e)||this.keySet.add(e),this.map.set(e,t)}resetUsedSet(){this.keySet.clear()}vaporize(e){for(const[t,i]of this.map.entries())this.keySet.has(t)||(this.map.delete(t),e==null||e([t,i]))}}function Nre(n){n.splice(0,n.length)}function hc(n){let e=0;return n.forEach(t=>e+=t),e}class Bre{constructor(e){this.__recalcForEach=0,this.__countUntilRecalc=0,this.__history=[],this.__index=0,this.__count=0,this.__cache=0,this.__length=e,this.__recalcForEach=e;for(let t=0;t<e;t++)this.__history[t]=0}get mean(){const e=Math.min(this.__count,this.__length);return e===0?0:this.__cache/e}get recalcForEach(){return this.__recalcForEach}set recalcForEach(e){const t=e-this.__recalcForEach;this.__recalcForEach=e,this.__countUntilRecalc=Math.max(0,this.__countUntilRecalc+t)}reset(){this.__index=0,this.__count=0,this.__cache=0,this.__countUntilRecalc=0;for(let e=0;e<this.__length;e++)this.__history[e]=0}push(e){const t=this.__history[this.__index];this.__history[this.__index]=e,this.__count++,this.__index=(this.__index+1)%this.__length,this.__countUntilRecalc===0?this.recalc():(this.__countUntilRecalc--,this.__cache-=t,this.__cache+=e)}recalc(){this.__countUntilRecalc=this.__recalcForEach;const e=this.__history.slice(0,Math.min(this.__count,this.__length)).reduce((t,i)=>t+i,0);this.__cache=e}}function Pf(n,e){if(typeof e!="function")return Pf(n,r=>r<e);const t=e;let i=0,s=n.length;for(;i<s;){const r=i+s>>1,o=n[r];t(o)?i=r+1:s=r}return i}class Ire{constructor(e){this.__history=[],this.__sorted=[],this.__index=0,this.__length=e}get median(){return this.percentile(50)}percentile(e){return this.__history.length===0?0:this.__sorted[Math.round(e*.01*(this.__history.length-1))]}reset(){this.__index=0,this.__history=[],this.__sorted=[]}push(e){const t=this.__history[this.__index];if(this.__history[this.__index]=e,this.__index=(this.__index+1)%this.__length,this.__sorted.length===this.__length){const s=Pf(this.__sorted,t);this.__sorted.splice(s,1)}const i=Pf(this.__sorted,e);this.__sorted.splice(i,0,e)}}function pl(n,e){let t=0;for(let i=0;i<n.length;i++)t+=n[i]*e[i];return t}function sC(n){return Math.min(Math.max(n,0),1)}function Fre(n){return`rgb( ${n.map(t=>sC(t)*256).join(", ")} )`}function Kre(n){const e=[.13572138,4.6153926,-42.66032258,132.13108234],t=[.09140261,2.19418839,4.84296658,-14.18503333],i=[.1066733,12.64194608,-60.58204836,110.36276771],s=[-152.94239396,59.28637943],r=[4.27729857,2.82956604],o=[-89.90310912,27.34824973];n=sC(n);const l=[1,n,n*n,n*n*n],a=[l[2],l[3]].map(h=>h*l[2]),u=[pl(l,e)+pl(a,s),pl(l,t)+pl(a,r),pl(l,i)+pl(a,o)];return Fre(u)}const ir=Z("profiler");class Ure{constructor(e,t){this.targetDelta=t.targetDelta,this.deltaUnit=t.deltaUnit,this.fractionDigits=t.fractionDigits,this.calcMode=t.calcMode,this.element=e.createElement("div"),this.element.classList.add(ir()),t.viewProps.bindClassModifiers(this.element),this.svgRootElement_=e.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgRootElement_.classList.add(ir("root")),this.element.appendChild(this.svgRootElement_),this.entryContainerElement_=e.createElementNS("http://www.w3.org/2000/svg","g"),this.entryContainerElement_.classList.add(ir("container")),this.entryContainerElement_.setAttribute("transform","translate( 1, 1 )"),this.svgRootElement_.appendChild(this.entryContainerElement_),this.tooltipElement_=e.createElement("div"),this.tooltipElement_.classList.add(ir("tooltip")),this.tooltipElement_.style.display="none",this.element.appendChild(this.tooltipElement_),this.tooltipInsideElement_=e.createElement("div"),this.tooltipInsideElement_.classList.add(ir("tooltipinside")),this.tooltipElement_.appendChild(this.tooltipInsideElement_),this.labelElement_=e.createElement("div"),this.labelElement_.classList.add(ir("label")),this.labelElement_.textContent=this.deltaToDisplayDelta_(0),this.element.appendChild(this.labelElement_),this.entryElementCacheMap_=new IM,this.hoveringEntry_=null}update(e){const t=this.entryToDelta_(e);this.labelElement_.textContent=this.deltaToDisplayDelta_(t),this.entryElementCacheMap_.resetUsedSet();const i=160/Math.max(this.targetDelta,t);let s=0;for(const r of e.children)this.addEntry_(r,"",this.entryContainerElement_,i).setAttribute("transform",`translate( ${s}, 0 )`),s+=this.entryToDelta_(r)*i;this.entryElementCacheMap_.vaporize(([r,o])=>{o.remove(),this.hoveringEntry_===r&&(this.hoveringEntry_=null)}),this.updateTooltip_()}updateTooltip_(){const e=this.hoveringEntry_;if(e){const t=this.entryElementCacheMap_.get(e),i=t==null?void 0:t.getAttribute("data-delta"),s=this.deltaToDisplayDelta_(parseFloat(i??"0.0")),r=`${e}
${s}`;this.tooltipElement_.style.display="block",this.tooltipInsideElement_.textContent=r}else this.tooltipElement_.style.display="none"}addEntry_(e,t,i,s){const r=`${t}/${e.name}`,o=this.entryElementCacheMap_.getOrCreate(r,()=>{const h=document.createElementNS("http://www.w3.org/2000/svg","g");h.classList.add(ir("entry")),i.appendChild(h),this.entryElementCacheMap_.set(r,h);const c=document.createElementNS("http://www.w3.org/2000/svg","rect");return c.classList.add(ir("entryrect")),h.appendChild(c),c.addEventListener("mouseenter",()=>{this.hoveringEntry_=r,this.updateTooltip_()}),c.addEventListener("mouseleave",()=>{this.hoveringEntry_=null,this.updateTooltip_()}),h}),l=this.entryToDelta_(e);o.setAttribute("data-delta",`${l}`);const a=o.childNodes[0];a.setAttribute("width",`${Math.max(.01,l*s-1)}px`),a.setAttribute("height","9px");const u=.15+.7*sC(l/this.targetDelta);if(a.setAttribute("fill",Kre(u)),e.children.length>0){let h=0;e.children.forEach(c=>{this.addEntry_(c,r,o,s).setAttribute("transform",`translate( ${h}, 10 )`),h+=this.entryToDelta_(c)*s})}return o}entryToDelta_(e){if(this.calcMode==="frame")return e.delta;if(this.calcMode==="mean")return e.deltaMean;if(this.calcMode==="median")return e.deltaMedian;throw new Error('Unreachable! calcMode must be one of "frame", "mean", or "median"')}deltaToDisplayDelta_(e){return`${e.toFixed(this.fractionDigits)} ${this.deltaUnit}`}}class Hre{constructor(e,t){this.targetDelta=t.targetDelta,this.bufferSize=t.bufferSize,this.onTick_=this.onTick_.bind(this),this.ticker_=t.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.viewProps=t.viewProps,this.view=new Ure(e,{targetDelta:this.targetDelta,deltaUnit:t.deltaUnit,fractionDigits:t.fractionDigits,calcMode:t.calcMode,viewProps:this.viewProps}),this.viewProps.handleDispose(()=>{this.ticker_.dispose()}),this.measureHandler=t.measureHandler,this.rootCalcCacheStack_=[this.createNewEntryCalcCache_()]}measureStart(e){const i=this.rootCalcCacheStack_[this.rootCalcCacheStack_.length-1].childrenCacheMap.getOrCreate(e,()=>this.createNewEntryCalcCache_());i.childrenCacheMap.resetUsedSet(),Nre(i.childrenPromiseDelta),this.rootCalcCacheStack_.push(i),i.measureEnd=this.measureHandler.measureStart()}measureEnd(){return Cx(this,void 0,void 0,function*(){const e=this.rootCalcCacheStack_[this.rootCalcCacheStack_.length-1],t=this.rootCalcCacheStack_[this.rootCalcCacheStack_.length-2],i=Promise.resolve(e.measureEnd());e.measureEnd=null,t.childrenPromiseDelta.push(i),this.rootCalcCacheStack_.pop(),e.childrenCacheMap.vaporize();const s=yield Promise.all(e.childrenPromiseDelta),r=hc(s),o=(yield i)-r;e.meanCalc.push(o),e.medianCalc.push(o),e.latest=o})}measure(e,t){this.measureStart(e),t(),this.measureEnd()}measureAsync(e,t){return Cx(this,void 0,void 0,function*(){this.measureStart(e),yield t(),this.measureEnd()})}renderEntry(){return this.renderEntryFromCalcCache_("",this.rootCalcCacheStack_[0])}renderEntryFromCalcCache_(e,t){const i=[];for(const d of t.childrenCacheMap.keySet){const f=t.childrenCacheMap.get(d);i.push(this.renderEntryFromCalcCache_(d,f))}const s=t.latest,r=t.meanCalc.mean,o=t.medianCalc.median,l=hc(i.map(d=>d.delta)),a=hc(i.map(d=>d.deltaMean)),u=hc(i.map(d=>d.deltaMedian)),h=s+l,c=r+a,m=o+u;return{name:e,delta:h,deltaMean:c,deltaMedian:m,selfDelta:s,selfDeltaMean:r,selfDeltaMedian:o,children:i}}onTick_(){this.view.update(this.renderEntry())}createNewEntryCalcCache_(){return{meanCalc:new Bre(this.bufferSize),medianCalc:new Ire(this.bufferSize),latest:0,measureEnd:null,childrenCacheMap:new IM,childrenPromiseDelta:[]}}}function zre(n,e){return e===0?new Mie:new Tie(n,e??Nh.monitor.defaultInterval)}function qre(n){switch(n){case"frame":case"mean":case"median":return n;default:return}}function Gre(n){if(typeof n=="object"&&n!=null&&"measureStart"in n)return n;typeof n=="object"&&n!=null&&"measure"in n&&console.warn("The API of `ProfilerBladeDefaultMeasureHandler` has been changed in v0.4.0! Please define `measureStart` instead of `measure`. Fallback to the default measure handler.")}xt({id:"profiler",type:"blade",accept(n){const e=dt(n,t=>({view:t.required.constant("profiler"),targetDelta:t.optional.number,bufferSize:t.optional.number,deltaUnit:t.optional.string,fractionDigits:t.optional.number,calcMode:t.optional.custom(qre),label:t.optional.string,interval:t.optional.number,measureHandler:t.optional.custom(Gre)}));return e?{params:e}:null},controller(n){var e,t,i,s,r,o,l;const a=(e=n.params.interval)!==null&&e!==void 0?e:500,u=(t=n.params.targetDelta)!==null&&t!==void 0?t:16.67,h=(i=n.params.bufferSize)!==null&&i!==void 0?i:30,c=(s=n.params.deltaUnit)!==null&&s!==void 0?s:"ms",m=(r=n.params.fractionDigits)!==null&&r!==void 0?r:2,d=(o=n.params.calcMode)!==null&&o!==void 0?o:"mean",f=(l=n.params.measureHandler)!==null&&l!==void 0?l:new jre;return new gx(n.document,{blade:n.blade,labelProps:we.fromObject({label:n.params.label}),valueController:new Hre(n.document,{ticker:zre(n.document,a),targetDelta:u,bufferSize:h,deltaUnit:c,fractionDigits:m,calcMode:d,viewProps:n.viewProps,measureHandler:f})})},api(n){return n.controller instanceof gx?new Rre(n.controller):null}});function Te(n){return n==null}function rC(n){return n!==null&&typeof n=="object"}function yf(n){return n!==null&&typeof n=="object"}function Yre(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function So(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return yf(r)&&yf(o)?Object.assign(Object.assign({},i),{[s]:So(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function Xre(n){return rC(n)?"target"in n:!1}const Wre={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class ln{static alreadyDisposed(){return new ln({type:"alreadydisposed"})}static notBindable(){return new ln({type:"notbindable"})}static notCompatible(e,t){return new ln({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new ln({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new ln({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=Wre[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class fp{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!fp.isBindable(i))throw ln.notBindable();if(!(e in i))throw ln.propertyNotFound(e);i[e]=t}}class Cn{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}}class Zre{constructor(e,t){var i;this.constraint_=t==null?void 0:t.constraint,this.equals_=(i=t==null?void 0:t.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new Cn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}}class Qre{constructor(e){this.emitter=new Cn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}}class Jre{constructor(e){this.emitter=new Cn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function rt(n,e){const t=e==null?void 0:e.constraint,i=e==null?void 0:e.equals;return!t&&!i?new Qre(n):new Zre(n,e)}function eoe(n){return[new Jre(n),(e,t)=>{n.setRawValue(e,t)}]}class Y{constructor(e){this.emitter=new Cn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:rt(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new Y(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class Dd{constructor(e){this.values=Y.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}}class toe{constructor(e){this.values=Y.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Te(i)||(s=Math.max(s,i)),Te(t)||(s=Math.min(s,t)),s}}class noe{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}}class ioe{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const soe={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};class roe{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=soe[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ooe={"+":n=>n,"-":n=>-n,"~":n=>~n};class loe{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=ooe[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function oC(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Ju(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function aoe(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function eh(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function uoe(n,e){const t=eh(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=eh(n,e);return s===""?"":i+s}function lC(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=uoe(n,e);return i===""?"":t+i}function FM(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=aoe(n,e);return e+=i.length,i===""?"":i+eh(n,e)}function hoe(n,e){const t=FM(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=eh(n,e);return e+=s.length,t+i+s+lC(n,e)}function coe(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=eh(n,e);return e+=i.length,i===""?"":t+i+lC(n,e)}function poe(n,e){const t=FM(n,e);return e+=t.length,t===""?"":t+lC(n,e)}const doe=oC([hoe,coe,poe]);function moe(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function voe(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=moe(n,e);return i===""?"":t+i}function foe(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function woe(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=foe(n,e);return i===""?"":t+i}function _oe(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function boe(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=_oe(n,e);return i===""?"":t+i}const goe=oC([voe,woe,boe]),Coe=oC([goe,doe]);function Poe(n,e){const t=Coe(n,e);return e+=t.length,t===""?null:{evaluable:new ioe(t),cursor:e}}function yoe(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=UM(n,e);if(!i)return null;e=i.cursor,e+=Ju(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function Eoe(n,e){var t;return(t=Poe(n,e))!==null&&t!==void 0?t:yoe(n,e)}function KM(n,e){const t=Eoe(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=KM(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new loe(i,s.evaluable)}):null}function xoe(n,e,t){t+=Ju(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Ju(e,t).length,{cursor:t,operator:i}):null}function $oe(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=xoe(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new roe(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const Voe=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>$oe(n,e),KM);function UM(n,e){return e+=Ju(n,e).length,Voe(n,e)}function koe(n){const e=UM(n,0);return!e||e.cursor+Ju(n,e.cursor).length!==n.length?null:e.evaluable}function Tr(n){var e;const t=koe(n);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function HM(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Tr(n);if(!Te(e))return e}return 0}function on(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function q(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function Px(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Xe(n,e,t){return Math.min(Math.max(n,e),t)}function zM(n,e){return(n%e+e)%e}function Soe(n,e){return Te(n.step)?Math.max(Px(e),2):Px(n.step)}function qM(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function Loe(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function GM(n,e){return Te(n.step)?null:new noe(n.step,e)}function YM(n){return!Te(n.max)&&!Te(n.min)?new Dd({max:n.max,min:n.min}):!Te(n.max)||!Te(n.min)?new toe({max:n.max,min:n.min}):null}function XM(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:on(Soe(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:qM(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:Loe(n,e)}}function WM(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function aC(n){return{constraint:n.constraint,textProps:Y.fromObject(XM(n.params,n.initialValue))}}class uC{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class Od{constructor(e){this.target=e}}class ZM extends Od{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}}class Aoe extends Od{constructor(e,t){super(e),this.expanded=t}}class Moe extends Od{constructor(e,t){super(e),this.index=t}}class hC extends uC{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Cn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new ZM(this,t.binding.target.read(),e.options.last))}}function Toe(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function Doe(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function Ooe(n){return n===null?!1:typeof n=="object"}function ts(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function yx(n){return{custom:e=>ts(e)(n),boolean:ts(e=>typeof e=="boolean"?e:void 0)(n),number:ts(e=>typeof e=="number"?e:void 0)(n),string:ts(e=>typeof e=="string"?e:void 0)(n),function:ts(e=>typeof e=="function"?e:void 0)(n),constant:e=>ts(t=>t===e?e:void 0)(n),raw:ts(e=>e)(n),object:e=>ts(t=>{if(Ooe(t))return Toe(t,e)})(n),array:e=>ts(t=>{if(Array.isArray(t))return Doe(t,e)})(n)}}const Ef={optional:yx(!0),required:yx(!1)};function mt(n,e){const t=e(Ef),i=Ef.required.object(t)(n);return i.succeeded?i.value:void 0}function Hi(n,e,t,i){if(e&&!e(n))return!1;const s=mt(n,t);return s?i(s):!1}function zi(n,e){var t;return So((t=n==null?void 0:n())!==null&&t!==void 0?t:{},e)}function Nc(n){return"value"in n}function Roe(n){if(!rC(n)||!("binding"in n))return!1;const e=n.binding;return Xre(e)}const Hn="http://www.w3.org/2000/svg";function wp(n){n.offsetHeight}function joe(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function cC(n){return n.ontouchstart!==void 0}function Noe(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const Boe={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Rd(n,e){const t=n.createElementNS(Hn,"svg");return t.innerHTML=Boe[e],t}function QM(n,e,t){n.insertBefore(e,n.children[t])}function pC(n){n.parentElement&&n.parentElement.removeChild(n)}function JM(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function Ioe(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function eT(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function _s(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function ki(n,e,t){_s(n.value(e),t)}const Foe="tp";function Q(n){return(t,i)=>[Foe,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const mu=Q("lbl");function Koe(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}class Uoe{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(mu()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(mu("l")),ki(t.props,"label",r=>{Te(r)?this.element.classList.add(mu(void 0,"nol")):(this.element.classList.remove(mu(void 0,"nol")),Ioe(i),i.appendChild(Koe(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(mu("v")),this.element.appendChild(s),this.valueElement=s}}class Hoe{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new Uoe(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Hi(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return zi(null,{label:this.props.get("label")})}}function zoe(){return["veryfirst","first","last","verylast"]}const Ex=Q(""),xx={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class tT{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{zoe().forEach(i=>{t.classList.remove(Ex(void 0,xx[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(Ex(void 0,xx[i]))})}),this.viewProps.handleDispose(()=>{pC(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Hi(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return zi(null,Object.assign({},this.viewProps.exportState()))}}class qoe extends uC{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new Od(this))}),this}}function Goe(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function La(n,e){return t=>{Goe(n,e,t)}}function dC(n,e){_s(n,t=>{e.textContent=t??""})}const dv=Q("btn");class Yoe{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(dv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(dv("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(dv("t")),dC(t.props.value("title"),s),this.buttonElement.appendChild(s)}}class Xoe{constructor(e,t){this.emitter=new Cn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Yoe(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Hi(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return zi(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}}class $x extends tT{constructor(e,t){const i=new Xoe(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new Hoe(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Hi(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return zi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class Woe{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}const Zoe=new Woe("2.0.1");function $t(n){return Object.assign({core:Zoe},n)}$t({id:"button",type:"blade",accept(n){const e=mt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new $x(n.document,{blade:n.blade,buttonProps:Y.fromObject({title:n.params.title}),labelProps:Y.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof $x?new qoe(n.controller):null}});function Qoe(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function Joe(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function ele(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function tle(n){return rC(n)?"refresh"in n&&typeof n.refresh=="function":!1}function nle(n,e){if(!fp.isBindable(n))throw ln.notBindable();return new fp(n,e)}class ile{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Cn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,nle(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return Joe(this,e)}addButton(e){return Qoe(this,e)}addTab(e){return ele(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{tle(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=Roe(t.value)?t.value.binding:null;this.emitter_.emit("change",new ZM(i,s?s.target.read():t.value.rawValue,e.options.last))}}class mC extends uC{constructor(e,t){super(e),this.rackApi_=new ile(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class vC extends tT{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Hi(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return zi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}}function xf(n){return"rackController"in n}class sle{constructor(e){this.emitter=new Cn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw ln.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function rle(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Nc(i)&&i.value===e)return i}return null}function ole(n){return xf(n)?n.rackController.rack.bcSet_:null}class lle{constructor(e){var t,i;this.emitter=new Cn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new sle(ole),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Nc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(xf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Nc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(xf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=rle(this.find(Nc),e.sender);if(!t)throw ln.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class fC{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new lle({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&QM(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&pC(e.bladeController.view.element)}}function nT(){return new Y({positions:rt([],{equals:Yre})})}class Bh extends Y{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=Y.createCore(t);return new Bh(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Te(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};ki(this,"expanded",i),ki(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function ale(n,e){let t=0;return joe(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),wp(e),t=e.clientHeight,n.set("temporaryExpanded",null),wp(e)}),t}function Vx(n,e){e.style.height=n.styleHeight}function wC(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Te(n.get("expandedHeight"))){const t=ale(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),wp(e)}),n.emitter.on("change",()=>{Vx(n,e)}),Vx(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}class ule extends mC{constructor(e,t){super(e,t),this.emitter_=new Cn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new Aoe(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}}const iT=Q("cnt");class hle{constructor(e,t){var i;this.className_=Q((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),iT()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ki(this.foldable_,"completed",La(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),ki(t.props,"title",u=>{Te(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),dC(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}}class kx extends vC{constructor(e,t){var i;const s=Bh.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new hle(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new fC({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,wC(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Hi(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return zi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}$t({id:"folder",type:"blade",accept(n){const e=mt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new kx(n.document,{blade:n.blade,expanded:n.params.expanded,props:Y.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof kx?new ule(n.controller,n.pool):null}});const cle=Q("");function Sx(n,e){return La(n,cle(void 0,e))}class Ih extends Y{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=eoe(rt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new Ih(Y.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){_s(this.globalDisabled_,Sx(e,"disabled")),ki(this,"hidden",Sx(e,"hidden"))}bindDisabled(e){_s(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){_s(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i==null||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Lx=Q("tbp");class ple{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Lx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Lx("c")),this.element.appendChild(i),this.containerElement=i}}const vu=Q("tbi");class dle{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vu()),t.viewProps.bindClassModifiers(this.element),ki(t.props,"selected",r=>{r?this.element.classList.add(vu(void 0,"sel")):this.element.classList.remove(vu(void 0,"sel"))});const i=e.createElement("button");i.classList.add(vu("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(vu("t")),dC(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class mle{constructor(e,t){this.emitter=new Cn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new dle(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class $f extends vC{constructor(e,t){const i=new ple(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new fC({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new mle(e,{props:t.itemProps,viewProps:Ih.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,ki(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Hi(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return zi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class vle extends mC{constructor(e,t){super(e,t),this.emitter_=new Cn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new $f(t,{blade:nT(),itemProps:Y.fromObject({selected:!1,title:e.title}),props:Y.fromObject({selected:!1}),viewProps:Ih.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new Moe(this,e.rawValue))}}class fle extends mC{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}}const Ax=-1;class wle{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=rt(!0),this.selectedIndex=rt(Ax),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Ax,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const fu=Q("tab");class _le{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(fu(),iT()),t.viewProps.bindClassModifiers(this.element),_s(t.empty,La(this.element,fu(void 0,"nop")));const i=e.createElement("div");i.classList.add(fu("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(fu("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(fu("c")),this.element.appendChild(r),this.contentsElement=r}}class Mx extends vC{constructor(e,t){const i=new wle,s=new _le(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new fC({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;QM(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;pC(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}$t({id:"tab",type:"blade",accept(n){const e=mt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new Mx(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new $f(n.document,{blade:nT(),itemProps:Y.fromObject({selected:!1,title:t.title}),props:Y.fromObject({selected:!1}),viewProps:Ih.create()});e.add(i)}),e},api(n){return n.controller instanceof Mx?new vle(n.controller,n.pool):n.controller instanceof $f?new fle(n.controller,n.pool):null}});class _C extends hC{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class Fh{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}}function _p(n,e){if(n instanceof e)return n;if(n instanceof Fh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}class jd{constructor(e){this.values=Y.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}}function Nd(n){var e;const t=Ef;if(Array.isArray(n))return(e=mt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function sT(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function bC(n){return Te(n)?null:new jd(sT(n))}const mv=Q("lst");class ble{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(mv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(mv("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(mv("m")),s.appendChild(Rd(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,ki(this.props_,"options",r=>{JM(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class la{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new ble(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Hi(e,null,t=>({options:t.required.custom(Nd)}),t=>(this.props.set("options",sT(t.options)),!0))}exportProps(){return zi(null,{options:this.props.get("options")})}}const Tx=Q("pop");class gle{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Tx()),t.viewProps.bindClassModifiers(this.element),_s(t.shows,La(this.element,Tx(void 0,"v")))}}class rT{constructor(e,t){this.shows=rt(!1),this.viewProps=t.viewProps,this.view=new gle(e,{shows:this.shows,viewProps:this.viewProps})}}const Dx=Q("txt");class Cle{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Dx()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(Dx("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class gC{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Cle(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Te(s)||(this.value.rawValue=s),this.view.refresh()}}function Ple(n){return String(n)}function oT(n){return n==="false"?!1:!!n}function Ox(n){return Ple(n)}function yle(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const Ele=on(0);function bp(n){return Ele(n)+"%"}function lT(n){return String(n)}function Vf(n){return n}function Aa({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Jt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function th(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function ks(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function xle(n){return n==="ArrowUp"||n==="ArrowDown"}function aT(n){return xle(n)||n==="ArrowLeft"||n==="ArrowRight"}function vv(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}class Ho{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Cn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(vv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(vv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(vv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const Tn=Q("txt");class $le{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Tn(),Tn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Tn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Tn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Tn()),this.inputElement.classList.add(Tn("i"));const s=e.createElement("div");s.classList.add(Tn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(Hn,"svg");r.classList.add(Tn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(Hn,"path");o.classList.add(Tn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(Hn,"path");l.classList.add(Tn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(Q("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Tn(void 0,"drg"));return}this.element.classList.add(Tn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Xe(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Kh{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=rt(null),this.view=new $le(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Ho(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Te(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Jt(this.props.get("keyScale"),th(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Jt(this.props.get("keyScale"),th(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const fv=Q("sld");class Vle{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(fv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(fv("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(fv("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Xe(q(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class kle{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Vle(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ho(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(q(Xe(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Jt(this.props.get("keyScale"),ks(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Jt(this.props.get("keyScale"),ks(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const wv=Q("sldtxt");class Sle{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wv());const i=e.createElement("div");i.classList.add(wv("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(wv("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class Rx{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new kle(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Kh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new Sle(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Hi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return zi(null,{max:e.get("max"),min:e.get("min")})}}function Lle(n){return{sliderProps:new Y({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new Y({formatter:rt(n.formatter),keyScale:n.keyScale,pointerScale:rt(n.pointerScale)})}}const Ale={containerUnitSize:"cnt-usz"};function uT(n){return`--${Ale[n]}`}function nh(n){return WM(n)}function mr(n){if(yf(n))return mt(n,nh)}function hs(n,e){if(!n)return;const t=[],i=GM(n,e);i&&t.push(i);const s=YM(n);return s&&t.push(s),new Fh(t)}function hT(n){if(n==="inline"||n==="popup")return n}function Uh(n,e){n.write(e)}const cc=Q("ckb");class Mle{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(cc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(cc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(cc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(cc("w")),i.appendChild(r);const o=Rd(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Tle{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Mle(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}function Dle(n){const e=[],t=bC(n.options);return t&&e.push(t),new Fh(e)}$t({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=mt(e,i=>({options:i.optional.custom(Nd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>oT,constraint:n=>Dle(n.params),writer:n=>Uh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&_p(i,jd);return s?new la(e,{props:new Y({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Tle(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof la?new _C(n.controller):null}});const eo=Q("col");class Ole{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(eo()),t.foldable.bindExpandedClass(this.element,eo(void 0,"expanded")),ki(t.foldable,"completed",La(this.element,eo(void 0,"cpl")));const i=e.createElement("div");i.classList.add(eo("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(eo("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(eo("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(eo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}function Rle(n,e,t){const i=Xe(n/255,0,1),s=Xe(e/255,0,1),r=Xe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function jle(n,e,t){const i=(n%360+360)%360,s=Xe(e/100,0,1),r=Xe(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function Nle(n,e,t){const i=Xe(n/255,0,1),s=Xe(e/255,0,1),r=Xe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function cT(n,e,t){const i=zM(n,360),s=Xe(e/100,0,1),r=Xe(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function Ble(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function Ile(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function Si(n){return[n[0],n[1],n[2]]}function Bd(n,e){return[n[0],n[1],n[2],e]}const Fle={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:Ble,rgb:jle},hsv:{hsl:Ile,hsv:(n,e,t)=>[n,e,t],rgb:cT},rgb:{hsl:Rle,hsv:Nle,rgb:(n,e,t)=>[n,e,t]}};function aa(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function Kle(n,e){return n===e?e:zM(n,e)}function pT(n,e,t){var i;const s=aa(e,t);return[e==="rgb"?Xe(n[0],0,s[0]):Kle(n[0],s[0]),Xe(n[1],0,s[1]),Xe(n[2],0,s[2]),Xe((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function jx(n,e,t,i){const s=aa(e,t),r=aa(e,i);return n.map((o,l)=>o/s[l]*r[l])}function dT(n,e,t){const i=jx(n,e.mode,e.type,"int"),s=Fle[e.mode][t.mode](...i);return jx(s,t.mode,"int",t.type)}class G{static black(){return new G([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=pT(e,t,this.type)}getComponents(e){return Bd(dT(Si(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const sr=Q("colp");class Ule{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(sr()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(sr("hsv"));const s=e.createElement("div");s.classList.add(sr("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(sr("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(sr("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(sr("a"));const a=e.createElement("div");a.classList.add(sr("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(sr("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Hle(n){return n==="int"?"int":n==="float"?"float":void 0}function CC(n){return mt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Hle)}),expanded:e.optional.boolean,picker:e.optional.custom(hT),readonly:e.optional.constant(!1)}))}function Lo(n){return n?.1:1}function mT(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}class PC{constructor(e,t){this.type="float",this.mode=t,this.comps_=pT(e,t,this.type)}getComponents(e){return Bd(dT(Si(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const zle={int:(n,e)=>new G(n,e),float:(n,e)=>new PC(n,e)};function yC(n,e,t){return zle[t](n,e)}function qle(n){return n.type==="float"}function Gle(n){return n.type==="int"}function Yle(n){const e=n.getComponents(),t=aa(n.mode,"int");return new G([Math.round(q(e[0],0,1,0,t[0])),Math.round(q(e[1],0,1,0,t[1])),Math.round(q(e[2],0,1,0,t[2])),e[3]],n.mode)}function Xle(n){const e=n.getComponents(),t=aa(n.mode,"int");return new PC([q(e[0],0,t[0],0,1),q(e[1],0,t[1],0,1),q(e[2],0,t[2],0,1),e[3]],n.mode)}function Nt(n,e){if(n.type===e)return n;if(Gle(n)&&e==="float")return Xle(n);if(qle(n)&&e==="int")return Yle(n);throw ln.shouldNeverHappen()}function Wle(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function zn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const Zle={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function vT(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return Zle[i](t)}function fT(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[zn(e[1],255),zn(e[2],255),zn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Qle(n){const e=fT(n);return e?new G(e,"rgb"):null}function wT(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[zn(e[1],255),zn(e[2],255),zn(e[3],255),zn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Jle(n){const e=wT(n);return e?new G(e,"rgb"):null}function _T(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[vT(e[1]),zn(e[2],100),zn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function eae(n){const e=_T(n);return e?new G(e,"hsl"):null}function bT(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[vT(e[1]),zn(e[2],100),zn(e[3],100),zn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function tae(n){const e=bT(n);return e?new G(e,"hsl"):null}function gT(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function nae(n){const e=gT(n);return e?new G(e,"rgb"):null}function CT(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),q(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),q(parseInt(t[4],16),0,255,0,1)]:null}function iae(n){const e=CT(n);return e?new G(e,"rgb"):null}function PT(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Nx(n){return e=>{const t=PT(e);return t?yC(t,"rgb",n):null}}function yT(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Bx(n){return e=>{const t=yT(e);return t?yC(t,"rgb",n):null}}const sae=[{parser:gT,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:CT,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:fT,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:wT,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:_T,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:bT,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:PT,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:yT,result:{alpha:!0,mode:"rgb",notation:"object"}}];function rae(n){return sae.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function oae(n,e="int"){const t=rae(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Hh(n){const e=[nae,iae,Qle,Jle,eae,tae];n==="int"&&e.push(Nx("int"),Bx("int")),n==="float"&&e.push(Nx("float"),Bx("float"));const t=yle(e);return i=>{const s=t(i);return s?Nt(s,n):null}}function lae(n){const e=Hh("int");if(typeof n!="string")return G.black();const t=e(n);return t??G.black()}function ET(n){const e=Xe(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function EC(n,e="#"){const t=Si(n.getComponents("rgb")).map(ET).join("");return`${e}${t}`}function xC(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(ET).join("");return`${e}${i}`}function xT(n){const e=on(0),t=Nt(n,"int");return`rgb(${Si(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Bc(n){const e=on(2),t=on(0);return`rgba(${Nt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function aae(n){const e=[on(0),bp,bp],t=Nt(n,"int");return`hsl(${Si(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function uae(n){const e=[on(0),bp,bp,on(2)];return`hsla(${Nt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function $T(n,e){const t=on(e==="float"?2:0),i=["r","g","b"],s=Nt(n,e);return`{${Si(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function hae(n){return e=>$T(e,n)}function VT(n,e){const t=on(2),i=on(e==="float"?2:0),s=["r","g","b","a"];return`{${Nt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function cae(n){return e=>VT(e,n)}const pae=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:EC},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:xC},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:xT},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Bc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:aae},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:uae},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:hae(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:cae(e)}],[])];function kT(n){return pae.reduce((e,t)=>e||(Wle(t.format,n)?t.stringifier:null),null)}const wu=Q("apl");class dae{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(wu()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(wu("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(wu("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(wu("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(wu("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new G([t[0],t[1],t[2],0],"rgb"),s=new G([t[0],t[1],t[2],255],"rgb"),r=["to right",Bc(i),Bc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Bc(e);const o=q(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class mae{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new dae(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ho(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new G([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Jt(Lo(!0),ks(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new G([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Jt(Lo(!0),ks(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const dl=Q("coltxt");function vae(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}class fae{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(dl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(dl("m")),this.modeElem_=vae(e),this.modeElem_.classList.add(dl("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(dl("mm")),s.appendChild(Rd(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(dl("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),_s(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){JM(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(dl("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}}function wae(n){return on(n==="float"?2:0)}function _ae(n,e,t){const i=aa(n,e)[t];return new Dd({min:0,max:i})}function bae(n,e,t){return new Kh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:Y.fromObject({formatter:wae(e.colorType),keyScale:Lo(!1),pointerScale:e.colorType==="float"?.01:1}),value:rt(0,{constraint:_ae(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function gae(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Tr,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=bae(n,t,i);return Aa({primary:e.value,secondary:s.value,forward(r){return Nt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Nt(r,e.colorType).getComponents(l);u[i]=o;const h=yC(Bd(Si(u),u[3]),l,e.colorType);return Nt(h,"int")}}),s})}function Cae(n,e){const t=new gC(n,{parser:Hh("int"),props:Y.fromObject({formatter:EC}),value:rt(G.black()),viewProps:e.viewProps});return Aa({primary:e.value,secondary:t.value,forward:i=>new G(Si(i.getComponents()),i.mode),backward:(i,s)=>new G(Bd(Si(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function Pae(n){return n!=="hex"}class yae{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=rt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new fae(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return Pae(t)?gae(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):Cae(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}}const _v=Q("hpl");class Eae{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(_v()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(_v("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(_v("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=xT(new G([t,100,100],"hsv"));const i=q(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class xae{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Eae(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ho(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=q(Xe(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new G([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Jt(Lo(!1),ks(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new G([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Jt(Lo(!1),ks(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const bv=Q("svp"),Ix=64;class $ae{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(bv()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=Ix,i.width=Ix,i.classList.add(bv("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(bv("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=Noe(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const m=q(c,0,s,0,100),d=q(h,0,r,100,0),f=cT(i[0],m,d),p=(h*s+c)*4;l[p]=f[0],l[p+1]=f[1],l[p+2]=f[2],l[p+3]=255}e.putImageData(o,0,0);const a=q(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=q(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}}class Vae{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new $ae(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ho(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=q(e.point.x,0,e.bounds.width,0,100),s=q(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new G([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){aT(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=Lo(!1),l=Jt(o,ks(e)),a=Jt(o,th(e));l===0&&a===0||this.value.setRawValue(new G([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Lo(!1),i=Jt(t,ks(e)),s=Jt(t,th(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class kae{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new xae(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Vae(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new mae(e,{value:this.value,viewProps:this.viewProps}),text:new Kh(e,{parser:Tr,props:Y.fromObject({pointerScale:.01,keyScale:.1,formatter:on(2)}),value:rt(0,{constraint:new Dd({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Aa({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new G(r,i.mode)}}),this.textsC_=new yae(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Ule(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const gv=Q("colsw");class Sae{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(gv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(gv("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(gv("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=xC(e)}onValueChange_(){this.update_()}}class Lae{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Sae(e,{value:this.value,viewProps:this.viewProps})}}class $C{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Bh.create(t.expanded),this.swatchC_=new Lae(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new gC(e,{parser:t.parser,props:Y.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Ole(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new rT(e,{viewProps:this.viewProps}):null;const s=new kae(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Aa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),wC(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=eT(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!cC(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Aae(n){return Si(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function Mae(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function Tae(n){return new G([n>>16&255,n>>8&255,n&255],"rgb")}function Dae(n){return new G([n>>24&255,n>>16&255,n>>8&255,q(n&255,0,255,0,1)],"rgb")}function Oae(n){return typeof n!="number"?G.black():Tae(n)}function Rae(n){return typeof n!="number"?G.black():Dae(n)}function Ic(n,e){return typeof n!="object"||Te(n)?!1:e in n&&typeof n[e]=="number"}function ST(n){return Ic(n,"r")&&Ic(n,"g")&&Ic(n,"b")}function LT(n){return ST(n)&&Ic(n,"a")}function AT(n){return ST(n)}function VC(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function Fx(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function jae(n){const e=kT(n);return e?(t,i)=>{Uh(t,e(i))}:null}function Nae(n){const e=n?Mae:Aae;return(t,i)=>{Uh(t,e(i))}}function Bae(n,e,t){const s=Nt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function Iae(n,e,t){const s=Nt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function Fae(n,e){return(t,i)=>{n?Bae(t,i,e):Iae(t,i,e)}}function Kae(n){var e;return!!(!((e=n==null?void 0:n.color)===null||e===void 0)&&e.alpha)}function Uae(n){return n?e=>xC(e,"0x"):e=>EC(e,"0x")}function Hae(n){return"color"in n||n.view==="color"}$t({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!Hae(e))return null;const t=CC(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:Kae(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?Rae:Oae,equals:VC,writer:n=>Nae(n.params.supportsAlpha)},controller:n=>{var e,t;return new $C(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:Uae(n.params.supportsAlpha),parser:Hh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function zae(n,e){if(!AT(n))return Nt(G.black(),e);if(e==="int"){const t=Fx(n);return new G(t,"rgb")}if(e==="float"){const t=Fx(n);return new PC(t,"rgb")}return Nt(G.black(),"int")}function qae(n){return LT(n)}function Gae(n){return e=>{const t=zae(e,n);return Nt(t,"int")}}function Yae(n,e){return t=>n?VT(t,e):$T(t,e)}$t({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!AT(n))return null;const i=CC(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=mT(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>Gae(n.params.colorType),equals:VC,writer:n=>Fae(qae(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=LT(n.initialValue);return new $C(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:Yae(i,n.params.colorType),parser:Hh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});$t({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=oae(n,mT(e));if(!t)return null;const i=kT(t);if(!i)return null;const s=CC(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>lae,equals:VC,writer:n=>{const e=jae(n.params.format);if(!e)throw ln.notBindable();return e}},controller:n=>{var e,t;return new $C(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Hh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});class kC{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}}const Kx=Q("pndtxt");class Xae{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Kx()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(Kx("a")),s.appendChild(i.element),this.element.appendChild(s)})}}function Wae(n,e,t){return new Kh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:rt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class SC{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>Wae(e,t,s)),this.acs_.forEach((i,s)=>{Aa({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new Xae(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}}class Zae extends hC{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}function Qae(n,e){const t=[],i=GM(n,e);i&&t.push(i);const s=YM(n);s&&t.push(s);const r=bC(n.options);return r&&t.push(r),new Fh(t)}$t({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=mt(e,i=>Object.assign(Object.assign({},WM(i)),{options:i.optional.custom(Nd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>HM,constraint:n=>Qae(n.params,n.initialValue),writer:n=>Uh},controller:n=>{const e=n.value,t=n.constraint,i=t&&_p(t,jd);if(i)return new la(n.document,{props:new Y({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=XM(n.params,e.rawValue),r=t&&_p(t,Dd);return r?new Rx(n.document,Object.assign(Object.assign({},Lle(Object.assign(Object.assign({},s),{keyScale:rt(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Tr,value:e,viewProps:n.viewProps})):new Kh(n.document,{parser:Tr,props:Y.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof Rx?new Zae(n.controller):n.controller.valueController instanceof la?new _C(n.controller):null}});class Er{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Te(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const MT={toComponents:n=>n.getComponents(),fromComponents:n=>new Er(...n)},ml=Q("p2d");class Jae{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ml()),t.viewProps.bindClassModifiers(this.element),_s(t.expanded,La(this.element,ml(void 0,"expanded")));const i=e.createElement("div");i.classList.add(ml("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(ml("b")),s.appendChild(Rd(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(ml("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(ml("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}const rr=Q("p2dp");class eue{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(rr()),t.layout==="popup"&&this.element.classList.add(rr(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(rr("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(Hn,"svg");s.classList.add(rr("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(Hn,"line");r.classList.add(rr("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(Hn,"line");o.classList.add(rr("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(Hn,"line");l.classList.add(rr("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(rr("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=q(e,-i,+i,0,100),r=q(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Ux(n,e,t){return[Jt(e[0],ks(n)),Jt(e[1],th(n))*(t?1:-1)]}class tue{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new eue(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ho(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=q(e.point.x,0,e.bounds.width,-i,+i),r=q(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Er(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){aT(e.key)&&e.preventDefault();const[t,i]=Ux(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Er(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=Ux(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class nue{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Bh.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new rT(e,{viewProps:this.viewProps}):null;const r=new tue(e,{layout:t.pickerLayout,props:new Y({invertsY:rt(t.invertsY),max:rt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new SC(e,{assembly:MT,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new Jae(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Aa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),wC(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=eT(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!cC(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function iue(n){return Er.isObject(n)?new Er(n.x,n.y):new Er}function sue(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function rue(n,e){return new kC({assembly:MT,components:[hs(Object.assign(Object.assign({},n),n.x),e.x),hs(Object.assign(Object.assign({},n),n.y),e.y)]})}function Hx(n,e){var t,i;if(!Te(n.min)||!Te(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=qM(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function oue(n,e){var t,i;const s=Hx(So(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=Hx(So(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function lue(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}$t({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Er.isObject(n))return null;const t=mt(e,i=>Object.assign(Object.assign({},nh(i)),{expanded:i.optional.boolean,picker:i.optional.custom(hT),readonly:i.optional.constant(!1),x:i.optional.custom(mr),y:i.optional.object(Object.assign(Object.assign({},nh(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>iue,constraint:n=>rue(n.params,n.initialValue),equals:Er.equals,writer:()=>sue},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new nue(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return aC({constraint:r.components[a],initialValue:l,params:So(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:lue(n.params),max:oue(n.params,s.rawValue),parser:Tr,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});class Il{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Te(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const TT={toComponents:n=>n.getComponents(),fromComponents:n=>new Il(...n)};function aue(n){return Il.isObject(n)?new Il(n.x,n.y,n.z):new Il}function uue(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function hue(n,e){return new kC({assembly:TT,components:[hs(Object.assign(Object.assign({},n),n.x),e.x),hs(Object.assign(Object.assign({},n),n.y),e.y),hs(Object.assign(Object.assign({},n),n.z),e.z)]})}$t({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Il.isObject(n))return null;const t=mt(e,i=>Object.assign(Object.assign({},nh(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(mr),y:i.optional.custom(mr),z:i.optional.custom(mr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>aue,constraint:n=>hue(n.params,n.initialValue),equals:Il.equals,writer:n=>uue},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new SC(n.document,{assembly:TT,axes:e.rawValue.getComponents().map((s,r)=>{var o;return aC({constraint:t.components[r],initialValue:s,params:So(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Tr,value:e,viewProps:n.viewProps})}});class Fl{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Te(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const DT={toComponents:n=>n.getComponents(),fromComponents:n=>new Fl(...n)};function cue(n){return Fl.isObject(n)?new Fl(n.x,n.y,n.z,n.w):new Fl}function pue(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function due(n,e){return new kC({assembly:DT,components:[hs(Object.assign(Object.assign({},n),n.x),e.x),hs(Object.assign(Object.assign({},n),n.y),e.y),hs(Object.assign(Object.assign({},n),n.z),e.z),hs(Object.assign(Object.assign({},n),n.w),e.w)]})}$t({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Fl.isObject(n))return null;const t=mt(e,i=>Object.assign(Object.assign({},nh(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(mr),x:i.optional.custom(mr),y:i.optional.custom(mr),z:i.optional.custom(mr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>cue,constraint:n=>due(n.params,n.initialValue),equals:Fl.equals,writer:n=>pue},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new SC(n.document,{assembly:DT,axes:e.rawValue.getComponents().map((s,r)=>{var o;return aC({constraint:t.components[r],initialValue:s,params:So(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Tr,value:e,viewProps:n.viewProps})}});function mue(n){const e=[],t=bC(n.options);return t&&e.push(t),new Fh(e)}$t({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=mt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Nd)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>lT,constraint:n=>mue(n.params),writer:n=>Uh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&_p(i,jd);return s?new la(e,{props:new Y({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new gC(e,{parser:r=>r,props:Y.fromObject({formatter:Vf}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof la?new _C(n.controller):null}});const Id={monitor:{defaultInterval:200,defaultRows:3}},zx=Q("mll");class vue{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(zx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(zx("i")),i.style.height=`calc(var(${uT("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class LC{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new vue(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const qx=Q("sgl");class fue{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(qx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(qx("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class AC{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new fue(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}$t({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=mt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>oT},controller:n=>{var e;return n.value.rawValue.length===1?new AC(n.document,{formatter:Ox,value:n.value,viewProps:n.viewProps}):new LC(n.document,{formatter:Ox,rows:(e=n.params.rows)!==null&&e!==void 0?e:Id.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});class wue extends hC{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const or=Q("grl");class _ue{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(or()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(Hn,"svg");i.classList.add(or("g")),i.style.height=`calc(var(${uT("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(Hn,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(or("t"),Q("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const m=q(c,0,t,0,e.width),d=q(h,i,s,e.height,0);r.push([m,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(or("t","a"));return}const a=q(this.cursor_.rawValue,0,t,0,e.width),u=q(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(or("t","a"))||(o.classList.add(or("t","a"),or("t","in")),wp(o),o.classList.remove(or("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class OT{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=rt(-1),this.view=new _ue(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!cC(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Ho(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Hi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return zi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(q(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(q(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function kf(n){return Te(n.format)?on(2):n.format}function bue(n){var e;return n.value.rawValue.length===1?new AC(n.document,{formatter:kf(n.params),value:n.value,viewProps:n.viewProps}):new LC(n.document,{formatter:kf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Id.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function gue(n){var e,t,i;return new OT(n.document,{formatter:kf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Id.monitor.defaultRows,props:Y.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function Gx(n){return n.view==="graph"}$t({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=mt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>Gx(n)?64:1,reader:n=>HM},controller:n=>Gx(n.params)?gue(n):bue(n),api:n=>n.controller.valueController instanceof OT?new wue(n.controller):null});$t({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=mt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>lT},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new LC(n.document,{formatter:Vf,rows:(e=n.params.rows)!==null&&e!==void 0?e:Id.monitor.defaultRows,value:t,viewProps:n.viewProps}):new AC(n.document,{formatter:Vf,value:t,viewProps:n.viewProps})}});class Yx{constructor(){this.drawer=e=>`L ${e[0]} ${e[1]}`}}class Cue{constructor(){this.drawer=(e,t,i)=>{const[s,r]=this.controlPoint(i[t-1],i[t-2],e),[o,l]=this.controlPoint(e,i[t-1],i[t+1],!0);return`C ${s},${r} ${o},${l} ${e[0]},${e[1]}`}}controlPoint(e,t,i,s){const r=t||e,o=i||e,l=.2,a=o[0]-r[0],u=o[1]-r[1],h=Math.sqrt(Math.pow(a,2)+Math.pow(u,2))*l,c=Math.atan2(u,a)+(s?Math.PI:0),m=e[0]+Math.cos(c)*h,d=e[1]+Math.sin(c)*h;return[m,d]}}const Xx=Q("wfm");class Pue{constructor(e,t){switch(this.element=e.createElement("div"),this.element.classList.add(Xx()),t.viewProps.bindClassModifiers(this.element),this.svgElem=e.createElementNS(Hn,"svg"),this.svgElem.classList.add(Xx("g")),this.element.appendChild(this.svgElem),this.pathElem=e.createElementNS(Hn,"path"),this.svgElem.appendChild(this.pathElem),this.props=t.props,this.value=t.value,this.value.emitter.on("change",this.onValueChange_.bind(this)),this.props.get("lineStyle")){case"linear":this.lineDrawerProvider=new Yx;break;case"bezier":this.lineDrawerProvider=new Cue;break;default:this.lineDrawerProvider=new Yx;break}this.refresh(),t.viewProps.handleDispose(()=>{this.value.emitter.off("change",this.onValueChange_)})}svgPath(e,t){return e.reduce((s,r,o,l)=>o===0?`M ${r[0]},${r[1]}`:`${s} ${t(r,o,l)}`,"")}refresh(){var e,t;const i=this.svgElem.getBoundingClientRect(),s=this.value.rawValue[0];if(s){const r=(e=this.props.get("min"))!==null&&e!==void 0?e:Math.min(...s)-1,o=(t=this.props.get("max"))!==null&&t!==void 0?t:Math.max(...s)+1,l=o-r,a=[],u=s.length-1,h=s.length>32?0:i.width/(s.length-1),c=l>50?0:i.height/l;this.element.style.backgroundSize=`${h}px ${c}px`,s.forEach((d,f)=>{if(d===void 0)return;const p=q(f,0,u,0,i.width),v=q(d,r,o,i.height,0);a.push([Math.floor(p),Math.floor(v)])});const m=this.svgPath(a,this.lineDrawerProvider.drawer);this.pathElem.setAttributeNS(null,"d",m)}}onValueChange_(){this.refresh()}}class yue{constructor(e,t){this.value=t.value,this.props=t.props,this.viewProps=t.viewProps,this.viewProps.handleDispose(()=>{}),this.view=new Pue(e,{value:this.value,viewProps:this.viewProps,props:this.props})}}function Eue(n){return"view"in n&&n.view==="waveform"}function Wx(n){return typeof n=="object"?"length"in n:!1}$t({id:"monitor-waveform",type:"monitor",accept:(n,e)=>{if(!Wx(n))return null;const t=mt(e,i=>({max:i.optional.number,min:i.optional.number,style:i.optional.custom(s=>s==="linear"||s==="bezier"?s:void 0),view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>Eue(n)?64:1,reader:n=>e=>Wx(e)?e:[]},controller:n=>{var e,t,i;return new yue(n.document,{props:Y.fromObject({max:(e="max"in n.params?n.params.max:null)!==null&&e!==void 0?e:null,min:(t="min"in n.params?n.params.min:null)!==null&&t!==void 0?t:null,lineStyle:(i="style"in n.params?n.params.style:null)!==null&&i!==void 0?i:"linear"}),value:n.value,viewProps:n.viewProps})}});function Zx(n,e,t){const i=n.slice();return i[7]=e[t],i[9]=t,i}function xue(n){let e,t;return e=new iD({props:{enableDamping:!0,enablePan:!0,enableZoom:!0}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p:ft,i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function Qx(n){let e,t;return e=new t$({props:{linearVelocity:[0,5,0],$$slots:{default:[$ue]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function $ue(n){let e,t,i,s;return e=new n$({props:{shape:"ball",args:[1],mass:10}}),i=new sD({}),{c(){M(e.$$.fragment),t=Dn(),M(i.$$.fragment)},l(r){T(e.$$.fragment,r),t=On(r),T(i.$$.fragment,r)},m(r,o){D(e,r,o),z(r,t,o),D(i,r,o),s=!0},p:ft,i(r){s||(g(e.$$.fragment,r),g(i.$$.fragment,r),s=!0)},o(r){C(e.$$.fragment,r),C(i.$$.fragment,r),s=!1},d(r){r&&k(t),O(e,r),O(i,r)}}}function Vue(n){let e,t,i,s;return e=new n$({props:{shape:"ball",args:[1],mass:n[3][n[0]].strength}}),i=new rD({}),{c(){M(e.$$.fragment),t=Dn(),M(i.$$.fragment)},l(r){T(e.$$.fragment,r),t=On(r),T(i.$$.fragment,r)},m(r,o){D(e,r,o),z(r,t,o),D(i,r,o),s=!0},p(r,o){const l={};o&1&&(l.mass=r[3][r[0]].strength),e.$set(l)},i(r){s||(g(e.$$.fragment,r),g(i.$$.fragment,r),s=!0)},o(r){C(e.$$.fragment,r),C(i.$$.fragment,r),s=!1},d(r){r&&k(t),O(e,r),O(i,r)}}}function kue(n){let e,t;return e=new t$({props:{linearVelocity:[Math.random()*10,Math.random()*10,0],position:[Math.random()*100-50,Math.random()*100-50,0],$$slots:{default:[Vue]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&1025&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function Jx(n){let e,t;return e=new Cv.Group({props:{position:n[4][n[9]+1],$$slots:{default:[kue]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&1025&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function Sue(n){let e,t,i,s,r,o;function l(c){n[5](c)}let a={values:[1,2,3]};n[1]!==void 0&&(a.value=n[1]),e=new $q({props:a}),R.push(()=>F(e,"value",l));function u(c){n[6](c)}let h={label:"Show Earth"};return n[2]!==void 0&&(h.value=n[2]),s=new HU({props:h}),R.push(()=>F(s,"value",u)),{c(){M(e.$$.fragment),i=Dn(),M(s.$$.fragment)},l(c){T(e.$$.fragment,c),i=On(c),T(s.$$.fragment,c)},m(c,m){D(e,c,m),z(c,i,m),D(s,c,m),o=!0},p(c,m){const d={};!t&&m&2&&(t=!0,d.value=c[1],I(()=>t=!1)),e.$set(d);const f={};!r&&m&4&&(r=!0,f.value=c[2],I(()=>r=!1)),s.$set(f)},i(c){o||(g(e.$$.fragment,c),g(s.$$.fragment,c),o=!0)},o(c){C(e.$$.fragment,c),C(s.$$.fragment,c),o=!1},d(c){c&&k(i),O(e,c),O(s,c)}}}function Lue(n){let e,t;return e=new B2({props:{userExpandable:!1,exanded:!0,title:"Number of Bodies",$$slots:{default:[Sue]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&1030&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function Aue(n){let e,t,i,s,r,o,l,a,u,h;e=new Cv.PerspectiveCamera({props:{"position.y":20,"position.z":100,makeDefault:!0,fov:70,far:1e5,$$slots:{default:[xue]},$$scope:{ctx:n}}}),e.$on("create",Mue),i=new Cv.GridHelper({props:{args:[100]}});let c=n[2]&&Qx(n),m=jC(Array.from({length:n[1]})),d=[];for(let p=0;p<m.length;p+=1)d[p]=Jx(Zx(n,m,p));const f=p=>C(d[p],1,1,()=>{d[p]=null});return l=new nD({props:{range:n[3][n[0]].range,gravitationalConstant:n[3][n[0]].gravitationalConstant,strength:n[3][n[0]].strength,gravityType:n[0]}}),u=new lne({props:{position:"fixed",title:"Playground",userExpandable:!0,$$slots:{default:[Lue]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment),t=Dn(),M(i.$$.fragment),s=Dn(),c&&c.c(),r=Dn();for(let p=0;p<d.length;p+=1)d[p].c();o=Dn(),M(l.$$.fragment),a=Dn(),M(u.$$.fragment)},l(p){T(e.$$.fragment,p),t=On(p),T(i.$$.fragment,p),s=On(p),c&&c.l(p),r=On(p);for(let v=0;v<d.length;v+=1)d[v].l(p);o=On(p),T(l.$$.fragment,p),a=On(p),T(u.$$.fragment,p)},m(p,v){D(e,p,v),z(p,t,v),D(i,p,v),z(p,s,v),c&&c.m(p,v),z(p,r,v);for(let w=0;w<d.length;w+=1)d[w]&&d[w].m(p,v);z(p,o,v),D(l,p,v),z(p,a,v),D(u,p,v),h=!0},p(p,[v]){const w={};if(v&1024&&(w.$$scope={dirty:v,ctx:p}),e.$set(w),p[2]?c?v&4&&g(c,1):(c=Qx(p),c.c(),g(c,1),c.m(r.parentNode,r)):c&&(Ul(),C(c,1,1,()=>{c=null}),Hl()),v&27){m=jC(Array.from({length:p[1]}));let x;for(x=0;x<m.length;x+=1){const P=Zx(p,m,x);d[x]?(d[x].p(P,v),g(d[x],1)):(d[x]=Jx(P),d[x].c(),g(d[x],1),d[x].m(o.parentNode,o))}for(Ul(),x=m.length;x<d.length;x+=1)f(x);Hl()}const _={};v&1&&(_.range=p[3][p[0]].range),v&1&&(_.gravitationalConstant=p[3][p[0]].gravitationalConstant),v&1&&(_.strength=p[3][p[0]].strength),v&1&&(_.gravityType=p[0]),l.$set(_);const A={};v&1030&&(A.$$scope={dirty:v,ctx:p}),u.$set(A)},i(p){if(!h){g(e.$$.fragment,p),g(i.$$.fragment,p),g(c);for(let v=0;v<m.length;v+=1)g(d[v]);g(l.$$.fragment,p),g(u.$$.fragment,p),h=!0}},o(p){C(e.$$.fragment,p),C(i.$$.fragment,p),C(c),d=d.filter(Boolean);for(let v=0;v<d.length;v+=1)C(d[v]);C(l.$$.fragment,p),C(u.$$.fragment,p),h=!1},d(p){p&&(k(t),k(s),k(r),k(o),k(a)),O(e,p),O(i,p),c&&c.d(p),eD(d,p),O(l,p),O(u,p)}}}const Mue=({ref:n})=>{n.lookAt(0,-10,0)};function Tue(n,e,t){let{type:i="static"}=e;const s={static:{type:"static",strength:3,range:100,gravitationalConstant:void 0}};let r=1,o=!0;const l={1:[-50,0,60],2:[0,10,-20],3:[50,0,60]};function a(h){r=h,t(1,r)}function u(h){o=h,t(2,o)}return n.$$set=h=>{"type"in h&&t(0,i=h.type)},[i,r,o,s,l,a,u]}class Due extends Ft{constructor(e){super(),Kt(this,e,Tue,Aue,It,{type:0})}}function Oue(n){let e,t;return e=new Due({}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function Rue(n){let e,t;return e=new aD({props:{gravity:[0,0,0],$$slots:{default:[Oue]},$$scope:{ctx:n}}}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p(i,s){const r={};s&2&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}function jue(n){let e,t,i,s;return i=new oD({props:{$$slots:{default:[Rue]},$$scope:{ctx:n}}}),{c(){e=li("article"),t=li("div"),M(i.$$.fragment),this.h()},l(r){e=ai(r,"ARTICLE",{class:!0});var o=ui(e);t=ai(o,"DIV",{id:!0,class:!0});var l=ui(t);T(i.$$.fragment,l),l.forEach(k),o.forEach(k),this.h()},h(){dc(t,"id","canvas-wrapper"),dc(t,"class","sticky top-0 min-w-0 h-screen"),dc(e,"class","relative flex-col hidden lg:flex")},m(r,o){z(r,e,o),tD(e,t),D(i,t,null),s=!0},p(r,[o]){const l={};o&2&&(l.$$scope={dirty:o,ctx:r}),i.$set(l)},i(r){s||(g(i.$$.fragment,r),s=!0)},o(r){C(i.$$.fragment,r),s=!1},d(r){r&&k(e),O(i)}}}function Nue(n,e,t){let i;return Kl(n,uD,s=>t(0,i=s)),n.$$.update=()=>{n.$$.dirty&1&&i&&lD.ScrollTrigger.refresh()},[i]}class Bue extends Ft{constructor(e){super(),Kt(this,e,Nue,jue,It,{})}}function Iue(n){let e,t;return e=new Bue({}),{c(){M(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,s){D(e,i,s),t=!0},p:ft,i(i){t||(g(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){O(e,i)}}}class KPe extends Ft{constructor(e){super(),Kt(this,e,null,Iue,It,{})}}export{KPe as component};
